{"L2Jsb2cvMjAxNS8xMi9jb250ZW5pZG9ycw==":{"date":1449014400000,"title":"Docker: crea, desplega i executa aplicacions en contenidors","description":"Docker és una tecnologia que ha revolucionat el desplegament d’aplicacions i de programari degut a la seva senzillesa, facilitat d'ús i velocitat de  desplegament.","sections":["Blog","home"],"blog_tags":["desplegament","contenidors","docker"],"imatge":"/images/bloc/docker/large_h-dark-trans.png","path":"/blog/2015/12/contenidors","content":"Des de la Unitat d'Arquitectura de CTTI estem avaluant **Docker** com a tecnologia de desplegament d'aplicacions, de cara a utilitzar-la en el futur als clouds de la Generalitat.\n\nDocker és una tecnologia que ha revolucionat el desplegament d’aplicacions i de programari degut a la seva senzillesa, facilitat d'ús i velocitat de  desplegament.\n\nEl seu fonament és l’ús de plantilles, anomedades \"imatges\", que inclouen tant el sistema operatiu com les dependències necessàries per a executar les aplicacions. Aquestes imatges són: \n\n* **Extensibles**, podent partir d'imatges ja creades, i poder-hi afegir les característiques requerides a nivell de programari. \n\n* **Exportables**: la definició de la imatge consisteix en un fitxer de text (Dockerfile) que pot ser utilitzat per a crear la imatge a qualsevol ordinador/servidor i sistema operatiu.\n\n* **Lleugeres** en comparació amb les màquines virtuals tradicionals\n\nA partir de les imatges Docker s'arrenquen els contenidors. Els contenidors són instàncies executades d'una imatge concreta, arrencada amb una sèrie de característiques. Per exemple, una contenidor es pot arrencar amb aïllament de CPU i RAM, i amb volums de dades compartits entre el host i el contenidor per a realitzar certes operacions. \n\nDegut a que els contenidors no arrenquen un sistema operatiu complet, a diferència de les màquines virtuals, el seu _footprint_ és molt petit i són capaços d'arrencar en pocs segons, aspecte que permet l'escalat automàtic d'aplicacions de manera molt senzilla i sota demanda.\n\n## Comparativa entre VM i Docker\n\n![comparativa vm i docker](/images/bloc/docker/vm-vs-container2.png)\n\nUn altre aspecte a destacar és que els contenidors, i concretament Docker, és una tecnologia adoptada a la majoria de cloud públics (Amazon, Google, Azure, Bluemix, ...), fent dels contenidors una tecnologia portable i àmpliament suportada, junt amb un, cada cop més gran, ecosistema d'eines per a governar el cicle de vida dels contenidors i les imatges.\n\nA més, els fabricants de software també proporcionen imatges Docker oficials, donant certes garanties sobre la tecnologia i la manera de fer servir els seus productes.\n\nDes de la Unitat d'Arquitectura, una de les imatges que hem creat és la de **\"Apache GICAR\"**. Aquesta imatge ens permet aixecar instàncies d'Apache amb l'agent de Siteminder instal·lat i configurat en un segon (literalment), amb polítiques i configuracions diverses que es passen al contenidor en el moment de l'arrencada.\n\n","objectID":"L2Jsb2cvMjAxNS8xMi9jb250ZW5pZG9ycw=="},"L2Jsb2cvMjAxNS8xMi9sbGVuZ3VhdGdlcw==":{"date":1449100800000,"title":"Nous llenguatges i entorns d'execució: Node.js i Golang","description":"Tecnologies de desenvolupament i altres opcions davant noves necessitats dels projectes","sections":["Blog","home"],"blog_tags":["desenvolupament"],"imatge":"/images/bloc/nodejs_golang.png","path":"/blog/2015/12/llenguatges","content":"Des de la Unitat d'Arquitectura fem un seguiment de noves tecnologies de desenvolupament, per a avaluar el seu encaix dins la Generalitat de Catalunya i tenir altres opcions davant noves necessitats dels projectes. \n\nUs presentem dues que tenim al nostre radar i amb les que ja hem fet alguns projectes:\n\n## Node.js\n\n* basat en la màquina de Google Chrome V8\n* javascript\n* model asíncron\n* un únic thread\n* la comunitat que més ha crescut als últims anys\n* grans empreses l'han adoptat per als seus serveis migrant-los de piles tecnològiques antigues\n* Node.js Foundation (https://nodejs.org/en/foundation/members/): fabricants i proveïdors de serveis formen part de la fundació\n\n\n### Experiències a la Generalitat\n\n* Serveis oberts (http://serveisoberts.gencat.cat ): \n\t* és una API d'accés a dades obertes de la Generalitat construïda sobre Node.js i MongoDB.  \n\t* exposa una API privada per a la sincronització de dades des dels backends i una API pública de consulta\n\t* inclou un \"explorador de dades\" per a cada col·lecció, per a poder visualitzar les dades en un format més amigable (http://serveisoberts.gencat.cat/equipaments/explorer)\n\n* Microservei per a les aplicacions de mobilitat per a comprovar versions i compatibilitat \n\n* Diccionari clínic de l'ICS\n\nResultat: alta productivitat de l'equip de desenvolupament, corba d'aprenentatge relativament petita i gran rendiment de la plataforma.\n\n\n## Golang\n\n* llenguatge que va sortir dels laboratoris de Google\n* intenta millorar aspectes de baix nivell que amb C són més difícils de realitzar\n* molt bona gestió de threads i concurrència\n* \"garbage collected\"\n* compilat\n* cross-compiling: des d'un mateix entorn es pot compilar per a diverses arquitectures\n\n### Experiències a la Generalitat\n\nHem desenvolupat una eina orientada a avaluar la qualitat de les infraestructures lliurades. \n\nEn aquest cas, ens permet avaluar si totes les connectivitats necessàries s'han obert, mitjançant el lliurament d'un fitxer de configuració en format YAML adaptat al projecte concret. L'eina genera un informe de resultats que inclou si les diferents connectivitats han estat satisfactòries o no, la data, hora i host en el que s'ha executat, així com un hash per a validar la integritat de l'informe generat.\n\nL'eina s'afegeix a totes les plantilles d'imatges virtuals de tots els CPDs, de manera que només s'ha d'afegir el fitxer de configuració i executar l'eina. \n\nCom que l'eina ha de córrer en diferents sistemes operatius i havia de ser compilada - per a evitar dependències externes - i el més lleugera possible, vàrem pensar que Golang podria ser una bona oportunitat. \n\nResultat: alta productivitat i posada en funcionament realment ràpida.\n","objectID":"L2Jsb2cvMjAxNS8xMi9sbGVuZ3VhdGdlcw=="},"L2Jsb2cvMjAxNS8xMi9wcmluY2lwaXM=":{"date":1448928000000,"title":"Principis d'Arquitectura de Sistemes d'Informació","description":"Recomanacions a seguir en la construcció de sistemes d'informació a la Generalitat de Catalunya","blog_tags":["bones pràctiques"],"sections":["Blog","home"],"aliases":["/principis","/principis/","/bloc/principis","/bloc/2015/11/principis","/arquitectura/principis","/arquitectura/2015/11/principis"],"imatge":"/images/bloc/principis.png","langs":["ca","es"],"path":"/blog/2015/12/principis","content":"## **Principis sobre el disseny d'aplicacions**\n\n1.  **Segregació de funcions/responsabilitats**. Les aplicacions han d'estar estructuralment dividides en blocs independents per funcionalitats, processos de negoci o serveis, per tal d'evitar els **monòlits**.  \n\n    Aquest principi és d'aplicació a totes les capes. Una aplicació tipus pot dividir-se fàcilment, per exemple, en els següents mòduls:\n\n    *   Públic general (internet)\n    *   Col·laboradors externs (extranet)\n    *   Backoffice (intranet)\n    *   Processos batch\n    *   Extraccions (ETL)\n\n1.  La **presentació** (client/frontend) i el **backend/negoci** estaran **desacoblats**.\n\n1.  **Orientació a serveis**. Cada cop més, les aplicacions poden ser **consumides externament** o bé han d'**integrar-se amb 3rs**. Els backend han d'**exposar** la seva funcionalitat de negoci via serveis per facilitar-ho. \n\n1.  Emmagatzemar a la **memòria cau** tot allò que sigui possible. Per fer-ho, utilitzar la tecnologia que millor s'adapti tant a client (html5 cache, localstorage , etc.) com a servidor (Redis, Varnish, Memcache, caché personalitzada, etc.)\n\n1.  Tenir present sempre la **compatibilitat cap a enrere dels serveis**: si s'expossa una **API REST** i s'actualitza un servei, que sigui compatible amb versions anteriors per a evitar actualitzacions innecessàries als consumidors i d'aquesta manera poder evolucionar el servei lliurement.\n\n1.  Dissenyar l'aplicació o servei tenint present els conceptes d'**elasticitat** (enlloc de per a suportar els pics de càrrega), d'**alta disponibilitat**, d'**alta concurrència** i **_zero downtime_**.\n\n1.  Pensar en la **portabilitat de les aplicacions**, això és, que es puguin moure amb facilitat d'un cloud privat a un cloud públic, per exemple.\n\n1.  A l'hora de dissenyar un sistema cal incorporar **aspectes qualitatius al cicle de vida**:\n\n\t*   Proves per a verificar la qualitat o requisits no funcionals del sistema.\n\t*   Documentació detallada del projecte (descripció d'arquitectura, document funcional, manual de desplegament, manual d'explotació, …).\n\t*   Control de versions. El sistema, en el seu conjunt, ha de ser tractat com un producte amb les seves versions majors, menors, etc.\n\t*   Desplegament automatitzat, execució de proves automàtiques que verifiquin la instal·lació i integració contínua.\n\n10.  Són d'aplicació en aquest apartat els principis que estableix la **[Guia Web Gencat](http://guiaweb.gencat.cat/ca/inici/)**\n\n## **Principis sobre la tecnologia**\n\n1.  **Utilitzar la tecnologia que millor encaixi al cas d'ús**, si cal combinant tecnologies, ja que en un mateix sistema en poden conviure diverses.\n\n1.  Els **serveis** (backend) exposaran el seu negoci mitjançant **REST** i en format **JSON**.\n\n1.  En el cas d'aplicacions web, la presentació estarà construïda amb **tecnologies estàtiques** (html5/javascript/css) i **consumirà els serveis** que li proporcioni el backend. \n\n1.  Davant solucions estàndards s'utilitzaran preferentment les tecnologies del **[Full de Ruta](https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/).** Aquest fet no exclou que per a noves solucions es puguin utilitzar altres tecnologies, que eventualment passaran a formar-ne part.\n\n1.  Des de les unitats d'Arquitectura s'ha de fer un **seguiment de noves tecnologies**, per a avaluar el seu encaix i tenir altres opcions davant noves necessitats dels projectes (per exemple, [nous llenguatges i frameworks](http://canigo.ctti.gencat.cat/blog/2015/12/llenguatges/) o [provisió d'infraestructura](http://canigo.ctti.gencat.cat/blog/2015/12/contenidors/)).\n\n1.  Les versions de les diferents peces (productes, llibreries, etc) que componen un sistema han de ser el més estable possible, d'aquí que es recomani l'ús de **versions LTS (Long-Term Support)** o, si de cas hi manca, GA (General Availability) o la nomenclatura que hagi donat el fabricant. Versions productives d'un sistema mai haurien d'incorporar versions no consolidades (snapshot, alpha, beta, release candidate, milestone, etc) dels components que en formen part.\n\n## **Principis sobre el cost i manteniment de les solucions**\n\n1.  Cal tenir presents els **costos d'infraestructura** i el **model de llicenciament** requerits per a posar en marxa una solució ja que representen un cost recurrent.\n\n1.  Pensar en els **costos** i en la seva **optimització**:\n\n    *   Monitoritzar els serveis per a identificar necessitats d'ampliació o reducció de recursos i poder ajustar els costos en conseqüència\n    *   Arquitectura/dissenya les càrregues de treball amb els costos en ment\n\n1.  **\"Opensource vs Comercial vs Construcció a mida\"**: a l'hora de concebre una nova solució, s'ha de regir pel següent arbre de decisió:\n\n    *   Per a **problemes comuns**, utilitza \"Opensource\". \n    *   Per a **problemes poc comuns**, compra. \n    *   Per a **problemes únics**, construeix.\n\n    A l'hora de triar entre utilitzar un producte (opensource o comercial) o fer un desenvolupament a mida, cal fer una avaluació del cost vs. benefici de l'opció triada respecte a les altres.   \n\n1.  Pensar en l'**impacte d'actualització** que pugui tenir un canvi de sistema operatiu, _middleware_ o producte allà on corre l'aplicació: quant menys acoblament amb el sistema de base i utilitzant estàndards, més senzilla serà l'actualització o l'ampliació de funcionalitats de l'aplicació.\n","objectID":"L2Jsb2cvMjAxNS8xMi9wcmluY2lwaXM="},"L2Jsb2cvMjAxNi8wMS9hcGk=":{"date":1452556800000,"lastmod":"2017-10-03","title":"APIs RESTful: millors pràctiques","description":"Millors pràctiques per a la construcció d'APIs REST","toc":true,"sections":["Blog","home"],"blog_tags":["bones pràctiques","api","desenvolupament"],"imatge":"/images/bloc/json-api.png","path":"/blog/2016/01/api","content":"Aquest document pretèn unificar la manera d'interaccionar amb les APIs que ofereixin els diferents sistemes de la Generalitat, ja siguin públics o d'ús intern.\r\n\r\n## Acords generals\r\n\r\n- Utilitzarem estàndards HTTP: verbs, http codes, headers, ...\r\n- Els recursos exposats a través de la API seran en plural (\"aplicacions\" enlloc d' \"aplicacio\")\r\n- El format per defecte serà JSON. No es contemplaran altres formats, en general.\r\n- Recomanable utilitzar només caràcters alfanumérics per atributs que formin part d'una URI\r\n- Si exposem dades d'accés públic o per tercers, implementarem el verb OPTIONS per possibilitar CORS \r\n- Paràmetres del querystring reservats explicats més endavant:\r\n\t\r\n\t- fields\r\n\t- sort\r\n\t- q\r\n\t- limit\r\n\t- offset\r\n\t- v\r\n\r\n- La nostra API es publicarà en el path /api del nostre domini:\r\n\t\r\n\t\thttp://subdomini.gencat.cat/api\r\n\r\n## Verbs HTTP\r\n \r\n- GET = select\r\n- POST = insert\r\n- [PATCH o PUT] (http://www.baeldung.com/http-put-patch-difference-spring) = update \r\n- DELETE\r\n- OPTIONS \r\n\r\n###\t Exemple\r\n\r\nL'esquema general de la nostra uri serà el següent:\r\n\r\n\t\thttp://subdomini.gencat.cat/api/{recurs}/{id}\r\n\r\nImaginem que la nostra API gestiona el recurs \"Aplicació\". La notra API exposarà aquests recursos amb el verbs http de la manera següent:\r\n\r\n- GET **/aplicacions** - obté el llistat de totes les aplicacions\r\n- GET **/aplicacions/{id}** - obté la informació de l'aplicació amb l'id corresponent passat a l'URI\r\n- POST **/aplicacions** - crea una nova aplicació\r\n- PATCH o PUT **/aplicacions/{id}** - actualitza l'aplicació amb l'id corresponent passat a l'URI\r\n- DELETE **/aplicacions/{id}** - elimina l'aplicació amb l'id corresponent passat a l'URI\r\n- OPTIONS **/aplicacions** - obté  els verbs suportats per l'aplicacíó i si suporta CORS\r\n\r\n## Esquemes JSON\r\n\r\n- GET\r\n\r\n\t\t\t{\r\n\t\t\t\tdata : {\r\n\r\n\t\t\t\t\ttotal : 976,  //nombre total dels resultats de la petició\r\n\t\t\t\t\tlimit : 100,  //màxim nombre de resultats a retornar per a cada petició\r\n\t\t\t\t\tnumberOfElements : 10 // nombre d'elements que es mostren en la pàgina actual\r\n\t\t\t\t\toffset : 200, //en quin resultat del total comença aquesta petició \r\n\t\t\t\t\t\r\n\t\t\t\t\tincluded : [  //array de resultats\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid : 1,\r\n\t\t\t\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\t\t\t\tcamp2 : \"B\"\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid : 2,\r\n\t\t\t\t\t\t\tcamp1 : \"C\",\r\n\t\t\t\t\t\t\tcamp2 : \"D\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t...\r\n\t\t\t\t\t]\r\n\t\t\t\t} \r\n\t\t\t}\r\n\r\n- GET/POST/PATCH/PUT/DELETE\r\n\r\n\t\t\t{\r\n\t\t\t\terrors : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcode : 401,\r\n\t\t\t\t\t\tmessage : \"l'usuari proporcionat no té permisos d'accés\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\r\n- GET/POST/PATCH/PUT - Elements individuals\r\n\r\n\r\n\t\t\t{\r\n\t\t\t\tid : 1, // en el cas del POST no enviarem el id, normalment\r\n\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\tcamp2 : \"B\"\r\n\t\t\t}\r\n\r\n\r\n## GET - Filtrat de resultats\r\n\r\n- Els recursos es filtraran mitjançant paràmetres al querystring.\r\n\r\n- S'utilitzarà un sol cop cada paràmetre que permeti filtratge:\r\n\r\n\t- si s'han de realitzar operacions més complexes, s'hauria d'establir el mecanisme amb un sol paràmetre\r\n\r\n- Exemple\r\n\r\n\t\tGET /aplicacions?estat=evolutiu&lang=nodejs\r\n\r\n\tRetornarà totes les aplicacions que en aquell moment estiguin en evolució i el llenguatge de desenvolupament sigui Node.js.\r\n\r\n## GET - Paginació\r\n\r\n- En una petició sense cap filtre, mai no es retornaran tots els elements del recurs consultat.\r\n\r\n- La nostra API implementarà paginació, indicant els resultats de la següent manera:\r\n\r\n\r\n\t\t\tdata : {\r\n\t\t\t\ttotal : 976,\r\n\t\t\t\tlimit : 100, \r\n\t\t\t\tnumberOfElements : 10,\r\n\t\t\t\toffset : 200,\r\n\t\t\t\tincluded : [\r\n\t\t\t\t\t...\r\n\t\t\t\t]\r\n\t\t\t} \r\n\r\n\r\n\t- el camp \"**total**\" indicarà el número de resultats d'una request\r\n\t- el camp \"**limit**\" indicarà el número de resultats per pàgina. S'inclourà al querystring. Si no s'informa, per defecte serà 10 i el màxim dependrà dels objectius de rendiment, però no hauríem de passar de 500 resultats.\r\n\t- el camp \"**offset**\" indicarà en quin resultat hauria de començar el subset de resultats demanat en una request. S'inclourà al querystring. Si no s'informa, per defecte serà 0 i retornarà el primers resultats en funció del paràmetre \"limit\".\r\n\r\n\t\t\tGET /aplicacions?limit=100&offset=200 \r\n\r\n\t\tRetornarà a partir del resultat 300 i amb 100 resultats en aquella petició.\r\n\r\n\r\n\t- Amb l'exemple anterior, el número de pàgines seria:\r\n\r\n\t\t- total / límit = 976 / 100 = 9,76, que arrodonit a l'enter superior ens donaria 10 planes\r\n\r\n\t- I la pàgina activa seria:\r\n\r\n\t\t- (offset / limit) + 1 = 200/100+1 = pàgina 3\r\n\r\n\t- [Exemple a jsfiddle](https://goo.gl/WKlXnV)\r\n\r\n## GET - Selecció de camps\r\n\r\n- Es permetrà seleccionar els camps que es volen consultar implementant el paràmetre \"**fields**\", on el seu valor seran els noms dels camps a incloure en els resultats separats per coma:\r\n\r\n\t\tGET /aplicacions?fields=codi,data_creacio,proveidor,lang \r\n\r\n\tRetornarà totes les aplicacions però els documents només retornaran els camps enumerats al camp fields.\r\n\t\t\r\n\r\n## GET - Ordre dels resultats\r\n\r\n- Si es requereix, es podrà habilitar un paràmetre \"**sort**\" que acceptarà valors dels camps separats per comes i on es podrà indicar amb el signe \"-\" precedint el nom del camp, l'ordre descendent per a aquell camp. Per defecte l'ordre serà ascendent\r\n\r\n- Exemple:\r\n\r\n\t\tGET /aplicacions?sort=data_creacio,-loc \r\n\r\n\tRetornarà totes les aplicacions ordenades per data de creació ascendent i línies de codi (loc) descendent.\r\n\r\n## GET - Cerca lliure\r\n\r\n- Per a les cerques lliures a qualsevol camp dels elements del recurs, el paràmetre per defecte serà \"**q**\"\r\n\r\n- Exemple:\r\n\r\n\t\tGET /aplicacions?q=mysql\r\n\r\n\tRetornarà totes les aplicacions que en algun dels camps continguin \"mysql\"\t\r\n\r\n## GET - Memòria cau\r\n\r\nLes peticions de tipus GET són succeptibles de ser guardades en memòria cau si l'API està exposada al públic i té un consum elevat. Depèn de què es vulgui guardar, establirem una o altra \"clau de caché\". \r\n\r\nUtilitzarem dues aproximacions:\r\n\r\n- Per a consultes sobre tot el recurs establirem una clau de caché que podria ser tota la url + el querystring o bé alguns paràmetres del querystring.\r\n\r\n\tPer a realitzar aquesta funcionalitat es podria incorporar dins la lògica de la pròpia API però la millor pràctica seria utilitzar serveis de caché externs (Varnish, caché a balancejadors, ...)\r\n\r\n- En qualsevol cas, siguin consultes múltiples o d'un ítem concret, hauríem de proporcionar les capçareleres http relacionades amb la caducitat dels resultats:\r\n\r\n\t- Etag\r\n\t- Date\r\n\t- Last-modified\r\n\t- Expires\r\n\r\n\r\n## POST - Creació d'un recurs\r\n\r\nAmb el verb POST crearem nous elements al nostre recurs:\r\n\r\n\t\tPOST /aplicacions/\r\n\t\tContent-type: application/json\r\n\r\n\t\t{\r\n\t\t\tdata : {\r\n\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\tcamp2 : \"B\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\nSi tot ha anat correctament el HTTP response code serà 201. La resposta pot incloure un header location amb la uri del recurs creat.\r\n\r\n\r\n\t\tLocation: /api/aplicacions/5220-4848-864539594927\r\n\r\n\t\t{\r\n\t\t\tdata : {\r\n\t\t\t\tid : \"5220-4848-864539594927\", // en el cas del POST no enviarem el id, normalment\r\n\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\tcamp2 : \"B\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n## PUT - Actualització total d'un recurs\r\n\r\nAmb el verb PUT substituirem un recurs concret completament. Si un dels camps és una llista, que inclou [1,2,3,4,5] la nova llista al aplicar la operació de sota quedaria [2,3,4,5]\r\n\r\n\t\tPUT /aplicacions/5220-4848-864539594927\r\n\t\tContent-type: application/json\r\n\r\n\t\t{\r\n\t\t\tdata : {\r\n\t\t\t\tid : 5220-4848-864539594927\r\n\t\t\t\tcamp1 : \"X\"\r\n\t\t\t\tcamp2 : \"Y\"\r\n\t\t\t\tlista : [2,3,4,5]\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\nSi tot ha anat correctament el HTTP response code serà 20x, depenent de si s'ha realitzat o s'ha encuat per a processar\r\n\r\n## PATCH - Actualització parcial d'un recurs\r\n\r\nAmb el verb PATCH actualitzarem un recurs concret. Només actualitzarem els camps que constin al payload. Això te avantatges sobretot amb llistes on només especifiquem els canvis a afegir. Al nostre cas d'abans quedaria [1,2,3,4,5,2,3,4,5]\r\n\r\n\t\tPATCH /aplicacions/5220-4848-864539594927\r\n\t\tContent-type: application/json\r\n\r\n\t\t{\r\n\t\t\tdata : {\r\n\t\t\t\tid : 5220-4848-864539594927\r\n\t\t\t\tcamp1 : \"X\"\r\n\t\t\t\tcamp2: \"Y\"\r\n\t\t\t\tlista: [2,3,4,5]\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\nSi tot ha anat correctament el HTTP response code serà 20x, depenent de si s'ha realitzat o s'ha encuat per a processar\r\n\r\n## DELETE - Eliminació d'un recurs\r\n\r\nAmb el verb DELETE eliminarem un recurs concret.\r\n\r\n\t\tDELETE /aplicacions/5220-4848-864539594927\r\n\t\tContent-type: application/json\r\n\r\n\r\nSi tot ha anat correctament el HTTP response code serà 20x, depenent de si s'ha realitzat o s'ha encuat per a processar\r\n\r\n## Operacions múltiples (BATCH)\r\n\r\n- La nostra API podrà incorporar un mecanisme per a poder realitzar operacions múltiples (crear, actualitzar o eliminar) a la url:\r\n\r\n\t\thttp://subdomini.gencat.cat/api/_batch\r\n\r\n- L'acció serà de crear, actualitzar o eliminar, no es podran barrejar accions.\r\n\r\n- Es realitzarà mitjançant un POST amb el següent format de document:\r\n\r\n\r\n\t\tPATCH /_batch/\r\n\t\tContent-type: application/json\r\n\r\n\t\t{\r\n\t\t\taction : \"POST\" //o \"PATH\", \"DELETE\"\r\n\t\t\tdata : [\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594927\r\n\t\t\t\t\tcamp1 : \"X\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594928\r\n\t\t\t\t\tcamp1 : \"Z\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\r\n\r\n- En el cas de crear múltiples elements, és obligatori enviar un \"id\" que permeti retornar en la resposta si l'id enviat s'ha processat correctament o no.\r\n\r\n- Qualsevol acció múltiple estarà limitada a un màxim de **100 elements**.\r\n\r\n- La resposta http consistirà en el mateix atribut data enviat, que retornarà un status per a cada document enviat a crear, actualitzar o eliminar. En el cas d'errors, s'inclourà un atribut \"errors\" que serà un array d'errors a processar, amb el codi intern que li correspongui i la descripció.\r\n\r\n\t\t{\r\n\t\t\tdata : [\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594927,\r\n\t\t\t\t\tstatus: 200\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594928,\r\n\t\t\t\t\tstatus: 400,\r\n\t\t\t\t\terrors : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcode : 999,\r\n\t\t\t\t\t\t\tmessage : \"Falten camps obligatoris per informar\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\r\n\r\n\r\n\r\n## Multi idioma\r\n\r\nSi l'API pot retornar atributs en múltiples idiomes, tindrem dos mecanismes per a poder negociar-lo:\r\n\r\n- Paràmetre \"lang\" al querystring per a peticions GET\r\n\r\n\t\tGET /aplicacions?lang=ca\r\n\r\n- Header \"Accept-Language\" a tots els verbs\r\n\r\nUtilitzarem els codis de l'estàndard ISO-639-1: https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes\r\n\r\nLa API tindrà un idioma per defecte i informarà en quins llenguatges es pot consultar a la seva pàgina d'ajuda.\r\n\r\n## Versionat\r\n\r\n- El mètode preferit per a seleccionar la versió que volem consultar de l'API, serà incloent el paràmetre \"**v**\" a la querystring\r\n\r\n- Exemple:\r\n\r\n\t\tGET /aplicacions?q=mysql&v=2 \r\n\r\n\tRetornarà totes les aplicacions que en algun dels camps continguin \"mysql\" en la versió 2 de l'API\r\n\r\n- Només farem versions per a canvis majors, de manera que els canvis menors s'incorporaran a la versió major actual en un moment donat, garantint la compatibilitat cap a enrera dels recursos servits mentre es mantingui una versió major.\r\n\r\n## Missatges i errors\r\n\r\nTota interacció amb els recursos de a nostra API retornarà un codi HTTP en funció del tipus d'acció i èxit o error de la mateixa. HTTP codes més comuns:\r\n\r\n- 200 – _OK_ – Tot correcte\r\n- 201 – _OK_ – Nou recurs creat (POST)\r\n- 204 – _OK_ – El recurs s'ha eliminat correctament (DELETE)\r\n\r\n- 304 – _Not Modified_. Es pot utilitzar la caché.\r\n\r\n- 400 – _Bad Request_ – La petició és incorrecta. L'error s'haurà de descriure en el _payload_ de la resposta http.\r\n- 401 – _Unauthorized_ – La petició requereix d'autorització.\r\n- 403 – _Forbidden_ – El servidor entèn la petició però la rebutja o l'accés no està permès.\r\n- 404 – _Not found_ – No s'ha trobat el recurs.\r\n\r\nEn cas d'errors, inclourem un _payload_ en format JSON que informarà dels problemes trobats, ampliant la informació si cal a la descripció (\"desc\"):\r\n\r\n\t\t\t{\r\n\t\t\t\terrors : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcode : 404,\r\n\t\t\t\t\t\tmessage : \"El recurs sol·licitat no s'ha trobat\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\r\n\t\t\t}\r\n\r\n## Autenticació\r\n\r\nEls mecanismes preferits per a donar accés a la nostra API seran els següents, per ordre de preferència:\r\n\r\n1. Oauth2\r\n1. Autenticació Bàsica sobre GICAR\r\n1. HMAC\r\n\r\nEn cas d'existir un API Gateway en el moment d'implementar l'API, la millor opció serà gestionar la seguretat a través d'aquesta peça, millor que implementar-la a la nostra API.\r\n\r\n## Documentació\r\n\r\nEntre els formats de descripció d'APIs tenim Swagger i WADL. La nostra opció preferida serà utilitzar [Swagger](http://swagger.io/). Podeu veure un exemple de funcionament a [http://petstore.swagger.io/](http://petstore.swagger.io/)\r\n\r\n\r\n## Referències\r\n\r\n- http://jsonapi.org/\r\n- http://www.restapitutorial.com/resources.html\r\n- http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api\r\n- http://restful-api-design.readthedocs.org/en/latest/methods.html\r\n- http://blog.mwaysolutions.com/2014/06/05/10-best-practices-for-better-restful-api/\r\n- http://blog.octo.com/en/design-a-rest-api\r\n\r\n### Aspectes pendents de definir\r\n\r\n- Filtrat per rangs: establir un QL\r\n\r\n- Relacions entre elements \r\n\r\n","objectID":"L2Jsb2cvMjAxNi8wMS9hcGk="},"L2Jsb2cvMjAxNi8wMi9hcHBsZXRz":{"date":1455494400000,"title":"Desenvolupament web. Discontinuació dels Applets Java","description":"","sections":["Blog","home"],"blog_tags":["legacy"],"imatge":"/images/bloc/applet.png","path":"/blog/2016/02/applets","content":"Com bé sabeu la tecnologia dels applets està entrant en obsolescència i se n’està discontinuant el suport per part dels diferents actors del mercat:\n\n* **Navegadors**: no es poden executar sobre Google Chrome des de setembre de 2015 en què es va deixar de donar suport a l’especificació NPAPI. La resta de navegadors també seguiran aquesta via (https://java.com/en/download/faq/chrome.xml)\n\n* **Màquina virtual Java**: a partir de la versió 9 de Java, Oracle deixarà de donar suport als applets. Està previst que aquesta versió es publiqui l’abril de 2017. Cal fer esment que encara que es disposés d’un navegador que suportés l’execució d’applets no els podria executar quan la jvm del PC sigui la versió 9 (https://blogs.oracle.com/java-platform-group/entry/moving_to_a_plugin_free)\n\nDes de la Unitat d’Arquitectura estem avaluant les diferents alternatives tecnològiques que hi ha a l’ús dels applets en funció del seu cas d’ús a les aplicacions de la Generalitat de Catalunya. \n\nActualment, tenim identificats els casos d’ús següents:\n\n* Accés a maquinari (perifèrics del PC):\n\n\t* **Accés a lectors de targes per la signatura digital des del navegador**. L’exemple més rellevant és el que es coneix com a “applet de CatCert”. L'AOC està en procés de construcció d’una alternativa a aquesta funcionalitat.  Estem fent seguiment amb ells per avaluar els impactes del canvi sobre els sistemes d’informació de la Generalitat. Al llarg de la propera setmana ja disposaran d’una primera versió sobre un entorn de proves i començaran les proves internes dins AOC.\n\n\t* **Accés a impressores**. Com per exemple, l’applet d S@rcat que permet accedir a la impressora de registre de documents.\n\n\t* **Accés a escàner**\n\n* Accés a programari:\n\n\t* **JClic**: aquest applet s'utilitza per a fer córrer aplicacions educatives que es dissenyen amb el Generador de JClic\n\n\t* **Edició de documents**. Applet que s’utilitza per a poder editar documents amb un openOffice instal·lat al PC, convertir-los a pdf, etc.\n\n\t* **Comparador de documents de MS Word**\n\n\t* **Gestió de dades a client**: per temes de performance en aplicacions antigues s'utilitzaven applets per a emmagatzemar dades poc volàtils per a evitar anar a buscar-les al servidor\n\n\t* **Generació de pantalles a client**\n\nDurant les properes setmanes publicarem les alternatives per substituir aquesta tecnologia a les aplicacions.\n\t","objectID":"L2Jsb2cvMjAxNi8wMi9hcHBsZXRz"},"L2Jsb2cvMjAxNi8wNC9hcHBsZXRzLXRvLWpubHA=":{"date":1459987200000,"title":"Dels Applets a Java Web Start amb JNLP","description":"Us expliquem breument les estratègies de migració dels Applets Java i en concret, la migració a tecnologia Java Web Start amb JNLP","sections":["Blog","home"],"blog_tags":["legacy"],"key":"ABRIL2016","path":"/blog/2016/04/applets-to-jnlp","content":"Tal i com us explicàvem fa unes setmanes, la tecnologia applet tal i com la coneixem deixarà de poder utilitzar-se als navegadors d'internet en breu i, a més, la versió Java 9 deixarà de donar suport als plugins de navegador que permeten l'execució d'aquests applets.\n\nPer tant, davant d'aquesta problemàtica se'ns presenten dues solucions:\n\n- Continuar utilitzant els applets amb l'alternativa recomanada per Oracle: Java Web Start\n- Canviar la funcionalitat que utilitza els applets per tecnologia nativa web\n\n### Java Web Start (JWS)\n\n[Java Web Start](https://www.java.com/en/download/faq/java_webstart.xml) permet executar aplicacions des de la web, però enlloc d'executar-se dins del navegador, incrustats a l'html (tags object, applet, ...) l'usuari es descarrega un fitxer JNLP (Java Network Launching Protocol) i, en clicar-lo, s'executa l'aplicació JWS fora del navegador.\n\nEn el cas dels applets, JWS dóna suport a la seva execució, de manera que un applet incrustat en una pàgina web d'aquesta manera:\n\n\t\t<applet code=\"java2d.Java2DemoApplet\"          \n        \tjnlp_href=\"dynamictree_applet.jnlp\"         \n        \twidth=\"710\" \n        \theight=\"540\" >        \n\t\t    <param name=\"param1\" value=\"value1\"/>\n\t\t</applet> \n\nPassaria a cridar-se mitjançant un fitxer amb extensió jnlp que contindria el següent codi:\n\n\t\t<jnlp spec='1.0+' codebase='http://sc-pre.aoc.cat/appletCentralitzat/resources/jars/' href=''>\n\t\t\t<information>\n\t\t\t\t<title>Applet Centralitzat</title>\n\t\t\t</information>\n\t\t\t<resources>\n\t\t\t\t<jar href=\"SwingSet2.jar\"/>\n\t\t\t</resources>\n\t\t\t<applet-desc main-class=\"SwingSet2Applet\" name=\"SwingSet\" width=\"625\" height=\"595\">\n\t\t\t\t<param name=\"param1\" value=\"value1\"/>\n\t\t\t  \t<param name=\"param2\" value=\"value2\"/>\n\t\t\t</applet-desc>\n\t\t</jnlp>\n\nL'usuari es descarregaria aquest fitxer des de la web i aixecaria l'aplicació Java fora del navegador. \n\n**En el cas que l'applet intercanviés informació amb l'aplicació web que el fa servir (o a la inversa) mitjançant javascript, aquesta comunicació deixarà de funcionar, i, per tant, s'haurà de canviar la manera de comunicar l'aplicació applet/java i l'aplicació web. La solució passa per crear un servei del costat de servidor que s'encarregui de comunicar l'applet i l'aplicació web.** \n\nNota d'Oracle sobre la migració d'applets a JWS: http://docs.oracle.com/javase/8/docs/technotes/guides/deploy/applet_dev_guide.html#JSDPG1032\n\n### Codi\n\n- Applet de Signatura de l'AOC: https://github.com/ConsorciAOC/signador \n\n","objectID":"L2Jsb2cvMjAxNi8wNC9hcHBsZXRzLXRvLWpubHA="},"L2Jsb2cvMjAxNi8wNS9yZXN0LXZzLWpzZg==":{"date":1463097600000,"title":"Aplicacions webs modernes: JSF vs REST","description":"Us donem una breu explicació d'aquest canvi de paradigma en la capa de presentació","sections":["Blog","home"],"blog_tags":["patrons de disseny","bones pràctiques","legacy","desenvolupament"],"imatge":"/images/bloc/rest.png","key":"JUNY2016","path":"/blog/2016/05/rest-vs-jsf","content":"Des de fa més de 3 anys, des de la Unitat d'Arquitectura Corporativa i el Centre de Suport Canigó, promovem la creació d'aplicacions orientades a serveis/API (dins els moviments de API Economy, API First, API Strategy) on la capa de presentació és un client més d'aquesta API. A més, proposem que aquest client html sigui totalment estàtic, on no hi hagi renderització des del costat de servidor: d'aquesta manera, el manteniment i evolució de l'aplicació és més senzill i no depenem de frameworks pesats de servidor (com són JSF o Struts).\n\nPer aquest motiu, us comuniquem que a partir d'aquest moment, **l'ús de JSF ha de ser exclusiu a efectes de manteniment d'aplicacions**. Qualsevol nova aplicació o funcionalitat dins d'una aplicació, s'hauria de desenvolupar seguint el patró REST, on el servidor exposa la lògica de negoci mitjançant serveis en format JSON (i seguint les millor pràctiques en desenvolupament d'APIs que trobareu al nostre bloc) i el client, normalment desenvolupat amb tecnologia estàtica (html/javascript/css), consumeix aquest servei.\n\nAixò no vol dir que no es puguin utilitzar elements de servidor (jsp) per a facilitar la renderització de plantilles, però s'hauria de reduir a la mínima expressió.\n\n#### JSF vs HTML5/JS\n\nA continuació s'exposen una sèrie de referències d'interès que reflecteixen l'impuls dels nous frameworks de client basats en HTML5 i Javascript vers el frameworks JSF més estès del moment, Primefaces:\n\n*Primefaces (JSF)*\n\n- https://www.thoughtworks.com/radar/languages-and-frameworks/jsf (Només manteniment)\n- https://github.com/primefaces/primefaces (No arriba a 400 starts a Github)\n\n*AngularJS (HTML5/JS)*\n\n- https://www.thoughtworks.com/radar/languages-and-frameworks/angularjs (Avaluar)\n- https://github.com/angular/angular.js (Aprop de 50.000 starts a Github)\n\n*ReactJS (HTML5/JS)*\n\n- https://www.thoughtworks.com/radar/languages-and-frameworks/react-js (Adoptar)\n- https://github.com/facebook/react (Més de 40.000 starts a Github)\n\n*EmberJS (HTML5/JS)*\n\n- https://www.thoughtworks.com/radar/languages-and-frameworks/ember-js (Provar)\n- https://github.com/emberjs/ember.js (Més de 16.000 starts a Github)\n\nLa tendència de les cerques realitzades a Google també indica un canvi clar des de fa uns anys:\n\n![Google Trends](/images/bloc/comparativa-frameworks.png  \"Google Trends\")\n\n*Termes comparats: Primefaces, Richfaces, JavaServer Faces (JSF), Representational state transfer (REST) i AngularJS (JavaScript MVW Framework)*\n\n### Notícies i comunicats\n\nDes del CS Canigó s'han anat publicant notícies i enviant comunicats durant aquests darrers anys promocionant aquest tipus d'arquitectura moderna REST+HTML5/JS:\n\n* [Notícia - Plantilla d'aplicació REST](http://canigo.ctti.gencat.cat/noticies/2015-09-01-Canigo-Plantilla-aplicacio-rest/)\n\n* [Notícia - Arquitectura d'aplicacions recomanada](http://canigo.ctti.gencat.cat/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada/)\n\n* [Notícia - Integració de serveis REST amb GICAR](http://canigo.ctti.gencat.cat/noticies/2015-02-05-Canigo-integracio-serveis-rest-gicar/)\n\n* [Notícia - Cas d'èxit d'aplicació Canigó 3 amb arquitectura HTML5 + REST](http://canigo.ctti.gencat.cat/noticies/2015-01-08-canig%C3%B3-REST/)\n\n* [Comunicat Gener 2015](http://canigo.ctti.gencat.cat/related/cs/2015/01/comunicat.html)\n\n* [Comunicat Novembre 2013](http://canigo.ctti.gencat.cat/comunicats_antics/2013/11/)\n\n* [Comunicat Maig 2013](http://canigo.ctti.gencat.cat/comunicats_antics/2013/05/)\n\n### Canigó\n\nProperes publicacions del framework Canigó 3 deixaran de donar suport a JSF. També el plugin d'Eclipse inclòs l'[Entorn de desenvolupament Canigó](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/) per a generació de noves aplicacions no permetrà la generació d'aplicacions basades en aquesta tecnologia. L'única opció serà la creació d'aplicacions amb arquitectura REST+HTML5/JS.\n","objectID":"L2Jsb2cvMjAxNi8wNS9yZXN0LXZzLWpzZg=="},"L2Jsb2cvMjAxNi8wOC9taWNyb3NlcnZlaXM=":{"date":1470268800000,"title":"(micro)serveis","description":"Introducció al patró de disseny basat en microserveis i les implicacions que té a l'hora de pensar les aplicacions","sections":["Blog","home"],"blog_tags":["patrons de disseny","api","microserveis"],"imatge":"/images/bloc/microserveis.png","key":"SETEMBRE2016","path":"/blog/2016/08/microserveis","content":"**(micro)serveis és un patró de disseny** de sistemes orientat a descompondre una aplicació en les seves **unitats funcionals mínimes**, tractar-les com a aplicacions independents, on **cada servei és responsable d'un domini de negoci** i la resta de serveis es comuniquen amb ell mitjançant **interfícies i contractes estàndard** (per exemple, HTTP/REST amb una API coneguda).\n\nPosem (micro) entre parèntesis perquè la granularitat dels serveis dependrà de diversos factors, però el que sí que és important és que les comunicacions entre els diferents serveis/mòduls/funcionalitats es realitzi mitjançant les interfícies que s'exposin. El que no es farà en cap cas és anar a buscar les dades al repositori del servei que volem consumir. És a dir, cada servei serà [**\"l'única font de la veritat\"**](https://en.wikipedia.org/wiki/Single_source_of_truth) de les dades que gestiona.\n\nÉs un pas més a la componentització i modularització dels sistemes en totes les seves capes, on tant el **software** (la meva aplicació) com els **middlewares** (el programari sobre el que corre l'aplicació: servidor web, base de dades, ...) i els **entorns de desplegament** (contenidors o runtimes) es poden dedicar en exclusiva a cada (micro)servei.\n\n### Millors pràctiques\n\n- un servei, un repositori independent: els serveis no comparteixen repositori (lògic)\n- cada servei té un procés de construcció (build) independent\n- es recomana desplegar en contenidors o runtimes estàndards\n- s'han de respectar els contractes/interfícies interns (diferents equips de desenvolupament?) i externs (clients o aplicacions terceres)\n\t\n\n### Beneficis\n\n- cada servei és relativament petit i pot ser desplegat independentment de la resta (això sí, s'han de vigilar els canvis de contracte i per a això és important el versionat dels serveis).\n\n- en ser serveis independents i desplegats de manera independent, poden ser escalats per separat: els monòlits, per contra, s'han d'escalar en bloc.\n\n- permet fer conviure diverses tecnologies en un sistema, de manera que l'únic que ens hem de preocupar d'estandarditzar és la interfície de comunicació (API)\n\n- si un servei té problemes, no té per què veure's afectat tot el sistema, això sí, s'ha de gestionar en els diferents serveis la tolerància a errors de serveis tercers.\n\n\n### Aspectes a tenir presents\n\n- s'ha d'automatitzar TOT des del principi del projecte, ja que la coordinació és la clau de l'èxit.\n\n- en sistemes grans i amb molts serveis, apareixen patrons relacionats que cal gestionar, per a coreografiar els fluxes, gestionar la configuració, ...\n\n\t- service registration: els microserveis s'han d'enregistrar (ells mateixos o via un servei dedicat) al servei de registre\n\n\t- service discovery: han de poder ser \"descoberts\" pels clients abans de ser cridats o a la banda de servidor, que seria la millor pràctica, (en aquest cas, per un API Gateway), de manera que el sistema sabrà les diferents instàncies que corren i a les que ha de dirigir les peticions\n\n\t- seria recomanable disposar d'un API Gateway per a governar els serveis (seguretat, discovery, caché, ...)\n\n- estem acostumats a tenir les dades centralitzades mentre que en aquest patró estan descentralitzades. Per exemple estem acostumats a tenir eines de reporting o BI que accedeixen a un repositori centralitzat. En aquest cas, on els repositoris poden ser diferents i estar ubicats en diferents llocs, es pot optar per disposar d'una BD que agregui la informació per al reporting.\n\n### Canigó + (micro)serveis \n\nCom que estem parlant d'un patró, la seva implementació es pot realitzar de diverses maneres. I com ja hem comentat, aquest patró permet la coexistència de diverses tecnologies. \n\nEn el cas de Canigó, basat en Spring, tot dependrà del disseny que es faci de l'aplicació. Això sí, implica respectar els [principis d'arquitectura](http://canigo.ctti.gencat.cat/blog/2015/12/principis/) i les [millors pràctiques en la construcció d'apis i serveis](http://canigo.ctti.gencat.cat/blog/2016/01/api/). A més, algunes de les característiques d'aquest patró ja estan resoltes dins Spring Cloud (routing, load balancing, registry, discovery, ...) i per això recomanem el seu ús als projectes Canigó.\n\n\n<br />\n\n**Referències**:\n\n- http://samnewman.io/books/building_microservices/\n- https://www.nginx.com/blog/introduction-to-microservices/\n- http://microservices.io/patterns/microservices.html\n- https://www.nginx.com/blog/microservices-at-netflix-architectural-best-practices/\n- https://netflix.github.io/ (Common Runtime Services & Libraries: Eureka, Zuul, ...)\n- https://spring.io/blog/2015/07/14/microservices-with-spring\n- http://projects.spring.io/spring-cloud/\n","objectID":"L2Jsb2cvMjAxNi8wOC9taWNyb3NlcnZlaXM="},"L2Jsb2cvMjAxNi8wOS9jbG91ZC1yZWFkeQ==":{"date":1473897600000,"title":"Cloud-Ready","description":"Aspectes a tenir en compte en la definició de l'arquitectura d'una aplicació per estar preparada per anar al Cloud","sections":["Blog","home"],"blog_tags":["patrons de disseny","microserveis","api"],"imatge":"/images/bloc/cloud-ready.png","key":"OCTUBRE2016","path":"/blog/2016/09/cloud-ready","content":"Per tal que una aplicació pugui ser desplegada al **Cloud** i s'aprofiti dels beneficis que aquest aporta, cal que hagi estat dissenyada amb aquesta finalitat. Aquest disseny, normalment, és més complex que el disseny que es pugui realitzar per una aplicació destinada a ser desplegada en servidors \"on-premise\". Són molts els avantatges d'un entorn Cloud (flexibilitat, agilitat en aprovisionament, facilitat per desplegament continu, ...) que fan que l'esforç en la **definició de l'arquitectura** valgui la pena.\n\nA continuació s'enumeren diferents conceptes a tenir en compte en el disseny d'una aplicació que vulgui estar preparada per anar al Cloud:\n\n## Conceptes\n\n### Micro-serveis <img src=\"/images/bloc/cloud-ready-microservices.png\" alt=\"Microserveis\" style=\"width: 80px;\"/>\n\nL'aplicació ha de ser concebuda com una **col·lecció de serveis**, no com a una única peça (monòlit). Més informació en aquesta [entrada](/blog/2016/08/microserveis/) d'aquest mateix bloc.\n\n### Escalabilitat <img src=\"/images/bloc/cloud-ready-scalability.png\" alt=\"Escalabilitat\" style=\"width: 80px;\"/>\n\nUna arquitectura orientada a micro-serveis permetrà l'**escalabilitat de cada servei per separat**. Els entorns Cloud estan dissenyats per aprovisionar molts entorns d'execució petits (contenidors, paas, ...). Per tant, les arquitectures orientades a micro-serveis són de forma natural fàcilment integrables en entorns Cloud.\n\nL'escalabilitat permetrà canviar el nombre d'instàncies de l'aplicació segons les necessitats. És important que l'aplicació sigui el més \"stateless\" possible ja que d'aquesta manera serà molt més fàcil d'escalar.\n\nL'aplicació ha d'estar preparada per aturar-se i reiniciar-se sempre que calgui, aturant nodes quan la càrrega sigui petita o incrementant-ne quan hi hagi un pic de consum.\n\n### Agnòstic de la infraestructura <img src=\"/images/bloc/cloud-ready-infraestructure-agnostic.png\" alt=\"Agnòstic de la infraestructura\" style=\"width: 70px;\"/>\n\nL'aplicació **no ha d'estar lligada a cap element de la infraestructura** on hagi de ser desplegada. D'aquesta manera, si l'aplicació ha de traslladar-se d'una infraestructura a una altra de diferent, no es veurà afectada. Per exemple, no ha d'utilitzar IPs, o tenir en compte el número de instàncies de l'aplicació. Tampoc hauria de tenir funcionalitats dependents d'un sistema operatiu concret.\n\n### Robustesa <img src=\"/images/bloc/cloud-ready-fault-tolerance.png\" alt=\"Robustesa\" style=\"width: 50px;\"/>\n\nCada component ha de ser **el més autònom possible**, podent funcionar encara que la resta no estiguin disponibles. Aquesta tolerància a fallides és clau per a l'èxit d'una aplicació amb una arquitectura distribuïda. S'han d'evitar punts crítics que suposin la caiguda (downtime) de tota l'aplicació.\n\n### Desacoblament de les dades <img src=\"/images/bloc/cloud-ready-decoupled.png\" alt=\"Desacoblament\" style=\"width: 60px;\"/>\n\nEl **processament de les dades, i les mateixes dades, han d'estar en components separats**. Un cop desacoblats, és possible tenir les dades en un CPD privat i fer-ne el processament en un cloud públic o privat. Aquesta és una pràctica habitual en empreses i organitzacions que volen tenir les dades en els seus servidors però aprofitar els avantatges que proporciona el cloud.\n\n### Emmagatzemament local <img src=\"/images/bloc/cloud-ready-storage.jpg\" alt=\"Emmagatzemament\" style=\"width: 80px;\"/>\n\nEn un entorn Cloud **els fitxers que escriu l'aplicació al sistema de fitxers local són volàtils**. Per exemple, suposant que l'aplicació utilitza el sistema de fitxers local com a caché, en aturar-se un node i aixecar-se posteriorment en una altra ubicació (màquina física, VM, ...), aquesta caché desapareixerà, el que suposarà que el temps de resposta serà diferent dels altres nodes on si existeix aquesta caché. El que es recomana és utilitzar un repositori extern com pugui ser una base de dades SQL o NoSQL.\n\nUn altre aspecte a tenir en compte és la lectura de fitxers de configuració de l'aplicació. Aquests han de ser idèntics en tots els nodes, ja que en cas contrari el resultat pot ser inesperat.\n\n### Seguretat <img src=\"/images/bloc/cloud-ready-security.png\" alt=\"Seguretat\" style=\"width: 80px;\"/>\n\n#### Stateless\n\nPer tal que una aplicació no es vegi afectada per un escalat dinàmic (canvi del nombre d'instàncies en calent) cal que sigui \"stateless\", és a dir, **no mantingui l'estat en la mateixa aplicació**. Una possibilitat és emmagatzemar part de l'estat en el navegador en aplicacions web modernes utilitzant funcionalitats d'HTML5, encara que el més habitual és utilitzar un repositori centralitzat en el servidor (Redis, per exemple). No ha d'utilitzar-se l'HTTPSession en Java, o session[] hash a Ruby on Rails, donat que llavors estem emmagatzemant l'estat dins la pròpia aplicació, fet que volem evitar. La solució implica utilitzar un repositori amb alta disponibilitat extern a l'aplicació com pugui ser Redis o Memcached. \n\n### Interoperabilitat  <img src=\"/images/bloc/cloud-ready-interoperability.png\" alt=\"Interoperability\" style=\"width: 60px;\"/>\n\n#### Protocols moderns i estàndards\n\nL'aplicació ha d'utilitzar protocols moderns, preferiblement **REST sobre HTTP(s)**, o inclús SOAP i WS-* estàndards. Per tant, cal evitar l'ús de protocols com per exemple RMI-IIOP ja en desús des de fa força temps.\n\n#### Optimització de la comunicació entre components\n\nPer tal que una aplicació tingui un bon rendiment, cal pensar molt bé quina és la manera més òptima per a comunicar els diferents components que en formen part. Per exemple, agrupant missatges en lloc d'estar contínuament fent intercanvi d'informació.\n\n### DevOps <img src=\"/images/bloc/cloud-ready-devops.jpg\" alt=\"DevOps\" style=\"width: 60px;\"/>\n\n#### Configuració/Automatització\n\nÉs molt important que els equips de desenvolupament i operacions es posin d'acord en com ha de ser la configuració de l'aplicació per a poder ser desplegada en els diferents entorns i aquest procés de desplegament pugui automatitzar-se (DevOps). Per assolir aquest objectiu cal definir **convencions** i documentar com han de ser aquestes configuracions per tal que no hi hagi divergències que puguin dificultar la tasca.\n\n#### Monitorització\n\nL'aplicació ha de poder ser monitoritzada. No ha de ser necessari tenir coneixements (interpretar logs) de l'aplicació per a poder determinar si aquesta està funcionant correctament o no. Per tant, han d'existir **mètriques i sondes (health check URL) tècniques**, no funcionals, que permetin saber si l'estat de l'aplicació és correcte. Per exemple, una URL que retorni el codi HTTP 200 en cas satisfactori o un codi diferent altrament.\n\n#### Traçabilitat\n\nL'aplicació no ha d'escriure els logs a un fitxer local. Cal recordar que els nodes han de poder aturar-se i reiniciar-se sense que l'aplicació es vegi afectada. En cas que els logs s'escriguin en el sistema de fitxers local aquesta informació es perdrà.\n\nEn entorns cloud s'acostuma a utilitzar un servei extern que funciona com a **agregador de logs**. D'aquesta manera els logs persistiran encara que els nodes de l'aplicació s'eliminin. Donat que la transmissió de logs es fa per la xarxa, cal anar amb compte amb el nivell de log (error, warn, info, debug, trace) configurat en entorns productius, ja que pot produïr un problema de saturació en cas que estigui configurat a un nivell de detall molt alt. El volum de logs ha de ser manegable.\n\n## Canigó\n\nEs preveu una evolució del framework Canigó durant l'any 2017 en aquesta línia, per tal de facilitar el màxim possible el seu desplegament en entorns Cloud.\n\n<br />\n\n**Referències**:\n\n- http://blog.octo.com/en/cloud-ready-applications/\n- http://www.ibm.com/developerworks/websphere/techjournal/1404_brown/1404_brown.html\n- http://techbeacon.com/5-steps-building-cloud-ready-application-architecture\n","objectID":"L2Jsb2cvMjAxNi8wOS9jbG91ZC1yZWFkeQ=="},"L2Jsb2cvMjAxNi8xMS93ZWItYXJxdWl0ZWN0dXJh":{"date":1478649600000,"lastmod":"2018-01-10","title":"Tecnologia darrera del Web d'Arquitectura","description":"Us expliquem la tecnologia darrera la web d'arquitectura i com l'utilitzem de base per a part de la R&D que fem a la unitat","sections":["Blog","home"],"blog_tags":["patrons de disseny"],"imatge":"/images/bloc/web-aq.png","aliases":["/bloc/2016/11/web-arquitectura/"],"path":"/blog/2016/11/web-arquitectura","content":"Amb el **Web d'Arquitectura** gaudim d'un petit laboratori d'investigació que ens permet avaluar tecnologies, provar aspectes que en un futur seran susceptibles de formar part del catàleg de solucions, i posar en producció principis i tècniques que serviran com a patrons per al disseny d'aplicacions.\n\n## Web d'Arquitectura S01E01 \"Pilot\"\n\nEl Web d'Arquitectura actual va néixer de l'antic web del Centre de Suport Canigó, desenvolupat amb _Confluence_, i era difícil de mantenir i evolucionar. En el moment que ens vàrem plantejar la modernització del web i l'ampliació de seccions i continguts, vam estudiar què es feia al món dels bloggers. \n\nAllà hi havia una tendència per a simplificar la pila tecnològica sobre la que corrien els blocs (normalment PHP + MySQL, com en el cas de Wordpress). D'aquest corrent varen començar a sorgir el que s'anomenen **Static Site Generators**. Aquestes eines simplificaven moltíssim la gestió de blocs, mitjançant un sistema de plantilles com qualsevol gestor de continguts. Utilitzant **markdown** com a metallenguatge que es \"compila\" a html, es generaven sites estàtics que es podien allotjar a tan sols un servidor web o en _(diverses plataformes)_ al núvol.\n\nVam considerar interessant aquesta aproximació i vam avaluar diverses eines. D'elles vam considerar [**Hugo**](http://gohugo.io) per la seva senzillesa i potència, per que no incorpora dependències externes (doncs és un sol binari), i aconsegueix un performance molt elevat en la generació del web. Una altra raó colateral es que està desenvolupat amb Golang i va coincidir en el temps amb la nostra investigació d'aquest llenguatge de programació.\n\nUn temps després, a principis de l'any 2015, vàrem publicar el web que esteu llegint.\n\n## Web d'Arquitectura S01E02 \"Hugo\"\n\nEn què ens beneficia, doncs, [**Hugo**](http://gohugo.io)? \n\nParadoxalment, en molts casos ens trobem que el rendiment que donen piles tecnològiques més complexes pel fet de ser dinàmiques, com el nostre vell i estimat model en 3 capes, no és òptim per la quantitat de visites que pateix. Llavors un remei que acostumem a aplicar és guardar, a memòria cau, còpies del html que genera aquest codi dinàmic, que, per disseny, a cada petició accedeix a una base de dades. És a dir, guardem a la caché una còpia de la crida que fa el codi dinàmic a la base de dades i la transformació a html que es serveix a l'usuari final. Llavors, ens trobem que, si obviem aquesta generació dinàmica, només necessitem quelcom que ens generi l'html directament. Val a dir que no tots els webs o aplicacions poden fer servir aquesta tècnica, però per al web d'arquitectura, va encaixar perfectament. Un altre dels principis que pretenim cobrir es que les arquitectures puguin evolucionar segons requeriments o la tecnologia de cada moment. En tenir els continguts en text pla organitzats en carpetes, un canvi d'eina de generació del web seria relativament senzill.\n\n## Web d'Arquitectura: el Making-off\n\nA banda de Hugo com a generador del site, hem anat incoporant diverses peces a mida que anàvem investigant o necessitant de noves solucions tecnològiques. Us fem un breu resum i us explicarem en posts posteriors algunes d'elles:\n\n- **Cercador**: inicialment utilitzàvem el _Google Search Appliance_ com a eina de cerca, però, lligat a que Google discontinuarà aquesta solució i havíem d'investigar-ne de noves, una de les avaluades ens va semblar prou bona i ens ha servit per establir requeriments per al futur **Cercador Corporatiu**. En aquest cas parlem d'[**Algolia**](https://www.algolia.com), un _Search Engine as a Service_ que dóna moltíssimes facilitats per a crear tant l'índex com les pàgines de resultats.\n\n- [**Github**](https://github.com): el web l'editen diversos usuaris i com que, inicialment, l'edició la fèiem en local (cada usuari editor necessitava instal·lar el binari d'Hugo a la seva màquina), necessitàvem un repositori àgil que ens permetés recuperar (git pull) i publicar (git push) els canvis i fer-los visibles als companys. A banda, ens ha servit per avaluar **Git** com a possible substitució del **Subversion** que utilitzem al **SIC**.\n\n- [**Github Pages**](https://pages.github.com): per a publicar el web, de manera que tingui la màxima disponibilitat possible, res millor que un _Content Delivery Network_. En aquest cas, utilitzant Github com a repositori del codi (templates Hugo, contingut markdown, ...), publicar el portal a la solució que ofereix el propi Github per a allotjar webs, ens va semblar una bona idea i ens va servir per a demostrar els beneficis de cloud públic per a segons quines necessitats.\n\n- [**NodeJS**](https://nodejs.org): utilitzem uns scripts desenvolupats amb aquesta tecnologia per a transformar el markdown a un index en JSON que injectem a Algolia. Fem un incremental amb els canvis, de manera que l'índex sempre està operatiu (_zero downtime_): https://github.com/cs-canigo/portal/blob/master/_tasks/algolia/index-algolia.js\n\n- [**Prose.io**](http://prose.io): com hem comentat, inicialment tots els usuaris editors havien d'instal·lar certes eines a la seva màquina (Hugo, client de Git,...). Recentment hem començat a utilitzar Prose com a editor per sobre de Github, cosa que ens permet actualitzar els continguts del portal a través del navegador web. Lligat al punt següent de Continuous Delivery, hem aconeguit tenir la solució totalment lliure de dependències locals i podem treballar únicament amb un navegador web.\n\n- **Continuous Delivery**: la nostra línia objectiu d'evolució del SIC, lligat a la iniciativa de cloud públic/contenidors/xpaas, és normalitzar els conceptes d'integració contínua i lliurament continu. En aquest cas, com que estem parlant d'un web estàtic, no crític, ens ha semblat un bon exemple per a començar. Hem utilitzat una eina al cloud públic ([**Wercker**](http://www.wercker.com)) que simularà el que acabarem fent al SIC amb Jenkins. En aquest cas, hem configurat l'eina per a que rebi un _webhook_ de Github quan es produeix un \"push\" del codi del portal. Aquesta eina s'encarrega de fer la construcció del web (amb Hugo), la indexació a Algolia (amb NodeJS) i la publicació a Github pages (amb Git). Aquí es pot veure el workflow i les pipelines que hem creat: https://github.com/cs-canigo/portal/blob/master/wercker.yml\n\n- [**Disqus**](https://disqus.com): Un cop creat el portal ens va semblar que li faltava un punt de interactivitat. Amb **Disqus** tenim una eina SaaS que ens permet la interacció amb els lectors en base a comentaris al propi bloc. Sent un portal obert al públic, Disqus ens permet també la gestió dels comentaris i així evitar comentaris malsonants o fora de lloc.\n\n![Workflow](/related/blog/workflow.png)\n\n\n## Referències\n\n* Llista de generadors de sites estàtics: https://www.staticgen.com/\n* Markdown: https://guides.github.com/features/mastering-markdown/\n* Codi del web a github: https://github.com/cs-canigo/portal\n* Html generat a github pages: https://github.com/cs-canigo/portal/tree/gh-pages\n","objectID":"L2Jsb2cvMjAxNi8xMS93ZWItYXJxdWl0ZWN0dXJh"},"L2Jsb2cvMjAxNy8wMy9hY2Nlcy1lbGFzdGljc2VhcmNoLWRiYWFz":{"date":1488412800000,"title":"Elasticsearch, open source en cloud públic amb orientació empresarial","description":"L'accés a un Elasticsearch a cloud públic té una sèrie de consideracions de seguretat a tenir en compte","sections":["Blog"],"blog_tags":["dbaas","seguretat"],"imatge":"/images/bloc/elastic-search.png","aliases":["/bloc/2017/03/acces-elasticsearch-dbaas/"],"path":"/blog/2017/03/acces-elasticsearch-dbaas","content":"La base de dades Elasticsearch (ES) en la seva versió de programari lliure no incorpora el mòdul de seguretat [X-Pack](https://www.elastic.co/products/x-pack/security) que permet gestionar-ne els permisos de connexió per prevenir accessos no autoritzats.\n\nLa gestió de la seguretat de la base de dades dedicada a cerques esdevé encara més crítica quan es tracta de solucions hostatjades en clouds públics i per a solucions amb visibilitat en portals web de lliure accés.\n\n## Accés des d’una pàgina web\n\nEn alguns casos, com per exemple cercadors a portals web, és possible que l’accés a l’ES es realitzi directament des del navegador de l’usuari. Per fer-ho, cal que el client disposi de les credencials d’accés a l’ES. No entrarem en detall sobre millors pràctiques de seguretat al respecte, però ho deixarem en què és una pràctica clarament insegura. Pels ES que no incorporin el mòdul X-Pack és més important encara, ja que els usuaris tenen privilegis de lectura i escriptura.\n\nUna opció que nosaltres hem implementat amb èxit per evitar aquesta problemàtica és aprovisionar un Proxy intermig que evita la potencial sostracció de credencials.\n\nLes planes web no haurien d’incorporar les credencials a l’ES donat que la sostracció d’aquestes podria derivar en un ús indegut. Pels ES que no incorporin el mòdul X-Pack és més important encara, ja que els usuaris tenen privilegis de lectura i escriptura.\n\nTenir en compte que el tràfic entre el Proxy i l’ElasticSearch ha d’estar encriptat per a evitar que es pugui interceptar les credencials.\n\n## Accés per la indexació de contingut\n\nAddicionalment a la mesura anterior, és molt recomanable també implementar un control sobre les IP que podran accedir a l’ES per fer les gravacions d’informació que conformen l’índex.\n\nEn el nostre cas, també s’ha posat en pràctica aquest filtratge i l’ES disposa d’una whitelist que només permet l’accés des del backend per poder administar-ne el contingut. \n\nMalgrat tot, si per algun motiu això no fos possible, alternativament també es podria utilitzar el Proxy que desacobla els accessos de les aplicacions per habilitar-hi el mecanisme de filtratge d’IPs en mode whitelist.\n\n![Seguretat accés a ES a cloud públic](/images/bloc/seguretat_es_cloud_public_generic.png)\n\n## Referències\n\n- [Securing Elasticsearch and Kibana](https://www.elastic.co/guide/en/x-pack/current/xpack-security.html)\n","objectID":"L2Jsb2cvMjAxNy8wMy9hY2Nlcy1lbGFzdGljc2VhcmNoLWRiYWFz"},"L2Jsb2cvMjAxNy8wNC9TRE4tMjAxNzA0MDE=":{"date":1491004800000,"title":"Sobre les SDN","description":"Què és i el per què de SDN. Consideracions per dummies que trobem al respecte","sections":["Blog","home"],"blog_tags":["comunicacions","patrons de disseny","sdn"],"imatge":"/images/bloc/XarxesSDN.png","aliases":["/bloc/2017/04/XarxesSDN/"],"key":"ABRIL2017","path":"/blog/2017/04/SDN-20170401","content":"# SDN (Software Defined Network)\n\nSi busquem la definició de SDN, ens trobarem en que es tracta d'una **arquitectura emergent** que és dinàmica, rentable, adaptable i manegable, el que la fa ideal per l'ample de banda i la naturalesa dinàmica de les aplicacions.\nTot i que es tracta d’una *nova* arquitectura (separa el pla de control del pla de dades en els dispositius de xarxa), crec que la importància de la mateixa radica sobretot en el canvi de la forma de treballar permetent adaptar-nos, a nivell de xarxa, a les pròpies necessitats del mercat / aplicacions.\n\n## D'on sorgeix la necessitat\n\nLa pròpia evolució de la societat de la Informació, i en concret d'Internet, ha fet que les necessitats del mercat vagin canviant i, com a conseqüència, els negocis hagin d'evolucionar a gran velocitat. Ens trobem en una situació on conceptes com flexibilitat i rapidesa són fonamentals per evolucionar.\n\nL'evolució dels sistemes d’informació ha estat i esta sent decisiva en el desenvolupament dels negocis,  i no només pel que fa referència al hardware  (major capacitat de processament, memòria, etc) sinó també a nivell de programari, virtualització fonamentalment. \n\nAquesta evolució, juntament amb la aparició de noves tecnologies, estratègies (dockers, microserveis, etc.) ens permet poder crear aplicacions d’una forma ràpida i flexible reduint substancialment el temps emprat per  oferir el nostre producte.\n\n## Canvi en la direcció del tràfic dins dels Data Centers\n\nEns els Data Centera el sentit del tràfic, fins fa poc, era majoritàriament Nord-Sud (vertical). Aquesta tendència està canviat a gran velocitat, passant a ser Est-Oest (horitzontal).\n\nEl motiu d’aquest canvi ve determinat principalment pel canvi / evolució que es produeix en l’arquitectura de les aplicacions, passant d’arquitectures monolítiques a arquitectures distribuïdes, com per exemple els (micro)serveis.\n\n\n![Distribució SDN1](/images/bloc/ImatgeSDN1.PNG)\n\n\n## Però...   i la xarxa?\n\nTot i les evolucions / canvis descrits anteriorment, aquests no seran realment efectius sense l'evolució pertinent del medi sobre el que ha de viatjar la informació, la xarxa. \n\nL’evolució constant dels equipaments de xarxa, ens permet anar *solucionant* tant problemes de capacitat com de configuració. Valgui com a exemple la limitació en quant a les VLANS actives per switch que, a part dels possibles altres problemes que això podria suposar, provocava que el moviment de les maquines virtuals dins del Data Center depengués en molts casos de la realització de tasques prèvies per part de xarxa, amb el temps que això comporta. En l’actualitat, aquesta limitació ja ha estat superada.\n\nTot i així, un dels principals problemes amb què ens trobem és el d’aconseguir una xarxa flexible (on es puguin realitzar canvis de forma immediata),  ràpida i segura. En definitiva, **la xarxa hauria de ser  transparent**. Això permetrà que front a qualsevol canvi i/o nova necessitat ( a nivell d’aplicació / S.I.) la configuració de la part de xarxa no suposi cap “stopper” pel que fa al temps de provisionament. \n\n## Entendre SDN\n\nCom ja hem indicat anteriorment, SDN es tracta d’una arquitectura emergent que es basa principalment en la separació del pla de control del pla de dades dels dispositius de xarxa. \n\nTradicionalment, el funcionament de la xarxa, juntament amb la seva governabilitat està basada en dos conceptes bàsics, el **pla de control** (control plane) i el **pla de dades** (data plane). \n\nEl **pla de control** és l’encarregat de dur a terme totes aquelles accions necessàries per a fer possible l’enviament dels paquets / dades, com pot ser la construcció de la taula de rutes, l’establiment de polítiques de seguretat, etc. En definitiva és l’encarregat de configurar el pla de dades\n\nEl **pla de dades** en canvi, està format per totes aquelles activitats encarregades del propi enviament dels paquets, com per exemple la fragmentació i reconstrucció, replicació pel tràfic multicast, etc.\n\nAquests dos plans es troben presents en els propis dispositius de xarxa separats lògicament o, en alguns dispositius, inclús físicament.\n\n\n![Control vs Dades](/images/bloc/ImatgeSDN2.PNG)\n\nAixò comporta  que front a un canvi s’hagin de configurar  varis dispositius de forma separada, cuidant sempre de no caure en inconsistències. El resultat final és que el temps d'aprovisionament / canvi d’un servei no sol ser curt, afegint el risc que implica el fet d'haver d’anar configurant dispositiu a dispositiu.\n\n## Separació del pla de control del de dades\n\nHem d’entendre que quan parlem de separació d’aquests dos plans, no ens referim a la separació dins del propi dispositiu de xarxa (aquesta ja existeix) sinó que ens referim a l'extracció del pla de control dels dispositius de xarxa, ubicant-lo en un o varis elements externs a la mateixa., el que anomenarem a partir d’ara controlador.\n\nPer tant, el primer que ens proposa SDN, és **centralitzar el Pla de control** en un dispositiu (controlador) que serà l’encarregat de controlar a varis i/o tots els dispositius de xarxa.\n\n![Distribuït vs Centralitzat](/images/bloc/ImatgeSDN3.PNG)\n\nAquesta centralització del pla de control fa que:\n\n- Els switchos tan sols haurien de tenir el pla de dades ( realment, també tenen una mínima part de “pla de control”)\n\n- La xarxa sigui més consistent\n\n- La resposta front a canvis sigui més ràpida\n\n- La gestió de gran quantitat de dispositius sigui molt més fàcil\n\n\n## Arquitectura SDN\n\nSegons la  [Open Networking Foundation (ONF)](https://www.opennetworking.org/), organització que es dedica a accelerar la adopció de SDN y NFV, la arquitectura de SDN la podríem separar en les següents capes:\n\n- **Capa d'infraestructura**. Formada pels nodes / equipaments  de xarxa que realitzen la commutació i enrutament dels paquets.\n\n- **Capa de control**. Es tracta de la capa més important dins de la arquitectura SDN. És la capa on esta ubicada la intel·ligència de la xarxa. Es on ens trobem amb el controlador (programari ) , encarregat de controlar i configurar els nodes de la xarxa dirigint així els fluxes de tràfic, és a dir, la intel·ligència de conmutació i enrutament de les dades dels nodes de la xarxa passa a ser propietat del controlador SDN. La comunicació entre el controlador i els dispositius de la xarxa a controlar, es fa mitjançant un protocol ( per exemple openflow), que pot variar segons el fabricant de la solució. Anomenarem interface *northbound* a la comunicació/fluxe que hi ha entre la capa de control i la d'aplicació i interface *southbound* a la que hi ha entre la capa de cotnrol i la d'infraestructura.\n\n- **Capa d'aplicació**. Aquesta capa esta formada per aplicacions d’usuaris que incideixen directament en el controlador que ens permetran simplificar i automatitzar les tasques de configuració de la xarxa, aprovisionar y gestionar nous serveis, així com extreure informació de negoci, fent que  la xarxa es pugui anar adaptant automàticament a les necessitats que vagin sorgint. Aquestes aplicacions es comuniquen amb el controladors mitjançant APIs de la capa de control com REST, JSON, XML, etc. \n\n\n![Tres capes](/images/bloc/ImatgeSDN4.PNG)\n\n\n\n## On aplicar SDN\n\nTot i que a priori pot semblar que la aplicació de SDN s’hauria de fer en tots els entorns on hi hagi xarxa, cal destacar que aquesta en principi és una tecnologia / arquitectura pensada per Data Centers. Això no vol dir que en altres entorns o tipus de xarxa, com per exemple Nodes de trànsit (NUS de Comunicacions) no s’arribi a aplicar mai, però, la finalitat no es aquesta i per tant encara avui no esta pensada per poder aplicar-se a aquest tipus de xarxa, tot i que s'està treballant perquè acabi de ser una realitat.\n\nSDN ens ha d'aportat tot un seguit d'avantatges:\n\n- Gestió unificada de milers de dispositius\n\n- Escalat dinàmic, és a dir, ens ha de permetre poder créixer d’una forma transparent, sense afectar al servei\n\n- Integració de nous serveis de forma ràpida\n\n- Programable. Hem de ser capaços de programar la xarxa per a que aquesta canviï el seu comportament segons les circumstàncies que es donin\n\n- Automatització: reducció progressiva de les tasques manuals mitjançant l’automatització de les mateixes, evitant així errades operacionals\n\nUna de les principals característiques és la que fa referència a la **\"virtualització” de la xarxa**. Això permetrà, que el propi desenvolupador de la aplicació o l’encarregat dels sistemes d’informació, pugui configurar-se la xarxa de forma automàtica i transparent, és a dir, front una determinada necessitat, la gent de sistemes podrà arribar a configurar-se fins i tot la part de la xarxa, **sense haver de dependre de la intervenció per part del personal que gestiona la mateixa**.\n\nAixò no significa que hi hagi llibertat total per a fer el que vulgui en la xarxa, sempre s’hauran de establir unes normes molt bàsiques que permetran al personal que gestiona la xarxa no perdre el control de la mateixa i per tant garantir el servei. Com a exemple, els administradors de sistemes tindran assignat un pool de vlans per poder crear les xarxes que necessitin. Aquest pool serà definit pels administradors de la xarxa i de forma automàtica, aquestes VLANS s’afegiran i/o borraran dels ports de la xarxa segons necessitats dels administradors de sistemes.\n\nEn definitiva, el que tindrem és una xarxa amb una configuració base, sobre la que de forma automàtica s’aniran creant xarxes superposades (overlay network).\n\n## Maduresa\nTenint present la velocitat a la que s'està evolucionant, per a que la implementació de SDN sigui eficient s’hauria de tenir present:\n\n- Situació actual de la xarxa a transformar. Actualment, ens trobarem amb molta electrònica de xarxa que  no esta preparada i/o no compleix els requisits mínims per a ser gestionada per un controlador SDN.\n\n- Convivència entre xarxes SDN i  no SDN. El pas de les xarxes actuals a SDN no és fàcil (fer-se de cop és poc menys que una bogeria). Per fer possible aquesta evolució, cal anar molt poc a poc amb una planificació molt detallada.\n\n- Hi ha casos en els que separar el pla de control del de dades dels equipaments de xarxa no és el més adient, havent-se d’estudiar tots i cadascuna de les casuístiques  que ens apareguin.\n\nDonada la importància i l’impacte que pot suposar el fet de separar el pla de control del de dades dels dispositius, hi ha una tendència que defineix  SDN com la interacció de les aplicacions (moltes inclús a nivell de negoci) sobre la xarxa, sense la intervenció del operador de la mateixa. Tenint present aquesta definició, ens podem trobar amb:\n\n- **Switchos  que no disposen de pla de control** (tot i que sempre ha d’haver un mínim pla de control només pel fet que han de parlar amb el controlador i guardar les configuracions que aquest els hi fa arribar), el que s’anomena *Out-of-Band control Plane*. En cas de caiguda del controlador, la xarxa no podrà reaccionar front a qualsevol canvi.\n- **Switchos que sí disposen de pla de control**, *In-Band Control Plane*, però tot i així és el controlador el que configura el pla de control de tots i cadascun dels dispositius. En cas de caiguda del controlador, la xarxa podria reaccionar front a determinats canvis / incidències (caiguda d’un port, etc) i sempre, com a cas excepcional,  es podrien configurar els dispositius individualment.   \n\n\n\n### Referències:\n\n- [Open Networking](https://www.opennetworking.org)\n- [CISCO - SDN](http://www.cisco.com/c/en/us/solutions/software-defined-networking/overview.html) \n- [Microserveis](http://canigo.ctti.gencat.cat/blog/2016/08/microserveis/)\n- [SDX Central - SDN](https://www.sdxcentral.com/sdn)\n","objectID":"L2Jsb2cvMjAxNy8wNC9TRE4tMjAxNzA0MDE="},"L2Jsb2cvMjAxNy8wNi9Hb29nbGVDbG91ZE5leHQxNw==":{"date":1498521600000,"title":"Google Cloud Next 17","description":"Novetats Google Cloud Next 17","sections":["Blog","home"],"blog_tags":["cloud","kubernetes","contenidors"],"imatge":"/images/bloc/GC17.png","aliases":["/bloc/2017/06/GC17/"],"key":"JUNY2017","path":"/blog/2017/06/GoogleCloudNext17","content":"![GoogleNext17](/images/bloc/GC17.png)\r\n\r\nGoogle Cloud Next 17 és l'esdeveniment que va organitzar Google a San Francisco els dies 8, 9 i 10 de març. En aquest esdeveniment es presenten les novetats amb vocació empresarial al cloud, tant en el que respecta a lloc de treball (GSuite), com a nivell de construcció i desplegament d'aplicacions (Google Cloud Platform).\r\n\r\n![GSuite](/images/bloc/ImatgeGC17_1.png)\r\n\r\nLa solució de Google al treball col·laboratiu en cloud amb vocació empresarial és [GSuite](https://gsuite.google.es/). Les principals novetats en aquest producte van ser:\r\n\r\n## Team Drive\r\nSimilar a Google Drive però amb vocació corporativa. [Team Drive](https://www.youtube.com/watch?v=ywBuQZOHX-E) permetrà veure'l com a unitat local tot i no estar sincronitzat. La diferència principal amb Google Drive és que els documents emmagatzemats no pertanyen a una persona, sinó a la corporació.\r\n\r\n## App Maker\r\nEntorn de desenvolupament d'aplicacions JavaScript internes orientades a gestió de dades a l'abast dels usuaris funcionals. Permet utilitzar plantilles així com les APIs pròpies de Google per a dotar de funcionalitat les aplicacions de manera senzilla. [App Maker](https://www.youtube.com/watch?v=Br6aNwDXDgQ)\r\n\r\n## Jamboard\r\nPissarra que permet col·laboració en temps real a través de Hangouts.\r\n![Jamboard](/images/bloc/jamboard.jpg)\r\n\r\n![GCPlatform](/images/bloc/ImatgeGC17_3.png)\r\n\r\nPel que respecte a les plataformes cloud que ofereix Google, van presentar les següents novetats:\r\n\r\n## Plataformes d'execució\r\nDisposen de diferents opcions en que els integradors tenen més o menys graus de llibertat:\r\n\r\n- **AppEngines**. Motors d'execució gestionats per Google i utilitzats com a servei on sols es desplega els recursos de l'aplicació, sigui codi o dades.\r\n- **Contenidors**. Desplegament de contenidors a través de l'orquestrador **Kubernetes**.\r\n- **Infraestructura**. Potència a nivell de SO. Equivalent a un element IaaS, on sols es proporciona un SO.\r\n- **Cloud Functions**. Presentada en l'esdeveniment en estat beta. Serveis Serverless, sols s'executa en rebre un esdeveniment.\r\n\r\nLes principals novetats en aquesta categoria es van presentar a Kubernetes.\r\n**Kubernetes** és l'orquestrador de clústers de contenidors opensource desenvolupat per Google. Les seves principals funcionalitats inclouen:\r\n\r\n- **Portable**, entre escenaris de cloud públic, privat o híbrid\r\n- **Auto-corregit**, permet auto-ubicació, auto-restart, auto-rèplica, auto-escalat\r\n- **Balanceig integrat** permet definir regles de balanceig de càrrega entre els recursos\r\n\r\nAlgunes de les novetats presentades en la versió 1.6 de Kubernetes són:\r\n\r\n- Balanceig Multi-Clúster / multi-zona N7 amb SSL amb una única IP. Ingress és un recurs Kubernetes que permet encapsular condicions i configuració per a enrutar tràfic extern a serveis interns.\r\n- Nous paràmetres de desplegament:\r\n- Condicionar el desplegament a la tipologia de hardware sobre el que s'executa:\r\n- Desplega a la màquina més barata\r\n- Desplega a la màquina que té un mínim de prestacions a nivell de maquinari\r\n- Desplega a la màquina que té un mínim de prestacions a nivell de tipus de disc\r\n- Aprovisionament dinàmic de volums estàtics\r\n- Aplicacions amb estat\r\n- Federació de clústers ([Kubefed](https://kubernetes.io/docs/tasks/federation/set-up-cluster-federation-kubefed/)) en diverses regions (fins i tot entre on-premise i cloud)\r\n- Afinitat a pods\r\n- Afinitat a zones geogràfiques\r\n- Definició dinàmica de DNS\r\n\r\n## Emmagatzemament de dades\r\nEn aquesta categoria, la principal novetat va ser la presentació de [Spanner](https://cloud.google.com/spanner/). Una base de dades relacional com a servei, que permet l'escalat horitzontal a diferents zones de disponibilitat. En l'esdeveniment es va presentar una [demo](https://www.youtube.com/watch?v=AC9xUc4SkvU) amb les següents característiques:\r\n\r\n- BBDD desplegada en tres regions Google\r\n- 500.000 vendes transaccionals per minut\r\n- 3 Bilions de files\r\n- 80 TB BBDD\r\n- DBaaS, Completament administrada. Replicació, Failover\r\n\r\n## Data Analytics - Machine Learning\r\nÉs un dels aspectes en que Google aposta fortament. Es van presentar diverses novetats en aquest apartat:\r\n\r\n- **DLP Data Loss Prevention.** Basat en el principi de només guardar les dades que són necessàries, identifica les dades sensibles de les imatges i les oculta abans de guardar-les.\r\n- **API d'indexació d'imatges**. API que permet categoritzar una imatge en diferents eixos, contingut, detecció de cares, OCR, geogràficament, etc.\r\n- **API d'indexació de vídeos**. API que permet categoritzar un vídeo, a més a més d'identificar el seu contingut i el moment en que apareix. Molt il·lustrativa la demo feta a l'esdeveniment: [API vídeo ](https://www.youtube.com/watch?v=mDAoLO4G4CQ)\r\n\r\n## Xarxa\r\nEs van presentar les funcionalitats en la definició de la xarxa en que es va remarcar:\r\n\r\n- **La xarxa ha de ser global.** El cloud ha de ser una extensió de la xarxa local per tal de donar alta disponibilitat en diferents zones en format híbrid (part de la infraestructura en local, i part en el cloud) utilitzant l'espai d'IPs privades pròpies.\r\n- **La xarxa com a servei.** Les funcions de xarxa s'han d'oferir com a serveis distribuïts i gestionats. Dins d'aquest punt es va presentar els diferents models de XPN (Cross-Project Networking), Xarxes privades entre projectes.\r\n\r\nPodeu trobar tota l'agenda de l'esdeveniment a [Schedule](https://cloudnext.withgoogle.com/schedule) i les conferències estan disponibles a [Youtube](https://www.youtube.com/playlist?list=PLIivdWyY5sqI8RuUibiH8sMb1ExIw0lAR).\r\n","objectID":"L2Jsb2cvMjAxNy8wNi9Hb29nbGVDbG91ZE5leHQxNw=="},"L2Jsb2cvMjAxNy8wNi92ZXJzaW9uc19sdHM=":{"date":1496620800000,"title":"Utilització preferent de versions LTS de programari","description":"Les versions LTS (Long-Term Support) de programari lliure són les recomanades i a adoptar com a preferents seguint el criteri d'Arquitectura CTTI","sections":["Blog","home"],"blog_tags":["patrons","LTS","principis"],"categories":["principis"],"imatge":"/images/bloc/keep-calm-and-use-lts-versions.png","key":"JUNY2017","path":"/blog/2017/06/versions_lts","content":"### La necessitat d'un suport a llarg termini\r\n\r\nEl cicle de vida tradicional en molts projectes es desplegar noves versions sovint, o planificar els desplegaments en períodes curts i regulars. En qualsevol cas, cada nova versió inclou tant correccions funcionals com de seguretat i nous evolutius.\r\n\r\nLes grans organitzacions, i altres tipus de col·lectius amb projectes de missió crítica, necessiten les correccions a les vulnerabilitats però sovint prefereixen mantenir la mateixa base de codi per un període estès en el temps sense que hi hagi cap tipus de canvi en les funcionalitats. És habitual que canvis funcionals impliquin introducció de nous errors.\r\n\r\nEncara que es pogués assegurar al 100% que les noves versions estan lliures de defectes, per aquests tipus d'usuaris, el tractament de noves versions és sovint molt car. Actualitzar una aplicació requereix la participació de molts equips que poden fer prohibitiva la certificació contínua de noves versions.\r\n\r\nLes versions de Suport a Llarg Termini d'un programari, també conegudes com a LTS, de l'anglès \"Long Term Support\", usualment adrecen aquestes preocupacions. \r\n\r\n### Què són les versions LTS \r\n\r\nLes versions LTS són un tipus especial de versions o edicions de programari que estan designades per a ser suportades per un període més llarg que el normal. És un concepte que ha aparegut majoritàriament en programari lliure.\r\n\r\nEs tracta d'una política de gestió del cicle de vida del programari, que aplica criteris d'estabilitat de les versions en un termini més llarg de l'acostumat, alterant la freqüència de les noves versions per rebaixar el risc, la despesa i la disruptivitat que provoquen. Les versions LTS despleguen només aquelles actualitzacions que afecten a problemes de seguretat, donat que instal·lar-les aporta menys risc que no fer-ho. \r\n\r\nAl principi d'un període de suport a llarg termini, els desenvolupadors del programari imposen una congelació de les característiques: corregeixen errors i vulnerabilitats, però no introdueixen noves funcionalitats que poden causar problemes de regressió.\r\n\r\n### Nou Principi d'Arquitectura: fer servir versions LTS sempre que el programari escollit les ofereixi\r\n\r\nLes versions LTS ofereixen a la Generalitat una opció ideal per a mantenir el versionat dels components del programari al dia amb una eficiència en cost. També s'adapta millor al cicle de vida habitual de les nostres aplicacions, més llarg que en altres sectors. És per aquest motiu que s'ha decidit introduïr l'ús preferent de versions LTS dins dels [Principis d'Arquitectura](http://canigo.ctti.gencat.cat/principis/):\r\n\r\n```\r\nLes versions de les diferents peces (productes, llibreries, etc) que componen un sistema han de ser el més estable possible, d'aquí que es recomani l'ús de versions LTS (Long-Term Support) o, si de cas hi manca, GA (General Availability) o la nomenclatura que hagi donat el fabricant. Versions productives d'un sistema mai haurien d'incorporar versions no consolidades (snapshot, alpha, beta, release candidate, milestone, etc) dels components que en formen part.\r\n```\r\n\r\n### Exemples\r\n\r\nA continuació es mostra el roadmap de versions de Symfony, NodeJS o Ubuntu com a exemples:\r\n\r\n* Symfony\r\n\r\n![Symfony](/images/bloc/symfony_schedule.png)\r\n\r\n* NodeJS\r\n\r\n![NodeJS schedule](/images/bloc/nodejs_schedule.png)\r\n \r\n* Ubuntu\r\n\r\n![Ubuntu schedule](/images/bloc/ubuntu_schedule.png)\r\n","objectID":"L2Jsb2cvMjAxNy8wNi92ZXJzaW9uc19sdHM="},"L2Jsb2cvMjAxNy8wOS9Bbmd1bGFy":{"date":1504224000000,"title":"Angular: Estat actual i evolució","description":"Angular és un framework de JavaScript de codi obert, mantingut per Google, utilitzat per desenvolupar aplicacions web d'una única pàgina (SPA). Deriva d'AngularJs, un framework Javascript per a SPAs també mantingut per Google, però del que en conserva ben poques coses més enllà de la similitud del nom","sections":["Blog","home"],"blog_tags":["desenvolupament","Eines","SPA","Frameworks","Angular"],"categories":["desenvolupament","Eines","SPA","Frameworks"],"imatge":"/images/bloc/201709/logoAngularllarg.png","key":"SETEMBRE2017","path":"/blog/2017/09/Angular","content":"### Angular: Estat actual i evolució\r\n\r\nAngular és un framework de JavaScript de codi obert, mantingut per Google, utilitzat per desenvolupar aplicacions web d'una única pàgina (SPA). Deriva d'AngularJs, un framework Javascript per a SPAs també mantingut per Google, però del que en conserva ben poques coses més enllà de la similitud del nom.  \r\n\r\n![Angular Logo](/images/bloc/201709/logoAngularllarg.png)\r\n\r\nFem una mica d'història. Des que es va alliberar el codi d'AngularJs, el seu ús i recolzament per part de la comunitat software va ser molt ample. Comparativament amb altres frameworks que oferien funcionalitat similar com ara Vue, React o Ember, l'ús d'AngularJs es va imposar sobre la resta.\r\n\r\nUtilitzant Google trends podem veure la tendència i popularitat d'AngularJs sobre els seus competidors:\r\n\r\n![Tendències](/images/bloc/201709/InteresAngular.png)\r\n\r\nPer què va obtenir tanta popularitat? Hi ha varies raons:\r\n\r\n- Va sortir el primer: la versió 1.0 es va publicar el 2010\r\n- Sent mantingut per Google, generava confiança a la comunitat. Aquesta és, potser, la principal raó de la seva popularitat.\r\n- Aporta una estructura estàndard de directoris per facilitar la organització encara que es tracti d'aplicatius grans\r\n- Un dels objectius principals és la modularitat: és més senzill crear i testejar components\r\n- Corba d'aprenentatge molt plana per començar a produir\r\n\r\nAra bé, si AngularJs ha estat tan exitós i tan ben adoptat per la comunitat, calia trencar-ho tot i fer la transició d'AngularJs a Angular 2 tan traumàtica? Calia mantenir el nom si el canvi entre els dos era tan radical?\r\n\r\nCertament, hi va haver moltes coses millorables al procés, sobretot quan Google va anunciar que no hi hauria pla de migració de AngularJS 1.x a Angular 2.0. Això va acabar de dividir i radicalitzar a la comunitat i fa encara més difícil defensar l'adopció de qualsevol versió d'Angular. Què passarà quan surti una nova versió, diguem-ne Angular 4?  Serà la transició igual de dolorosa? \r\n\r\nAbans de mirar en detall com s'ha de gestionar això de cara al futur, mirem què ofereix Angular 2 respecte a AngularJS:\r\n\r\n- **Suport per plataformes mòbils:** AngularJS va ser pensat només per aplicacions responsives i de dades bidireccionals. L'arquitectura d'Angular, en canvi, està orientada a suport de plataformes mòbils des del començament. El mateix codi és generat diferent segons la plataforma final i l'experiència d'usuari és molt similar a aplicacions natives.\r\n- **Millores de rendiment:** El bootstrap, inicialització de l'aplicatiu, és fa diferent segons la plataforma reduint el temps i millorant l'experiència d'usuari.\r\n- **TypeScript** :  És un superset de JavaScript ES6 mantingut i desenvolupat per Microsoft. Afegeix tipat estàtic i objectes basats en classes. Una de les grans avantatges d'utilitzar TypeScript és el poder detectar errors abans d'executar el codi. És completament compatible amb ES6.\r\n- I molt més...: es canvia a programació basada en components, s'elimina el controvertit $scope d'AngularJS, simplificació de directives, més modular i un llarg etcètera.\r\n\r\nSi Angular és de fet un nou framework i té poc a veure amb AngularJS, és legítim qüestionar-se si val la pena fer la transició d'AngularJS a Angular o de fet triar altre framework.\r\n\r\nPrimer hem de dir que, després de la presentació d'Angular i de tota la incertesa que va generar, Google ha aprés i van reaccionar ràpid:\r\n\r\n- Van oferir un pla de migració ben documentat i fins i tot van publicar llibreries per ajudar amb la transició com ara **ng-upgrade**\r\n- Incorporen el concepte de SEMVER (semantic versioning). Això farà en el futur les actualitzacions menys traumàtiques. Totes les noves publicacions de Angular constaran de 3 números: MAJOR.MINOR.PATCH\r\n\r\n  - MAJOR: Nova funcionalitat amb canvis incompatibles a l'API.\r\n  - MINOR: Nova funcionalitat i és compatible amb versions anteriors\r\n  - PATCH: Corregeix bugs i es manté retrocompatible\r\n\r\nA més, l'equip d'Angular ha assegurat que en un futur una de les seves prioritats és facilitar al màxim la transició cap a noves versions.\r\n\r\nRecentment s'ha publicat la versió 4 d'Angular i la transició de Angular 2 a 4, en contrast a la transició d'AngularJS a Angular és força senzilla i molt ben documentada.\r\n\r\n![Tuit](/images/bloc/201709/tuit.png)\r\n\r\nCom hem mencionat, la versió actual és Angular 4, que va sortir el març de 2017. I què va passar amb la versió 3? Angular 3 mai va ser publicada.\r\n\r\nEn utilitzar el versionat semàntic es van trobar amb un problema amb la numeració de la llibreria router. Per ser coherents amb la nova adopció del SEMVER és va decidir de passar de la versió 2 a la 4 directament i així poder oferir un versionat coherent per totes les llibreries.\r\n\r\nI com queda el panorama actual? On es situa Angular respecte als seus competidors?\r\n\r\n![Tendències](/images/bloc/201709/InteresAngularvsCompetencia.png)\r\n\r\nPer ser justos, la cerca per AngularJS engloba a AngularJs i Angular. A més, altres mètriques com la quantitat d'estrelles per projecte a github o npm trends, la quantitat de vegades que es baixa una llibreria, dóna com a guanyador a React sobre Angular. Com és possible?\r\n\r\nPrimer, React té el suport d'una gran companyia com és Facebook. Aquesta llibreria s'ocupa de la part vista del patró MVC mentre que Angular és un framework i ofereix una solució completa per MVC a la part explorador així que no són totalment comparables. Una comparativa més acurada seria React + [Redux](http://redux.js.org/) contra Angular tot i que React es pot utilitzar amb altres frameworks.\r\n\r\nA més React no ha experimentat una revolució tan traumàtica com Angular i això ha permès fidelitzar més a la seva comunitat. Tot i que Google no ha sabut fer bé la transició d'AngularJs a Angular, han certament aprés de les seves errades i la projecció és clarament al alça.\r\n\r\nTant React com Angular semblen a dia d'avui les opcions més estables i recolzades per la comunitat tot i que l'esperança de vida de qualsevol tecnologia és difícil de estimar avui en dia.\r\n\r\nA CTTI observem que els projectes que ens arriben s'alineen bastant amb les tendències vistes anteriorment. \r\n\r\nEstàndards emergents com WebAssembly, que permet l'execució de codi nadiu dins de màquines virtuals al browser, o web components, que permet estendre HTML i definir components reutilitzables, arriben per segmentar, encara més, un diversificat univers frontend.\r\n\r\n![Estàndards](https://imgs.xkcd.com/comics/standards.png)\r\n\r\nFont original:  https://xkcd.com/927/\r\n\r\n### Referències:\r\n\r\nAngular is not a massive monolith – but your mom is:\r\n\r\n[https://gofore.com/angular-is-not-a-massive-monolith/](https://gofore.com/angular-is-not-a-massive-monolith/)\r\n\r\nAngular 1 to Angular 2 Upgrade Strategy:\r\n\r\n[https://docs.google.com/document/d/1xvBZoFuNq9hsgRhPPZOJC-Z48AHEbIBPlOCBTSD8m0Y/edit](https://docs.google.com/document/d/1xvBZoFuNq9hsgRhPPZOJC-Z48AHEbIBPlOCBTSD8m0Y/edit)\r\n\r\nReact vs Angular: An in-depth comparison\r\n\r\n[https://www.sitepoint.com/react-vs-angular/](https://www.sitepoint.com/react-vs-angular/)\r\n\r\nAngularJS to Angular quick reference\r\n\r\n[https://angular.io/guide/ajs-quick-reference](https://angular.io/guide/ajs-quick-reference)\r\n","objectID":"L2Jsb2cvMjAxNy8wOS9Bbmd1bGFy"},"L2Jsb2cvMjAxNy8wOS9oaWJyaWRhY2lvLW9mZmljZTM2NQ==":{"date":1505433600000,"title":"Hibridació de l'autenticació i de la gestió d'identitats amb Office365","description":"Arquitectura implementada per a assolir la hibridació de la capa de gestió d'identitats i de control d'accés amb l'Office365 de la Generalitat","sections":["Blog","home"],"blog_tags":["gestió identitats","GICAR","Office365","Microsoft","cloud"],"categories":["gestió identitats","GICAR","Office365","Microsoft","cloud"],"imatge":"/related/gicar/adfs-index.PNG","key":"SETEMBRE2017","path":"/blog/2017/09/hibridacio-office365","content":"El present document té per objectiu explicar el projecte d'hibridació de l'autenticació amb Office365 (Exchange Online, Skype Empresarial, OneDrive Empresarial, Office Online) dels usuaris de la Generalitat de Catalunya, i quina és l'arquitectura implementada per a dur a terme aquesta funcionalitat.\n\n## Antecedents\n\nLa Generalitat de Catalunya abans d'iniciar aquest projecte disposava de les següents eines per a gestionar les identitats dels seus empleats i col·laboradors:\n\n### Al CPD de la Generalitat (On premise)\n\n- El sistema corporatiu de gestió d'identitat (GICAR) amb 230.000 identitats actives\n\n- Un Exchange desplegat sobre un domini Windows per donar servei al correu corporatiu. Aquest Exchange disposava d'unes 90.000 bústies nominals + 20.000 de genèriques.\n\n- Les 90.000 bústies nominals estaven desplegades sobre identitats que venien sincronitzades des de la Gestió d'Identitats Corporativa (GICAR).\n\n### Al Núvol\n\n- Es disposava d'un tenant d'Office365, associat al domini gencat.cat, però sense cap lligam amb el Exchange i domini On Premise.\n\n- Els usuaris entraven als serveis del núvol amb un usuari i contrasenya diferent al corporatiu GICAR.\n\n- No hi havia cicle de vida dels usuaris al núvol. Quan un usuari marxava de la Generalitat no hi havia una sincronía entre la petició de baixa de GICAR i la d'aquest compte per a esborrar la identitat i la informació associada a aquella identitat a Office365.\n\n## Arquitectura\n\n### Requeriments a donar compliment\n\nS'ha proposat i desplegat la següent arquitectura, suportada per Microsoft, per a donar compliment als següents requeriments:\n\n- Mateixes credencials a la plataforma d'Exchange On Premise i als serveis del núvol.\n\n- La informació dels usuaris a la Plataforma d'Exchange On Premise ha d'estar reflectida a l'Exchange del núvol. No tota la informació sino només un subconjunt rellevant per a l'ús de les aplicacions al núvol.\n\n- Contrasenya de l'usuari nominal gestionada per GICAR, gestionable a través del Portal d'Autogestió de Contrasenyes, sotmesa a la Política de caducitat de les contrasenyes corporativa i hostatjada al CPD de la Generalitat.\n\n- Cicle de vida de les identitats nominals, tant a on Premise com al núvol, gestionat per GICAR.\n\n- Propagació de la llibreta d'adreces de l'Exchange On Premise cap als serveis d'Office365.\n\n### Descripció de les peces que componen l'arquitectura\n\nA continuació es descriuen les peces que componen aquesta arquitectura:\n\n![Integració Aplicacions GICAR](/related/gicar/adfs-hibridacio.PNG)\n\n- GICAR: plataforma de Gestió d'Identitats corporativa encarregada d'aprovisionar els usuaris i les contrasenyes d'aquests al directori actiu On Premise.\n\n- OIM (Oracle Identity Manager): component de GICAR que és l'encarregat d'efectuar aquesta sincronització.\n\n- Directori de LT1: directori actiu on Premise que conté les identitats que accedeixen tant a l'Exchange On Premise com a l'Office365.\n\n- ADFS: Servidors d'Active Directory Federation Services que s'encarreguen de validar l'autenticació de les identitats contra el Directori de LT1. Aquests servidors són accessibles només des de la xarxa de la Generalitat. Per a accedir a aquests des de fora del nus de comunicacions de la Generalitat, s'ha d'accedir a través dels servidors WAP, que fan de proxy invers, per a dotar de més seguretat als ADFS.\n\n- WAP: Web Application Proxy és un rol de servidor Windows que proporciona una funcionalitat de servidor proxy invers per a aplicacions web dins de la xarxa corporativa, per permetre que els usuaris de qualsevol dispositiu puguin accedir des de fora de la xarxa corporativa.\n\n- AD Sync: Servidor que conté el producte AADConnect que s'encarrega de sincronitzar les identitats del Directori de LT1 cap al directori d'Azure, a través del qual es pot donar accés a les aplicacions d'Office365. A través d'aquest servidor se sincronitzen les dades mínimes dels usuaris per a poder fer servir els serveis d'Office365, i no se sincronitza la contrasenya corporativa. No se sincronitzen tampoc cap al núvol els usuaris sensibles que no es veuen a la llibreta d'adreces de l'Exchange On Premise.\n\n- AD Azure: Directori de Microsoft al núvol, el qual permet gestionar l'accés pels usuaris als recursos de l'Office365.\n\n![Integració Aplicacions GICAR](/related/gicar/adfs-arquitectura.PNG)\n\n## Descripció del procés d'autenticació\n\nEl procés d'autenticació que se segueix de cara a que l'usuari pugui accedir als serveis de l'Office365 està basat en el protocol WS-FED, variant del protocol SAML.\n\nQuan un usuari intenta accedir a un dels serveis de l'Office365 es produeixen les següents accions:\n\n1.- Intent d’accés al recurs d’Office365 i introducció de nom d’usuari @gencat.cat.\n\n![Integració Aplicacions GICAR](/related/gicar/adfs-pas1.PNG)\n\n2.- Redirecció de l’usuari al ADFS de Gencat per a fer login\n![Integració Aplicacions GICAR](/related/gicar/adfs-pas2.PNG)\n\nLa redirecció es fa amb els paràmetres que necessita el ADFS per identificar l'aplicació origen d'on ve la petició. Quan l'accés a aquest ADFS es fa des d'internet, les peticions es fan a través d'un servidor WAP.\n\n3.- L’ADFS de GENCAT valida credencials contra el directori de LT1. **Procés efectuat a On Premise**\n\n4.- El directori de LT1 retorna OK/KO de les credencials. **Procés efectuat a On Premise**\n\n5.- ADFS de GENCAT retorna token amb la sessió de l’usuari. **Procés efectuat a On Premise**\n\nPer a fer això l'ADFS efectua un POST a **https://login.microsoftonline.com/login.srf** amb el paràmetre **wresult** que conté el XML de tornada cap a Office365 signat per l'ADFS.\n\nAl estar aquest token signat per l'ADFS, no és possible generar aquesta resposta per un tercer si no disposa del certificat de signatura dels tokens que només té el ADFS.\n\n6.- Amb aquest token es concedeix l’accés a Office365:\n![Integració Aplicacions GICAR](/related/gicar/adfs-pas3.PNG)\n\n## Descripció del procés de sincronització d'usuaris\n\nEl procés de sincronització d'usuaris permet que l'Office365 pugui trobar els usuaris al AD Azure i per tant, se li puguin assignar grups i autoritzacions a l'Office365.\n\nAquest procés es dispara cada tres hores a la màquina del AADConnect, i el que fa és sincronitzar els canvis que hi ha hagut al directori de LT1 cap l'AD Azure.\n\nAquest procés sincronitza només cap a l'AD Azure els atributs d'usuari que es poden veure a través de la llibreta d'adreces corporativa.\n\nEl procés de rèplica d'aquesta informació cap al núvol es fa de manera segura mitjançant protocol TLS per assegurar la confidencialitat de les dades que es repliquen.\n\nQuan Recursos Humans dels Departaments de la Generalitat fan una baixa a GICAR, a través d'aquest procés de sincronització d'usuaris, aquesta també es replica al AD Azure, impedint a l'usuari poder accedir al seu compte un cop ja no està en l'organització.\n\n\n## Altres funcionalitats que ens permetrà aquesta arquitectura en el futur\n\n- A banda de la federació del servei d'Office365 anteriorment descrita, aquesta solució de federació permet també la integració de portals web On Premise amb aquest flux d'autenticació. L'ADFS permet doncs la validació/generació de tokens cap a aplicacions On Premise (en el nostre cas s'ha fet ja amb aplicacions corporatives de col·laboració) o núvol (en el nostre cas Office365). En un futur poden ser més les aplicacions que s'integrin amb aquesta arquitectura, no necessàriament lligades a tecnologies Microsoft.\n\n- El fet de tenir els usuaris corporatius de la Generalitat aprovisionats a AD Azure també obre la porta a poder fer ús d'aquests usuaris en futures aplicacions de la Generalitat que puguin ser desplegades al CPD d'Azure.\n\n## Conclusions\n\n- Amb aquest tipus d'arquitectura es permet fer l'autenticació a l'Office365 sense haver de passar credencials d'usuari al núvol. Tot el procés d'autenticació es fa a On Premise, i només es passa cap al núvol un token signat amb l'identificador de l'usuari que s'ha autenticat.\n\n- Amb aquest model d'arquitectura les dades dels usuaris a l'Office365 són consistents amb les dades dels usuaris a GICAR. Les dades que l'usuari tingui als serveis al núvol seran fidedignes amb les que hi ha a GICAR.\n\n- Amb aquest model d'arquitectura el cicle de vida de l'usuari queda cobert, i una baixa d'un usuari a GICAR queda reflectida a l'Office365 evitant així la proliferació de comptes orfes d'usuaris que ja no estan a l'organització, i conseqüentment el cost en llicències innecessari que això podria implicar.\n\n- Aquesta arquitectura podria ser utilitzada per altres aplicacions on Premise que puguin requerir d'ADFS com a mecanisme d'autenticació.\n","objectID":"L2Jsb2cvMjAxNy8wOS9oaWJyaWRhY2lvLW9mZmljZTM2NQ=="},"L2Jsb2cvMjAxNy8xMi9wcmluY2lwaXNtaWNyb3NlcnZlaXM=":{"date":1513382400000,"title":"Principis de Microserveis","description":"Un cop acabada la transformació del maquinari i dels programaris que suporten les aplicacions, comencem a observar una certa tracció en les necessitats de posar al dia també les aplicacions. En la majoria de casos són plantejables la conversió de monòlits en aplicacions basades en microserveis. En aquest post, continuem la sèrie d'articles sobre els microserveis i presentem els principis que han de governar el disseny i la implementació de les aplicacions basades en microserveis.","sections":["Blog","home"],"blog_tags":["patrons de disseny","microserveis","automatitzacio"],"categories":["microserveis"],"imatge":"/images/bloc/Services4.png","key":"DESEMBRE2017","path":"/blog/2017/12/principismicroserveis","content":"## Principis de Microserveis\r\n\r\nUn cop acabada la fase de transformació i posada al dia del maquinari i dels programaris base que suporten les aplicacions de la Generalitat, a Arquitectura CTTI comencem a observar interès en posar al dia també les aplicacions. En la majoria de casos es posa damunt de la taula la conversió d'aplicacions monòlits cap a aplicacions basades en microserveis. D'aquesta manera es pretén dotar de lleugeresa i adaptabilitat als canvis a les aplicacions. Aquestes acostumen a durar molts més anys que les infraestructures i programaris que les sustenten. Per tant, gaudir d'aplicacions basades en arquitectures flexibles i que facilitin els canvis esdevé un factor d'èxit decisiu. \r\n\r\nEn aquest post, continuem la sèrie d'articles sobre els [microserveis](http://canigo.ctti.gencat.cat/blog/2016/08/microserveis/) i presentem els principis que han de governar el disseny i la implementació de les aplicacions basades en microserveis. En properes entrades continuarem aprofundint en les arquitectures de microserveis i iniciarem una nova sèrie sobre la Refactorització d'aplicacions.\r\n\r\n*Aquest post està basat en una sèrie de ponències i material videogràfic creat per [Sam Newman](http://samnewman.io/)*\r\n\r\n![Microservices logo](/images/bloc/Services4.png)\r\n\r\n### Què són els microserveis?\r\n\r\nEls microserveis són serveis petits i autònoms que treballen plegats. Cadascun d'aquests serveis té una funció determinada, i la fa bé. Una aplicació està composada per uns quants d'aquests serveis, que poden ser propis o creats per altres equips de dins o de fora de l'organització. En ser molts i petits, l'arquitectura, el disseny, el desenvolupament i les operacions dels microserveis són substancialment diferents dels sistemes monolítics. En aquests principis es mostren directrius per a crear una bona arquitectura de microserveis:\r\n\r\n### 1. Han de ser modelats sobre el domini de negoci que volem cobrir.\r\n\r\nSembla un principi trivial i simple, però trenca d'arrel el model que s'ha anat seguint els darrers anys: els serveis es creaven per capes tecnològiques; presentació, dades, totes les funcionalitats agrupades en una única capa de negoci, interoperabilitat, etc. En canvi, els microserveis es dissenyen per a cobrir funcionalitats senceres, de dalt a baix. Les capes tecnològiques s'utilitzen només dins del propi àmbit funcional del microservei. El **disseny basat en el domini de negoci** ajuda a trobar **límits estables** (un pagament de nòmines sempre serà això mentre hi hagi treballadors a qui pagar una nòmina!), i preparats per a ser **reutilitzables**  en l'aplicació que l'ha creat, o en altres (es poden pagar n varietats de nòmines, independentment dels tipus de contracte que estigui vigent segons la llei).\r\n\r\n### 2. Es basen en l'automatització.\r\n\r\nAquest és un principi crucial. Quan hi ha més parts a controlar, l'automatització és clau per a poder construir i desplegar l'aplicació. Les dependències, que són difícils de gestionar en qualsevol producte de programari, esdevenen un maldecap encara major si no **s'automatitzen els canals de construcció i desplegament** dels microserveis. Deixar clar per escrit (en un script o fitxer de configuració) quines són les dependències i com s'han d'executar la construcció i el desplegament dels microserveis és la clau per a no fracassar. L'**aprovisionament de plataformes per codi**, assegura que els microserveis es comporten sempre de la mateixa manera, doncs els entorns d'execució són exactament iguals a com s'han definit cada cop. D'aquesta manera s'evita que cada entorn es comporti de manera diferent perquè s'ha creat manualment. L'**automatització de les proves** assegura que els resultats són coherents de versió en versió, detectant fàcilment si les funcionalitats no es cobreixen en qüestió de minuts.\r\n\r\nSi no es té prou clar aquest principi, millor no posar-s'hi.\r\n\r\n### 3. Ocultar els detalls de la implementació.\r\n\r\nUn dels errors que sovint cometen els sistemes distribuïts és el d'acoblar excessivament els seus serveis entre ells. Dissenyar i crear **contextos limitats**, amb abast determinat i sense interseccions amb altres serveis. Com està fet el servei per dins, no ha d'afectar a com els seus clients el consumeixen. De la mateixa manera, com més clients de diferents tecnologies pugui tenir un servei, més èxit tindrà i més podrà evolucionar. Per tant cal **evitar a tota costa**: \r\n\r\n* **accessos directes a la base de dades** del nostre servei, \r\n\r\n* fer servir **protocols propietaris** a una tecnologia concreta (RMI només funciona amb java), o\r\n\r\n* utilitzar la distribució de **clients o agents** com a mitjà de connexió als nostres serveis. En aquest cas la distribució de clients i el seu manteniment és un maldecap addicional. \r\n\r\n**Com més universals siguin els protocols i la forma de cridar als nostres serveis, millor**. **REST** és potser el paradigma d'aquest principi.\r\n\r\n### 4. Descentralitzar-ho tot.\r\n\r\nCom ja s'hi introduïa en la definició, els microserveis han de ser **autosuficients** en recursos i en decissions de disseny. Cada equip que crea microserveis ha d'actuar com un **operador autònom** en les decisions que afecten a la funcionalitat que pretenen cobrir. Una dependència d'altres elements, com una capa única de presentació, una base de dades centralitzada, o un bus de serveis, trenquen aquest principi de disseny. El microservei necessitaria doncs d'altres equips i recursos i en dependria de llurs decisions i de la seva disponibilitat. \r\n\r\nEn el cas de processos de llarga durada que requereixen la participació de varis microserveis, considerar tècniques com l'**orquestració** o la **coreografia** de serveis, implementades com un agregat de microserveis.\r\n\r\n### 5. Desplegar-los independentment.\r\n\r\nÉs la característica més important que necessiten els microserveis. **Cada servei ha de desplegar-se en un sistema operatiu** per a poder gaudir d'independència d'altres components; la utilització de contenidors permet crear màquines mínimes per a un sol servei, sense haver de pagar els peatges de la sobrecapacitat dels servidors físics o dels recursos dedicats pels hipervisors en el cas de la virtualització. \r\n\r\nEls serveis han de poder variar sense afectar als seus consumidors. Per això és convenient establir **contractes dirigits pels consumidors**. En aquests, els consumidors estableixen les seves expectatives de funcionament en base a uns tests que faciliten als propietaris del microservei. Si la nova versió del servei falla en executar aquests tests, aquesta no pot pujar a producció doncs faria fallar l'execució a aquest consumidor. \r\n\r\nEls serveis s'han de poder versionar independentment de les necessitats i els calendaris dels consumidors. Mitjançant la **Coexistència de versions** els serveis poden anar publicant noves versions sense afectar als consumidors de versions antigues. Aquesta pràctica ha de tenir un compromís per anar eliminant versions obsoletes, sinó, el manteniment dels serveis requeriria de múltiples branques actives. Aquesta és una pràctica altament desaconsellada per la complexitat que afegeix al desenvolupament en cas d'haver d'aplicar correccions a vàries versions vives. \r\n\r\nUna altra tècnica que es pot utilitzar és la de **punts finals múltiples** en què el servei desplega noves APIs en ports o camins diferents de l'aplicació, deixant el codi antic donant servei a les APIs originals. Aquest és un mètode útil en la majoria de casos, especialment quan no es pot controlar el calendari de canvis dels consumidors, com en el cas d'APIs públiques. \r\n\r\n### 6. Donar preferència als consumidors dels serveis.\r\n\r\nDissenyar serveis perquè siguin usats posa als consumidors d'aquests en primera línia de les preocupacions dels desenvolupadors. **Conèixer els teus consumidors** i que aquests et coneguin és primordial perquè els serveis facin bé la feina per la que han estat creats. Els **contractes creats pels consumidors** són una bona eina per a conèixer les expectatives dels consumidors respecte als serveis que es publiquen. Uns **estàndards d'ús clars** i que s'entenguin ajuden a que els consumidors entenguin la seva funció sense dubtes. Per això resulten útils eines com els **documentadors d'APIs**, els **programaris de descoberta de serveis** o els **registres llegibles per humans**.\r\n\r\n### 7. Aïllar les caigudes.\r\n\r\nEn una arquitectura basada en microserveis, el fet que un microservei falli no ha de comportar que tot el sistema caigui. L'arquitectura ha de dissenyar-se tenint en compte aquesta eventualitat, i que l'error d'un servei no bloquegi l'execució d'altres serveis en la mesura del possible. Hi ha tres tècniques que poden ajudar a mantenir viva l'aplicació malgrat que un o varis serveis caiguin:\r\n\r\n* **Timeouts**. Posant timeouts adequats a la durada esperada de l'execució d'una crida a un servei pot donar més temps a resoldre el problema i fer el sistema més resilient. Un microservei que ha de tenir un temps de resposta sub-segon, no cal que tingui un timeout de 10 minuts.\r\n\r\n* **Mampares**. En un ús semblant a les mampares dels vaixells, separar els fils d'execució en pools de connexions dedicats en exclusiva a serveis diferents. Per tant si un servei cau no afecta a altres serveis que estan funcionant.\r\n\r\n* **Tallacircuits**. Com els que tenim a les entrades de les cases per evitar mals majors amb l'electricitat, els tallacircuits en microserveis donen una resposta alternativa als consumidors quan el servei no pot funcionar de la manera que s'espera.\r\n\r\n### 8. Altament observables.\r\n\r\nEn sistemes tradicionals, la **monitorització estàndard** basada en logs, temps de resposta i codis d'error a més a més del seguiment de les variables de CPU, espai en disc, memòria i I/O poden ser suficients. Però en el cas dels microserveis, amb múltiples parts mòbils i donant aquesta informació, pot ser inviable fer un seguiment a la manera clàssica. L'automatització i l'**agregació de logs i d'estadístiques** són claus per a donar una visió holística del sistema. \r\n\r\nEls microserveis poden fallar malgrat que estiguin aixecats i reportant bon funcionament de forma individual. La **monitorització de corrent** captura disfuncions de l'orquestració dels microserveis provocades per la xarxa o per altres sistemes de suport a l'execució. La **monitorització semàntica**, en què s'executa un circuit funcional complet, com \"Crear un Expedient\", és útil per avaluar les funcionalitats més crítiques d'un sistema. Cal notar que aquestes transaccions són falses i que no han d'introduir soroll al sistema. La introducció de rastres o **IDs de correlació** pot donar idea de per on ha anat passant l'execució d'una funcionalitat. Aquesta tècnica és especialment útil en sistemes dirigits per esdeveniments. És una eina molt potent a l'hora de realitzar investigacions d'informàtica forense. Finalment, la creació de **panells** on es mostri tota la informació en temps real del comportament del sistema i dels microserveis que el composen ajuden a la comprensió i al seguiment del seu funcionament.\r\n\r\n\r\n## Referències:\r\n\r\nSam Newman: \"Principles of Microservices\"\r\n[http://samnewman.io/talks/principles-of-microservices/](http://samnewman.io/talks/principles-of-microservices/)\r\n\r\nSam Newman: \"The Principles of Microservices. Embrace Autonomy to Optimize Performance\" [http://shop.oreilly.com/product/0636920043935.do#](http://shop.oreilly.com/product/0636920043935.do#)\r\n\r\nSam Newman: \"Building Microservices\"\r\n[http://shop.oreilly.com/product/0636920033158.do?cmp=af-code-books-video-product_cj_0636920033158_7739078](http://shop.oreilly.com/product/0636920033158.do?cmp=af-code-books-video-product_cj_0636920033158_7739078)\r\n","objectID":"L2Jsb2cvMjAxNy8xMi9wcmluY2lwaXNtaWNyb3NlcnZlaXM="},"L2Nhbmlnby9kb3dubG9hZA==":{"date":1422115902000,"title":"Binaris de Canigó","description":"Descàrrega de les diferents versions de Canigó, entorn de treball, plugin d'eclipse...","sections":"Canigó","weight":4,"path":"/canigo/download","content":"## Maven\r\n\r\n*Repositori*: https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/\r\n\r\nPer a utilitzar el repositori, en realitat grup de repositoris, s'ha d'afegir el certificat del domini \"sic.ctti.extranet.gencat.cat\" al \"cacerts\" de Java des d'on s'executi el procés Maven que construeixi l'aplicació Canigó. Les passes a seguir són les següents:\r\n\r\n* Descarregar el certificat de la web mitjançant un navegador. Per exemple amb Google Chrome es pot fer amb les \"Eines per a desenvolupadors\" -> \"Seguretat\" -> \"Veure certificat\" -> \"Detalls\" -> \"Exportar\"\r\n\r\n* Importar el certificat (Ex. \"certificat.cer\") al magatzem \"cacerts\" de Java amb l'eina keytool inclosa dins la JDK:\r\n\r\n    $ keytool -keystore cacerts -importcert -alias canigo -file certificat.cer\r\n\r\nUn cop importat el certificat els processos Maven executats que utilitzin la JDK on s'ha importat el certificat seran capaços de descarregar dependències del grup de repositoris.\r\n\r\nAl settings.xml del Maven configurar el repository al profile per defecte:\r\n\r\n```\r\n\t<profile>\r\n\t\t<id>defaultProfile</id>\r\n\t\t<activation>\r\n\t\t\t<activeByDefault>true</activeByDefault>\r\n\t\t</activation>\r\n\t\t<repositories>\r\n\t\t\t<repository>\r\n\t\t\t\t<id>canigo</id>\r\n\t\t\t\t<url>https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/</url>\r\n\t\t\t\t<snapshots>\r\n\t\t\t\t\t<enabled>true</enabled>\r\n\t\t\t\t\t<updatePolicy>always</updatePolicy>\r\n\t\t\t\t</snapshots>\r\n\t\t\t\t<releases>\r\n\t\t\t\t\t<enabled>true</enabled>\r\n\t\t\t\t</releases>\r\n\t\t\t</repository>\r\n\t\t</repositories>\r\n\t\t<properties>\r\n\t\t\t<downloadSources>true</downloadSources>\r\n\t\t\t<downloadJavadocs>false</downloadJavadocs>\r\n\t\t</properties>\r\n\t</profile>\r\n  \r\n```\r\n\r\n## Canigó 3.2 \r\n\r\n- [Mòduls de Canigó 3.2](https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/)\r\n- [Release notes Canigó 3.2](/canigo-download-related/release-notes-canigo-32)\r\n- [Matriu de Compatibilitat Canigo 3](/canigo-download-related/matrius-compatibilitats)\r\n\r\n|          Versió LTS Actual       \t |      Última versió disponible    \t |\r\n|--------------------------------- \t |------------------------------------\t |\r\n|              3.2.0.1            \t |                3.2.4 \t             |\r\n\r\n\r\n### Creació de l'entorn local\r\n\r\n<!--\r\n- Descàrrega de l'[entorn base de treball](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/entorn-treball/canigo3.html) *És necessari realitzar l'upgrade del plugin de Canigó per Eclipse a la versió 1.2.0.\r\n- Guia d'inici per a la configuració d'un entorn de desenvolupament. Veure aquest [link](/canigo-download-related/guia-inici)\r\n-->\r\n\r\nVeure [Entorn desenvolupament Canigó](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/)\r\n\r\nAltra informació d'interés:\r\n\r\n* [Plugin Canigó 3.2 per a Eclipse i creació d'aplicació](/canigo-download-related/plugin-canigo)\r\n* [Codi plantilla demo Canigó 3.2] (https://github.com/gencatcloud/plantilla-demo-canigo32)\r\n\r\n## Canigó 2.3.22\r\n\r\n- [Serveis de Canigó 2.3.22](https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/canigo/)\r\n- [Connectors de Canigó 2.3.22](https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/canigo/connectors/)\r\n- [Release notes Canigó 2.3.22](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10452)\r\n- [Plantilla Canigó 2.3.20 (Amb exemples) (format .zip)](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/plantilla-canigo-inicial/2.3.20/demo-canigo-2.3.20.zip)\r\n- [Plantilla Canigó 2.3.20 (Sense exemples) (format .zip)](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/plantilla-canigo-inicial/2.3.20/plantilla-canigo-2.3.20.zip)\r\n- [Contingut estàtic versió 2.3.20 (Comprimit) (format .zip)](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/plantilla-canigo-inicial/2.3.20/demo-canigo-static-compress-2.3.20.zip)\r\n\r\n### Creació de l'entorn local\r\n\r\n- Descàrrega de l'[entorn base de treball](https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/canigo/entorn-treball/canigo.zip)\r\n- Guia d'inici per a la configuració d'un entorn de desenvolupament. Veure aquest [link](/canigo-download-related/guia-inici-canigo2)\r\n\r\n<p>&nbsp;</p>\r\n\r\n## Versions anteriors 2.x\r\n\r\nPer a versions antigues del Framework Canigó, contacteu amb el Centre de Suport.\r\n<p>&nbsp;</p>\r\n","objectID":"L2Nhbmlnby9kb3dubG9hZA=="},"L2Nhbmlnby9lbnRvcm4tZGVzZW52b2x1cGFtZW50":{"date":1447804800000,"lastmod":"2017-11-20","title":"Entorn de desenvolupament","description":"Màquina virtual amb l'ecosistema d'eines Canigó per a començar a desenvolupar","sections":"Canigó","weight":99,"path":"/canigo/entorn-desenvolupament","content":"### Objectius\r\n\r\n* Facilitar la posada en marxa de l'entorn de desenvolupament, aprovisionant una màquina virtual amb tot el necessari per a començar el desenvolupament d'una aplicació Canigó.\r\n* Simular els entorns de desplegament als CPD Generalitat, facilitant contenidors amb les mateixes versions i configuracions dels PaaS que ens trobarem als clouds.\r\n\r\n### Pre requisits\r\n\r\n* [Virtualbox](https://www.virtualbox.org/wiki/Downloads)\r\n* [Vagrant](http://www.vagrantup.com/downloads.html)\r\n* [Vagranfile](https://github.com/gencat/dev-environment/releases/tag/2.0.0) amb la configuració de l'entorn Canigó\r\n\r\nLa creació de la VM ha estat certificada amb Vagrant 1.8. Es recomana l'ús d'aquesta versió o superior.\r\n\r\n### Com començar?\r\n\r\n* Descarregar i descomprimir el [zip](https://github.com/gencat/dev-environment/archive/2.0.0.zip) a la carpeta que desitgem (p.e. c:/vms o /home/user/vms)\r\n\r\n* Anar per línia de comanda a la carpeta on estigui el Vagrantfile i executem:\r\n\r\n\t\tvagrant up\r\n\r\n\tAmb aquesta instrucció, vagrant aixecarà una màquina virtual a Virtualbox i executarà les comandes que inclogui el Vagrantfile. El temps d'instal·lació serà llarg degut a que instal·la tot el software necessari per a desenvolupar i desplegar en els entorns de proves (es pot veure què instal·la reseguint el shell script).\r\n\r\n* En el moment que a la màquina virtual aixecada es vegi l'escriptori, el procés ja haurà finalitzat. Podem tancar la màquina i engegar-la i aturar-la a través de VirtualBox.\r\n\r\n\r\n### Setup inicial\r\n\r\n* Usuari i password: canigo/canigo\r\n* Obrir un terminal i executar\r\n\r\n\t\tsudo dpkg-reconfigure keyboard-configuration\r\n\r\n* _Important_: es recomana no realitzar cap actualització ni de versió de sistema operatiu ni d'eines a l'entorn sense previa consulta a l'equip del CS Canigó. En aquesta linia s'hauria de configurar l'Eclipse per deshabilitar les notificacions d'actualitzacions disponibles a Preferences -> Install/Update -> Automatic Updates -> Automatically find new updates and notify me\r\n\r\n### Programari instal·lat\r\n\r\n* IDE: [Spring Tool Suite] (https://spring.io/tools) (basat en Eclipse Mars) amb JDK 8 (Oracle) i els següents plugins:\r\n\r\n\t- M2Eclipse per integració amb [Apache Maven](https://maven.apache.org/)\r\n\t- [CTTI Canigó](http://canigo.ctti.gencat.cat/canigo-download-related/plugin-canigo/) per creació aplicacions Canigó 3.2 basades en arquitectura REST+HTML5/JS\r\n\t- Spring Tool Suite per facilitar el desenvolupament d'aplicacions basades en [Spring](http://spring.io/projects)\r\n\t- Subclipse per integració amb [Subversion] (https://subversion.apache.org/)\r\n\t- SonarQube per integració amb [SonarQube] (http://www.sonarqube.org/) (antic Sonar)\r\n\r\n* Altres\r\n\r\n\t- Engine Docker i Docker Compose Tool per l'execució de contenidors Docker\r\n\t- Navegador Google Chrome\r\n\t- Client VPNC per accés a XCAT\r\n\r\n### Oracle VirtualBox\r\n\r\nSi es vol poder copiar text entre la màquina host i la guest cal activar la opció Dispositiu -> Portapapers compartit -> Bidireccional\r\n\r\nSi es volen afegir carpetes compartides entre la màquina host i la guest s'han de seguir les següents passes:\r\n\r\n* Afegir el grup vboxsf a l'usuari canigo (cal ser root o fer sudo):\r\n\r\n\t\t$ sudo usermod -a -G vboxsf canigo\r\n\r\n* Reiniciar la màquina o tornar logar-se.\r\n* Afegir les carpetes desitjades a través de Dispositius -> Carpetes compartides -> Preferències de carpetes compartides... Es pot fer en \"calent\" i apareixen al directori \"/media\" dins la màquina virtual.\r\n\r\n### Versions\r\n\r\n#### 2.0.0 (20/11/2017) -- <span style=\"color:green\">OPERATIVA</style>\r\n\r\n_RELEASE NOTES_\r\n\r\n* Incorporada nova versió del plugin d'Eclipse per Canigó 3.2\r\n* Implementat procés de healthcheck per comprovar el correcte funcionament del procés de construcció de la VM\r\n\r\n#### 1.0.4 (29/05/2017)\r\n\r\n_RELEASE NOTES_\r\n\r\n* Actualitzada la versió de Oracle Java a 1.8\r\n\r\n#### 1.0.3 (21/03/2017)\r\n\r\n_RELEASE NOTES_\r\n\r\n* Actualitzada la màquina virtual a Ubuntu 16.04\r\n* Actualitzat el plugin SVN a la versió 1.12.x\r\n\r\n#### 1.0.2 (9/1/2017)\r\n\r\n_RELEASE NOTES_\r\n\r\n* Revisats enllaços \"trencats\" a instal·lables (Subclipse, Docker Tooling, ...)\r\n\r\n#### 1.0.1 (16/3/2016)\r\n\r\n_RELEASE NOTES_\r\n\r\n* Actualització a Ubuntu 15.10\r\n\r\n_RELEASE NOTES_\r\n\r\nEn cas de voler actualitzar a la v1.0.1 des de la v1.0.0 de l'entorn de desenvolupament cal...\r\n\r\n* Fer l'upgrade a la versió 15.10 d'Ubuntu\r\n* Executar les següents comandes per a que segueixi apareixent el fons de pantalla corporatiu CTTI:\r\n\r\n\t\t$ sudo cp /usr/share/lubuntu/wallpapers/1510-lubuntu-default-wallpaper.png /usr/share/lubuntu/wallpapers/1510-lubuntu-default-wallpaper_bck.png\r\n\t\t$ sudo wget http://canigo.ctti.gencat.cat/devenv/fonspantalla_1280.png -O /usr/share/lubuntu/wallpapers/1510-lubuntu-default-wallpaper.png\r\n\r\n* Revisar la configuració de teclat a Preferències -> IBus Preferences -> Input method (en cas de no estar activat l'IBus cal activar-lo a Preferències -> Language Support -> Keyboard input method system)\r\n\r\n#### 1.0.0 (16/11/2015)\r\n\r\nRELEASE NOTES\r\n\r\n* Versió inicial\r\n","objectID":"L2Nhbmlnby9lbnRvcm4tZGVzZW52b2x1cGFtZW50"},"L2Nhbmlnby9mcmFtZXdvcms=":{"date":1463011200000,"title":"Framework Canigó","description":"Descripció del Framework de desenvolupament corporatiu JEE de la Generalitat de Catalunya","sections":"Canigó","taxonomies":[],"toc":true,"weight":1,"path":"/canigo/framework","content":"## Descripció del framework\n\nCanigó es defineix com un \"Espai de treball tecnològic comú per al desenvolupament i execució d'aplicacions en l'àmbit dels sistemes corporatius i departamentals de la Generalitat de Catalunya\", i es els seus objectius són: \n\n- Oferir una arquitectura comuna de construcció d'aplicacions JEE.\n- Proporcionar un entorn de treball, documentacó, suport i manteniment dels seus components.\n- Simplificar la complexitat inherent a JEE, oferint un marc de referència de treball.\n- Oferir una solució aliniada amb els estàndars i solucions més utilitzades per la comunitat OpenSource.\n- Oferir una solució oberta que permeti afegir i intercanviar qualsevol peça amb un cost reduït.\n- Oferir una solució d'interconnectivitat amb els serveis corporatius.\n- Oferir patrons de desenvolupament àmpliament acceptats.\n\nL'arquitectura de Canigó es basa en l'arquitectura MVC (Model-Vista-Controlador), on existeix un procés d'abstracció que permet dividir una aplicació en components lògics amb responsabilitats diferenciades i que poden ser desenvolupats fins i tot per diferents rols de l'equip.\n\nTanmateix, a més de l'estructura lògica dels components segons el patró MVC, Canigó defineix la seva ubicació segons una arquitectura en 3 capes i 4 mòduls transversals:\n\n**Capes**\n\n- **Capa de Presentació**: els patrons de desenvolupament actuals fomenten la separació de la capa de presentació en dues parts diferenciades:\n\t- **Servidor**: la \"vista\" serà una resposta format JSON, mitjançant serveis (microserveis) HTTP/REST\n\t- **Client**: client lleuger estàtic que consumirà el serveis del punt anterior.\n\n- **Capa de Lògica de Negoci**\n- **Capa de Dades/Integració**\n\n\n**Mòduls**\n\n- **Nucli del Framework**\n- **Mòdul de Seguretat**\n- **Mòdul de Suport**\n- **Mòdul d'Operació**\n\n\n![Arquitectura Canigó](/related/canigo/arquitectura.png)\n\nCom es mostra en el gràfic anterior, Canigó esta estructurat modularment donant així la opció de només utlitzar el mòdul del framework que es requereixi. Tots aquests mòduls es troben definits mitjançant interfícies, aïllant-los així de la implementació concreta escollida.\n\nCanigó es basa en la utilització de interfícies i en la integració existent entre diferents APIs (JPA,...) i paquets oberts (Spring, Hibernate, ...). També ofereix extensions als paquets oberts, afegint un ampli ventall de components reutilitzables.\n\nEl framework base es pot classificar en els següents blocs:\n\n## Components Base\n\nCanigó3 és un framework de codi obert per a la plataforma Java. Està basat en Spring, la primera versió del qual va ser creada per Rod Johnson a l'octubre de 2002. Està pensat per donar suport a:\n\n- la configuració d'aplicacións \n- facilitar el muntatge d'un sistema per parts fàcilment intercanviables i visibles entre elles\n- la integració de serveis\n- serveis de seguretat\n- connexió a base de dades, transaccionalitat, ... \n- la realització de proves, a través de Spring, que permet realitzar tests unitaris desacoblant els objectes del seu context fent més senzill realitzar proves dels components per separat\n- l'accés a dades externes, mitjantçant Spring, gestionant els recursos, proporcionant APIs d'ajuda i suportant la majoria de les tecnologies d'accés a dades com: JDBC, Hibernate, JPA, JDO o iBatis. \n\nEs pot considerar que la base principal de l'arquitectura de Canigó és un conjunt totalment integrat, i a la vegada modular, de les millors pràctiques tecnològiques existent actualment en aquest entorn, formada pels següents components:\n\n- **Spring 4 Framework** com a contenidor centralitzat d'objectes i serveis, totalment configurable mitjançant fitxers XML. La injecció de dependències permet la configuració d'objectes fora del codi de l'aplicació (i de manera no intrusiva). Redueix el codi d'aplicació dedicat a configurar i localitzar recursos. Facilita millors pràctiques com programar contra interfícies enlloc de contra classes, permetent el desacoblament de serveis i el canvi ràpid d'una implementació concreta per una altra. Permet també la gestió de transaccions sense la utilització de APIs específiques mitjançant l'ús de Aspect Oriented Programming (AOP)\n- **JPA** proporciona un mòdel de persistència basat en POJO's (Plain Old Java Objects) per mapejar bases de dades relacionals en Java.\n- **AOP (Aspect Oriented Programming)** per intercepció d'events a l'aplicació sense necessitat de modificar el codi\n\n## Nucli del Framework\n\nAquest mòdul és el <i>core</i> del framework on es troben les principals caracteristiquest:\n\n- **Configuració Multientorn**: basat en el PropertyPlaceHolder ofert per Spring. Amb la diferència que aquest mòdul permet disposar de propietats depenents de l'entorn sense necessitat de cap configuració extra a nivell de beans o propietats.\n- **Internacionalització (i18n)**: té com a objectiu facilitar el desenvolupament a l'hora d'oferir una aplicació en múltiples llenguatges.\n- **Servei de Traces**: basat en Log4j. Permet definir el nivell de traces, sortides, nivell mínim de traces, format de sortida, informació de context, ...\n- **Servei d'Excepcions**: permet informar que s'ha produït un error al realitzar una petició. Canigó ofereix una sèrie d'excepcions per defecte (BaseException, CoreException, ...). També proporciona un mecanisme d'intercepció d'Excepcions per a evitar \"try-catch\".\n\n## Mòdul de Seguretat\n\nTé com a propòsit gestionar l'autenticació i autorització dels usuaris que accedeixen a les aplicacions.\n\n- **Mòdul de Seguretat**: basat en Spring Security 3.0. Permet gestionar l'autenticació i l'autorització dels usuaris de les aplicacions.\n- **Backends Seguretat**: El servei de seguretat s'integra amb GICAR, SACE, LDAP, Base de dades i Inmemory.\n\n## Mòdul d'Integració\n\nLa finalitat d'aquests mòduls és facilitar l'accés a diferents serveis que ofereix la Generalitat.\n\n- **PICA**: proporciona una interfície Java per accedir a la Plataforma d'Integració i Col·laboració Administrativa. Aquest mòdul permet realitzar comunicacions síncrones i asíncrones.\n- **GECAT**: proporciona funcionalitat d'alta de factures, consultes i reserves online que ofereix el servei SAP de GECAT.\n- **PSIS**: permet la validació de signatures i certificats mitjançant el servei de PSIS ofert per Catcert.\n- **SARCAT**: permet consumir els diferents serveis que ofereix Sarcat, via Webservices o FTP/SFTP per a peticions planificades.\n- **Documentum**: permet consumir funcionalitats de Documentum com l'emmagatzematge i recuperació de documents, a més de crear carpetes i associar propietats.\n- **Notificacions Telemàtiques**: és un connector funcional cap a la PICA que simplifica l'utilització de Notificacions Telemàtiques de la Generalitat.\n- **Antivirus**: permet l'escaneig d'arxius mitjançant la Plataforma d'Antivirus Corporatiu de la Generalitat.\n- **SAP**: proporciona una interfície simplificada per a accedir a backends SAP de la Generalitat.\n- **Webservices**: Canigó 3 no disposa d'un mòdul de Webservices. S'ha realitzat una guia on s'explica com realitzar l'exportació de serveis Java mitjançant Webservices, l'importació de webservices externs i generació de les classes Java d'invocació. Proposa l'utilització d'Spring WS, Jaxb i OXM\n- **Cues**: Canigó 3 no disposa d'un mòdul de Gestió de Cues. S'ha realitzat una guia on s'explica com produir i consumir missatges d'una cua. Proposa l'utilització d'Spring JMS (Java Message Service).\n\n## Mòdul de Persistència\n\nAquest mòdul permet persistir i recuperar dades entre l'aplicació i el motor de base de dades.\n\n- **JPA**: Java Persistence API busca la manera d'unificar les utilitats que proporcionen un mapeig objecte-relacional. La implementació de JPA per defecte a Canigó 3 és Hibernate.\n\n## Mòdul de Suport\n\nAquest mòdul facilita l'ús d'un conjunt addicional de funcionalitats mitjançant el framework.\n\n- **Transferència Fitxers**: permet al servidor obtenir fitxers adjunts provinents d'una petició d'un formulari HTML. A més, aquest mòdul s'integra amb d'altres com el d'Antivirus.\n- **Enviament de correu**: permet l'enviament de correus electrònics a una o diverses adreces. També permet enviar en format de text pla o html i en tots dos casos ofereix la possibilitat d'adjuntar un o més fitxers en mode adjunt o inline.\n- **Planificador Tasques**: basat en Spring i Quartz. Ofereix la possibilitat d'executar tasques de forma diferida. En qualsevol moment del dia, algun dia de la setmana, ...\n- **OLE**: permet la manipulació d'objectes OLE (Excel i Word: crear, llegir, modificar documents de Microsoft en format OLE). Basat en POI.\n- **Merging**: permet realitzar la fusió de documents en format WordML, partint d'un document amb uns marcadors que seran substituïts per un conjunt de valors indicats en un diccionari.\n- **SFTP**: Permet enviar i rebre arxius entre el servidor on s'executa l'aplicació i altres servidors de forma segura mitjançant un intercanvi de claus. Basat en llibreries JSCH i Commons-VFS.\n\n## Mòdul d'Operació\n\n- **Instrumentació**: permet a l'aplicació generar dades d'instrumentació (nombre de peticions, nombre d'errors, ...) de la seva execució i posteriorment ser explotades amb eines de monitorització.\n- **Monitorització**: permet a l'aplicació mostrar una pantalla on es mostren dades guardades pel mòdul d'instrumentació.\n- **Logging**: permet a l'aplicació mostrar una pantalla on canviar el nivell dels logs, monitoritzar el diferents fitxers de logs i descarregar-los.\n\nLa informació detallada sobre els diferents components del Framework Canigó, la seva arquitectura i components, es pot trobar a l'apartat de <a href=\"/canigo-documentacio\">documentació del portal web</a>.\n","objectID":"L2Nhbmlnby9mcmFtZXdvcms="},"L2Nhbmlnby9yb2FkbWFw":{"date":1499990400000,"title":"Roadmap Framework Canigó","description":"Roadmap previst per a la evolució del Framework Canigó","sections":"Canigó","taxonomies":[],"toc":true,"weight":5,"path":"/canigo/roadmap","content":"Aquest és el Roadmap previst per a la evolució del Framework de Canigó 3\r\n\r\n<script type=\"text/javascript\" src=\"https://www.gstatic.com/charts/loader.js\"></script>\r\n\r\n<script type=\"text/javascript\">\r\n  google.charts.load(\"current\", {packages:[\"timeline\"], 'language': 'es'});\r\n  google.charts.setOnLoadCallback(drawChart);\r\n  function drawChart() {\r\n    var container = document.getElementById('roadmap');\r\n    var chart = new google.visualization.Timeline(container);\r\n    var dataTable = new google.visualization.DataTable();\r\n\r\n\tdataTable.addColumn({ type: 'string', id: 'id' });\r\n    dataTable.addColumn({ type: 'string', id: 'Name' });\r\n    dataTable.addColumn({ type: 'date', id: 'Start' });\r\n    dataTable.addColumn({ type: 'date', id: 'End' });\r\n    dataTable.addRows([\r\n      [ '1','Canigo 3.2.0 LTS', new Date(2017, 2), new Date(2020, 2) ],\r\n      [ '2','Canigo 3.2.1', new Date(2017, 5), new Date(2017, 8) ],\r\n      [ '3','Canigo 3.2.2', new Date(2017, 8), new Date(2017, 11) ],\r\n\t  [ '4','Canigo 3.2.3', new Date(2017, 11), new Date(2018, 2) ],\r\n\t  [ '5','Canigo 3.2.4', new Date(2018, 2), new Date(2018, 5) ],\r\n\t  [ '6','Canigo 3.2.5', new Date(2018, 5), new Date(2018, 8) ],\r\n      [ '7','Canigo 3.2.6', new Date(2018, 8), new Date(2018, 11) ],\r\n\t  [ '8','Canigo 3.2.7', new Date(2018, 11), new Date(2019, 2) ],\r\n\t  [ '9','Canigo 3.4.0 LTS', new Date(2019, 2), new Date(2022, 2) ],\r\n\t  [ '10','Canigo 3.4.1', new Date(2019, 5), new Date(2019, 8) ],\r\n\t  [ '11','Canigo 3.4.2', new Date(2019, 8), new Date(2019, 11) ],\r\n\t  [ '12','Canigo 3.4.3', new Date(2019, 11), new Date(2020, 2) ],\r\n\t  [ '13','Canigo 3.4.4', new Date(2020, 2), new Date(2020, 5) ]]);\r\n\r\n    var options = {\r\n      timeline: { groupByRowLabel: false, showRowLabels: false },\r\n\t  colors: ['blue', 'green', 'green', 'green', 'green', 'green', 'green', 'green', 'blue','green','green','green','green']\r\n    };\r\n\r\n    chart.draw(dataTable, options);\r\n  }\r\n</script>\r\n\r\n<div id=\"roadmap\" style=\"height: 590px;\"></div>\r\n\r\n*Aquest Roadmap està subjecte a canvis*","objectID":"L2Nhbmlnby9yb2FkbWFw"},"L2Nhbmlnby1kb2N1bWVudGFjaW8vbmF2ZWdhZG9ycw==":{"date":1423152702000,"title":"Navegadors","description":"Estadístiques de navegadors webs gencat (%)","sections":"Documentació Canigó","taxonomies":[],"weight":5,"path":"/canigo-documentacio/navegadors","content":"Principals navegadors que accedeixen a gencat.cat en els últims 3 mesos.\r\n\r\n<script src=\"https://www.google.com/jsapi\"></script>\r\n<script src=\"/js/browsers.js\"></script>\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8vbmF2ZWdhZG9ycw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8vaG93LXRvcw==":{"date":1422115902000,"title":"HOWTOs","description":"HOWTOs d'utilitat per els diferents serveis que ofereix el CS Canigó","sections":"HOWTOs","taxonomies":[],"weight":4,"path":"/canigo-documentacio/how-tos","content":"Un HOWTO és un document informal, generalment breu, que descriu com desenvolupar una certa tasca.\r\n\r\nEn aquest apartat s'aniran afegint un seguit de HOWTO, per tal de facilitar la configuració de certs components del framework, evitar possibles problemes, etc. Aquests documents estan disponibles en format pdf.\r\n\r\nHOWTOs disponibles actualment:\r\n\r\n- [Canigó. Propietats Multientorn al Front-End] (/howtos/2018-04-howto-frontend-multientorn/)\r\n- [Canigó. Jocs de proves API REST] (/howtos/2018-02-howto-swagger_soapui/)\r\n- [Proves Unitàries Mòduls de Canigó] (/howtos/2018-01-howto-test_jars_canigo/)\r\n- [Integració d'una aplicació Canigó a SIC 2.0] (/howtos/2017-12-howto-integracio_canigo_sic/)\r\n- [Ús de Spring Data i QueryDSL al servei de persistència de Canigó 3.2] (/howtos/2017-11-Howto-Us_Servei_Persistence_Canigo/)\r\n- [Ús de Spring Cache (Caffeine) en Canigó 3.2](/howtos/2017-10-Howto-Us_Spring_Cache_Canigo/)\r\n- [Actualització aplicació de Canigó 3.1 a Canigó 3.2](/howtos/2017-08-Howto-Actualitzacio_Canigo3_1_Canigo3_2/)\r\n- [Desplegar aplicació Canigó 3.2 en IBM Websphere 8.5.x] (/howtos/2017-06-Howto-Desplegar_aplicacio_canigo32_websphere)\r\n- [Connectar amb una BBDD Mongo amb SSL a través de NodeJS](/howtos/2017-05-Howto-Connectar_nodejs_amb_mongo_ssl)\r\n- [Inserció/actualització massiva de dades a una aplicació Canigó 3.2](/howtos/2017-04-Batch-inserts-updates-canigo32)\r\n- [Securitzar accés a Elasticsearch des d'una pàgina web](/howtos/2017-03-Securitzar_ElasticSearch_Apache)\r\n- [Autenticació amb JWT a una aplicació Canigó 3.1](/howtos/2016-11-Howto-Canigo-JWT)\r\n- [Gestió d'errors a una aplicació Canigó 3.1](/howtos/2016-10-Howto-Canigo-Gestio-Errors-Globals)\r\n- [Spring Batch en aplicació Canigó 3.1](/howtos/2016-10-Howto-Canigo-Spring-Batch)\r\n- [Swagger en aplicació Canigó 3.1](/related/canigo/howto/Canigo - Howto - Swagger_en_aplicacio_Canigo_3_1.pdf)\r\n- [Desplegament aplicació Canigo 3.1 en Docker](/related/canigo/howto/Canigo - Howto - Desplegament aplicacio Canigo 3.1 en Docker.pdf)\r\n- [Contenidor Docker GICAR a Canigó en entorns de desenvolupament](/related/canigo/howto/Canigo - Howto - Contenidor GICAR en entorns de desenvolupament.pdf)\r\n- [Incorporació Mòdul Administració de logs a aplicació Canigó 3.1](/related/canigo/howto/Canigo - Incorporacio modul Administracio de logs a aplicacio Canigo 3.pdf)\r\n- [Anàlisi d'aplicació Canigó 3.1 amb Sonar](/related/canigo/howto/Canigo - Analisi aplicacio Canigo amb Sonar.pdf)\r\n- [Websockets a Canigó 3.1](/related/canigo/howto/Canigo - Websockets a Canigo 3.1.pdf)\r\n- [Streaming de fitxers en clients REST a Canigó 3.1](/related/canigo/howto/Canigo - Streaming de fitxers en clients REST.pdf)\r\n- [Actualització connectors de Canigó amb la PICA](/related/canigo/howto/Canigo - Actualitzacio Connectors PICA.pdf)\r\n- [Execució demo Equipaments al nou Entorn de Treball de Canigó](/related/canigo/howto/Canigo - HowTo - Execucio demo Equipaments al nou Entorn de Treball.pdf)\r\n- [Certificació desplegaments d'aplicacions Canigó 3.X a Websphere 8.5](/related/canigo/howto/Canigo - HowTo - Certificació desplegaments d'aplicacions Canigó a Websphere 8.5.pdf)\r\n- [Custodia i control de versions del codi de les aplicacions al SIC](/related/canigo/howto/SIC-Custodia_i_control_de_versions_del_codi_de_les_aplicacions.pdf)\r\n- [Generació aplicació Canigó 3.1 amb plugin d'Eclipse](/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf)\r\n- [Aplicació Canigó 3.1 sense frontend](/related/canigo/howto/Canigo - HowTo - Aplicacio Canigo 3.1 sense frontend.pdf)\r\n- [Ús de relacions lazy a entitats de domini en serveis REST](/related/canigo/howto/Canigo - Us de relacions Lazy en aplicacions REST.pdf)\r\n- [Configuració GICAR i CORS amb proxy invers Apache en aplicacions REST+HTML5/JS](/related/canigo/howto/Canigó - Configuració GICAR-CORS amb Apache en aplicacions REST_HTML5_JS.pdf)\r\n- [Configuració autenticació bàsica a Canigó 3.1](/related/canigo/howto/Canigó - Configuració autenticació bàsica a Canigó 3.1.pdf)\r\n- [Integració Recaptcha](/related/canigo/howto/Canigó - Howto - Integració Recaptcha.pdf)\r\n- [Configuració de Canigo LOPD](/related/canigo/howto/Canigó - Howto - Configuració de Canigo LOPD.pdf)\r\n- [Us checkstyle pmd i findbugs en entorns de desenvolupament](/related/canigo/howto/Canigó - Howto - Us checkstyle pmd i findbugs en entorns de desenvolupament.pdf)\r\n- [Actualització Canigó 3.0 a Canigó 3.1](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Actualitzacio+Canig%C3%B3+3.0+a+Canigo+3.1.pdf)\r\n- [Configuració plantilla canigó amb Primefaces](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Plantilla+Canigo+amb+Primefaces.pdf)\r\n- [Configuració scope view JSF a Spring 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Configuraci%C3%B3+scope+view+JSF+a+Spring+3.pdf)\r\n- [AOP i AspectJ a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+AOP+i+AspectJ+amb+Canig%C3%B3+3.pdf)\r\n- [Configuració fil d'Ariadna a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Configuraci%C3%B3+fil+d%27ariadna+a+Canig%C3%B33.pdf)\r\n- [Menú Lateral amb estat a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Men%C3%BA+Lateral+amb+Recordatori+d%27estat.pdf)\r\n- [Validacions amb Java Bean Validation (JSR-303)](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Validacions+amb+Java+Bean+Validation+%28JSR-303%29.pdf)\r\n- [Llistats paginables a servidor amb Canigó 3 ](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Llistats+paginables+a+servidor+amb+Canig%C3%B3+3.pdf)\r\n- [Joc de caràcters en aplicacions Canigó 3 ](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Joc+de+car%C3%A0cters+en+aplicacions+Canig%C3%B3+3.pdf)\r\n- [Upload de fitxers a Canigó 3 ](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Upload+de+fitxers+a+Canig%C3%B3+3.pdf)\r\n- [Generació de CRUDs amb JSF 2 ](/related/canigo/howto/howto_crud_jsf2.zip)\r\n- [Gestió d'excepcions amb JSF 2](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Gesti%C3%B3+d%27excepcions+amb+JSF+2.pdf)\r\n- [Exemple d'arquitectura servidor i clients desacoblats](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Exemple+d%27arquitectura+servidor+i+clients+desacoblats.pdf)\r\n- [Generació d'informes amb JasperReports](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Generaci%C3%B3+d%27informes+amb+JasperReports.pdf\")\r\n- [Generació de codis de barres](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Generaci%C3%B3+de+codis+de+barres.pdf\")\r\n- [Configuració slave Windows a Jenkins](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Configuraci%C3%B3+slave+Windows+a+Jenkins.pdf\")\r\n- [Implementació CRUD amb serveis REST i JQuery](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Implementaci%C3%B3+CRUD+amb+servei+REST+i+JQuery.pdf\")\r\n- [Mavenització d'aplicacions Android](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Mavenitzaci%C3%B3+d%27aplicacions+Android.pdf\")\r\n- [Custodia i control de versions del codi de les aplicacions](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Custodia+i+control+de+versions+del+codi+de+les+aplicacions.pdf\")\r\n- [Generació de gràfiques amb Primefaces a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Generaci%C3%B3+de+gr%C3%A0fiques+amb+Primefaces+a+Canig%C3%B3+3.pdf\")\r\n- [Canigó - HowTo + YUI Compressor al SIC](/related/canigo/howto/HowTo.+YUI+Compressor+al+SIC.pdf\")\r\n- [Creació d'un client CXF per l'STD](/related/canigo/howto/HowTo++Creaci%C3%B3+d%27un+client+CXF+STD.pdf\")\r\n- [Creació EAR's en un sol pas](/related/canigo/howto/HowTo.+Creaci%C3%B3+EAR+en+un+sol+pas.pdf)\r\n- [Desplegament Scripts de BBDD en INT](/related/canigo/howto/HowTo.Desplegament+Scripts+de+BBDD+en+INT.pdf)\r\n- [Instrumentació de Canigó 3 custom](/related/canigo/howto/HowTo.+Personalitzaci%C3%B3+de+la+Instrumentaci%C3%B3+Canig%C3%B33.pdf)\r\n- [Eina de Generació de Projectes Canigó 3](/related/canigo/howto/HowTo++Operativa+Eina+de+creaci%C3%B3+de+projectes+Canig%C3%B3.pdf)\r\n- [WURFL](/related/canigo/howto/Howto+Canigo3+-+WURFL_v1+3.pdf)\r\n- [Mavenització d'aplicacions basades en scripts d'ANT.pdf](/related/canigo/howto/HowTo+-+Mavenitzaci%C3%B3+aplicacions+basades+en+scripts+ANT.pdf\")\r\n- [Configuració de Webservices per MTOM.pdf](/related/canigo/howto/Howto+-+Configuraci%C3%B3+de+Webservices+MTOM.pdf)\r\n- [Upgrade Weblogic 10g.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Upgrade+Weblogic+10g.pdf)\r\n- [Crides webservices segurs SSL.pdf](/related/canigo/howto/Howto - Crides webservices segurs SSL.pdf)\r\n- [Millora entorn desenvolupament.pdf](/related/canigo/howto/Howto+-+Millora+entorn+desenvolupament.pdf)\r\n- [Ús d'eines d'increment de la productivitat per l'entorn de treball de Canigó.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-++%C3%9As+d%3Feines+d%3Fincrement+de+la+productivitat+per+l%3Fentorn+de+treball+de+Canig%C3%B3.pdf)\r\n- [Tomcat 6.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Tomcat+6.pdf)\r\n- [Directrius J2EE.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Directrius+J2EE.pdf)\r\n- [Canigo - HowTo - Upgrade Hibernate 3.2.6.ga a Canigó 1.4.x.pdf](/related/canigo/howto/HowTo.Pujar+la+versi%C3%B3+de+Hibernate+a+3.2.6.ga.pdf)\r\n- [Canigo - HowTo - Empaquetat en format EAR.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Empaquetat+en+format+EAR.pdf)\r\n- [Canigo - HowTo - Construcció de projectes amb Maven.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Construcci%C3%B3+de+projectes+amb+Maven.pdf)\r\n- [Accés a WebServices externs des de la Xarxa XCAT.pdf](/related/canigo/howto/Howto+-+Utilitzaci%C3%B3+Proxy+Servei+Framework.pdf)\r\n- [Canigo - HowTo - Com fer upgrade a Servlet 2.4 i JSP 2.0 (J2EE 1.4)](/related/canigo/howto/Canigo+-+HowTo+-+Com+fer+upgrade+a+Servlet+2.4+i+JSP+2.0+%28J2EE+1.4%29.pdf)\r\n- [Com pujar la versió de Hibernate a 3.2.6.ga.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Com+pujar+la+versi%C3%B3+de+Hibernate+a+3.2.6.ga.pdf)\r\n- [Integració amb Gicar](/related/canigo/howto/Canig%C3%B3+-+HowTo+GICAR+v2.pdf)\r\n- [Què fer si els missatges d'excepció d'Hibernate no arriben correctament](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+que+fer+si+els+missatges+d%27excepci%C3%B3+de+Hibernate+no+arriben+correctament.pdf)\r\n- [mostrar excepcions produides en fase de renderitzat .pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+mostrar+excepcions+produides+en+fase+de+renderitzat+.pdf)\r\n- [Publicació i invocació de WebServices](/related/canigo/howto/Canigo+-+HowTo+WebServices-v1.1.pdf)\r\n- [Canigo - HowTo - Generació i visualització de Traces.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Generaci%C3%B3+i+visualitzaci%C3%B3+de+Traces.pdf)\r\n- [Canigo - HowTo - Com securitzar els mètodes de negoci.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Com+securitzar+els+m%C3%A8todes+de+negoci.pdf)&nbsp;\r\n- [Com definir tests en context Spring.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Com+definir+tests+en+context+Spring.pdf)\r\n- [Canigo - HowTo - com fer paginacio amb grans volums de dades.pdf](/related/canigo/howto/Canigo+-+HowTo+-+com+fer+paginacio+amb+grans+volums+de+dades.pdf)\r\n- [Joc de Caràcters en aplicacions Canigó.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Joc+de+Car%C3%A0cters+en+aplicacions+Canig%C3%B3.pdf)\r\n- [Anàlisi d'Utilització de Memòria.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+An%C3%A0lisi+d%27Utilitzaci%C3%B3+de+Mem%C3%B2ria.pdf)\r\n- [Integracio Continua.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Integracio+Continua.pdf)\r\n- [Eines d'anàlisi de rendiment web.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+d%27an%C3%A0lisi+de+rendiment+web.pdf)\r\n- [Eines de compressió JavaScript.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+de+compressi%C3%B3+JavaScript.pdf)\r\n- [Antivirus.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Antivirus.docx)\r\n- [Transformació ppk a openSSH.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Transformaci%C3%B3+ppk+a+openssh.docx)\r\n- [Eines de visualització del GC.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+de+visualitzaci%C3%B3+del+GC.pdf)\r\n- [Eines Intercepció de peticions http.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+Intercepci%C3%B3+de+peticions.pdf)\r\n- [Entorn Treball](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Entorn+Treball.pdf)\r\n- [Generació de CRUD Canigó 3](/related/canigo/howto/Howto+-+Generaci%C3%B3+Crud+Canig%C3%B33.zip?version=2) [Descarregar ScreenCast](http://dl.dropbox.com/u/6456567/Videos%20Generaci%C3%B3%20CRUD.zip)\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8vaG93LXRvcw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8vbm9ybWF0aXVz":{"date":1422115902000,"title":"Normatius","description":"Normes aplicables al desenvolupament d'aplicacions","sections":"Documentació Canigó","taxonomies":[],"weight":3,"path":"/canigo-documentacio/normatius","content":"### Principals normes\r\n\r\n- [Norma de desenvolupament J2EE](/related/canigo/normes/NOR_0009_Desenvolupament_J2EE-V03.pdf)\r\n- [Norma de desenvolupament web](https://qualitat.solucions.gencat.cat/normatius/normatiu-desenvolupament-web/)\r\n- [Norma de desenvolupament de BBDD](/related/canigo/normes/SC-NOR11-01 Norma nomenclatura i esquema de bases de dades_v2.2.pdf)\r\n\r\n### Regles d'estil\r\n\r\n- Per als entorns de desenvolupament es recomana l'ús de Checkstyle, PMD i Findbugs\r\n- L'eina corporativa d'auditoria de codi és CAST. Més informació al web del [Model de Qualitat de Solucions](https://qualitat.solucions.gencat.cat/). Enllaç directe a [CAST](https://qualitat.solucions.gencat.cat/MQS/tools/cast_9A47CE30.html?nodeId=33196b46)\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8vbm9ybWF0aXVz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLWptcw==":{"date":1427973276000,"title":"Cues JMS","description":"Missatgeria estándard JMS","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-altres/modul-jms","content":"## Propòsit\r\n\r\nEn aquest apartat s'explica de forma senzilla la infraestructura de missatgeria estándard JMS (Java Messaging Service) de J2EE. Aquest estàndar defineix dues modalitats:\r\n\r\n1. Producció de missatges\r\n2. Consum de missatges, que pot ser asíncron.\r\n\r\nEl consum de missatges assíncrons a l'estàndar J2EE es realitza mitjançant \"Message-Driven Beans\".\r\n\r\nCanigó no incorpora cap llibreria addicional a les ja aportades per Spring per lo que aquest apartat estará enfocat com a guia per a simplificar la publicació i consum de missatge.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nReferència | URL\r\n---------- | ---\r\nSpring JMS | http://static.springsource.org/spring/docs/4.1.0.RELEASE/spring-framework-reference/html/jms.html\r\n\r\n## Glossari\r\n\r\n**JMS**\r\n\r\nJMS o Java Message Service es un estàndard de missatgeria que permet als components de les aplicacions basades en la plataforma J2EE, crear, enviar, rebre i llegir missatges de manera sincrona i asincrona.\r\n\r\n**ConnectionFactory**\r\n\r\nFactoria encarregada de crear una connexió al proveidor del sistema de missatges.\r\n\r\n**Destination**\r\n\r\nPunts de destí dels missatges que s'envien.\r\n\r\n## Descripció detallada\r\n\r\n### Missatgeria Publicació/Subscripció\r\n\r\nLa missatgeria de publicació/subscripció permet a una aplicació enviar missatges a una o múltiples aplicacions. Aquestes aplicacions envien i reben missatges subscrivint-se a un servidor de missatges a una cua o tòpic determinat.\r\n\r\nHi ha dos tipus de missatge depenent de com es consumeixen:\r\n\r\n* Queue: en el cas d'un missatge enviat a una cua, encara que hi hagi varis subscriptors a aquests missatges, únicament es processarà una única vegada pel primer subscriptor que estigui lliure.\r\n* Topic: en el cas d'un missatge enviat a un tòpic, tots els subscriptors a aquests missatges els processaran.\r\n\r\nEls consumidors d'un missatge poden ser síncrons o asíncrons. En general, els consumidors asíncrons escalen millor i tenen un rendiment superior.\r\n\r\nPer aplicacions que s'executen al costat servidor, gairebé sempre sempre s'utilitzaran consumidors asíncrons. Concretament per aplicacions J2ee es fa mitjançant Message-Driven Beans (MDB's) que són EJB's configurats per escoltar i subscriures a cues o tòpics del servidor d'aplicacions.\r\n\r\nA continuació es destaquen alguns paràmetres de configuració dels missatges JMS que cal tenir en compte en el desenvolupament d'aplicacions que publiquin o consumeixin aquests tipus de missatges.\r\n\r\n### Persistència del missatge\r\n\r\nEls missatges JMS poden ser especificats com a persistents o no-persistents.\r\n\r\n* Un missatge persistent garanteix la seva entrega un i només un cop. El missatge no pot ser perdut degut a una fallida del proveïdor JMS, i no pot ser entregat dos cops. No es considerat enviat el missatge fins que no ha estat persistit (a un fitxer ó a una base de dades).\r\n* Un missatge no-persistent no és emmagatzemat. Està garantit que sigui entregat com a molt un cop, però si hi ha una fallida del proveïdor JMS el missatge pot ser perdut.\r\n\r\nEls missatges persistents tenen pitjor rendiment degut al pas addicional d'haver-se d'escriure en disc o a base de dades. Només es recomana utilitzar missatges persistents pels casos d'ús crítics, on no es pot permetre la pèrdua del missatge (p.ex. una trasacció bancària, ...).\r\n\r\n### Destinacions distribuïdes\r\n\r\nUna destinació distribuïda és un conjunt de destinacions que són accessibles com a una única destinació lògica al client. Disposen d'una sola adreça JNDI, i els membres d'aquest conjunt normalment són distribuïts pels membres d'un cluster, on cada destinació pertany a un servidor JMS separat.\r\n\r\nLes aplicacions que usen destinacions distribuïdes tenen més disponibilitat respecte a les tradicionals, ja que els servidor (Weblogic) proporciona balanceig de càrrega i tolerància a fallades pels membres d'una destinació distribuïda en un cluster.\r\n\r\nPer tant, es recomana l'ús de destinacions distribuïdes sempre que les aplicacions publicadores/consumidores es desplegin en un cluster de Weblogic.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal- lar Quartz es necessari afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<org.opensymphony.quartz.version>2.2.1</org.opensymphony.quartz.version>\r\n<commons.collections.version>4.0</commons.collections.version>\r\n<org.springframework.version>4.1.0.RELEASE</org.springframework.version>\r\n\r\n<dependency>\r\n\t<groupId>org.springframework</groupId>\r\n\t<artifactId>org.springframework.jms</artifactId>\r\n\t<version>$org.springframework.version}</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>javax.jms</groupId>\r\n\t<artifactId>com.springsource.javax.jms</artifactId>\r\n\t<version>1.1.0</version>\r\n</dependency>\r\n<!-- Active MQ -->\r\n<dependency>\r\n\t<groupId>org.apache.activemq</groupId>\r\n\t<artifactId>com.springsource.org.apache.activemq</artifactId>\r\n\t<version>5.3.0</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>org.apache.xbean</groupId>\r\n\t<artifactId>com.springsource.org.apache.xbean.spring</artifactId>\r\n\t<version>3.6.0</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>org.apache.geronimo.specs</groupId>\r\n\t<artifactId>com.springsource.javax.management.j2ee</artifactId>\r\n\t<version>1.0.1</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del servei de cues el podriem dividir en els següents punts:\r\n\r\n* Configuració de la infraestructura\r\n* Configuració del productor\r\n* Configuració del consumidor\r\n* Externalització de les propietats d'aquests beans\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/jms-config.xml\r\n\r\nConfiguració dels arxius de propietats\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/jms.properties\r\n\r\nDins d'aquest arxiu romandrien les propietats per a la gestió de la invocació:\r\n\r\nExemple d'arxiu de propietats:\r\n\r\n```\r\n*.jms.physicalNameDestination=cat.gencat.cttit.jms.test\r\n*.jms.acknowledge=auto\r\n*.jms.uri=tcp://localhost:0\r\n``\r\n\r\n\r\n## Utilització del Mòdul\r\n\r\nEn aquest exemple es configurarà:\r\n\r\n* Arxiu de configuració de Spring per a la càrrega de beans implicats en l'enviament i consum de missatges JMS.\r\n* Arxiu de propietats de configuració.\r\n* Productor de missatges.\r\n* Listener/consumidor de missatges.\r\n* Classe de Test per certificar el se funcionament.\r\n\r\n**jms-config.xml**\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n       xmlns:p=\"http://www.springframework.org/schema/p\"\r\n       xmlns:context=\"http://www.springframework.org/schema/context\"\r\n       xmlns:jms=\"http://www.springframework.org/schema/jms\"\r\n       xmlns:amq=\"http://activemq.apache.org/schema/core\"\r\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\r\n                           http://www.springframework.org/schema/beans/spring-beans.xsd\r\n                           http://www.springframework.org/schema/context\r\n                           http://www.springframework.org/schema/context/spring-context.xsd\r\n                           http://www.springframework.org/schema/jms\r\n                           http://www.springframework.org/schema/jms/spring-jms.xsd\r\n                           http://activemq.apache.org/schema/core\r\n                           http://activemq.apache.org/schema/core/activemq-core.xsd\">\r\n\r\n    <context:component-scan base-package=\"cat.gencat.ctti.testing.jms\" />\r\n\r\n    <!--  ActiveMQ Broker Embegut -->\r\n    <amq:broker id=\"broker\" useJmx=\"false\" persistent=\"false\">\r\n        <amq:transportConnectors>\r\n            <amq:transportConnector uri=\"${jms.uri}\" />\r\n        </amq:transportConnectors>\r\n    </amq:broker>\r\n\r\n    <!--  ActiveMQ Destination  -->\r\n    <amq:queue id=\"destination\" physicalName=\"${jms.physicalNameDestination}\" />\r\n\r\n    <!-- JMS ConnectionFactory al broker embegut -->\r\n    <amq:connectionFactory id=\"jmsFactory\" brokerURL=\"${jms.brokerURL}\" />\r\n\r\n    <!-- Configuració del productor -->\r\n    <bean id=\"jmsProducerConnectionFactory\"\r\n          class=\"org.springframework.jms.connection.SingleConnectionFactory\"\r\n          depends-on=\"broker\"\r\n          p:targetConnectionFactory-ref=\"jmsFactory\" />\r\n\r\n    <bean id=\"jmsProducerTemplate\" class=\"org.springframework.jms.core.JmsTemplate\"\r\n          p:connectionFactory-ref=\"jmsProducerConnectionFactory\"\r\n          p:defaultDestination-ref=\"destination\" />\r\n\r\n    <!-- Configuració del consumidor -->\r\n    <bean id=\"jmsConsumerConnectionFactory\"\r\n          class=\"org.springframework.jms.connection.SingleConnectionFactory\"\r\n          depends-on=\"broker\"\r\n          p:targetConnectionFactory-ref=\"jmsFactory\" />\r\n\r\n    <jms:listener-container container-type=\"default\"\r\n                            connection-factory=\"jmsConsumerConnectionFactory\"\r\n                            acknowledge=\"${jms.acknowledge}\">\r\n        <jms:listener destination=\"org.springbyexample.jms.test\" ref=\"jmsMessageListener\" />\r\n    </jms:listener-container>\r\n\r\n    <!-- Contador per al consumidor i la clase de test per verificar el número de missatges enviats -->\r\n    <bean id=\"counter\" class=\"java.util.concurrent.atomic.AtomicInteger\" />\r\n\r\n</beans>\r\n```\r\n\r\n<div class=\"message information\">\r\nEn aquest cas s'ha fet servir un servidor ActiveMQ embegut que Spring s'encarrega de aixecar. En el cas d'apuntar a un servidor remot, s'hauria d'eliminar les referències a aquest i apuntar al nou broker.\r\n</div>\r\n\r\n\r\nDestacar que els beans del consumidor i productor han de'estar al package \"cat.gencat.ctti.testing.jms\" perque component-scan aixequi de manera automàtica els beans de Spring.\r\n\r\n**jms.properties**\r\n\r\n```\r\n*.jms.physicalNameDestination=cat.gencat.cttit.jms.test\r\n*.jms.acknowledge=auto\r\n*.jms.uri=tcp://localhost:0\r\n*.jms.brokerURL=vm://localhost\r\n```\r\n\r\n**JmsMessageProducer.java**\r\n\r\n```java\r\n@Component\r\npublic class JmsMessageProducer {\r\n\r\n    private static final Log logger = LogFactory.getLog(JmsMessageProducer.class);\r\n\r\n    protected static final String MESSAGE_COUNT = \"messageCount\";\r\n\r\n    @Autowired\r\n    private JmsTemplate template = null;\r\n    private int messageCount = 100;\r\n\r\n    /**\r\n     * Generació dels missatges\r\n     */\r\n    @PostConstruct\r\n    public void generateMessages() throws JMSException {\r\n        for (int i = 0; i < messageCount; i++) {\r\n            final int index = i;\r\n            final String text = \"Message number is \" + i + \".\";\r\n\r\n            template.send(new MessageCreator() {\r\n                public Message createMessage(Session session) throws JMSException {\r\n                    TextMessage message = session.createTextMessage(text);\r\n                    message.setIntProperty(MESSAGE_COUNT, index);\r\n                    logger.info(\"Sending message: \" + text);\r\n                    return message;\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nL'annotació PostConstruct fa que el métode generateMessage s'executi un cop Spring instanciï/creï el bean **JmsMessageProducer**.\r\n\r\n**JmsMessageListener.java**\r\n\r\n```java\r\n@Component\r\npublic class JmsMessageListener implements MessageListener {\r\n\r\n    private static final Log logger = LogFactory.getLog(JmsMessageListener.class);\r\n\r\n    @Autowired\r\n    private AtomicInteger counter = null;\r\n\r\n    /**\r\n     * Implementació de <code>MessageListener</code>.\r\n     */\r\n    public void onMessage(Message message) {\r\n        try {\r\n            int messageCount = message.getIntProperty(JmsMessageProducer.MESSAGE_COUNT);\r\n\r\n            if (message instanceof TextMessage) {\r\n                TextMessage tm = (TextMessage)message;\r\n                String msg = tm.getText();\r\n                logger.info(\"Processed message '\" + msg + \"'.  value=\" + messageCount);\r\n                counter.incrementAndGet();\r\n            }\r\n        } catch (JMSException e) {\r\n            logger.error(e.getMessage(), e);\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nConsumim asincronament els missatges que el productor ha anat enviat a la cua.\r\n\r\n**JmsMessageListenerTest.java**\r\n\r\n```java\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(locations = {\"jms-config.xml\"})\r\npublic class JmsMessageListenerTest {\r\n\r\n    private static final Log logger = LogFactory.getLog(JmsMessageListenerTest.class);\r\n\r\n    @Autowired\r\n    private AtomicInteger counter = null;\r\n\r\n    @Test\r\n    public void testMessage() throws Exception {\r\n        assertNotNull(\"Counter is null.\", counter);\r\n        int expectedCount = 100;\r\n        logger.info(\"Testing...\");\r\n        // Esperem que el listener processi tots els missatges\r\n        Thread.sleep(2 * 1000);\r\n        assertEquals(\"Message is not '\" + expectedCount + \"'.\", expectedCount, counter.get());\r\n    }\r\n\r\n}\r\n```\r\n\r\nEns assegurem que el contador ha arribat a 100, lo que asegura que el consumidor ha rebut els 100 missatges del productor.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLWptcw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXBsYW5pZmljYWRvcg==":{"date":1427971783000,"title":"Planificador de tasques","description":"Planificador de tasques","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-altres/modul-planificador","content":"## Propòsit\r\n\r\nEl propòsit d'aquest apartat es introduir al desenvolupador a la planificació de tasques mitjançant Quartz.\r\n\r\nQuartz permet l'execució de tasques de forma diferida:\r\n\r\n* en qualsevol moment del dia (precisió de milisegons)\r\n* en alguns dies de la setmana\r\n* en alguns dies del mes\r\n* en alguns dies de l'any\r\n* un número específic de repeticions\r\n* repetidament fins a una data/instant determinat\r\n* repetida e indefinidament\r\n* repetidament en un determinat interval de temps\r\n\r\nDocuments i Fonts de Referència\r\n\r\nReferència                       | URL\r\n-------------------------------- | ----\r\nQuartz                           | http://www.quartz-scheduler.org/\r\nSpring 4 + Quartz                | http://static.springsource.org/spring/docs/4.1.0.RELEASE/spring-framework-reference/html/scheduling.html#scheduling-quartz\r\nGuia migració Quartz 1.8.x a 2.0 | http://www.quartz-scheduler.org/documentation/quartz-2.x/migration-guide\r\n\r\n## Glossari\r\n\r\n**Job**\r\n\r\nUn Job o tasca és simplement la referència a la classe que conté el mètode que volem executar de forma diferida.\r\n\r\n**Trigger**\r\n\r\nUn objecte de tipus Trigger s'utilitza per llençar l'execució dels Jobs o tasques. Quan es vol programar una tasca, s'intancia un Trigger i configures les seves propietats per tal de proporcionar la programació d'execució (interval d'execució, número de repeticions, timeout, etc..).\r\n\r\n**SchedulerFactory**\r\n\r\nObjecte que s'encarrega d'instanciar el programador o scheduler que s'encarregarà de gestionar l'execució de les tasques.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar Quartz es necessari afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<org.opensymphony.quartz.version>2.2.1</org.opensymphony.quartz.version>\r\n<commons.collections.version>4.0</commons.collections.version>\r\n<org.springframework.versionn>4.1.0.RELEASE</org.springframework.version>\r\n\r\n<dependency>\r\n    <groupId>org.quartz-scheduler</groupId>\r\n    <artifactId>quartz</artifactId>\r\n    <version>${org.opensymphony.quartz.version}</version>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework</groupId>\r\n    <artifactId>spring-context-support</artifactId>\r\n    <version>${org.springframework.version}</version>\r\n</dependency><!-- Només per clustering Oracle -->\r\n<dependency>\r\n    <groupId>org.quartz-scheduler</groupId>\r\n    <artifactId>quartz-oracle</artifactId>\r\n    <version>${org.opensymphony.quartz.version}</version>\r\n</dependency>\r\n<!-- Només per a Weblogic -->\r\n<dependency>\r\n    <groupId>org.quartz-scheduler</groupId>\r\n    <artifactId>quartz-weblogic</artifactId>\r\n    <version>${org.opensymphony.quartz.version}</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>org.apache.commons</groupId>\r\n\t<artifactId>commons-collections4</artifactId>\r\n\t<version>${commons.collections.version}</version>\r\n</dependency>\r\n<dependency>\r\n      <groupId>org.springframework</groupId>\r\n      <artifactId>spring-tx</artifactId>\r\n      <version>${org.springframework.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del servei de planificació de tasques es pot dividir en dos punts:\r\n\r\n* Definició dels xmls (o anotacions) de Spring que s'encarregen de la inicialització dels beans de Quartz.\r\n* Externalització de les propietats d'aquest beans.\r\n    \t\r\n<div class=\"message information\">\r\nIMPORTANT: <br>\r\nPer a entorns clusteritzats revisar l'apartat de Preguntes freqüents.\r\n</div>\r\n\r\n#### Definició dels xmls de Spring\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/quartz-config.xml\r\n\r\nLa configuració del planificador de tasques Quartz implica 3 pasos:\r\n\r\n* Definir les tasques que volem executar de forma diferida\r\n* Definir els triggers que defineixen en quin moment s'executaran les tasques\r\n* Definir la factoria per executar les tasques amb els triggers\r\n\r\n#### Configuració dels arxius de propietats\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/planificador.properties\r\n\r\nDins d'aquest arxiu romandrien les propietats dels Jobs, Triggers, Scheduler, etc.\r\n\r\nExemple d'arxiu de propietats:\r\n\r\n```\r\n*.quartz.repeatInterval=2000\r\n*.quartz.autoStartup=false\r\n*.quartz.concurrent=true\r\n```\r\n\r\n## Utilització del Mòdul\r\n\r\n\r\nEn aquest exemple es configura una tasca que es repeteix cada dos segons amb el work manager per defecte de Quartz.\r\n\r\n**quartz-config.xml**\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\r\n\t<bean id=\"salutacio\" class=\"springapp.web.vo.Salutacio\"/>\r\n\r\n        <bean id=\"unaTasca\"\r\n             class=\"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean\">\r\n\t\t<property name=\"targetObject\" \tref=\"salutacio\" />\r\n\t\t<property name=\"targetMethod\" \tvalue=\"saludar\" />\r\n\t\t<property name=\"concurrent\" \tvalue=\"${quartz.concurrent}\" />\r\n\t</bean>\r\n\r\n\t<bean id=\"simpleTrigger\" class=\"org.springframework.scheduling.quartz.SimpleTriggerBean\">\r\n\t\t<property name=\"jobDetail\" ref=\"unaTasca\" />\r\n\t\t<property name=\"repeatInterval\" value=\"${quartz.repeatInterval}\" />\r\n\t</bean>\r\n\r\n\t<bean id=\"schedulerFactoryBean\"\r\n             class=\"org.springframework.scheduling.quartz.SchedulerFactoryBean\">\r\n\t\t<property name=\"autoStartup\" value=\"${quartz.autoStartup}\" />\r\n\t\t<property name=\"triggers\">\r\n\t\t\t<list>\r\n\t\t\t\t<ref bean=\"simpleTrigger\" />\r\n\t\t\t</list>\r\n\t\t</property>\r\n\t</bean>\r\n\r\n</beans>\r\n```\r\n\r\n<div class=\"message warning\">\r\nWorkmanager per defecte\r\n\r\nPer defecte de Quartz gestiona l'execució de les tasques amb el seu pròpi workmanager. Aquest motor per defecte s'encarrega de gestionar els diferents \"threads\" o fils d'execució de les tasques planificades de manera autònoma sense que el servidor d'aplicacions tingui constància d'aquests \"threads\" oberts.\r\nEn entorns productius s'ha pogut observar com en algunes situacions el motor no allibera correctament aquests \"threads\" de la VM, lo que pot provocar la degradació del sistema o en el pitjor dels casos, la seva indisponibilitat.\r\n\r\nPer evitar aquest tipus de situacions es recomenable que llegiu l'apartat de Recomanacions.\r\n</div>\r\n\r\n## Recomanacions\r\n\r\nCom a alternativa al workmanager per defecte de \"Quartz\", i amb la idea de que sigui el servidor d'aplicacions qui gestioni els threads de Quartz, a continuació es descriu un exemple de configuració per a utilitzar la implementació de \"Commonj\".\r\n\r\n### Configuració per a servidors d'aplicacions Weblogic\r\n\r\nPer canviar el WorkManager per defecte per el de \"Commonj\" a servidors d'aplicacions Weblogic, es necessari realitzar les següents accions:\r\n\r\n* Modificar el taskexecutor del SchedulerFactoryBean.\r\n* Modificar web.xml per afegir una referència local al \"WorkManager\".\r\n* Modificar weblogic.xml per crear un \"WorkManager\".\r\n\r\n### Modificar el taskexecutor del SchedulerFactoryBean\r\n\r\nPer sobrescriure el \"taskexecutor\" per defecte de \"Quartz\", s'ha de modificar el SchedulerFactoryBean per instanciar el nou \"TaskExecutor\", aquest informarà les següents propietats:\r\n\r\n* workManagerName: Nom JNDI del WorkManager JCA.\r\n* resourceRef: Indica si la cerca del nom JNDI es realitza en un contenidor J2EE.\r\n\r\n```\r\n<!-- Planificador amb l'engine de commonj -->\r\n<bean id=\"schedulerFactoryBeanCommonj\"\r\n      class=\"org.springframework.scheduling.quartz.SchedulerFactoryBean\">\r\n    <property name=\"autoStartup\" value=\"false\" />\r\n    <property name=\"triggers\">\r\n        <list>\r\n            <ref bean=\"simpleTrigger\" />\r\n        </list>\r\n    </property>\r\n    <property name=\"taskExecutor\" ref=\"taskExecutor\"/>\r\n</bean>\r\n<bean id=\"taskExecutor\"\r\n      class=\"org.springframework.scheduling.commonj.WorkManagerTaskExecutor\">\r\n    <property name=\"workManagerName\" value=\"appWorkManager\" />\r\n    <property name=\"resourceRef\" value=\"true\" />\r\n</bean>\r\n```\r\n\r\n### Modificar web.xml per afegir una referència local al \"WorkManager\"\r\n\r\nModificar l'arxiu \"web.xml\" per afegir una referència local al \"WorkManager\" que posteriorment es definirà al \"weblogic.xml\":\r\n\r\n```\r\n...\r\n<resource-ref>\r\n\t<res-ref-name>appWorkManager</res-ref-name>\r\n\t<res-type>commonj.work.WorkManager</res-type>\r\n\t<res-auth>Container</res-auth>\r\n\t<res-sharing-scope>Shareable</res-sharing-scope>\r\n</resource-ref>\r\n...\r\n```\r\n\r\n### Modificar weblogic.xml per crear un \"WorkManager\"\r\n\r\nFinalment cal registrar un \"WorkManager\" aplicatiu al servidor d'aplicacions mitjançant l'arxiu \"weblogic.xml\". En l'exemple es registra un \"WorkManager\" que com a màxim pot executar 3 \"threads\" concurrents.\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<weblogic-web-app xmlns=\"http://www.bea.com/ns/weblogic/90\"\r\n\txmlns:j2ee=\"http://java.sun.com/xml/ns/j2ee\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://www.bea.com/ns/weblogic/90\r\n                           http://www.bea.com/ns/weblogic/90/weblogic-web-app.xsd\">\r\n\r\n\t<work-manager>\r\n\t\t<name>appWorkManager</name>\r\n\t\t<max-threads-constraint>\r\n\t\t\t<name>appWorkManager</name>\r\n\t\t\t<count>3</count>\r\n\t\t</max-threads-constraint>\r\n\t</work-manager>\r\n</weblogic-web-app>\r\n```\r\n\r\n### Configuració per a servidors d'aplicacions Tomcat\r\n\r\nPer canviar el WorkManager per defecte per el de \"Commonj\" per a servidors d'aplicacions Tomcat es necessari realitzar les següents accions:\r\n\r\n* Afegir les llibreries de Commonj.\r\n* Modificar el taskexecutor del SchedulerFactoryBean.\r\n* Modificar web.xml per afegir una referència local al \"WorkManager\".\r\n* Crear el \"WorkManager\" al context.xml de Tomcat.\r\n\r\n### Afegir les llibreries de Commonj\r\n\r\nCal verificar que les llibreries de Commonj estiguin incloses dins la carpeta de llibreries compartides de Tomcat o bé dins l'aplicació que les farà servir:\r\n\r\n* Si es volen afegir directament com a llibreries compartides de Tomcat, cal afegir a $TOMCAT_HOME/lib les llibreries commonj-twm.jar i foo-commonj-1.1.0.jar . Aquestes es poden trobar dins la carpeta \\foo-commonj-1.1.0\\lib del zip que es pot descarregar de la web oficial\r\n* Si es volen afegir al projecte Canigó3, cal afegir les següents dependències Maven al pom.xml:\r\n\r\n```\r\n<dependency>\r\n    <groupId>com.bea.wlplatform</groupId>\r\n    <artifactId>commonj-twm</artifactId>\r\n    <version>1.1</version>\r\n</dependency>\r\n<dependency>\r\n    <groupId>com.bea.wlplatform</groupId>\r\n    <artifactId>foo-commonj</artifactId>\r\n    <version>1.1.0</version>\r\n</dependency>\r\n```\r\n\r\n### Modificar el taskexecutor del SchedulerFactoryBean\r\n\r\nPer sobrescriure el \"taskexecutor\" per defecte de \"Quartz\", s'ha de modificar el SchedulerFactoryBean per instanciar el nou \"TaskExecutor\", aquest informarà les següents propietats:\r\n\r\n* workManagerName: Nom JNDI del WorkManager JCA.\r\n* resourceRef: Indica si la cerca del nom JNDI es realitza en un contenidor J2EE.\r\n\r\n```\r\n<!-- Planificador amb l'engine de commonj -->\r\n<bean id=\"schedulerFactoryBeanCommonj\"\r\n      class=\"org.springframework.scheduling.quartz.SchedulerFactoryBean\">\r\n    <property name=\"autoStartup\" value=\"false\" />\r\n    <property name=\"triggers\">\r\n        <list>\r\n            <ref bean=\"simpleTrigger\" />\r\n        </list>\r\n    </property>\r\n    <property name=\"taskExecutor\" ref=\"taskExecutor\"/>\r\n</bean>\r\n<bean id=\"taskExecutor\"\r\n      class=\"org.springframework.scheduling.commonj.WorkManagerTaskExecutor\">\r\n    <property name=\"workManagerName\" value=\"wm/appWorkManager\" />\r\n    <property name=\"resourceRef\" value=\"true\" />\r\n</bean>\r\n```\r\n\r\n### Modificar web.xml per afegir una referència local al \"WorkManager\"\r\n\r\nModificar l'arxiu \"web.xml\" per afegir una referència local al \"WorkManager\" que posteriorment es definirà al \"weblogic.xml\":\r\n\r\n```\r\n...\r\n<resource-ref>\r\n\t<res-ref-name>wm/appWorkManager</res-ref-name>\r\n\t<res-type>commonj.work.WorkManager</res-type>\r\n\t<res-auth>Container</res-auth>\r\n\t<res-sharing-scope>Shareable</res-sharing-scope>\r\n</resource-ref>\r\n...\r\n```\r\n\r\n### Crear el \"WorkManager\" al context.xml de Tomcat\r\n\r\nFinalment cal registrar un \"WorkManager\" aplicatiu al servidor d'aplicacions. En aquest cas caldría afegir-ho al fitxer $TOMCAT_HOME/conf/context.xml. En l'exemple es registra un \"WorkManager\" que com a màxim pot executar 3 \"threads\" concurrents.\r\n\r\n```\r\n...\r\n<Resource name=\"wm/appWorkManager\"\r\n\tauth=\"Container\"\r\n\tfactory=\"de.myfoo.commonj.work.FooWorkManagerFactory\" \r\n\ttype=\"commonj.work.WorkManager\"\r\n\tmaxThreads=\"3\"/>\r\n...\r\n```\r\n\r\nAlguns dels paràmetres de configuració i tunning del \"WorkManager\" es poden trobar a la següent adreça:\r\nhttp://download.oracle.com/docs/cd/E11035_01/wls100/config_wls/self_tuned.html\r\n\r\n## Preguntes freqüents\r\n\r\n### Utilització de Quartz en un cluster\r\n\r\nLa principal problemàtica del planificador de tasques en un cluster és l'execució del planificador en cadascuna de les màquines de forma independent. Si l'aplicació es troba en un cluster i no es gestiona aquesta problemàtica, la tasca s'executarà tants cops com nodes al cluster tinguessim.\r\n\r\nPer solventar aquest problema, Quartz proporciona una solució basada en una base de dades centralitzada que funciona com a semàfor d'execució dels diferents Jobs.\r\n\r\n### Configuració\r\n\r\nLa configuració consta de dos passos:\r\n\r\n1. Crear les taules a partir dels scripts proporcionats per Quartz. Els pots trobar al directori: quartz\\docs\\dbTables directory.\r\n2. Crear el arxiu de propietats quartz.properties a l'arrel de l'aplicació. src/main/resources/quartz.properties\r\n\r\n```\r\n#============================================================================\r\n# Configure Main Scheduler Properties\r\n#============================================================================\r\norg.quartz.scheduler.instanceName = MyClusteredScheduler\r\norg.quartz.scheduler.instanceId = AUTO\r\n#============================================================================\r\n# Configure ThreadPool\r\n#============================================================================\r\norg.quartz.threadPool.class = org.quartz.simpl.SimpleThreadPool\r\norg.quartz.threadPool.threadCount = 25\r\norg.quartz.threadPool.threadPriority = 5\r\n#============================================================================\r\n# Configure JobStore\r\n#============================================================================\r\norg.quartz.jobStore.misfireThreshold = 60000\r\norg.quartz.jobStore.class = org.quartz.impl.jdbcjobstore.JobStoreTX\r\norg.quartz.jobStore.driverDelegateClass = org.quartz.impl.jdbcjobstore.oracle.OracleDelegate\r\norg.quartz.jobStore.useProperties = false\r\norg.quartz.jobStore.dataSource = myDS\r\norg.quartz.jobStore.tablePrefix = QRTZ_\r\n\r\norg.quartz.jobStore.isClustered = true\r\norg.quartz.jobStore.clusterCheckinInterval = 20000\r\n#============================================================================\r\n# Configure Datasources\r\n#============================================================================\r\n#org.quartz.dataSource.myDS.driver = oracle.jdbc.driver.OracleDriver\r\n#org.quartz.dataSource.myDS.URL = jdbc:oracle:thin:@localhost:1521:orcl\r\n#org.quartz.dataSource.myDS.user = scott\r\n#org.quartz.dataSource.myDS.password = tiger\r\n#org.quartz.dataSource.myDS.maxConnections = 5\r\n#org.quartz.dataSource.myDS.validationQuery=select 0 from dual\r\n#============================================================================\r\n# Configure Datasources JNDI\r\n#============================================================================\r\norg.quartz.dataSource.myDS.jndiURL=jdbc/myDataSource\r\norg.quartz.dataSource.myDS.java.naming.factory.initial=com.evermind.server.rmi.RMIInitialContextFactory\r\norg.quartz.dataSource.myDS.java.naming.provider.url=ormi://localhost\r\norg.quartz.dataSource.myDS.java.naming.security.principal=admin\r\norg.quartz.dataSource.myDS.java.naming.security.credentials=123\r\n```\r\n\r\nMés informació a:\r\n\r\nhttp://www.quartz-scheduler.org/documentation/quartz-2.x/configuration/ConfigJDBCJobStoreClustering\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXBsYW5pZmljYWRvcg=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXByb3Zlcw==":{"date":1427978212000,"title":"Proves","description":"Proves unitàries","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-altres/modul-proves","content":"## Propòsit\r\n\r\nLes proves son una part fonamental en el desenvolupament d'aplicacions, en aquest apartat es focalitza en com realitzar proves unitàries dels diferents mòduls de l'aplicació mitjançant Spring Test.\r\n\r\nA l'utilitzar injecció de dependència, això fa que el codi sigui menys dependent del que ho seria en un desenvolupament java tradicional i per tant realitzar proves unitàries de diferents parts de mòduls sense tenir el conjunt complert hauria de ser més senzill.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nReferència | URL\r\n---------- | ---\r\nSpring Test | http://docs.spring.io/spring/docs/4.1.x/spring-framework-reference/html/testing.html\r\n\r\n## Glossari\r\n\r\n**@RunWith** - Anotació a nivell de classe per indicar amb que s'executarà la classe de test.\r\n**@ContextConfiguration** - Anotació a nivell de classe per a carregar el context d'Spring.\r\n**@Before** - Anotació a nivell de mètode per indicar quin és el mètode d'inicialització de la classe de test.\r\n**@Test** - Anotació a nivell de mètode per indicar que el mètode és de test.\r\n**@Autowired** - Anotació a nivell de propietat o mètode per a indicar que la propietat de la classe es carregui automàticament amb el bean del context d'spring.\r\n**@Qualifier** - Anotació a nivell de propietat o mètode que s'utilitza quan s'ha indicat un @Autowired i al context d'spring existeixen més d'un bean del mateix tipus del que s'ha de realitzar l'autowired, aleshores d'indica el @Qualifier per indicar a Spring el nom del bean que ha de setejar.\r\n\r\n## Instal.lació\r\n\r\nUtilitzant Canigó3 on cal realitzar cap pas addicional per a tenir instal- lat el mòdul de testing d'Spring. Ja que el framework ja incorpora la dependència.\r\n\r\n**Dependència pom.xml**\r\n\r\nPer defecte canigó3 incorpora la dependència d'Spring Test en scope test, aquesta dependència la incorpora canigo-core de la següent manera:\r\n\r\n```\r\n<dependency>\r\n\t<groupId>org.springframework</groupId>\r\n\t<artifactId>spring-test</artifactId>\r\n\t<version>${org.springframework.version}</version>\r\n\t<scope>test</scope>\r\n</dependency>\r\n```\r\n\r\n## Utilització\r\n\r\n### Definició classe de test\r\n\r\nPer a crear una classe de test simplement s'ha de crear una classe de Java tradicional i afegir la següent anotació @RunWith (org.junit.runner.RunWith) per a que spring detecti que és una classe de test.\r\n\r\n```\r\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\r\n\r\n...\r\n\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n```\r\n\r\n### Càrrega del context de l'aplicació\r\n\r\nPer a carregar el context de l'aplicació s'utilitzarà l'anotació @ContextConfiguration (org.springframework.test.context.ContextConfiguration) a nivell de classe.\r\n\r\nEs pot carregar el context de canigo-core que carregarà tot el framework:\r\n\r\n```\r\n@ContextConfiguration(locations = {\"../../../core/config/canigo-core.xml\"})\r\n```\r\n\r\n\r\nal carregar el context de canigó serà necessari indicar els fitxers xml app-custom-***.xml dintre del directori spring i els fitxers de propietats d'aquest fitxer xml dintre del directori config, tal i com es te a l'aplicació.\r\n\r\no be només carregar els beans que es troben en certs fitxers xml:\r\n\r\n```\r\n@ContextConfiguration(locations = {\"config/canigo-support-mailing.xml\", \"config/app-support-mailing.xml\"})\r\n```\r\n\r\n### Mètodes de setUp\r\n\r\nPer indicar el mètode de setUp del test cal fer-ho mitjançant l'anotació @Before (org.junit.Before) a nivell de mètode.\r\n\r\nEn aquest mètode es realitzaran les inicialitzacions necessàries per a poder executar els mètodes de test de la classe.\r\n\r\n```java\r\n@Autowired\r\n@Qualifier(\"accountDAO\")\r\nAccountDAO<Account, Integer> dao = null;\r\n\r\n...\r\n\r\n@Before\r\npublic void settingUp(){\r\n\tAssert.assertNotNull(dao);\r\n\tAssert.assertEquals(Account.class, dao.getPersistentClass());\r\n}\r\n```\r\n\r\n### Mètodes de test\r\n\r\nPer indicar que un mètode és de test cal fer-ho mitjançant l'anotació @Test (org.junit.Test) a nivell de mètode.\r\n\r\n```java\r\n@Test\r\npublic void testFinder(){\t\t\r\n\tAssert.assertNull(dao.get(1));\r\n\tAccount account = new Account();\r\n\taccount.setName(\"test1\");\r\n\tdao.save(account);\r\n\t\r\n\tAssert.assertNotNull(dao.get(account.getId()));\r\n\t\r\n\tAccount account2 = new Account();\r\n\taccount2.setName(\"test2\");\r\n\tdao.save(account2);\r\n\t\r\n\tList<Account> accounts = dao.findAll();\r\n\tAssert.assertEquals(5, accounts.size());\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXByb3Zlcw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXdlYnNlcnZpY2Vz":{"date":1427976156000,"title":"Webservices","description":"Webservices","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-altres/modul-webservices","content":"## Propòsit\r\n\r\nEl propòsit d'aquest apartat es introduir al desenvolupador en la configuració i ús d'una infraestructura de Webservices en dues modalitats:\r\n\r\n* Exportació de serveis Java mitjançant Web Services.\r\n* Importació de Web Services externs, generació si cal de classes Java d'invocació.\r\n\r\nJa que Canigó 3 no disposa d'un servei addicional de Webservices, l'enfocament d'aquest apartat es el de simplificar tant la definició de Web Services a partir de serveis Java simples (que no tindran dependències amb la implementació particular de Web Services) així com la de facilitar la invocació a Web Services externs.\r\n\r\nPer aquesta aproximació s'ha fet servir Spring WS, JAXB i OXM.\r\n\r\n## Context i Escenaris d'Ús\r\n\r\nLa integració de WebServices no es troba ubicat dins del framework de Canigó com a un servei addicional. Ens recolzarem en les classes de Spring WS per a realitzar els exemples d'integració.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nReferència | URL\r\n---------- | ---\r\nSpring Web Services | http://static.springsource.org/spring-ws/sites/2.0/reference/html/\r\n\r\n## Glossari\r\n\r\n**EndPoint**\r\n\r\nUna interfície endpoint, també coneguda com a interfície de servei endpoint (SEI), és un terme utilitzat en la plataforma J2EE quan s'exposa un Enterprise Java Bean com a servei web. Un client accedeix a partir d'aquesta interfície, que com a totes les interfícies, defineix el mètodes de negoci del bean.\r\n\r\n**OXM**\r\n\r\nLa API OXM (spring-oxm.jar) proporciona integració entre les APIs més populars de marshalling de XML (JAXB1, JAXB2, Castor, Jibx).\r\n\r\n**JAXB**\r\n\r\nJava Architecture for XML Binding (JAXB) és una API que proporcionar als desenvolupadors una eina de mapping de classes Java a la seva representació XML.\r\n\r\n**Marshalling**\r\n\r\nÉs el procés que s'encarrega de transformar la representació d'un objecte en memoria (Java Object) en un format que encaixi amb el canal de comunicació amb el que es treballa (XML).\r\n\r\n**UnMarshalling**\r\n\r\nÉs el procés invers al Marshalling, la representació en format XML passa a convertir-se en una Java Object.\r\n\r\n**XSDL**\r\n\r\nUn arxiu WSDL és un arxiu XML que descriu la forma de comunicació, es a dir, els requsisits de protocol i els formats dels missatges necessaris per interactuar amb els serveis llistats en el seu catàleg. Així un arxiu WSDL funciona com a interficie pública del web service.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nLa instal.lació del servei requereix de la utilització de la llibreria 'spring-ws-core' i les dependències indicades a l'apartat 'Introducció-Versions i Dependències'.\r\n\r\n### Configuració\r\n\r\nAquest punt el dividirem en dues parts segons si volem exposar un servei o bé som consumidor(clients) de ell:\r\n\r\n#### Configuració com a client\r\n\r\nLa configuració del web implica els següents passos:\r\n\r\n* Definir l'arxiu de propietats amb les dades del webservice.\r\n* Generar les classes Java i els seus bindings a partir del WSDL del Webservice.\r\n* Definir l'arxiu de configuració de Spring: client, marshallers, WebserviceTemplate.\r\n* Definir el client que realitzarà la crida.\r\n* Test d'exemple\r\n\r\n#### Definició de l'arxiu de propietats\r\n\r\nFitxer de configuració: webservices.properties\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props\r\n\r\n    *.ws.uri=http://ws.cdyne.com/WeatherWS/Weather.asmx\r\n\r\nContindrà les URLs del webservices segons l'entorn al que es vulgui atacar.\r\n\r\n#### Generar les classes Java i els seus bindings a partir del WSDL del Webservice\r\n\r\nPer aquest procés s'utilitzarà un plugin de maven. Aquest serà l'encarregat de generar el codi Java i les anotacions de binding de manera automàtica a partir del WSDL.\r\n\t\r\n    És recomanable generar aquestes classes en un projecte extern, i posteriorment afegir aquest projecte com a dependència del projecte\r\n\r\n**pom.xml**\r\n\r\n```\r\n....\r\n<build>\r\n\t<plugins>\r\n\t\t...........\r\n                ...........\r\n\r\n\t\t<plugin>\r\n\t\t\t<groupId>org.apache.cxf</groupId>\r\n\t\t\t<artifactId>cxf-codegen-plugin</artifactId>\r\n\t\t\t<version>2.2.10</version>\r\n\t\t\t<executions>\r\n\t\t\t\t<execution>\r\n\t\t\t\t\t<id>generate-sources</id>\r\n\t\t\t\t\t<phase>generate-sources</phase>\r\n\t\t\t\t        <configuration>\r\n\t\t\t\t\t        <sourceRoot>${basedir}/src/main/java</sourceRoot>\r\n                                                <wsdlOptions>\r\n\t\t\t\t\t\t\t<wsdlOption>\r\n\t\t\t\t\t\t\t\t<wsdl>http://wsf.cdyne.com/WeatherWS/Weather.asmx?wsdl</wsdl>\r\n\t\t\t\t\t\t\t</wsdlOption>\r\n\t\t\t\t\t\t</wsdlOptions>\r\n\t\t\t\t\t</configuration>\r\n\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t<goal>wsdl2java</goal>\r\n\t\t\t\t\t</goals>\r\n\t\t\t\t</execution>\r\n\t\t\t</executions>\r\n\r\n\t\t\t<dependencies>\r\n\t\t\t\t<dependency>\r\n\t\t\t\t\t<groupId>org.jvnet.jaxb2_commons</groupId>\r\n\t\t\t\t\t<artifactId>jaxb2-basics</artifactId>\r\n\t\t\t\t\t<version>0.6.0</version>\r\n\t\t\t\t</dependency>\r\n\t\t\t\t<dependency>\r\n\t\t\t\t\t<groupId>org.jvnet.jaxb2_commons</groupId>\r\n\t\t\t\t\t<artifactId>jaxb2-basics-runtime</artifactId>\r\n\t\t\t\t\t<version>0.6.0</version>\r\n\t\t\t\t</dependency>\r\n\t\t\t</dependencies>\r\n\t\t</plugin>\r\n\t</plugins>\r\n</build>\r\n......\r\n```\r\n\r\nAquest plugin generarà automàticament el codi Java de el WSDL informat, en aquest cas: http://ws.cdyne.com/WeatherWS/Weather.asmx?wsdl. Un servei web gratuït per a consultar el temps a partir del ZIP code.\r\n\r\n### Definir l'arxiu de configuració de Spring\r\n\r\nFitxer de configuració: canigo-webservices-config.xml\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/spring\r\n\r\n```\r\n<bean id=\"messageFactory\" class=\"org.springframework.ws.soap.saaj.SaajSoapMessageFactory\">\r\n\t<property name=\"soapVersion\">\r\n\t\t<util:constant static-field=\"org.springframework.ws.soap.SoapVersion.SOAP_12\" />\r\n\t</property>\r\n</bean>\r\n\r\n<bean id=\"webServiceTemplate\" class=\"org.springframework.ws.client.core.WebServiceTemplate\">\r\n\t<constructor-arg ref=\"messageFactory\" />\r\n\t<property name=\"marshaller\" ref=\"marshaller\" />\r\n\t<property name=\"unmarshaller\" ref=\"marshaller\" />\r\n\t<property name=\"defaultUri\" value=\"${ws.uri}\" />\r\n</bean>\r\n\r\n<bean id=\"webServiceClient\" class=\"cat.gencat.ctti.canigo.demo.ws.WebServiceClientImpl\">\r\n\t<property name=\"webServiceTemplate\" ref=\"webServiceTemplate\"/>\r\n\t<property name=\"defaultUri\" value=\"${ws.uri}\" />\t\t\r\n</bean>\r\n\r\n<bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\">\r\n\t<property name=\"classesToBeBound\">\r\n\t\t<list>\r\n\t\t\t<value>com.cdyne.ws.weatherws.ArrayOfForecast</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.ArrayOfWeatherDescription</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.Forecast</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.ForecastReturn</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetCityForecastByZIP</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetCityForecastByZIPResponse</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetCityWeatherByZIP</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetCityWeatherByZIPResponse</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetWeatherInformation</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetWeatherInformationResponse</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.POP</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.Temp</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.WeatherDescription</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.WeatherReturn</value>\r\n\t\t</list>\r\n\t</property>\r\n</bean>\r\n```\r\n\r\nEn aquesta configuració destacar classesToBeBound: que és el conjunt de classes de les quals OXM farà el marshalling i unmarshalling sense necessitat de manipular XML per part del desenvolupador.\r\n\r\n### Definir el client que realitzarà la crida\r\n\r\nCodi d'exemple per a la crida al webservice.\r\n\r\n**WebServiceClientImpl.java**\r\n\r\n```java\r\npublic class WebServiceClientImpl implements WebServiceClient {\r\n\t\r\n\tprivate WebServiceTemplate webServiceTemplate;\r\n\r\n\tpublic void setWebServiceTemplate(WebServiceTemplate webServiceTemplate) {\r\n\t\tthis.webServiceTemplate = webServiceTemplate;\r\n\t}\r\n\r\n\tpublic void setDefaultUri(String defaultUri) {\r\n\t\twebServiceTemplate.setDefaultUri(defaultUri);\r\n\t}\r\n\r\n\tpublic GetCityForecastByZIPResponse simpleSendAndReceive(String zip) {\r\n\t\t\t\t\r\n\t\tGetCityForecastByZIP request = new GetCityForecastByZIP();\r\n\t\trequest.setZIP(zip);\r\n\t\t\t\t\r\n\t\treturn (GetCityForecastByZIPResponse)webServiceTemplate.marshalSendAndReceive(request);\r\n\t}\r\n\r\n}\r\n```\r\n\r\n**WebServiceClient.java**\r\n\r\n```java\r\npublic interface WebServiceClient {\r\n\tGetCityForecastByZIPResponse simpleSendAndReceive(String zip);\r\n}\r\n```\r\n\r\nDefinir un test per a certificar el seu funcionament\r\n\r\n**WebServiceClientTest .java**\r\n\r\n```java\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(locations = {\"ws-context.xml\"})\r\npublic class WebServiceClientTest {\r\n\t\r\n\tprivate static final Log LOGGER = LogFactory.getLog(WebServiceClientTest.class);\r\n\t\r\n\t@Autowired\r\n\tpublic WebServiceClient client;\r\n\t\r\n\t@Before\r\n\tpublic void init(){\r\n\t\tAssert.assertNotNull(client);\r\n\t}\r\n\t\r\n\t@Test\r\n\tpublic void testCall(){\r\n\t\tGetCityForecastByZIPResponse response = client.simpleSendAndReceive(\"35004\");\r\n\t\t\r\n\t\tAssert.assertNotNull(response);\r\n\t\tAssert.assertEquals(\"Moody\", response.getGetCityForecastByZIPResult().getCity());\r\n\t\tAssert.assertEquals(\"AL\", response.getGetCityForecastByZIPResult().getState());\r\n\t\tAssert.assertEquals(\"Birmingham\", response.getGetCityForecastByZIPResult().getWeatherStationCity());\r\n\t\t\r\n\t\t\r\n\t\tfor(Forecast forecast : response.getGetCityForecastByZIPResult().getForecastResult().getForecast()){\r\n\t\t\tLOGGER.debug(forecast.getDate() + \": \" + forecast.getDesciption());\r\n\t\t}\r\n\t}\r\n}\r\n```\r\n\r\n### Configuració com a EndPoint\r\n\r\nLa configuració del webservice implica els següents passos:\r\n\r\n* Configuració del web.xml.\r\n* Definir l'arxiu de configuració de Spring: marshallers, endpoints.\r\n* Definir el Endpoint\r\n\r\nEn aquest punt considerem que l'usuari coneix o ha generat l'arxiu XSD (Schema) que defineix el contracte del webservice.\r\n\r\n### Configuració del web.xml.\r\n\r\nEl primer punt a considerar és la càrrega i generació d'un nou context d'spring amb les dades del WS.\r\n\t\r\nAquesta context és independent del context de Spring de l'aplicació web. Si el desenvolupador vol integrar un servei propi de canigó, l'haurà de referenciar directament dins del contextConfigLocation del servlet de Spring WS.\r\n\r\nAquest servlet MessageDispatcherServlet carregarà els arxius de configuració dins del seu context de Spring, i definirá el mapping de les peticions contra aquest servei.\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<web-app xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \r\n         xmlns=\"http://java.sun.com/xml/ns/javaee\" \r\n         xmlns:web=\"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\" \r\n         xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee \r\n                             http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\" \r\n\t     id=\"WebApp_ID\" version=\"2.5\">\r\n\r\n\t........\r\n\t\r\n    <servlet>\r\n        <servlet-name>ws-canigo</servlet-name>\r\n        <servlet-class>org.springframework.ws.transport.http.MessageDispatcherServlet</servlet-class>\r\n\t\t<init-param>\r\n\t\t\t<param-name>contextConfigLocation</param-name>\r\n\t\t\t<param-value>classpath:/spring-ws-context.xml</param-value>\r\n\t\t</init-param>\r\n    </servlet>\r\n\r\n    <servlet-mapping>\r\n        <servlet-name>ws-canigo</servlet-name>\r\n        <url-pattern>/*</url-pattern>\r\n    </servlet-mapping>\r\n\t\r\n\t.........\r\n\t\r\n</web-app>\r\n```\r\n\r\n### Definir l'arxiu de configuració de Spring\r\n\r\nDins de l'arxiu de configuració definim:\r\n\r\n* L' estrategia de resolució del Endpoint (en aquest cas per anotacions).\r\n* Configuració de OXM per tal d'aplicar marshalling i unmarshalling sobre les dades d'entrada i sortida del Endpoint.\r\n* Indicar al marshaller quins son els beans que contenen l'informació de binding.\r\n* Exportar el XSD com a WSDL de manera transparent.\r\n\r\nRuta proposada:\r\n/src/main/resources/spring-ws/spring-ws-context.xml\r\n\t\r\n<div class=\"message information\">\r\nEn el cas de que l'aplicació web de tipus Canigó no sigui exclusivament un webservice, evitar que el context de l'aplicació Web carregui els beans\r\nde Spring WS introduïnt-los en la carpeta /src/main/resources/spring/. Això carregaria de manera automàtica els beans de Spring WS, consumint memoria innecesariament\r\nja que el context de l'aplicació web no és el mateix que el del webservice.\r\n</div>\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n       xmlns:p=\"http://www.springframework.org/schema/p\"\r\n       xmlns:context=\"http://www.springframework.org/schema/context\"\r\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n                           http://www.springframework.org/schema/beans/spring-beans.xsd\r\n                           http://www.springframework.org/schema/context\r\n                           http://www.springframework.org/schema/context/spring-context.xsd\">\r\n\r\n    <context:component-scan base-package=\"cat.gencat.ws.example.service\" />\r\n\r\n    <bean id=\"echo\" class=\"org.springframework.ws.wsdl.wsdl11.DefaultWsdl11Definition\"\r\n          p:portTypeName=\"Echo\"\r\n          p:locationUri=\"/echoService/\"\r\n\t\t  p:targetNamespace=\"http://mycompany.com/hr/definitions\">\r\n        <property name=\"schema\">\r\n            <bean class=\"org.springframework.xml.xsd.SimpleXsdSchema\"\r\n                  p:xsd=\"classpath:/config/xsd/echo.xsd\" />\r\n            </bean>\r\n        </property>        \r\n    </bean>\r\n\r\n    <bean class=\"org.springframework.ws.server.endpoint.mapping.PayloadRootAnnotationMethodEndpointMapping\"/>\r\n\r\n    <bean class=\"org.springframework.ws.server.endpoint.adapter.MarshallingMethodEndpointAdapter\">\r\n        <constructor-arg ref=\"marshaller\"/>\r\n    </bean>\r\n\r\n    <bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\"\r\n          p:contextPath=\"cat.gencat.ws.example.schema.beans\" />\r\n\r\n</beans>\r\n```\r\n\r\n### Definir el Endpoint\r\n\r\nInterficie que defineix les operacions públiques del WS.\r\n\r\n**MarshallingEchoService.java**\r\n\r\n```\r\npublic interface MarshallingEchoService {\r\n    \r\n    /**\r\n     * Return Echo response\r\n     */\r\n    public EchoResponse echoEcho(EchoRequest request);\r\n\r\n}\r\n```\r\n\r\nLa anotació @Endpoint indica que es tracta d'un EndPoint, Spring gracies a component-scan i la clase PayloadRootAnnotationMethodEndpointMapping mapeja les peticions i respostes contra aquest bean.\r\n\r\nDe manera transparent el marshaller s'encarregarà de la conversió de XML a object i de object a XML.\r\n\r\n**EchoEndpoint.java**\r\n\r\n```java\r\n@Endpoint\r\npublic class EchoEndpoint implements MarshallingEchoService {\r\n    \r\n    /**\r\n     * Return Echo response\r\n     */\r\n    @PayloadRoot(localPart=\"echoEcho\", namespace=\"http://mycompany.com/hr/definitions\")\r\n    public EchoResponse echoEcho(EchoRequest request) {\r\n        return new EchoRequest().setMessage(request.getMessage());        \r\n    }\r\n\r\n}\r\n```\r\n\r\nDes d'un client d'aquest WS (revisar configuració com a client) realitzem la crida i recuperem el valor retornat:\r\n\r\n**EchoServiceClient.java**\r\n\r\n```java\r\npublic class EchoServiceClient implements MarshallingEchoService {\r\n   \r\n    @Autowired\r\n    private WebServiceTemplate wsTemplate;\r\n\r\n    private static final Log LOGGER = LogFactory.getLog(EchoServiceClient.class);\r\n   \r\n    /**\r\n     * Gets person list.\r\n     */\r\n    public EchoResponse echoEcho(EchoRequest request) {\r\n        EchoResponse response = \r\n            (EchoResponse) wsTemplate.marshalSendAndReceive(request);\r\n\r\n        if(LOGGER.isDebugEnabled(()){\r\n\t    LOGGER.debug(response.getMessage());\r\n        }\r\n\r\n        return response;\r\n        \r\n    }\r\n   \r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXdlYnNlcnZpY2Vz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1jb25maWd1cmFjaW8=":{"date":1425571902000,"title":"Mòdul de configuració","description":"Configuracio de les propietats dels components de l'aplicació.","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-core/modul-configuracio","content":"## Propòsit\r\n\r\nEl mòdul de configuració té com a propòsit la configuració de les\r\npropietats de qualsevol component de l'aplicació. Aquestes propietats\r\npoden ser tant referències a altres objectes com propietats internes\r\n(atributs) que necessiten per al seu correcte funcionament.\r\n\r\nUna de les principals avantatges del mòdul respecte la classe\r\n[PropertyPlaceholderConfigurer](http://docs.spring.io/spring/docs/4.3.3.RELEASE/javadoc-api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html \"Documentacio de Spring\")\r\naportada per Spring, és la possibilitat de disposar de propietats\r\ndependents d'entorn sense necessitat de cap configuració extra a nivell\r\nde beans - propietats.\r\n\r\n## Limitacions\r\n\r\nPer aplicacions Canigó 3.2 que no utilitzin Spring Boot, normalment aplicacions que actualitzin de versions anteriors, el mòdul de configuració no presenta cap incompatibilitat.\r\n\r\nPer aplicacions Canigó 3.2 que utilitzin Spring Boot, normalment noves aplicacions, el mòdul de configuració presenta les següents limitacions:\r\n\r\n* no és compatible amb la càrrega de propietats depenent dels profiles de Spring Boot (spring.profiles.active o SPRING_PROFILES_ACTIVE). Si es vol fer depenent els valors de les propietats segons l'entorn, s'han de seguir les instruccions especificades en aquesta plana.\r\n\r\n* condicionar la configuració de Spring Boot (Veure secció \"Condicionar la configuració de Spring Boot\" d'aquesta plana)\r\n\r\n\tDonades aquestes limitacions, en una futura versió de Canigó, es preveu deprecar aquest mòdul de configuració en favor dels profiles de Spring Boot\r\n\r\n## Instal.lació i configuració\r\n\r\n### Instal.lació\r\n\r\nEl mòdul de configuració i el corresponent test unitari s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació, l'eina de suport al desenvolupament inclourà la referència dins del pom.xml. \r\nEn cas d'una instal- lació manual afegir les següents línies al pom.xml de l'aplicació:\r\n\r\n```xml\r\n<canigo.core.version>[3.2.0,3.3.0)</canigo.core.version>\r\n<canigo.test.version>[1.2.0,1.3.0)</canigo.test.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.core</artifactId>\r\n    <version>${canigo.core.version}</version>\r\n</dependency>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.test</artifactId>\r\n    <version>${canigo.test.version}</version>\r\n    <scope>test</scope>\r\n</dependency>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.core</artifactId>\r\n    <type>test-jar</type>\r\n    <version>${canigo.core.version}</version>\r\n    <scope>test</scope>\r\n    <classifier>tests</classifier>\r\n</dependency>\r\n```\r\n\r\nAl pom.xml també s'ha d'afegir el plugin que executa el test unitari del mòdul de configuració:\r\n```\r\n<build>\r\n    ...\r\n    <plugins>\r\n        ...\r\n        <plugin>\r\n            <groupId>org.apache.maven.plugins</groupId>\r\n            <artifactId>maven-surefire-plugin</artifactId>\r\n            <executions>\r\n                <execution>\r\n                    <id>base-test</id>\r\n                    <phase>test</phase>\r\n                    <goals>\r\n                        <goal>test</goal>\r\n                    </goals>\r\n                    <configuration>\r\n                        <dependenciesToScan>\r\n                            <dependency>cat.gencat.ctti:canigo.core</dependency>\r\n                            ...\r\n                        </dependenciesToScan>\r\n\t\t\t<excludes>\r\n\t\t\t\t<exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t</excludes>\r\n                    </configuration>\r\n                </execution>\r\n                ...\r\n            </executions>\r\n        </plugin>\r\n        ...\r\n    </plugins>\r\n    ...\r\n</build>    \r\n```\r\n\r\n### Configuració\r\n\r\nNo requereix configuració per part del desenvolupador. Els xmls de\r\nconfiguració del servei es troben internalitzats dins del jar del core,\r\ni s'inicialitzarà de manera automàtica un cop arrenqui l'aplicació.\r\n\r\nEls arxius de configuració de propietats de l'aplicació han d'estar en\r\nla següent ubicació:\r\n\r\n    <PROJECT_ROOT>/src/main/resources/config/props/*.properties\r\n\r\n<div class=\"message warning\">\r\nTots els arxius d'aquest directori han de complir el format de multi-entorn. Totes les propietats que no disposin d'aquest format seran ignorades.\r\n</div>  \r\n\r\n\r\n#### Configuració segons l'entorn\r\n\r\nA partir de la versió 3.0 de Canigó i per tal de reduir el número\r\nd'arxius de configuració per entorn, s'introdueixen els arxius de\r\npropietats multientorn. Cadascuna de les claus d'aquests arxius de\r\nconfiguració disposa de dues parts:\r\n\r\n-   **Entorn:** identifica l'entorn en el que aquesta propietat serà\r\n    vàlida. El entorn amb asterisc indica valor per defecte. En el cas\r\n    de que existeixi una propietat específica per a l'entorn, aquesta es\r\n    seleccionarà per defecte.\r\n-   **Clau:** propietat de identifica un determinat valor de\r\n    configuració.\r\n\r\nUn exemple d'un arxiu de propietats de configuració *exemple.properties*\r\npodria ser el següent:\r\n\r\n```java\r\n# Arxiu de configuració per al mòdul d'antivirus\r\n*.antivirus.serverIp=127.0.0.1\r\npro.antivirus.serverIp=11.11.11.02\r\nint.antivirus.serverIp=21.21.11.02\r\n*.antivirus.serverPort=1344\r\nint.antivirus.serverPort=1567\r\n```\r\n\r\n\r\n\r\nAixí, en l'exemple anterior tindríem la següent configuració per entorn:\r\n\r\nClau|Entorn|Valor|Comentari\r\n----|------|-----|---------\r\nantivirus.serverIp|loc|127.0.0.1|Configuració per defecte. No hi ha propietat específica per al entorn local.\r\nantivirus.serverIp|dev|127.0.0.1|Configuració per defecte. No hi ha propietat específica per al entorn de desenvolupament.\r\nantivirus.serverIp|int|21.21.11.02|Configuració específica per a l'entorn d'integració.\r\nantivirus.serverIp|pre|127.0.0.1|Configuració per defecte. No hi ha propietat específica per al entorn de preproducció\r\nantivirus.serverIp|pro|11.11.11.02|Configuració específica per a l'entorn de producció.\r\nantivirus.serverPort|loc|1344|Configuració per defecte. No hi ha propietat específica per al entorn local.\r\nantivirus.serverPort|dev|1344|Configuració per defecte. No hi ha propietat específica per al entorn de desenvolupament.\r\nantivirus.serverPort|int|1567|Configuració específica per a l'entorn d'integració.\r\nantivirus.serverPort|pre|1344|Configuració per defecte. No hi ha propietat específica per al entorn de preproducció.\r\nantivirus.serverPort|pro|1344|Configuració per defecte. No hi ha propietat específica per al entorn de producció.\r\n\r\n##### Definició de l'entorn\r\n\r\nEl concepte d'Entorn es defineix mitjançant la propietat entorn, a la\r\nque s'assigna el valor corresponent a l'arrancar la màquina virtual\r\nJava\r\n\r\n```java\r\njava ... -Dentorn=pro\r\n```\r\n\r\n\r\n\r\nAmb aquesta configuració en funció de l'entorn, el servei de\r\nconfiguració de Canigó cerca la configuració adient en els diferents\r\narxius de configuració de la carpeta\r\n<PROJECT_ROOT>/src/main/resources/config/props/\r\n\r\n## Utilització del mòdul\r\n\r\nDegut a la pròpia naturalesa del mòdul, l'obtenció de les propietats des\r\nde classes \"clients\" no requereix cap injecció de dependències o\r\nconfiguració addiccional. La resolució de les propietats per entorn es\r\nrealitzarà de manera automàtica i transparent per al desenvolupador.\r\n\r\n-   Exemple d'inserció de propietats en configuració de Beans de Spring\r\n    basada en XML:\r\n\r\n    ```java\r\n    <bean id=\"antivirus\"  class=\"cat.gencat.ctti.canigo.arch.integration.antivirus.impl.AntivirusImpl\">\r\n        <property name=\"remote\" value=\"${antivirus.remote:false}\" />\r\n            <property name=\"serverIP\" value=\"${antivirus.serverIp}\" />\r\n        <property name=\"serverPort\" value=\"${antivirus.serverPort}\" />\r\n    </bean>\r\n    ```\r\n\r\n    \r\n\r\n-   Exemple d'inserció de propietats en configuració de Beans de Spring bassat en anotacions:\r\n\r\n    ```java\r\n    @Repository\r\n    public class AntivirusImpl implements Antivirus{\r\n        @Value(\"${antivirus.serverIp}\")\r\n        private String serverIP;\r\n    }\r\n    ```\r\n\r\n## Configuració a servidors JEE corporatius\r\n\r\n### Concepte de configuració amb propietats globals\r\n\r\nA partir de la versió 3.0.3 del mòdul canigo.core s'inclou la\r\npossibilitat de poder fer servir propietats definides fora de\r\nl'aplicació. Aquestes propietats es configuren a nivell del servidor JEE\r\nmitjançant un fitxer de propietats la ruta del qual és especificada\r\ndurant l'arrencada de la JVM. Les propietats d'aquest fitxer afecten a\r\ntotes les aplicacions desplegades al servidor que incorporin aquesta\r\nversió (o posterior) del mòdul canigo.core. També es dona flexibilitat\r\nper poder definir excepcions per a certes aplicacions mitjançant un\r\nfitxer de propietats específic. \r\n Per aconseguir aquest funcionament cal que el proveïdor de l'aplicació\r\ni l'administrador del servidor JEE al CPD facin una sèrie de\r\nconfiguracions: \r\n \r\n\r\n#### Proveïdor de l'aplicació Canigó\r\n\r\nCal definir a l'aplicació la següent propietat al fitxer:\r\n**src/main/resources/config/props/application.properties**\r\n\r\nPropietat|Requerit|Descripció\r\n---------|--------|----------\r\ncodi_aplicacio|NO|Típicament serà el codi de diàleg de l'aplicació. Cal informar-ho nomes si es vol emprar un fitxer de propietats específiques per a l'aplicació en comptes del global de servidor.\r\n\r\n#### Administrador del servidor JEE al CPD\r\n\r\n<div class=\"message warning\">\r\nDeixar clar que aquest punt és responsabilitat de CPD i que l'únic que necessita conèixer de l'aplicació per poder-ne fer una configuració específica és el <b>codi_aplicacio</b>.\r\n</div>\r\n\r\n\r\n##### Indicar path de la carpeta del fitxer de propietats globals\r\n\r\nAl arrencar la màquina virtual de Java cal indicar la següent propietat:\r\n\r\n```java\r\njava ... -Dconf_dir=[ pathToConfDir ]\r\n```\r\n\r\nOn [ pathToConfDir ] és el path de la carpeta al servidor on hi figura\r\nl'arxiu de propietats global server.properties.\r\n \r\n\r\n##### Informar el fitxer de propietats globals\r\n\r\nAl servidor cal crear el següent fitxer de propietats: **[ pathToConfDir\r\n]/server.properties**\r\n I definir les següents propietats:\r\n\r\nPropietat|Requerit|Descripció\r\n---------|--------|----------\r\nentorn|SI|Nom de l'entorn\r\ncodi_servei|NO|Cal informar-ho només si es vol habilitar l'ús de fitxers de propietats específics per a aplicacions al servidor.\r\n\r\n    \r\nA aquest fitxer caldria afegir-hi la resta de propietats globals que es\r\nvulguin definir per a totes les aplicacions que es despleguin en aquest\r\nservidor. \r\n\r\n\r\n##### Informar el fitxer de propietats específic d'aplicació\r\n\r\nEn cas de voler habilitar fitxers de propietats específics per a una\r\naplicació, caldria crear la següent estructura de carpetes i fitxers: \r\n **[ pathToConfDir ]/[ entorn ]/[ codi_servei ]/[ codi_aplicacio\r\n]/app.properties** \r\n \r\n\r\n#### Exemples d'ús de propietats globals a servidor\r\n\r\n##### Exemple 1: Ús de propietats globals definides al servidor\r\n\r\nEs vol que totes les aplicacions desplegades al servidor facin servir la\r\nmateixa configuració per al servei d'enviament de correus, tret del\r\nusername i password del compte d'enviament que les definiran les pròpies\r\naplicacions. Per a aquest propòsit:\r\n\r\n-   Els proveïdors de les aplicacions que despleguin en aquest servidor\r\n    hauran d'indicar les propietats referents al username/password al\r\n    fitxer de propietats de configuració de correu de l'aplicació:\r\n    **/src/main/resources/config/props/mail.properties**.\r\n\r\n    ```java\r\n    *.mail.username=demo@gencat.cat\r\n    *.mail.password=*****\r\n    ```\r\n\r\n-   Els administradors del servidor hauran de :\r\n    -   Indicar el path de la carpeta del fitxer de propietats globals\r\n        durant l'arrencada de la JVM:\r\n\r\n        ```java\r\n        java ... -Dconf_dir=/serveis/conf\r\n        ```\r\n\r\n    -   Crear el fitxer de propietats globals i informar les seves\r\n        propietats: **/serveis/conf/server.properties**\r\n\r\n        ```java\r\n        entorn=loc\r\n        #Propietats globals d'enviament de correu per a totes les aplicacions desplegades\r\n        *.mail.host=smtp-intranet.gencat.intranet\r\n        *.mail.port=25\r\n        *.mail.protocol=smtp\r\n        *.mail.maxAttachmentSize=1024\r\n        ```\r\n\r\n        \r\n\r\n##### Exemple 2: Ús de propietats específiques d'aplicació definides al servidor\r\n\r\nEs vol definir el nom dels dataSources de les conexions per JNDI de les\r\naplicacions mitjançant els fitxers de propietats específics d'aplicació\r\ndins servidor. Per a aquest propòsit:\r\n\r\n-   Els proveïdors de l'aplicació hauran d'informar la propietat\r\n    **codi_aplicacio** al fitxer de propietats de la seva aplicació:\r\n    **src/main/resources/config/props/application.properties**\r\n\r\n    ```java\r\n    codi_aplicacio=001\r\n    ```\r\n\r\n-   Els administradors del servidor hauran de :\r\n    -   Indicar el path de la carpeta del fitxer de propietats globals\r\n        durant l'arrencada de la JVM:\r\n\r\n        ```java\r\n        java ... -Dconf_dir=/serveis/conf\r\n        ```\r\n\r\n    -   Crear el fitxer de propietats globals i informar les seves\r\n        propietats: **/serveis/conf/server.properties**\r\n\r\n        ```java\r\n        entorn=pre\r\n        codi_servei=demo\r\n        ```\r\n\r\n        \r\n\r\n    -   Crear l'estructura de carpetes i el fitxer de propietats\r\n        específic per a l'aplicació al servidor (+ creació estructura\r\n        directoris): **/serveis/conf/pre/demo/001/app.properties**\r\n\r\n        ```java\r\n        #Configuració de l'orígen de dades per JNDI per a l'aplicació 001\r\n        *.jndi.name=java:comp/env/dataSource001\r\n        ```\r\n\r\n        Prèviament cal que l'administrador del servidor hagi consultat\r\n        aquest **codi_aplicacio** al proveïdor de l'aplicació. \r\n         \r\n\t\t \r\n#### Modificar el PlaceHolder de les propietats\r\n\r\nPer defecte Canigó carrega les propietats que es troben a **classpath:/config/props/*.properties**. \r\n\r\nSi es vol modificar aquest path s'ha d'afegir la propietat **application.configLocation** al fitxer **application.properties**. Per exemple per carregar fitxers de propietats en jars externs a l'aplicació:\r\n\r\n\t*.application.configLocation=classpath*:/config/props/*.properties\r\n\t\r\n#### Condicionar la configuració de Spring Boot\r\n\r\nSpring Boot ofereix la possibilitat de condicionar diversos aspectes de la configuració (Per exemple quines classes s'han de carregar, o que controladors s'han d'exposar) segons si compleixen unes condicions:\r\n\r\nhttps://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html\r\n\r\nPer a poder utilitzar propietats en aquestes condicions s'han de carregar específicament per a aquest motiu en un fitxer de configuració propi que llegeixi SpringBoot, ja que les propietats de l'aplicació es carreguen després de resoldre aquestes condicions.\r\n\r\nSpringBoot per defecte cerca les propietats en un fitxer que es digui application.properties a src/resources. Les propietats que es dessitgi utilitzar en la configuració de SpringBoot s'han d'afegir en aquest fitxer.\r\n\r\nSi es vol utilitzar profiles de Spring, s'hauria de crear un fitxer application-{profile}.properties.\r\n\r\nUna altre forma de carregar un fitxer de propietas és d'afegir l'annotació @PropertySource al nostre fitxer de de configuració:\r\n\r\n\t@Configuration\r\n\t@PropertySource(\"classpath:/config/props/boot.properties\")\r\n\t@ImportResource({ \"classpath:cat/gencat/ctti/canigo/arch/core/config/canigo-core.xml\" })\r\n\t@EnableTransactionManagement\r\n\tpublic class AppConfig {\r\n\t\t\r\n\t}\r\n\r\nIndicant el path on es troba aquest fitxer.\r\n\r\nUn exemple d'aquesta condicionalitat es pot trobar al [servei de seguretat] (/canigo-documentacio-versions-3x-core/modul-seguretat/)\r\n\t\t\r\n\r\nPreguntes freqüents\r\n-------------------\r\n\r\n### Accés manual al servei de configuració\r\n\r\nEncara que no és recomanable accedir a les propietats del mòdul de\r\nmanera directa, el desenvolupador pot realitzar una crida de forma\r\nexterna mitjançant el patró ['Dependency\r\nInjection'](http://martinfowler.com/articles/injection.html \"Dependency Injection\")\r\nal mòdul i les seves propietats d'entorn.\r\n\r\n-   Injecció de dependències mitjançant xml. Per exemple:\r\n     Ruta proposada:\r\n    <PROJECT_ROOT>/src/main/resources/spring/exemple-beans-config.xml\r\n\r\n```java\r\n<bean id=\"myBean\"  class=\"cat.gencat.app.exemples.Injection\">\r\n    <property name=\"configuration\" ref=\"propertiesConfiguration\" />\r\n</bean>\r\n```\r\n\r\n\r\n\r\nLa clase Injection tindria la següent estructura:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.core.config.PropertiesConfiguration;\r\n\r\npublic class Injection {\r\n     PropertiesConfiguration configuration;\r\n\r\n     public void setConfiguration(PropertiesConfiguration  configuration){\r\n         this.configuration = configuration;\r\n     }\r\n\r\n}\r\n```\r\n\r\n\r\n\r\nInjecció del mòdul de configuració dins del bean \"myBean\". Spring\r\ns'encarregarà d'injectar la configuració del mòdul de propietats\r\nexecutant el mètode setConfiguration.\r\n\r\n-   Injecció de dependències mitjançant annotacions:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.core.config.PropertiesConfiguration;\r\n\r\n@Component(\"myBean\")\r\npublic class Injection {\r\n     @Autowired\r\n     PropertiesConfiguration configuration;\r\n\r\n     public void execute(){\r\n\r\n         String ip = configuration.getProperty(\"antivirus.serverIp\");\r\n     }\r\n\r\n}\r\n```\r\n\r\n\r\n\r\nL'anotació @Autowired injecta en aquest cas, un bean de tipus\r\ncat.gencat.ctti.canigo.arch.core.config.PropertiesConfiguration\r\nque Spring trobarà en el context de l'aplicació.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1jb25maWd1cmFjaW8="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1leGNlcGNpb25z":{"date":1426175425000,"title":"Mòdul d'excepcions","description":"Mòdul per a la gestió d'Errors","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-core/modul-excepcions","content":"## Propòsit\r\n\r\nLa gestió d'excepcions permet informar que s'ha produït un error al realitzar una petició. Aquest error podrà ser tractat adequadament i en cas necessari informar a l'usuari, llençar una traça, enviar un correu, etc.\r\n\r\nLa gestió correcta de les excepcions és molt important i crítica, però generalment la forma en la que es generen i gestionen les excepcions en les aplicacions és un dels aspectes més ignorats en el disseny de les mateixes. L'ús apropiat de les excepcions fa que els nostres aplicatius siguin més robusts, més fàcils de desenvolupar i mantenir, més lliures d'errors i més fàcils d'utilitzar. Per aquest motiu és important que donem el màxim de detall en les excepcions.\r\n\r\nPer evitar l'ús innecessari de blocs 'try-catch' dins el codi dels nostres aplicatius Canigó proporciona un mecanisme d'intercepció, pel qual indicarem quines excepcions volem tractar i quins gestors les tractaran sense haver d'incorporar cap referència a cap classe de l'aplicació.\r\n\r\n## Glossari\r\n\r\n## Instal.lació i configuració\r\n\r\n### Instal.lació\r\n\r\nEl mòdul de configuració s'inclou per defecte dins del core de Canigó 3. Durant el procés de creació de l'aplicació (Struts o JSF), l'eina de suport al desenvolupament inclourà la referència dins del pom.xml. En cas d'una instal- lació manual afegir les següents línies al pom.xml de l'aplicació:\r\n\r\n```\r\n<canigo.core.version>[3.1.0,3.2.0)</canigo.core.version>\r\n<canigo.web.jsf.version>[1.2.0,1.3.0)</canigo.web.jsf.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.core</artifactId>\r\n          <version>${canigo.core.version}</version>\r\n</dependency>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.web.jsf</artifactId>\r\n\t<version>${canigo.web.jsf.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del servei d'exepcions es configura mitjançant el fitxer de configuració web.xml:\r\n\r\nCaldrà configurar el filtre que interceptarà les peticions:\r\n\r\n```\r\n<filter>\r\n\t<filter-name>ErrorHandler Filter</filter-name>\r\n\t<filter-class>cat.gencat.ctti.canigo.arch.web.jsf.filter.ErrorHandlerFilter</filter-class>\r\n</filter>\r\n<filter-mapping>\r\n\t<filter-name>ErrorHandler Filter</filter-name>\r\n\t<url-pattern>*.jsf</url-pattern>\r\n</filter-mapping>\r\n\r\nTambé es definirà la pantalla d'error genèrica:\r\n\r\n<context-param>\r\n\t<param-name>errorPage</param-name>\r\n\t<param-value>/AppJava/views/error.jsf</param-value>\r\n</context-param>\r\n```\r\n\r\n## Utilització del mòdul\r\n\r\nEl filtre, intercepta totes les peticions a les pàgines JSF. Per defecte el filtre ErrorHandlerFilter que ofereix el framework, el que fa es interceptar qualsevol petició que doni un error del tipus Exception i mostrar la pàgina d'error genèrica definida al web.xml amb la informació de la excepció.\r\n\r\nEl framework defineix una interfície IBaseException, la qual han d'implementar totes les excepcions que es creï la pròpia aplicació. Aquesta interfície simplement defineix que aquesta hagi de tenir un detall de l'error amb informació de l'excepció base, codis d'error i altres propietats.\r\n\r\nEl core de Canigó3 ja incorpora una sèrie d'excepcions definides:    \r\n<br>\r\n\r\n![Imatge de les Excepcions Definides](/related/canigo/documentacio/modul-excepcions/cat.gencat.ctti.canigo.arch.core.exceptions.jpg \"Excepcions definides al mòdul\")","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1leGNlcGNpb25z"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnRlcm5hY2lvbmFsaXR6YWNpbw==":{"date":1426150815000,"title":"Mòdul d'internacionalització","description":"Mòdul d'internacionalització.","sections":"Canigó. Documentació versió 3.x","weight":5,"path":"/canigo-documentacio-versions-3x-core/modul-internacionalitzacio","content":"## Propòsit\r\n\r\nEl mòdul d'internacionalització té com a objectiu principal permetre el\r\ndesenvolupament d'aplicacions en el que no sigui necessària cap\r\nreenginyeria cada vegada que s'incorpori un nou llenguatge a\r\nl'aplicació.\r\n\r\nEn general tota aplicació internacionalitzada pot realitzar-se de dues\r\nformes diferenciades:\r\n\r\n1.  Mitjançant la rèplica d'un conjunt de pàgines per a cada idioma.\r\n2.  Mitjançant un únic conjunt de pàgines que obtenen diferents literals\r\n    de forma externa segons l'idioma.\r\n\r\nLa primera solució, fins ara utilitzada en moltes pàgines Web, implica\r\nun cost gran de rèplica i manteniment, ja que qualsevol nou requeriment\r\no canvi comporta realitzar més d'un desenvolupament, un per cada idioma.\r\n\r\nLa segona solució, recomanada per Canigó permet que:\r\n\r\n1.  Es puguin afegir llenguatges sense haver de realitzar canvis al\r\n    codi.\r\n2.  Els texts, imatges i missatges s'emmagatzemen de forma externa al\r\n    codi.\r\n3.  La informació (per exemple dates) es pot formatejar segons l'idioma\r\n    de l'usuari\r\n\r\n## Glossari\r\n\r\n**i18N (Internationalization)**\r\n\r\ni18N o Internationalization (el 18 correspon a les 18 lletres que hi ha\r\nentre la I inicial i la n final) és el procés d'agafar una aplicació\r\ndissenyada i reestructurar-la per a què pugui ser usada en diferents\r\nlocalitats o bé definir el procés de crear-la per a ser totalment\r\nflexible per executar-se en qualsevol localitat. Java defineix les\r\nclasses bàsiques d'ús de la internacionalització.\r\n\r\n## Instal.lació i configuració\r\n\r\n### Instal.lació\r\n\r\nEl mòdul de configuració s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació (Struts o JSF), l'eina de\r\nsuport al desenvolupament inclourà la referència dins del pom.xml. En\r\ncas d'una instal- lació manual afegir les següents línies al pom.xml de\r\nl'aplicació:\r\n\r\n~~~~ {.code-java}\r\n<canigo.core.version>[3.1.0,3.2.0)</canigo.core.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.core</artifactId>\r\n          <version>${canigo.core.version}</version>\r\n</dependency>\r\n~~~~\r\n\r\n### Configuració\r\n\r\nPer a configurar el mòdul d'internacionalització s'han de manipular els\r\nsegüents fitxers:\r\n\r\n1.  Definició dels fitxers de traduccions (típicament els fitxers dels\r\n    diferents idiomes: application.properties,\r\n    application_XX_XX.properties)\r\n2.  Definició de la integració amb el servei de presentació (web.xml)\r\n3.  Definició dels idiomes i literals suportats (només JSF).\r\n\r\nNo requereix configuració per a inicialitzar el mòdul per part del\r\ndesenvolupador. Els xmls de configuració del servei es troben\r\ninternalitzats dins del jar del core, i s'inicialitzarà de manera\r\nautomàtica un cop arrenqui l'aplicació.\r\n\r\nEls arxius de configuració d'idiomes de l'aplicació han d'estar en la\r\nsegüent ubicació:\r\n\r\n<PROJECT_ROOT>/src/main/resources/config/i18n/*.properties\r\n\r\nAutomàticament el mòdul d'internacionalització carregarà tots els arxius\r\nde configuració d'idiomes perquè posteriorment puguin ser explotats per\r\nl'aplicació.\r\n\r\n#### Definició dels fitxers de traducció\r\n\r\nUbicació:\r\n\r\n <PROJECT_ROOT>/src/main/resources/config/i18n/*.properties\r\n\r\nExplicació:\r\n\r\nEls fitxers de traducció són els fitxers que contenen els missatges en\r\nels diferents idiomes. Es basen en l'ús de la internacionalització de\r\nJava (i18n o Internationalization).\r\n\r\n Aquests fitxers s'han de construir tenint en compte que:\r\n\r\n1.  La seva extensió ha de ser '.properties' (es denominen resource\r\n    bundles).\r\n2.  Per cada idioma que volguem suportar cal crear un nou fitxer. Aquest\r\n    fitxer tindrà la següent nomenclatura:\r\n    'nomFitxer__lg_pa._properties', on 'lg' correspon al codi del\r\n    llenguatge i 'pa' correspon al codi del país pel qual volem definir\r\n    els literals.\r\n3.  El seu contingut es basa en l'ús de parells clau-valor tal i com es\r\n    mostra a continuació:\r\n\r\nFitxer de multiidioma application.properties\r\n\r\n~~~~ {.code-java}\r\nclau_1=valor_1\r\nclau_2=valor_2\r\n...\r\n~~~~\r\n\r\nEn cas de que l'idioma escollit per l'usuari no correspongui amb cap\r\nfitxer, es pot crear un fitxer per defecte. Aquest fitxer tindrà el\r\nformat 'nomFitxer.properties'.\r\n\r\nExemple:\r\n\r\n1.  'applicationResources_en.properties', per representar els literals\r\n    en anglès\r\n2.  'applicationResources_es.properties', per representar els literals\r\n    en castellà\r\n3.  'applicationResources_ca.properties', per representar els literals\r\n    català\r\n4.  'applicationResources.properties', per representar els literals de\r\n    qualsevol altre idioma\r\n\r\nMés informació dels codis de pais e idioma:\r\n\r\n-   [Codis d'idioma\r\n    (ISO-639)](http://ftp.ics.uci.edu/pub/ietf/http/related/iso639.txt)\r\n-   [Codis de pais\r\n    (ISO-3166)](http://www.chemie.fu-berlin.de/diverse/doc/ISO_3166.html)\r\n\r\n<div class=\"message warning\">\r\nEn cas de que per un llenguatge determinat existeixi un fitxer específic, l'obtenció del literal a partir d'una clau s'obtindrà des d'aquest fitxer. Si no es troba la clau en cap cas s'anirà al fitxer per defecte. Així doncs és important que es mantinguin actualitzats els fitxers de recursos per cada idioma de l'aplicació per evitar problemes. És important que es proporcioni un fitxer de recursos per defecte. Aquest serà el fitxer utilitzat  pel servei en cas de que el llenguatge escollit per l'usuari no correspongui a cap dels fitxers de recursos definits.\r\n</div>\r\n\r\n#### Definició de la integració amb el mòdul de presentació\r\n\r\nFitxer de configuració: web.xml\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/webapp/WEB-INF/web.xml\r\n\r\nPer integrar el mòdul d'internacionalització amb el mòdul de presentació\r\ns'han de definir els següents filtres a nivell d'aplicació:\r\n\r\n##### Localization Filter\r\n\r\nAquest filtre s'encarrega d'exposar el mòdul d'internacionalització per\r\ntal de que sigui accessible a tota la capa web. Comú tant aplicacions\r\nJSF com a Struts.\r\n\r\nAtributs:\r\n\r\n**Atribut**  | **Requerit** | **Valor**\r\n------------ | ------------ | ---------\r\nfilter-name  | Sí           | Nom del filtre<br>Exemple: Localization Filter\r\nfilter-class | Sí           | cat.gencat.ctti.canigo.arch.web.core.filters.LocalizationFilter\r\n\r\n~~~~ {.code-java}\r\n<filter>\r\n    <filter-name>Localization Filter</filter-name>\r\n    <filter-class>cat.gencat.ctti.canigo.arch.web.core.filters.LocalizationFilter</filter-class>\r\n</filter>\r\n~~~~\r\n\r\n##### Struts Locale Filter\r\n\r\nAquest filtre s'encarrega de d'integrar el mòdul d'internacionalització\r\nexposat pel filtre comú de Localization Filter per tal que des de Struts\r\nes pugui fer ús de fitxers d'internacionalització.\r\n\r\nAtributs:\r\n\r\n**Atribut**  | **Requerit** | **Valor**\r\n------------ | ------------ | ---------\r\nfilter-name  | Sí           | Nom del filtre<br>Exemple: Struts Locale Filter\r\nfilter-class | Sí           | cat.gencat.ctti.canigo.arch.web.struts.filter.StrutsLocaleFilter\r\n\r\n~~~~ {.code-java}\r\n<filter>\r\n   <filter-name>Struts Locale Filter</filter-name>\r\n   <filter-class>cat.gencat.ctti.canigo.arch.web.struts.filter.StrutsLocaleFilter</filter-class>\r\n</filter>\r\n~~~~\r\n\r\n#### Definició dels idiomes i literals suportats (només JSF)\r\n\r\nUbicació proposada:\r\n<PROJECT_ROOT>/src/main/webapp/WEB-INF/faces-config.xml\r\n\r\nLa configuració del locale permet definir amb quin nom s'exposaran les\r\npropietats a les pàgines JSF, i els idiomes permesos i per defecte del\r\nnavegador en cas de que no sigui informat.\r\n\r\nPer defecte, l'eina de suport al desenvolupament de Canigó informa\r\naquest valors segons les opcions seleccionades durant la creació de\r\nl'aplicació.\r\n\r\n~~~~ {.code-java}\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<faces-config version=\"1.2\" xmlns=\"http://java.sun.com/xml/ns/javaee\"\r\n xmlns:xi=\"http://www.w3.org/2001/XInclude\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-facesconfig_1_2.xsd\">\r\n\r\n    <application>\r\n\r\n        .......\r\n        <locale-config>\r\n        <default-locale>ca_ES</default-locale>\r\n        <supported-locale>es</supported-locale>\r\n        <supported-locale>en</supported-locale>\r\n        <supported-locale>de</supported-locale>\r\n    </locale-config>\r\n    <resource-bundle>\r\n            <base-name>config.i18n.applicationResources</base-name>\r\n            <var>msg</var>\r\n        </resource-bundle>\r\n        .......\r\n        </application>\r\n        ........\r\n</faces-config>\r\n~~~~\r\n\r\nEn l'exemple anterior l'idioma per defecte és Català, el locales\r\nsuportats: espanyol, anglès i alemany.\r\n Els recursos de l'aplicació es podran accedir des de la JSF a partir\r\ndel nom de variable **msg** i trobaran situats a:\r\n\r\n<PROJECT_ROOT>/src/main/resources/config/i18n/applicationResources.properties\r\n\r\n~~~~ {.code-java}\r\n<h:outputText value=\"#{msg.formulari_agregarCanvisArxiusIntegrats}\"/>\r\n~~~~\r\n\r\n#### Definició dels literals suportats (només Struts)\r\n\r\nUbicació proposada:\r\n<PROJECT_ROOT>/src/main/resources/struts/struts-config.xml\r\n\r\nAquest arxiu engloba la configuració de Struts, dins d'aquest podem\r\ndefinir els recursos que seran accessibles des de les pàgines web. Per\r\ntal d'habilitar aquesta internacionalització s'ha d'informar el tag\r\nmessage-resources.\r\n\r\n**Atribut** | **Requerit** | **Valor**\r\n----------- | ------------ | ---------\r\nparameter   | Sí           | Ruta per punts on estan localitzats els literals\r\nnull        | No           | Informant aquesta propietat com a \"false\" mostrará els recursos no informats com a ?key? enlloc de mostrar null\r\n\r\n~~~~ {.code-java}\r\n<message-resources parameter=\"i18n.applicationResources\" null=\"false\" />\r\n~~~~\r\n\r\nSi es vol exposar més d'un arxiu de literals crear tants tags\r\nmessage-resources com siguin necessaris.\r\n\r\n~~~~ {.code-java}\r\n<message-resources parameter=\"i18n.applicationResources\" null=\"false\" />\r\n<message-resources parameter=\"i18n.anotherApplicationResources\" null=\"false\" />\r\n<message-resources parameter=\"i18n.thirdApplicationResources\" null=\"false\" />\r\n~~~~\r\n\r\n## Utilització del mòdul\r\n\r\n### JSF\r\n\r\nSuposant que els recursos estan exposats a la variable **msg** i com a\r\nliterals tenim:\r\n\r\n**applicationResources.properties**\r\n\r\n~~~~ {.code-java}\r\nnomFormulari=Nom del formulari\r\n~~~~\r\n\r\n**prova.jsf**\r\n\r\n~~~~ {.code-java}\r\n<h:outputText value=\"#{msg.nomFormulari}\"/>\r\n~~~~\r\n\r\nSi la key del literal a mostrar conté un punt s'ha de mostrar de la\r\nsegüent manera:\r\n\r\n~~~~ {.code-java}\r\n<h:outputText value=\"#{msg['nom.formulari']\"/>\r\n~~~~\r\n\r\nI si el literal és del tipus cadena=Hola {0} {1} es poden passar\r\nparàmetres de la següent manera:\r\n\r\n~~~~ {.code-java}\r\n<h:outputFormat value=\"#{msg['cadena']}\">\r\n   <f:param value=\"Ramon\" />\r\n   <f:param value=\"Sala\" />\r\n</h:outputFormat>\r\n~~~~\r\n\r\n### Struts\r\n\r\nSuposant els següents literals:\r\n\r\n**applicationResources.properties**\r\n\r\n~~~~ {.code-java}\r\nnomFormulari=Nom del formulari\r\n~~~~\r\n\r\n**prova.jsf**\r\n\r\n~~~~ {.code-java}\r\n<font face=\"verdana\">\r\n  <bean:message key=\"formulari.errorActivacio\" />\r\n</font>\r\n~~~~\r\n\r\n## Preguntes freqüents\r\n\r\n### Accés manual al servei d'internacionalització\r\n\r\nEncara que no és una pràctica comú es pot accedir al mòdul d'idiomes\r\ndesde qualsevol bean de l'aplicació gestionat per Spring. Per recuperar\r\naquest bean el desenvolupador pot realitzar una crida de forma externa\r\nmitjançant el patró ['Dependency\r\nInjection'](http://martinfowler.com/articles/injection.html)\r\nal mòdul i les seves propietats d'entorn.\r\n\r\n- Injecció de dependències mitjançant xml. Per exemple:\r\n\r\nRuta proposada: <PROJECT_ROOT>/src/main/resources/spring/exemple-beans-config.xml\r\n\r\n~~~~ {.code-java}\r\n<bean id=\"myBean\"  class=\"cat.gencat.app.exemples.Injection\">\r\n    <property name=\"i18nResource\" ref=\"messageSource\" />\r\n</bean>\r\n~~~~\r\n\r\nLa clase Injection tindria la següent estructura:\r\n\r\n~~~~ {.code-java}\r\nimport cat.gencat.ctti.canigo.arch.core.i18n.I18nResourceBundleMessageSource;\r\n\r\npublic class Injection {\r\n     I18nResourceBundleMessageSource i18n;\r\n     private static final Log LOGGER= LogFactory.getLog(Injection.class);\r\n\r\n     public void setI18nResource(I18nResourceBundleMessageSource i18nResource){\r\n         this.i18n = i18nResource;\r\n     }\r\n     \r\n     public void executeCommand(){\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(i18n.getMessage(\"test.label\"));\r\n        }\r\n     }\r\n}\r\n~~~~\r\n\r\nSpring s'encarregarà d'injectar el bean d'internacionalització dins del\r\nbean \"myBean\" executant el mètode setI18nResource.\r\n\r\n-   Injecció de dependències mitjançant anotacions:\r\n\r\n~~~~ {.code-java}\r\nimport cat.gencat.ctti.canigo.arch.core.i18n.I18nResourceBundleMessageSource;\r\n\r\npublic class Injection {\r\n     \r\n     private static final Log LOGGER= LogFactory.getLog(Injection.class);\r\n     \r\n     @Autowired\r\n     I18nResourceBundleMessageSource i18n;\r\n     article table {\r\n    margin:1em 0;\r\n}\r\n     public void executeCommand(){\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(i18n.getMessage(\"test.label\"));\r\n        }\r\n     }\r\n}\r\n~~~~\r\n\r\nL'anotació @Autowired injecta en aquest cas, un bean de tipus\r\ncat.gencat.ctti.canigo.arch.core.i18n.I18nResourceBundleMessageSource\r\nque Spring trobarà en el context de l'aplicació.\r\n\r\n### Claus amb punts en JSF\r\n\r\nA diferencia de Struts l'accés a propietats amb punts a la seva clau\r\ncanvia:\r\n\r\nExemple de claus amb punts:\r\n\r\n~~~~ {.code-java}\r\nusuaris.name=Nom\r\nusuaris.dni=DNI\r\nusuauri.surname=Cognoms\r\n~~~~\r\n\r\nPer accedir aquest tipus de clau des d'una pàgina JSF es necessari\r\naccedir de la següent manera:\r\n\r\n**pageExemple.jsf**\r\n\r\n~~~~ {.code-java}\r\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\" standalone=\"yes\" ?>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\r\n    xmlns:ui=\"http://java.sun.com/jsf/facelets\"\r\n xmlns:f=\"http://java.sun.com/jsf/core\"\r\n xmlns:h=\"http://java.sun.com/jsf/html\"\r\n xmlns:c=\"http://java.sun.com/jstl/core\"\r\n xmlns:t=\"http://myfaces.apache.org/tomahawk\">\r\n \r\n<ui:composition template=\"../layouts/template.jsf\">\r\n   <h:outputText value=\"\\#{msg['usuaris.name']}\"/>\r\n</ui:composition>\r\n</html>\r\n~~~~\r\n\r\n## Exemples\r\n\r\n### Exemple de Test unitari\r\n\r\nCom a exemple d'utilització es mostra com podem fer una prova unitària:\r\n\r\n1.  Creem la classe de test 'I18nTest' i afegim un mètode 'testI18N()'\r\n2.  Creem els diferents fitxers de literals\r\n\r\n~~~~ {.code-java}\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(locations = {\"../canigo-core.xml\"})\r\npublic class I18nTest{\r\n    \r\n    @Autowired\r\n    I18nResourceBundleMessageSource messageResource;\r\n\r\n    @Test\r\n    public void testI18N() {\r\n       try {\r\n            Assert.assertEquals(\"Hola!\", messageResource.getMessage(\"var1\"));\r\n            Assert.assertEquals(\"Hi!\", messageResource.getMessage(\"var1\", Locale.UK));\r\n            Assert.assertEquals(\"Attaaaaaack!\", messageResource.getMessage(\"var1\", Locale.US));\r\n        }\r\n        catch(NoSuchMessageException ex){\r\n            Assert.assertTrue(\"var1 not found\", false);\r\n        }    \r\n    }\r\n}\r\n~~~~\r\n\r\nFitxers dels diferents idiomes (application_xx_XX.properties):\r\n\r\n-   **application.properties (fitxer per defecte)**\r\n\r\n    ~~~~ {.code-java}\r\n    var1=Hola!\r\n    ~~~~\r\n\r\n-   **application_en_US.properties (fitxer pel 'Locale' 'US')**\r\n\r\n    ~~~~ {.code-java}\r\n    var1=Attaaaaaack!\r\n    ~~~~\r\n\r\n-   **application_en_GB.properties (fitxer pel 'Locale' 'GB')**\r\n\r\n    ~~~~ {.code-java}\r\n    var1=Hi!\r\n    ~~~~","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnRlcm5hY2lvbmFsaXR6YWNpbw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnN0cnVtZW50YWNpbw==":{"date":1480326267000,"title":"Instrumentació","description":"Mòdul per generar dades d’instrumentació (nombre de peticions, nombre d’errors, …) de l'aplicació.","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-core/modul-instrumentacio","content":"## Propòsit\r\n\r\nAquest mòdul permet a l'aplicació generar dades d'instrumentació de la seva execució, per tal de poder ser explotades posteriorment amb eines de monitorització.\r\n\r\nDins d'aquest mòdul podem trobar les següents funcionalitats:\r\n\r\n* Instrumentació de les peticions web: nombre de peticions, nombre d'errors i temps mig per petició.\r\n* Instrumentació manual en format log de mètodes de classes aplicatives.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'instrumentació es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.operation.instrumentation.version>[1.2.0, 1.3.0)</canigo.operation.instrumentation.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.operation.instrumentation</artifactId>\r\n    <version>${canigo.operation.instrumentation.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament també genera automàticament el fitxer de propietats necessari per a la configuració del servei.  \r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/instrumentation.properties\r\n\r\n<table>\r\n    <tbody>\r\n        <tr>\r\n            <th><b>Propietat</b></th>\r\n            <th><b>Requerit</b></th>\r\n            <th><b>Descripció</b></th>\r\n        </tr>\r\n        <tr>\r\n            <td> *.instrumentation.interval </td>\r\n            <td> No </td>\r\n            <td> Interval de refresc de les dades instrumentades en l'aplicació de monitorització. Per defecte: 60000 </td>\r\n        </tr>\r\n    </tbody>\r\n</table>\r\n\r\n### Utilització del Mòdul\r\n\r\nPer a utilitzar aquest mòdul, cal instal- lar-lo amb l'eina de desenvolupament.\r\n\r\nA continuació es descriu el mode d'ús per cadascuna de les funcionalitats oferides pel mòdul:\r\n\r\n#### End Point Rest amb les dades de monitorització de l'aplicació\r\n\r\nPer accedir a aquesta interfície l'usuari ha d'introduir les següents URLs al navegador:\r\n\r\n    http:\\\\url_aplicacio\\info\\monitoring\\time\r\n    http:\\\\url_aplicacio\\info\\monitoring\\request\r\n    http:\\\\url_aplicacio\\info\\monitoring\\errors\r\n    \r\nEn aquestes URLs es mostren el temps mig, nombre de peticions i errors respectivament. El format de les dades retornades és JSON.\r\n\r\n<div class=\"message information\">\r\nControl d'accés\r\n\r\nPer defecte, i només si el desenvolupador ha instal- lat el mòdul de seguretat de l'aplicació, aquesta pantalla només serà accessible per a usuaris logats amb rol administrador (ROLE_ADMIN).\r\n</div>\r\n\r\n\r\n#### Eines de revisió de l'estat de l'aplicació\r\n\r\nMitjançant anotacions Java, el desenvolupador pot crear els seus propis punts de control de l'aplicació, per certificar d'una manera ràpida el seu correcte funcionament.\r\n\r\nClasse de servei que serà invocada des del Rest Controller:\r\n\r\n```java\r\n/**\r\n * Check status for several backend\r\n *\r\n * @author\r\n *\r\n */\r\n@Service(\"statusService\")\r\npublic class StatusService {\r\n\r\n\t@Autowired\r\n        private GenericDAO<User, Integer> dao;\r\n\r\n\r\n\t/**\r\n        * Check PSIS\r\n        * @throws IOException\r\n        */\r\n        @CheckStatus\r\n        public void checkPSIS() throws IOException{\r\n\t        URL myUrl = new URL(\"http://psis.catcert.net/psis/catcert/dss\");\r\n         \tURLConnection myConn = (HttpURLConnection)myUrl.openConnection();\r\n        \tmyConn.setRequestProperty(\"User-agent\",\"Mozilla/4.0\");\r\n        \tInputStreamReader is = null;\r\n        \tBufferedReader br = null;\r\n        \ttry{\r\n\t        \tis = new InputStreamReader(myConn.getInputStream());\r\n\t\t        br = new BufferedReader(is);\r\n            \t\tbr.readLine();\r\n          \t}finally{\r\n\t         \tif(is!=null){\r\n\t\t        \tis.close();\r\n          \t\t}\r\n\t          \tif(br!=null){\r\n\t\t        \tbr.close();\r\n           \t\t}\r\n\t         }\r\n         }\r\n\r\n\t/**\r\n\t * Database check\r\n\t */\r\n\t@CheckStatus\r\n\tpublic void checkDataBaseConnection(){\r\n\t\tdao.get(1);\r\n\t}\r\n\r\n\t/**\r\n\t * Always IOException\r\n\t * @throws IOException\r\n\t */\r\n\t@CheckStatus\r\n\tpublic void checkLDAP() throws IOException{\r\n\t  .....\r\n          .....\r\n\t}\r\n\r\n}\r\n```\r\n\r\n<div class=\"message information\">\r\nControl d'excepcions\r\n\r\nLes excepcions dels diferents mètodes de validació han de propagar-se per tal de que Canigó detecti si ha finalitzat en execució correcta o errònia.\r\n</div>\r\n\r\n#### Instrumentació en format log de l'execució de mètodes de l'aplicació\r\n\r\nAmb l'anotació @Trace, el desenvolupador pot marcar un mètode d'una classe gestionada per Spring, i de automàticament aquest generarà traces d'instrumentació de la seva execució:\r\n\r\n```java\r\n@Service(\"myService\")\r\npublic class ServiceImpl implements Service {\r\n\r\n\r\n\t@Trace\r\n\tpublic void doSomething(){\r\n\t\t.....\r\n                .....\r\n\t}\r\n\r\n\r\n}\r\n```\r\n\r\nOn el resultat de l'execució del mètode ens deixarà la següent traça:\r\n\r\n```\r\ncanigo Message: XX XXX 2010 16:45:40,774 INFO  [main] cat.gencat.ctti.canigo.arch.operation.instrumentation.trace.AspectTrace - ea84cbe0-60ff-4ba5-a4e8-d90465101ac3;loc;nodeApp1;0;Service.doSomething();KO;\r\n```\r\n\r\nOn cadascun dels camps separats per coma son:\r\n\r\n* Identificador únic de petició\r\n* Entorn\r\n* Nom node servidor\r\n* Temps d'execució\r\n* Mètode executat\r\n* Resultat de l'execució.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnN0cnVtZW50YWNpbw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1qcGE=":{"date":1427444776000,"title":"Mòdul JPA","description":"Mòdul de persistència de Base de Dades.","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-core/modul-jpa","content":"## Propòsit\r\n\r\nAquest mòdul proporciona accés amb transaccionalitat amb la base de dades, permetent la execució d'operacions dintre de transaccions.\r\n\r\nAquest mòdul utilitza Spring Data JPA i QueryDSL. Es pot trobar informació sobre aquests frameworks a la documentació de referència:\r\n\r\n* [Spring Data JPA] (https://docs.spring.io/spring-data/jpa/docs/current/reference/html/). \r\n* [QueryDSL] (http://www.querydsl.com/static/querydsl/latest/reference/html/)\r\n\r\n## Instal·lació i Configuració\r\n\r\n### Instal·lació\r\n\r\nEl mòdul de persistència i el corresponent test unitari s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació, l'eina de suport al desenvolupament inclourà la referència dins del pom.xml. \r\nEn cas d'una instal- lació manual afegir les següents línies al pom.xml de l'aplicació:\r\n\r\n```\r\n<canigo.persistence.jpa.version>[1.2.0,1.3.0)</canigo.persistence.jpa.version>\r\n<canigo.test.version>[1.2.0,1.3.0)</canigo.test.version>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.persistence.jpa</artifactId>\r\n\t<version>${canigo.persistence.jpa.version}</version>\r\n</dependency>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.test</artifactId>\r\n\t<version>${canigo.test.version}</version>\r\n\t<scope>test</scope>\r\n</dependency>\r\n\r\n<dependency>\r\n   <groupId>cat.gencat.ctti</groupId>\r\n   <artifactId>canigo.persistence.jpa</artifactId>\r\n   <type>test-jar</type>\r\n   <version>${canigo.persistence.jpa.version}</version>\r\n   <scope>test</scope>\r\n   <classifier>tests</classifier>\r\n</dependency>\r\n```\r\n\r\nAl pom.xml també s'ha d'afegir el plugin que genera les classes per als filtres de [QueryDSL](http://www.querydsl.com/) i\r\nel que executa el test unitari del mòdul de persistència:\r\n```\r\n<build>\r\n\t...\r\n\t<plugins>\r\n\t\t...\r\n\t\t<plugin>\r\n\t\t\t<groupId>com.mysema.maven</groupId>\r\n\t\t\t<artifactId>apt-maven-plugin</artifactId>\r\n\t\t\t<version>1.1.3</version>\r\n\t\t\t<executions>\r\n\t\t\t\t<execution>\r\n\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t<goal>process</goal>\r\n\t\t\t\t\t\t<goal>test-process</goal>\r\n\t\t\t\t\t</goals>\r\n\t\t\t\t\t<configuration>\r\n\t\t\t\t\t\t<outputDirectory>target/generated-sources/java</outputDirectory>\r\n\t\t\t\t\t\t<processor>com.querydsl.apt.jpa.JPAAnnotationProcessor</processor>\r\n\t\t\t\t\t</configuration>\r\n\t\t\t\t</execution>\r\n\t\t\t</executions>\r\n\t\t</plugin>\r\n\t\t<plugin>\r\n\t\t\t<groupId>org.apache.maven.plugins</groupId>\r\n\t\t\t<artifactId>maven-surefire-plugin</artifactId>\r\n\t\t\t<executions>\r\n\t\t\t\t<execution>\r\n\t\t            <id>base-test</id>\r\n\t\t            <phase>test</phase>\r\n\t\t            <goals>\r\n\t\t                <goal>test</goal>\r\n\t\t            </goals>\r\n\t\t            <configuration>\r\n\t\t            \t<dependenciesToScan>\r\n\t\t            \t\t<dependency>cat.gencat.ctti:canigo.persistence.jpa</dependency>\r\n\t\t            \t\t...\r\n\t\t\t\t</dependenciesToScan>\r\n\t\t\t\t<excludes>\r\n\t\t\t\t\t<exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t\t</excludes>\r\n\t\t\t    </configuration>\r\n\t\t        </execution>\r\n\t\t        ...\r\n\t        </executions>\r\n\t\t</plugin>\r\n\t\t...\r\n\t</plugins>\r\n\t...\r\n</build>\t\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de l'eina de suport al desenvolupament (plugin de Canigó per a Eclipse)\r\n\r\nEn cas que no es generi automàticament el codi, s'ha de realitzar manualment la següent configuració:\r\n\r\n**jpa.properties**\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/jpa.properties\r\n\r\nPropietat | Requerit | Descripció\r\n--------- | -------- | ----------\r\n*.persistence.database | Si | Sistema de base de dades al que es conectarà.\r\n*.persistence.dialect | Si | El nom de classe que permet a JPA generar SQL per a una base de dades relacional en particular: <br> - org.hibernate.dialect.Oracle9Dialect <-- Versió 9<br> - org.hibernate.dialect.Oracle10gDialect <-- Versió 10g<br> - org.hibernate.dialect.Oracle8iDialect <-- Versió 8i<br> - org.hibernate.dialect.MySQL5Dialect <-- Versió 5<br> - org.hibernate.dialect.MySQLDialect <-- Versions < 5<br> - org.hibernate.dialect.HSQLDialect<br> - org.hibernate.dialect.PostgreSQLDialect\r\n*.persistence.showSQL | No | Escriu totes les sentències SQL al log aplicatiu.<br> Per defecte: true\r\n*.persistence.generateDdl |No | Exporta el DDL (Data Definition Language) a la BD després que l'EntityManagerFactory s'inicialitzi, creant/actualitzant les taules.<br> Valor per defecte: false\r\n*.persistence.hibernate.connection.release_mode | No | Serveix per especificar quan Hibernate ha d'alliberar les connexions JDBC. Una connexió JDBC es manté fins que la sessió és tancada explícitament o desconnectat per defecte. Per a un datasource JTA s'hauria de seleccionar after_statement, i per non-JTA after_transaction. En mode auto, se seleccionarà after_statement per a JTA i CMT, i afte_transaction per JDBC.<br> Per defecte: auto\r\n*.persistence.hibernate.connection.autocommit | No | Habilita l'autocommit per a connexions pooled JDBC\r\n*.persistence.hibernate.generate_statistics | No | Hibernate recopila informació útil per a tunning.<br> Per defecte: false\r\n*.persistence.hibernate.jdbc.use_scrollable_resultset | No | Habilita l'ús de JDBC2 scrollable resultsets a Hibernate.<br> Per defecte: true\r\n\r\n**persistence.xml**\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/persistence/persistence.xml\r\n\r\n```\r\n<persistence xmlns=\"http://java.sun.com/xml/ns/persistence\"\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd\"\r\n\tversion=\"1.0\">\r\n\r\n\t<persistence-unit name=\"canigo\" transaction-type=\"RESOURCE_LOCAL\"/>\r\n\r\n</persistence>\r\n```\r\n\r\n**app-custom-persistence-jpa.xml**\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/app-custom-persistence-jpa.xml\r\n\r\nExemple del fitxer de configuració per a un base de dades H2:\r\n```\r\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\r\n\txmlns:p=\"http://www.springframework.org/schema/p\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\r\n\txmlns:jdbc=\"http://www.springframework.org/schema/jdbc\"\r\n\txmlns:jpa=\"http://www.springframework.org/schema/data/jpa\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd\r\n           http://www.springframework.org/schema/tx \r\n           http://www.springframework.org/schema/tx/spring-tx-4.3.xsd\r\n           http://www.springframework.org/schema/jdbc \r\n           http://www.springframework.org/schema/jdbc/spring-jdbc-4.3.xsd\r\n           http://www.springframework.org/schema/aop \r\n           http://www.springframework.org/schema/aop/spring-aop-4.3.xsd\r\n           http://www.springframework.org/schema/data/jpa\r\n    \t   http://www.springframework.org/schema/data/jpa/spring-jpa.xsd\">\r\n\r\n\t<aop:aspectj-autoproxy />\r\n\t\r\n\t<jpa:repositories base-package=\"cat.gencat.test.repository\" base-class=\"cat.gencat.ctti.canigo.arch.persistence.jpa.repository.impl.JPAGenericRepositoryImpl\"/>\r\n\t\r\n\t<bean id=\"jpaVendorAdapter\" class=\"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter\">\r\n\t\t<description>\r\n\t\t\tFem servir Hibernate com a motor de persistència per sota de JPA.\r\n\t\t</description>\r\n\t\t<property name=\"showSql\" value=\"true\" />\r\n\t\t<property name=\"generateDdl\" value=\"false\" />\r\n\t\t<property name=\"database\" value=\"${persistence.database}\" />\r\n\t\t<property name=\"databasePlatform\" value=\"${persistence.dialect}\" />\r\n\t</bean>\r\n\r\n\t<tx:advice id=\"txAdvice\">\r\n\t\t<tx:attributes>\r\n\t\t\t<tx:method name=\"get*\" propagation=\"REQUIRED\" read-only=\"true\" />\r\n\t\t\t<tx:method name=\"filter*\" propagation=\"REQUIRED\" read-only=\"true\" />\r\n\t\t\t<tx:method name=\"find*\" propagation=\"REQUIRED\" read-only=\"true\" />\r\n\t\t\t<tx:method name=\"load*\" propagation=\"SUPPORTS\" read-only=\"true\" />\r\n\t\t\t<tx:method name=\"save*\" propagation=\"REQUIRED\" />\r\n\t\t\t<tx:method name=\"update*\" propagation=\"REQUIRED\" />\r\n\t\t\t<tx:method name=\"delete*\" propagation=\"REQUIRED\" />\r\n\t\t\t<tx:method name=\"insert*\" propagation=\"REQUIRED\" />\r\n\t\t</tx:attributes>\r\n\t</tx:advice>\r\n\t\r\n\t<jdbc:embedded-database id=\"dataSource\" type=\"H2\">\r\n\t\t<jdbc:script location=\"classpath:scripts/db-auth-hsqldb-schema.sql\"/>\r\n\t\t<jdbc:script location=\"classpath:scripts/db-auth-hsqldb-data.sql\"/>\r\n\t\t<jdbc:script location=\"classpath:scripts/db-app-hsqldb-schema.sql\"/>\r\n\t\t<jdbc:script location=\"classpath:scripts/db-app-hsqldb-data.sql\"/>\r\n\t</jdbc:embedded-database>\r\n\r\n</beans>\r\n```\r\n\r\nAl tag **jpa:repositories** al paràmetre **base-package** s'ha d'indicar el package on es troben els repositoris de l'aplicació.\r\n\r\n### Ús dels repositoris\r\n\r\nPer a utilitzar els repositoris s'ha de generar un objecte Repository per a l'entitat desitjada(T), que ha d'extendre de **cat.gencat.ctti.canigo.arch.persistence.jpa.repository.GenericRepository<T, ID extends Serializable>**\r\n\r\n\tpublic interface EquipamentRepository extends GenericRepository<Equipament, Long>{\r\n\r\n\t}\r\n\r\n#### Construcció de queries automàtiques\r\n\r\nA un repositori es poden definir mètodes per cada query que es vulgui definir. La construcció utilitza els prefixos find...By, read...By, query...By, count...By i get...By. El mètode pot incoporar la paraula Distinct, concatenar propietats amb And i Or o descriptors com OrderBy o IgnoreCase.\r\n\r\nExemples:\r\n\r\n    List<Equipament> findDistinctByNomOrMunicipi(String nom, String municipi);\r\n\tList<Equipament> findByNomIgnoreCase(String nom);\r\n\tList<Equipament> findByMunicipiOrderByNomDesc(String municipi);\r\n\r\n\r\nMés informació a la documentació oficial de [Spring Data JPA](http://docs.spring.io/spring-data/jpa/docs/current/reference/html/).\r\n\r\n#### Utilització de QueryDSL\r\n\r\nUna de les funcionalitats proposades és la d'utilitzar QueryDSL per a realitzar cerques segons filtres dinàmics, amb paginació i/o ordenació.\r\n\r\nEl GenericRepository proporciona el següent mètode:\r\n\r\n```\r\nPage<T> findAll(Predicate predicate, Pageable pageable);\r\n```\r\n\r\nAquest mètode espera un objecte org.springframework.data.domain.Pageable que conté el número de pàgina (la primera pàgina és la 0), el nombre d'elements per pàgina, la direcció d'ordenació, el camp d'ordenació. I un objecte Predicate amb la query a realitzar que es construeix de la següent manera:\r\n\r\nPrimer de tot el filtre ha de ser un String amb el següent patró:\r\n\r\n**field1Operador1Valor1,field2Operador2Valor2,fieldNOperadorNValorN**\r\n\r\n- on Field és el nom d'una propietat de l'entitat (per exemple id)<br>\r\n- on Operador és un dels tipus d'operador suportats:\r\n\r\nOperador | Descripció\r\n--------- | --------\r\n> | major que\r\n>: | major o igual que\r\n< | menor que\r\n<: | menor o igual que\r\n<> | diferent de\r\n: | igual que\r\n\r\n- on valor és el valor amb el qual es vol comparar.\r\n\r\nPer exemple, per cercar l'entitat que tingui id major que 15 i amb nom igual a 'Prova' el filtre hauria de ser el següent:<br>\r\nid>15,nom:Prova\r\n\r\n#### Projecció de resultats\r\n\r\nAmb QueryDSL també es poden realitzar cerques que en comptes de retornar l'objecte sencer, retorni només determinats camps de l'objecte desitjat, els camps no seleccionats els retorna amb valor null<br>\r\n\r\nPer a utilitzar les projeccions el GenericRepository proporciona el següent mètode:\r\n```\r\nPage<T> findAll(FactoryExpression<T> factoryExpression, Predicate predicate, Pageable pageable);\r\n```\r\n\r\nEl codi següent retorna una llista dels objectes Equipaments amb nom INDOORKARTING, però aquests objectes només tindran el camp nom.\r\n\r\n```\r\nString search = \"nom:INDOORKARTING\";\r\n\t\t\r\nPageable pageable = new PageRequest(0, 5, Sort.Direction.DESC, \"nom\");\r\nGenericPredicateBuilder<Equipament> builder = new GenericPredicateBuilder<Equipament>(Equipament.class, \"equipament\");\r\nbuilder.populateSearchCriteria(search);\r\n\t\t\r\nQEquipament qequipament = QEquipament.equipament;\r\n\t\r\nPage<Equipament> page = repository.findAll(Projections.bean(Equipament.class, qequipament.nom ), builder.build(), pageable);\r\n```\r\n\r\nMés informació a la documentació oficial de [QueryDSL](http://www.querydsl.com/static/querydsl/latest/reference/html/).\r\n\r\n#### Batch Inserts/Update\r\n\r\nLa classe GenericRepository també proporciona un mètode per a realitzar inserts/updates de forma massiva amb un rendiment òptim:\r\n\r\n\tpublic <S extends T> List<S> bulkSave(Iterable<S> entities);\r\n\t\r\nEs pot veure un exemple de com utilitzar aquesta classe al següent [howto] (/drafts/2017-03-Howto-SaveBatch-Canigo32)\r\n### Exemple \r\n\t\r\nPer exemple a l'aplicació inicial que genera el plugin de Canigó es generen els següents fitxers:\r\n\r\n**Equipament.java**\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/java/cat/gencat/test/model/Equipament.java\r\n```\r\npackage cat.gencat.test.model;\r\n\r\nimport javax.persistence.Column;\r\nimport javax.persistence.Entity;\r\nimport javax.persistence.Id;\r\nimport javax.persistence.Table;\r\n\r\n@Entity\r\n@Table(name = \"equipaments\")\r\npublic class Equipament {\r\n\r\n\tprivate Long id;\r\n\tprivate String nom;\r\n\tprivate String municipi;\r\n\r\n\tpublic Equipament() {\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic Equipament(Long id) {\r\n\t\tthis.id =id;\r\n\t}\r\n\t\r\n\t@Id\r\n\t@Column(name = \"id\", nullable = false, unique = true)\r\n\tpublic Long getId() {\r\n\t\treturn id;\r\n\t}\r\n\r\n\tpublic void setId(Long id) {\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\t\r\n\t@Column(name = \"nom\", nullable = false, unique = true)\r\n\tpublic String getNom() {\r\n\t\treturn nom;\r\n\t}\r\n\r\n\tpublic void setNom(String nom) {\r\n\t\tthis.nom = nom;\r\n\t}\r\n\r\n\t@Column(name = \"municipi\")\r\n\tpublic String getMunicipi() {\r\n\t\treturn municipi;\r\n\t}\r\n\r\n\tpublic void setMunicipi(String municipi) {\r\n\t\tthis.municipi = municipi;\r\n\t}\t\r\n\t\r\n\t@Override\r\n\tpublic String toString() {\r\n\t\treturn \"Equipament [nom=\" + nom + \"]\";\r\n\t}\r\n}\r\n```\r\n\r\n**EquipamentRepository**\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/java/cat/gencat/test/repository/EquipamentRepository.java\r\n```\r\npackage cat.gencat.test.repository;\r\n\r\nimport java.util.List;\r\n\r\nimport org.springframework.data.domain.Page;\r\nimport org.springframework.data.domain.Pageable;\r\n\r\nimport com.querydsl.core.types.FactoryExpression;\r\nimport com.querydsl.core.types.Predicate;\r\n\r\nimport cat.gencat.test.model.Equipament;\r\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.GenericRepository;\r\n\r\npublic interface EquipamentRepository extends GenericRepository<Equipament, Long> {\r\n\r\n\tPage<Equipament> findAll(Predicate predicate, Pageable pageable);\r\n\t\r\n\tPage<Equipament> findAll(FactoryExpression<Equipament> factoryExpression, Predicate predicate, Pageable pageable);\r\n\t\r\n    List<Equipament> findDistinctByNomOrMunicipi(String nom, String municipi);\r\n\tList<Equipament> findByNomIgnoreCase(String nom);\r\n\tList<Equipament> findByMunicipiOrderByNomDesc(String municipi);\r\n}\r\n```\r\n\r\n**EquipamentService**\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/java/cat/gencat/test/service/EquipamentService.java\r\n```\r\npackage cat.gencat.test.service;\r\n\r\nimport java.util.List;\r\n\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.data.domain.Page;\r\nimport org.springframework.data.domain.PageRequest;\r\nimport org.springframework.data.domain.Pageable;\r\nimport org.springframework.data.domain.Sort;\r\nimport org.springframework.data.domain.Sort.Direction;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport com.querydsl.core.types.Projections;\r\n\r\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.querydsl.GenericPredicateBuilder;\r\nimport cat.gencat.test.model.Equipament;\r\nimport cat.gencat.test.model.QEquipament;\r\nimport cat.gencat.test.repository.EquipamentRepository;\r\n\r\n@Service(\"equipamentService\")\r\n@Lazy\r\npublic class EquipamentService {\r\n\r\n\t@Autowired\r\n\tprivate EquipamentRepository repository;\r\n\t\r\n\tpublic List<Equipament> findAll() {\r\n\t\treturn repository.findAll();\r\n\t}\r\n\r\n\tpublic Page<Equipament> findPaginated(Pageable pageable, String filter) {\r\n\t\t\r\n\t\tGenericPredicateBuilder<Equipament> builder = new GenericPredicateBuilder<Equipament>(Equipament.class, \"equipament\");\r\n\t\tbuilder.populateSearchCriteria(filter);\r\n\t\t\r\n\t\treturn repository.findAll(builder.build(), pageable);\r\n\t}\r\n\t\r\n\tpublic Page<Equipament> findPaginatedProjeccio(Pageable pageable, String filter) {\r\n\t\t\r\n\t\tGenericPredicateBuilder<Equipament> builder = new GenericPredicateBuilder<Equipament>(Equipament.class, \"equipament\");\r\n\t\tbuilder.populateSearchCriteria(filter);\r\n\t\t\r\n\t    QEquipament qequipament = QEquipament.equipament;\r\n\t    \r\n\t    return repository.findAll(Projections.bean(Equipament.class, qequipament.nom ), builder.build(), pageable);\r\n\t}\r\n\r\n\tpublic Equipament getEquipament(Long equipamentId) {\r\n\t\treturn repository.findOne(equipamentId);\r\n\t}\r\n\r\n\tpublic Long saveEquipament(Equipament equipament) {\r\n\t\trepository.save(equipament);\r\n\r\n\t\treturn equipament.getId();\r\n\t}\r\n\r\n\tpublic void updateEquipament(Equipament equipament) {\r\n\t\trepository.save(equipament);\r\n\t}\r\n\r\n\tpublic void deleteEquipament(Long equipamentId) {\r\n\t\tEquipament equipament = new Equipament(equipamentId);\r\n\t\trepository.delete(equipament);\r\n\t}\r\n\r\n}\r\n```\r\n\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1qcGE="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1sb2dnaW5nLWFkbWlu":{"date":1427449467000,"title":"Administració de logs","description":"Mòdul per administrar els logs de l'aplicació","sections":"Canigó. Documentació versió 3.x","weight":10,"path":"/canigo-documentacio-versions-3x-core/modul-logging-admin","content":"## Propòsit\r\n\r\nAquest mòdul permet administrar els logs de l'aplicació proporcionant les següents funcionalitats:\r\n\r\n* Canviar en calent el nivell de log dels diferents paquets de l'aplicació\r\n* Visualització de fitxers de logs en temps real mitjançant streaming amb WebSockets\r\n* Descarregar els fitxers de logs\r\n\r\n## Instal·lació i Configuració\r\n\r\n### Instal·lació\r\n\r\nLa instal·lació del Mòdul d'Administració de Logs es pot incloure automàticament a través del [Plugin de Canigó per a Eclipse](/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf), o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.operation.logging.version>[1.1.0,1.2.0)</canigo.operation.logging.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.operation.logging</artifactId>\r\n    <version>${canigo.operation.logging.version}</version>\r\n</dependency>\r\n```\r\nAquest mòdul requereix Java 7, per tant, cal tenir la següent configuració per la compilació amb Maven:\r\n\r\n```\r\n<plugin>\r\n    <artifactId>maven-compiler-plugin</artifactId>\r\n    <configuration>\r\n        <source>1.7</source>\r\n        <target>1.7</target>\r\n    </configuration>\r\n</plugin>\r\n```\r\n\r\n### Configuració\r\n\r\n#### Client\r\n\r\nSi s'utilitza el Plugin de Canigó per a Eclipse s'instal·la automàticament una plana \"loggingAdministration.html\" dins l'aplicació.  En cas de realitzar la instal·lació de forma manual s'ha de descarregar la [part estàtica](/related/canigo/documentacio/modul-logging/canigo.operation.logging_static.zip).\r\n\r\n<div class=\"message warning\">\r\nDes del CS Canigó no es realitzen adaptacions al <a href=\"http://www.gencat.cat/web/guies/estil/\">PIV de la Generalitat de Catalunya</a>. És responsabilitat del proveïdor d'aplicacions fer les adaptacions necessàries segons els requeriments que tingui l'aplicació.\r\n</div>\r\n\r\nEl contingut estàtic està preparat per a ser ubicat al directori `<aplicacio>\\src\\main\\webapp\\`. Si es vol canviar aquesta ubicació s'han de modificar les URLs existents en aquests fitxers.\r\n\r\n##### Keep Alive\r\n\r\nEl client implementa un procés de \"keep alive\" que s'executa cada 30 minuts. D'aquesta manera el servidor el considerarà com a actiu mentre no es tanqui aquesta plana \"loggingAdministration.html\".\r\n\r\n#### Servidor\r\n\r\nAquesta és l'API REST que publica el Mòdul d'Administració de Logs:\r\n\r\n * `<appContext>/api/logs/list` (GET): mostra la llista de loggers i els nivells (DEBUG, INFO, ERROR, FATAL, WARN)\r\n * `<appContext>/api/logs/appenders` (GET): mostra la llista d'appenders de tipus file\r\n * `<appContext>/api/logs/change` (PUT): canvia el nivell d'un logger\r\n * `<appContext>/api/logs/startwatch` (PUT): comença a monitorizar un fitxer de log\r\n * `<appContext>/api/logs/stopwatch`(PUT): deixa de monitorizar un fitxer de log\r\n * `<appContext>/api/logs/keepwatch`(PUT): missatge de monitorització activa (keep alive) per un fitxer de log\r\n * `<appContext>/api/logs/downloadLog/{index}` (GET): descarrega d'un fitxer de log\r\n\r\nSpringBoot per defecte no permeteix peticions PUT, per a que es puguin realitzar al fitxer WebSecurityConfig, mètode configure s'ha d'afegir:\r\n\r\n```\r\n\thttp.csrf().ignoringAntMatchers(\"/api/logs/**\");\r\n```\r\n\r\nPer tal d'evitar un deadlock en l'escriptura de logs a fitxer i el corresponent enviament de missatge a client, cal realitzar la següent configuració en el fitxer de configuració log4j.xml:\r\n\r\n```\r\n<category name=\"org.springframework.messaging.simp.broker.SimpleBrokerMessageHandler\">\r\n  <level value=\"off\" />\r\n</category>\r\n```\r\nAquesta configuració només serà necessària en cas que els logs de Spring s'escriguin en un appender de tipus file.\r\n\r\n##### Alliberament de recursos\r\n\r\nEl mòdul executa un procés cada 45 minuts que valida si s'ha rebut algun missatge de \"keep alive\" d'algun client per els fitxers de log configurats en l'aplicació. En cas que no haver rebut cap missatge per un fitxer de log concret en aquest periode de 45 minuts s'alliberaran els recursos associats per a la monitorització d'aquell fitxer (watcher thread).\r\n\r\n### Utilització del Mòdul\r\n\r\nPer a utilitzar el mòdul s'ha de desplegar l'aplicació i accedir-hi a `http://<host>:<port>/<appContext>/loggingAdministration.html`. Per exemple: `http:\\\\localhost:8080\\aplicacioProva\\loggingAdministration.html`\r\n\r\n![Pantalla Configuració nivells de log](/related/canigo/documentacio/modul-logging/configuracio_nivell_logs.png \"Configuració nivells de log\")\r\n\r\nLa pantalla inicial mostra els paquets de l'aplicació. Amb els botons DEBUG - INFO - ERROR - FATAL - WARN es pot modificar els nivell de log de cada paquet.\r\n\r\n\r\n![Pantalla Visualització fitxers de log](/related/canigo/documentacio/modul-logging/visualitzacio_fitxers_log.png \"Visualització fitxers de log\")\r\n\r\nEn aquesta segona pestanya es pot seleccionar el fitxer de log que es desitgi monitoritzar, prement el botó Connectar, o descarregar amb el botó Descarregar.\r\n\r\nAmb el cercador es pot resaltar en groc el text que es desitgi trobar.\r\n\r\n### Consideracions de seguretat\r\n\r\nEs recomana que aquest mòdul es securitzi per a que només els usuaris amb rol Administrador puguin accedir-hi, tant a la plana html, com als serveis REST del backend proporcionats al mòdul.\r\n\r\n### Demo\r\n\r\nDes del CS Canigó es proporciona una aplicació de demo d'aquest nou mòdul. Podeu trobar el codi font en el següent [repositori de Github](https://github.com/gencat/demoAdminLogs).\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1sb2dnaW5nLWFkbWlu"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1tb25pdG9yaXR6YWNpbw==":{"date":1427453980000,"title":"Monitorització","description":"Monitorització de l'aplicació.","sections":"Canigó. Documentació versió 3.x","weight":8,"path":"/canigo-documentacio-versions-3x-core/modul-monitoritzacio","content":"## Introducció\r\n\r\nUn dels aspectes més innovadors de la nova versió 3 del Framework Canigó és la possibilitat de disposar inicialment d'un component de monitorització de l'aplicació sense haver de fer cap desenvolupament addicional per part dels desenvolupadors de les aplicacions. Aquest component permet:\r\n\r\n* Fer un seguiment de les peticions que rep l'aplicació.\r\n* Comprovar l'estat del sistema.\r\n* Administració dels paràmetres de configuració d'aquesta monitorització.\r\n\r\n### SEGUIMENT DE LES PETICIONS\r\n\r\nRespecte al tipus de peticions, l'eina visualitza:\r\n\r\n* Número de peticions.\r\n* Temps mitjà de les peticions.\r\n* Peticions errònies.\r\n\r\nLes peticions que es mostren són les efectuades contra el servidor d'aplicació des de que l'aplicació rep una petició fins que aquesta finalitza i la retorna al client.\r\n\r\n![Peticions per minut](/related/canigo/documentacio/modul-monitoritzacio/Peticions.jpg \"Peticions rebudes per minut\")  \r\nFigura 1 Nombre de peticions rebudes per minut\r\n\r\n![Temps de procés](/related/canigo/documentacio/modul-monitoritzacio/Temps.jpg \"Temps promig de procés\")  \r\nFigura 2 Temps promig en processar les peticions\r\n\r\n![Peticions errònies](/related/canigo/documentacio/modul-monitoritzacio/Error.jpg \"Nombre de peticions errònies\")  \r\nFigura 3 Nombre de peticions que han finalitzat amb error (no controlat)\r\n\r\n### COMPROVACIÓ DE L'ESTAT DEL SISTEMA\r\n\r\nEn aquesta part de la monitorització es podrà visualitzar l'estat de les diferents parts del sistema configurades (per configurar aquesta part de la monitorització mirar el mòdul d'instrumentació), com podria ser la comprovació de la connectivitat contra base de dades o contra un servei web.\r\n\r\nLa informació d'aquesta funcionalitat es mostrarà en una taula amb la següent informació:\r\n\r\n* Mètode\r\n* Temps transcorregut (ms)\r\n* Estat\r\n\r\n![Estat del sistema](/related/canigo/documentacio/modul-monitoritzacio/Estat.jpg \"Estat del sistema\")  \r\nFigura 4 Taula d'informació de l'estat del sistema\r\n\r\n### ADMINISTRACIÓ DELS PARÀMETRES DE CONFIGURACIÓ\r\n\r\nPer últim l'eina també ofereix la possibilitat de configurar la longitud de les mostres que apareixen en les gràfiques i l'interval de mostreig entre mostres. Per defecte ofereix una visualització de l'evolució de les peticions de 8 hores amb intervals de 1 minut.\r\n\r\n![Configuració gràfiques](/related/canigo/documentacio/modul-monitoritzacio/Config.jpg \"Configuració gràfiques\")  \r\nFigura 5 Pantalla de configuració per a les gràfiques de monitorització","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1tb25pdG9yaXR6YWNpbw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1ycw==":{"date":1490775976000,"title":"Mòdul RS","description":"Mòdul RESTful Services","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-core/modul-rs","content":"## Propòsit\r\n\r\nAquest mòdul proporciona eines per a l'exposició de serveis REST. Està basat en les millors pràctiques descrites a [Canigó APIs RESTful](http://canigo.ctti.gencat.cat/blog/2016/01/api/)\r\n\r\nEntre altres característiques, destaquem les següents:\r\n\r\n- Control genèric d'errors\r\n- Classes estàndard de resposta\r\n- Controladors per exposar les propietats de configuració de l'aplicació i mòduls carregats\r\n\r\nTot el contingut es serveix en format JSON.\r\n\r\n## Instal·lació i Configuració\r\n\r\n### Instal·lació\r\n\r\nEl mòdul RS i el corresponent test unitari s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació, l'eina de suport al desenvolupament inclourà la referència dins del pom.xml. \r\nEn cas d'una instal- lació manual afegir les següents línies al pom.xml de l'aplicació:\r\n\r\n```\r\n<canigo.web.rs.version>[1.1.0,1.2.0)</canigo.web.rs.version>\r\n<canigo.test.version>[1.2.0,1.3.0)</canigo.test.version>\r\n\r\n<dependency>\r\n <groupId>cat.gencat.ctti</groupId>\r\n <artifactId>canigo.web.rs</artifactId>\r\n <version>${canigo.web.rs.version}</version>\r\n</dependency>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.test</artifactId>\r\n\t<version>${canigo.test.version}</version>\r\n\t<scope>test</scope>\r\n</dependency>\r\n\r\n<dependency>\r\n   <groupId>cat.gencat.ctti</groupId>\r\n   <artifactId>canigo.web.rs</artifactId>\r\n   <type>test-jar</type>\r\n   <version>${canigo.web.rs.version}</version>\r\n   <scope>test</scope>\r\n   <classifier>tests</classifier>\r\n</dependency>\r\n```\r\n\r\nAl pom.xml també s'ha d'afegir el plugin que executa el test unitari del mòdul RS:\r\n```\r\n<build>\r\n    ...\r\n    <plugins>\r\n        ...\r\n        <plugin>\r\n            <groupId>org.apache.maven.plugins</groupId>\r\n            <artifactId>maven-surefire-plugin</artifactId>\r\n            <executions>\r\n                <execution>\r\n                    <id>base-test</id>\r\n                    <phase>test</phase>\r\n                    <goals>\r\n                        <goal>test</goal>\r\n                    </goals>\r\n                    <configuration>\r\n                        <dependenciesToScan>\r\n                            <dependency>cat.gencat.ctti:canigo.web.rs</dependency>\r\n                            ...\r\n                        </dependenciesToScan>\r\n\t\t\t<excludes>\r\n                            <exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t</excludes>\r\n                    </configuration>\r\n                </execution>\r\n                ...\r\n            </executions>\r\n        </plugin>\r\n        ...\r\n    </plugins>\r\n    ...\r\n</build>    \r\n```\r\n### Configuració\r\n\r\nNo necessita cap configuració especial.\r\n\r\n### Ús de controladors (REST Controllers)\r\n\r\nHi ha dos controladors inclosos dins el mòdul:\r\n```\r\n    1. _InfoModulesController_: retorna la llista de mòduls Canigó carregats a l'aplicació i les seves corresponents versions. La seva URL és http://<app>/info/modules\r\n    2. _InfoPropertiesController_: retorna la llista de propietats definides a l'aplicació i els seus valors. La seva URL és http://<app>/info/properties\r\n```\r\n\r\nPer seguretat aquests controladors per defecte no es troben disponibles.\r\n\r\nPer a que es publiquin a l'aplicació s'ha de realitzar la següent configuració:\r\n\r\nAl fitxer de configuració de l’aplicació (AppConfig.java) afegir l’annotació @PropertySource al fitxer boot.properties que s’ha de crear:\r\n\r\n\t@Configuration\r\n\t@PropertySource(\"classpath:/config/props/boot.properties\")\r\n\t@ImportResource({ \"classpath:cat/gencat/ctti/canigo/arch/core/config/canigo-core.xml\" })\r\n\t@EnableTransactionManagement\r\n\tpublic class AppConfig {\r\n\t}\r\n\t\r\nCrear el fitxer /src/main/reources/config/props/boot.properties amb les següents propietats a true:\r\n\r\n\tpublishInfoModules=true\r\n\tpublishInfoProperties=true\r\n\t\r\n<span style=\"color:red\">En entorns productius aquests endpoints s'han de protegir o bloquejar</style>\r\n\r\n#### Donar d'alta un nou controlador\r\n\r\nPer donar d'alta un nou controlador a l'aplicació Canigó s'ha de seguir la [documentació de referència de Spring MVC](http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html)\r\n\r\nExemple de definició d'un controlador:\r\n\r\n```\r\npackage cat.gencat.ctti.canigo.arch.web.rs.controller;\r\n\r\nimport org.springframework.web.bind.annotation.GetMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\n@RestController\r\n@RequestMapping(\"/hello\")\r\npublic class HelloController {\r\n\r\n\t@GetMapping(produces = MediaType.APPLICATION_JSON_VALUE)\r\n\tpublic String getHello() {\r\n\t\treturn \"hello!\";\r\n\t}\r\n\r\n}\r\n```\r\n\r\n### Gestió d'errors per defecte\r\n\r\nUna de les funcionalitats que incorpora el Mòdul RS és la de gestió d'errors per defecte. S'ha definit un @RestControllerAdvice que intercepta les excepcions dels tipus:\r\n\r\n```\r\n\t- MultipartException\r\n\t- AuthenticationException\r\n\t- AccessDeniedException\r\n\t- ResourceNotFoundException\r\n    - Exception\r\n    \r\n```\r\nQuan es produeix aquestes excepcions a l'aplicació, són capturades pel @RestControllerAdvice i retornades en format JSON al client. El client rep un JSON amb el codi i missatge de l'excepció en el cos de la resposta, i en format JSON o JSONP si s'ha fet la crida amb una funció de retorn.\r\nEs pot personalitzar i \"localitzar\" (i18n) el missatge que s'envia al client per cadascuna de les excepcions. Això és possible fer-ho definint les següents propietats en els fitxers de recursos carregats a l'aplicació:\r\n\r\n```\t\r\n\t- canigo.web.rs.resource.notfoud.msg --> Per a les excepcions de tipus ResourceNotFoundException\r\n\t- canigo.web.rs.unauthorized.msg  --> Per a les excepcions de tipus AuthenticationException i AccessDeniedException\r\n\t- canigo.web.rs.multipart.bad.request.msg --> Per a les excepcions de tipus MultipartException\r\n\t- Per a la resta d'excepcions que estenguin del tipus Exception s'utilitza el localizedMessage de la mateixa excepció. Per tant, és necessari sobreescriure el mètode getLocalizedMessage amb la propietat el valor de la qual es vol enviar com a missatge al client. Un exemple seria el següent:\r\n\r\n\tpublic class CustomException extends Exception {\r\n\r\n\t\tprivate static final long serialVersionUID = -3973341495451225082L;\r\n\t\r\n\t\t@Override\r\n\t\tpublic String getLocalizedMessage() {\r\n\t\t\treturn \"custom.message\";\r\n\t\t}\r\n\r\n    }\r\n    \r\n    \r\n```\r\n\r\nEs poden definir tants RestControllerAdvice com es necessiti.\r\n\r\n\r\n### Objectes de suport\r\n\r\nAmb la finalitat d'estandaritzar i facilitar la feina als desenvolupadors, es posa a la seva disposició objectes estàndard de petició i resposta.\r\n\r\n#### Request\r\n\r\nS'han definit els següents objectes de petició, tenint en compte les bones pràctiques definides a [Canigó APIs RESTful](http://canigo.ctti.gencat.cat/blog/2016/01/api/):\r\n\r\n```\r\n\t- BatchRequest --> Per a peticions batch\r\n\r\n```\r\n\r\n#### Response\r\n\r\nS'han definit els següents objectes de resposta, tenint en compte les bones pràctiques definides a [Canigó APIs RESTful](http://canigo.ctti.gencat.cat/blog/2016/01/api/):\r\n\r\n```\r\n\t- ResponseBatch --> Per a peticions batch\r\n\t- ResponseError --> Per errors\r\n\t- ResponsePage  --> Per documents paginats\r\n    \r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1ycw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1zZWd1cmV0YXQ=":{"date":1480326534000,"title":"Mòdul Seguretat","description":"Autenticació i autorització d'usuaris","sections":"Canigó. Documentació versió 3.x","weight":9,"path":"/canigo-documentacio-versions-3x-core/modul-seguretat","content":"## Propòsit\r\n\r\nEl Mòdul de Seguretat té com a propòsit principal gestionar l'autenticació i l'autorització dels usuaris en aplicacions Canigó. L'objectiu de l'autenticació és comprovar que l'usuari és qui diu ser, mentre que l'autorització s'encarrega de comprovar que realment té accés als recursos sol·licitats.\r\n\t\r\nCanigó recomana l'ús de Spring Security com a framework base i les extensions que Canigó proporciona.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal- lar el mòdul de seguretat es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.security.version>[1.2.0, 1.3.0)</canigo.security.version>\r\n<canigo.test.version>[1.2.0,1.3.0)</canigo.test.version>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.security</artifactId>\r\n\t<version>${canigo.security.version}</version>\r\n</dependency>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.test</artifactId>\r\n\t<version>${canigo.test.version}</version>\r\n\t<scope>test</scope>\r\n</dependency>\r\n\r\n<dependency>\r\n   <groupId>cat.gencat.ctti</groupId>\r\n   <artifactId>canigo.security</artifactId>\r\n   <type>test-jar</type>\r\n   <version>${canigo.security.version}</version>\r\n   <scope>test</scope>\r\n   <classifier>tests</classifier>\r\n</dependency>\r\n\r\n```\r\nAl pom.xml també s'ha d'afegir el plugin executa el test unitari del mòdul de seguretat. \r\nEn el cas de tenir configurat l'execució del test dels mòduls de configuració i/o persistència,\r\ncal excloure la dependència del mòdul de seguretat per tal d'evitar conflictes:\r\n```\r\n<build>\r\n\t...\r\n\t<plugins>\r\n\t\t...\r\n        <plugin>\r\n            <groupId>org.apache.maven.plugins</groupId>\r\n            <artifactId>maven-surefire-plugin</artifactId>\r\n            <executions>\r\n                <execution>\r\n                    <id>base-test</id>\r\n                    <phase>test</phase>\r\n                    <goals>\r\n                        <goal>test</goal>\r\n                    </goals>\r\n                    <configuration>\r\n                        <dependenciesToScan>\r\n\t\t          <dependency>cat.gencat.ctti:canigo.core</dependency>\r\n\t\t          <dependency>cat.gencat.ctti:canigo.persistence.jpa</dependency>\r\n\t\t\t  <dependency>cat.gencat.ctti:canigo.web.rs</dependency>\r\n                        </dependenciesToScan>\r\n\t\t\t<excludes>\r\n\t\t\t  <exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t</excludes>\r\n\t\t\t<classpathDependencyExcludes>\r\n\t\t\t  <classpathDependencyExcludes>cat.gencat.ctti:canigo.security</classpathDependencyExcludes>\r\n\t\t\t</classpathDependencyExcludes>\r\n                    </configuration>\r\n                </execution>\r\n                <execution>\r\n                    <id>cat.gencat.ctti:canigo.security-test</id>\r\n                    <phase>test</phase>\r\n                    <goals>\r\n                        <goal>test</goal>\r\n                    </goals>\r\n                    <configuration>\r\n                        <dependenciesToScan>\r\n                          <dependency>cat.gencat.ctti:canigo.security</dependency>\r\n                        </dependenciesToScan>\r\n\t\t\t<excludes>\r\n\t\t\t  <exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t</excludes>\r\n                    </configuration>\r\n                </execution>\r\n                ...\r\n            </executions>\r\n        </plugin>\r\n\t\t...\r\n\t</plugins>\r\n\t...\r\n</build>\t\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de l'eina de suport al desenvolupament i es compon de les següents parts:\r\n\r\n* Configuració de filtres web\r\n* Configuració de JWT (JSON Web Token)\r\n* Publicació Controladors de Seguretat\r\n* Configuració d'autenticació\r\n* Configuració d'autorització\r\n* Configuració de la font de dades de l'esquema de seguretat\r\n\r\n#### Configuració de filtres web\r\n\r\nSpring Security utilitza un conjunt de filtres per a detectar aspectes de l'autorització i autenticació. Per a fer-los servir definirem en el fitxer 'WEB-INF/web.xml el codi següent:\r\n\r\n```\r\n<filter>\r\n    <filter-name>springSecurityFilterChain</filter-name>\r\n    <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>\r\n</filter>\r\n<filter-mapping>\r\n    <filter-name>springSecurityFilterChain</filter-name>\r\n    <url-pattern>/*</url-pattern>\r\n</filter-mapping>\r\n```\r\n\r\nPer a més informació consultar la pàgina [Spring Security Doc](http://docs.spring.io/spring-security/site/docs/4.2.x/reference/htmlsingle/#security-filter-chain)\r\n\r\n#### Configuració de JWT (JSON Web Token)\r\n\r\nLa nova versió de Canigó permet treballar amb [JWT](https://jwt.io/). Per això s'ha fet servir la llibreria [Java JWT](https://java.jsonwebtoken.io/). Aquesta llibreria permet autenticar l'usuari amb qualsevol dels mètodes descrits en el següent apartat \"Configuració d'autenticació\". Un cop autenticat l'usuari, el servidor genera un token que serà enviat pel client a la capçalera HTTP a cada petició.\r\n\r\nPer poder configurar JWT es necessita afegir al fitxer de propietats del Servei de Seguretat (security.properties) la següent configuració:\r\n\r\nPropietat                     | Requerit | Descripció                                 | Valor per Defecte\r\n----------------------------- | -------- | -------------------------------------------|------------------\r\n*.jwt.header                  | No       | Nom del header del token JWT\t\t      | Authentication\r\n*.jwt.header.startToken       | No       | Inici del token JWT       \t\t      | Bearer\r\n*.jwt.tokenResponseHeaderName | No       | Nom del header del token JWT        \t      | jwtToken\r\n*.jwt.secret                  | No       | Password per generar el token JWT          | canigo\r\n*.jwt.expiration              | No       | Temps de vida del token JWT       \t      | 3600\r\n*.jwt.siteminderAuthentication| No       | Gicar authentication             \t      | false\r\n\r\nPer provar l'autenticació per token s'ha de cridar a \"http://<app>/api/auth\" amb la capçalera GICAR, en cas d'autenticació per GICAR, o en el cos de la petició en format JSON en altres casos.\r\n```\r\n{ \r\n\tusername = user,\r\n\tpassword  = secret\r\n} \r\n```\r\nAquesta crida ens retornarà un token vàlid. Per a les següents peticions s'ha d'enviar aquest token a la capçalera HTTP de la petició de la següent manera (configuració per defecte):\r\n\r\nAuthentication Bearer eyJhbGciOiJIUzUxMiJ9.eyJleHAiOjE0NzkyMzEzODMsInN1YiI6ImFkbWluIiwiYXV0aG9yaXRpZXMiOiJST0xFX0FETUlOLFJPTEVfVVNFUiJ9.jeApLoXyn4nrdp2iPRkjhoTWmzFNUYOkphnck0gmp1pLygOj1hgN1O1Ps86_jY6ZXaEhXl2Fk-o36SOMQAQGHA\r\n\r\nMés endavant es mostra un exemple de configuració a Canigó de JWT + GICAR.\r\n\r\n#### Publicació Controladors de Seguretat\r\n\r\nPer defecte el mòdul de seguretat publica les api /auth i /login.\r\n\r\nEn cas de no voler publicar-les a la nostra aplicació s'hauria de condicionar la càrrega de Spring Boot de la següent manera:\r\n\r\nAl fitxer de configuració de l'aplicació (AppConfig.java) afegir l'annotació @PropertySource al fitxer boot.properties que s'ha de crear:\r\n\r\n\t@Configuration\r\n\t@PropertySource(\"classpath:/config/props/boot.properties\")\r\n\t@ImportResource({ \"classpath:cat/gencat/ctti/canigo/arch/core/config/canigo-core.xml\" })\r\n\t@EnableTransactionManagement\r\n\tpublic class AppConfig {\r\n\t}\r\n\t\r\nCrear el fitxer /src/main/reources/config/props/boot.properties amb la propietat *publishAuthController* a false:\r\n\r\n\tpublishAuthController=false\r\n\r\n\r\n#### Configuració de l'autenticació\r\n\r\nEn la configuració de l'autenticació tindrem en consideració:\r\n\r\n* Seleccionar el tipus de font contra la que es realitza l'autenticació (per arxiu de propietats, base de dades, LDAP, ...)\r\n* Configurar el formulari d'autenticació web i la seqüència d'accions per realitzar l'autenticació.\r\n\r\nDins d'aquest mòdul trobem els següents proveidors de seguretat:\r\n\r\n* Seguretat In-Memory\r\n* Seguretat Base de dades\r\n* Seguretat LDAP\r\n* Seguretat GICAR\r\n\r\nEls diferents proveidors comparteixen els següents arxius de configuració:\r\n\r\n* security.properties: propietats del servei de seguretat\r\n* app-custom-security.xml: arxiu XML amb la configuració de seguretat.\r\n* SecurityConfig.java: classe Java amb la configuració de seguretat Web.\r\n* security.users.properties: llistat en format pla dels usuaris/password/rols de l'aplicació per al proveïdor \"InMemory\".\r\n\r\nLa disposició dels arxius és la següent:\r\n\r\n* Ubicació: <PROJECT_ROOT>/src/main/resources/config/props/security.users.properties\r\n* Ubicació: <PROJECT_ROOT>/src/main/resources/spring/app-custom-security.xml\r\n* Ubicació: <PROJECT_ROOT>/src/main/java/cat/gencat/nomapp/config/SecurityConfig.java\r\n* Ubicació: <PROJECT_ROOT>/src/main/resources/config/props/security.properties\r\n\r\nA continuació es mostra la classe SecurityConfig per a una configuració basada en GICAR amb token JWT en una aplicació Canigó:\r\n\r\n```\r\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\r\n\r\n\t@Autowired\r\n\tprivate AuthenticationEntryPoint restAuthenticationEntryPoint;\r\n\r\n\t@Autowired\r\n\tprivate PropertiesConfiguration propertiesConfiguration;\r\n\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate AuthenticationManager authenticationManager;\r\n\t\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate AuthenticationSuccessHandler restAuthenticationSuccessHandler;\r\n\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate DataSource dataSource;\r\n\r\n\t@Override\r\n\tprotected void configure(final HttpSecurity http) throws Exception {\r\n\r\n\t\thttp.authorizeRequests().antMatchers(\"/api/auth\").permitAll().antMatchers(\"/images/*/**\", \"/css/*/**\", \"/js/*/**\", \"/fonts/*/**\")\r\n\t\t\t\t.permitAll().antMatchers(\"/api/info/properties\", \"/api/info/modules\").hasRole(\"ADMIN\").antMatchers(\"/api/equipaments/**\").hasRole(\"USER\");\r\n\r\n\t\thttp.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);\r\n\t\thttp.exceptionHandling().authenticationEntryPoint(restAuthenticationEntryPoint);\r\n\t\thttp.addFilterBefore(jwtAuthenticationFilter(), AbstractPreAuthenticatedProcessingFilter.class);\r\n\r\n\t}\r\n\r\n\t@Bean\r\n\t@Autowired\r\n\tpublic ProxyUsernamePasswordAuthenticationFilter proxyUsernamePasswordAuthenticationFilter() {\r\n\t\tfinal ProxyUsernamePasswordAuthenticationFilter proxyUsernamePasswordAuthenticationFilter = new ProxyUsernamePasswordAuthenticationFilter(\"/api/login\",\r\n\t\t\t\tRequestMethod.POST.toString());\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setSiteminderAuthentication(true);\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setAuthenticationManager(authenticationManager);\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setAuthenticationSuccessHandler(restAuthenticationSuccessHandler);\r\n\t\treturn proxyUsernamePasswordAuthenticationFilter;\r\n\t}\r\n\r\n\t@Bean\r\n\tpublic AuthenticationProvider gicarProvider() {\r\n\t\tfinal SiteminderAuthenticationProvider siteminderAuthenticationProvider = new SiteminderAuthenticationProvider();\r\n\t\tsiteminderAuthenticationProvider.setUserDetailsService(gicarUserDetailsService());\r\n\t\treturn siteminderAuthenticationProvider;\r\n\t}\r\n\r\n\t@Bean\r\n\t@Primary\r\n\tpublic UserDetailsService gicarUserDetailsService() {\r\n\t\tfinal GICARUserDetailsServiceImpl gicarUserDetailsService = new GICARUserDetailsServiceImpl();\r\n\t\tgicarUserDetailsService.setHttpGicarHeaderUsernameKey(getHttpGicarHeaderUsernameKey());\r\n\t\tgicarUserDetailsService.setAuthoritiesDAO(authoritiesDAO());\r\n\t\treturn gicarUserDetailsService;\r\n\t}\r\n\r\n\t@Bean\r\n\tpublic AuthoritiesDAO authoritiesDAO() {\r\n\t\tfinal AuthoritiesDAOImpl authoritiesDAOImpl = new AuthoritiesDAOImpl();\r\n\t\tauthoritiesDAOImpl.setDataSource(dataSource);\r\n\t\treturn authoritiesDAOImpl;\r\n\t}\r\n\r\n\t@Override\r\n\t@Autowired\r\n\tprotected void configure(final AuthenticationManagerBuilder auth) throws Exception {\r\n\t\tauth.authenticationProvider(gicarProvider());\r\n\t}\r\n\r\n\t@Bean\r\n\t@Autowired\r\n\tpublic AuthenticationManager authenticationManager(final AuthenticationManagerBuilder auth) {\r\n\t\treturn auth.getOrBuild();\r\n\t}\r\n\r\n\t@Bean\r\n\t@Named(\"jwtAuthenticationService\")\r\n\tpublic AuthenticationService jwtAuthenticationService() {\r\n\t\tfinal JwtAuthenticationService JwtAuthenticationService = new JwtAuthenticationService();\r\n\t\tJwtAuthenticationService.setSiteminderAuthentication(getSiteminderAuthentication());\r\n\t\tJwtAuthenticationService.setTokenResponseHeaderName(getTokenResponseHeaderName());\r\n\t\tJwtAuthenticationService.setHeaderAuthName(getHeaderAuthName());\r\n\r\n\t\treturn JwtAuthenticationService;\r\n\t}\r\n\r\n\t@Bean\r\n\t@Named(\"jwtAuthenticationFilter\")\r\n\tpublic JwtAuthenticationFilter jwtAuthenticationFilter() {\r\n\t\tfinal JwtAuthenticationFilter jwtAuthenticationFilter = new JwtAuthenticationFilter();\r\n\t\tjwtAuthenticationFilter.setHeaderAuthName(getHeaderAuthName());\r\n\t\tjwtAuthenticationFilter.setStartToken(getStartToken());\r\n\t\tjwtAuthenticationFilter.setTokenResponseHeaderName(getTokenResponseHeaderName());\r\n\t\treturn jwtAuthenticationFilter;\r\n\t}\r\n\r\n\t@Bean\r\n\t@Named(\"jwtTokenHandler\")\r\n\tpublic JwtTokenHandler jwtTokenHandler() {\r\n\t\tfinal JwtTokenHandler JwtTokenHandler = new JwtTokenHandler();\r\n\t\tJwtTokenHandler.setExpiration(getExpiration());\r\n\t\tJwtTokenHandler.setSecret(getSecret());\r\n\t\treturn JwtTokenHandler;\r\n\t}\r\n\r\n\tprivate String getSecret() {\r\n\t\tfinal String secret = propertiesConfiguration.getProperty(\"jwt.secret\");\r\n\t\treturn secret != null ? secret : \"canigo\";\r\n\t}\r\n\r\n\tprivate Long getExpiration() {\r\n\t\tfinal Long expiration = new Long(propertiesConfiguration.getProperty(\"jwt.expiration\"));\r\n\t\treturn expiration != null ? expiration : 3600L;\r\n\t}\r\n\r\n\tprivate String getStartToken() {\r\n\t\tfinal String startToken = propertiesConfiguration.getProperty(\"jwt.header.startToken\");\r\n\t\treturn startToken != null ? startToken : \"Bearer\";\r\n\t}\r\n\r\n\tprivate String getHeaderAuthName() {\r\n\t\tfinal String headerAythName = propertiesConfiguration.getProperty(\"jwt.header\");\r\n\t\treturn headerAythName != null ? headerAythName : \"Authentication\";\r\n\t}\r\n\r\n\tprivate String getTokenResponseHeaderName() {\r\n\t\tfinal String tokenResponseHeaderName = propertiesConfiguration.getProperty(\"jwt.tokenResponseHeaderName\");\r\n\t\treturn tokenResponseHeaderName != null ? tokenResponseHeaderName : \"jwtToken\";\r\n\t}\r\n\r\n\tprivate boolean getSiteminderAuthentication() {\r\n\t\tfinal Boolean siteminder = new Boolean(propertiesConfiguration.getProperty(\"jwt.siteminderAuthentication\"));\r\n\t\treturn siteminder != null ? siteminder : false;\r\n\t}\r\n\r\n\tprivate String getHttpGicarHeaderUsernameKey() {\r\n\t\tfinal String gicarHeader = propertiesConfiguration.getProperty(\"security.gicar.httpGicarHeaderUsernameKey\");\r\n\t\treturn gicarHeader != null ? gicarHeader : \"NIF\";\r\n\t}\r\n}\r\n```\r\n\r\n\r\n\r\n#### Configuració de la font d'autorització per base de dades\r\n\r\nPer a configurar la font d'autorització mitjançant base de dades és necessari:\r\n\r\n* Configurar l'arxiu de propietats security.properties.\r\n* Conigurar el proveïdor de seguretat dins de la configuració de seguretat de Spring.\r\n\r\nEls dos arxius es generen i configuren de manera automàtica mitjançant l'eina de desenvolupament.\r\n\r\nLes propietats de l'arxiu security.properties son les següents:\r\n\r\nPropietat                    | Requerit | Descripció\r\n---------------------------- | -------- | ----------------------------------------------------------\r\n*.security.database.jndiName | Si       | Nom JNDI d'accés a la BD. Obligatori per a connexions JNDI\r\n*.security.database.url      | Si       | URL de connexió a la base de dades\r\n*.security.database.username | Si       | Usuari de connexió a la base de dades\r\n*.security.database.password | Si       | Password de connexió a la base de dades\r\n\r\nLa configuració del provider en app-custom-security.xml per aquest proveidor és la següent:\r\n\r\n* Afegim el provider al authentication manager.\r\n* Afegim el tipus de codificador de password per tal de comparar el password de base de dades i el que ens ha proporcionat l'usuari de l'aplicació. Aquest codificador suporta: plaintext, sha, sha-256, md5, md4, ssha. Si en la base de dades tenim emmagatzemat els password d'usuari en md5, i marquem \"password-encode\" com a md5, de manera automàtica, el password proporcionat per l'usuari via formulari de login (j_password) es codificarà en md5 per posteriorment ser comparat amb el emmagatzemat a la base de dades.\r\n\r\n```\r\n<security:authentication-manager>\r\n\t<security:authentication-provider>\r\n                <security:password-encoder hash=\"plaintext\"/>\r\n\t\t<security:jdbc-user-service data-source-ref=\"dataSource\"/>\r\n\t</security:authentication-provider>\r\n</security:authentication-manager>\r\n```\r\n\r\n<div class=\"message warning\">\r\nAccés base de dades\r\n\r\nL'eina de suport al desenvolupament automatitza la instal- lació del mòdul de persistència si aquest no ha estat instal- lat prèviament pel desenvolupador.\r\n</div>\r\n\r\n#### Configuració de l'Autorització per LDAP\r\n\r\nPer a configurar l'acces a LDAP és necessari:\r\n\r\n* Configurar l'arxiu de propietats security.properties.\r\n* Conigurar el proveidor de seguretat dins de la configuració de seguretat de Spring.\r\n\r\nEls dos arxius es generen i configuren de manera automàtica mitjançant l'eina de desenvolupament.\r\n\r\nLes propietats de l'arxiu security.properties son les següents:\r\n\r\nPropietat                           | Requerit | Descripció\r\n----------------------------------- | -------- | -----------------------------------------------------------------------\r\n*.security.ldap.url                 | Si       | Direcció del servidor ldap separat amb dos punts \":\" del port\r\n*.security.ldap.manager.dn          | Sí       | Identificador de l'usuari administrador del LDAP\r\n*.security.ldap.manager.password    | Si       | Password del l'usuari administrador del LDAP\r\n*.security.ldap.user.search.filter  | No       | Filtre de cerca dels usuaris dintre de l'estructura del LDAP. Per defecte: (uid={0})\r\n*.security.ldap.user.search.base    | Si       | String base de la ubicació dels usuaris dintre de l'estructura del LDAP\r\n*.security.ldap.group.search.base   | Si       | String base de la ubicació dels grups dintre de l'estructura del LDAP\r\n*.security.ldap.group.search.filter | No       | Filtre de cerca dels grups dintre de l'estructura del LDAP. Per defecte: (cn={0})\r\n\r\nPer a realitzar les proves en desenvolupament podem instal- lar un servidor LDAP senzill (veure l'apartat 'Eines de Suport' per a més referència).\r\n\r\nConfiguració del provider en **app-custom-security.xml**:\r\n\r\n* Afegim el provider al authentication manager.\r\n* Afegim la connexió al LDAP server\r\n\r\n```\r\n<security:authentication-manager>\r\n    <security:ldap-authentication-provider\r\n        server-ref=\"ldapLocal\"\r\n        user-search-filter=\"${security.ldap.user.search.filter:(uid={0})}\"\r\n        user-search-base=\"${security.ldap.user.search.base}\"\r\n        group-search-base=\"${security.ldap.group.search.base}\"\r\n        group-search-filter=\"${security.ldap.group.search.filter:(cn={0})}\">\r\n\r\n        <security:password-compare/>\r\n    </security:ldap-authentication-provider>\r\n</security:authentication-manager>\r\n\r\n<security:ldap-server url=\"${security.ldap.url}\" id=\"ldapLocal\" manager-dn=\"${security.ldap.manager.dn}\"\r\nmanager-password=\"${security.ldap.manager.password}\"/>\r\n```\r\n\r\n#### Configuració de l'Autorització per arxiu de propietats\r\n\r\nAquest proveidor de seguretat es recolça en un arxiu de propietats per carregar en memòria els usuaris/password/rols de l'aplicació.\r\n\r\nPer a configurar l'acces mitjançant un arxiu de propietats és necessari:\r\n\r\n* Configurar l'arxiu de propietats **security.users.properties**.\r\n* Conigurar el proveidor de seguretat dins de la configuració de seguretat de Spring (**app-custom-security.xml**).\r\n\r\nL'arxiu que conté aquesta configuració **security.users.properties** te el següent format:\r\n\r\n    username=password,grantedAuthority[,grantedAuthority][,enabled|disabled]\r\n\r\nExemple de configuració:\r\n\r\n```\r\nuser=password,ROLE_USER,enabled\r\nadmin=password,ROLE_USER,ROLE_ADMIN,enabled\r\n```\r\n\r\n#### Configuració del provider en **app-custom-security.xml**:\r\n\r\n* Afegim el provider al authentication manager.\r\n* Afegim el tipus de codificador de password per tal de comparar el password de l'arxiu de propietats i el que ens ha proporcionat l'usuari de l'aplicació. Aquest codificador suporta: plaintext, sha, sha-256, md5, md4, ssha.\r\n\r\n```\r\n<security:authentication-manager>\r\n\t<security:authentication-provider>\r\n\t\t<security:password-encoder hash=\"plaintext\"/>\r\n\t\t<security:user-service properties=\"classpath:/config/props/security.users.properties\"/>\r\n\t</security:authentication-provider>\r\n</security:authentication-manager>\r\n```\r\n\r\n#### Configuració de la Font d'Autorització per GICAR\r\n\r\nPer a configurar l'accés a GICAR és necessari:\r\n\r\n* Configurar l'arxiu de propietats **security.properties**.\r\n* Configurar el proveidor de seguretat dins de la configuració de seguretat de Spring.\r\n\r\nEls dos arxius es generen i configuren de manera automàtica mitjançant l'eina de desenvolupament:\r\n\r\nLes propietats de l'arxiu **security.properties** son les següents:\r\n\r\nPer a configurar l'acces a GICAR és necessari configurar l'arxiu de propietats **security.properties**. Aquest arxiu es genera automàticament des de l'eina de suport, i té el següent format:\r\n\r\nPropietat                                   | Requerit | Descripció\r\n------------------------------------------- | -------- | -----------------------------------\r\n*.security.gicar.httpGicarHeaderUsernameKey | No       | Aquesta propietat indica quin és el camp de la capçalera HTTP_GICAR que conté el nom de l'usuari autenticat a GICAR. Per defecte: NIF\r\n\r\n<div class=\"message warning\">\r\nEl servei de seguretat de Canigó no dona suport a la capçalera \"HTTP_GICAR_AUTH_CERT\". En cas de requerir l'autenticació amb certificat cal sol·licitar a l'equip de GICAR la recepció d'aquesta capçalera per aplicació/entorn, i fer-ne la gestió pertinent a l'aplicació.\r\n</div>\r\n\r\nA continuació es mostra la classe SecurityConfig per a una configuració basada en GICAR sense utilitzar JWT com a sistema d'autenticació.\r\n\r\n```\r\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\r\n\r\n\t@Autowired\r\n\tprivate AuthenticationEntryPoint restAuthenticationEntryPoint;\r\n\r\n\t@Autowired\r\n\tprivate PropertiesConfiguration propertiesConfiguration;\r\n\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate AuthenticationManager authenticationManager;\r\n\t\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate AuthenticationSuccessHandler restAuthenticationSuccessHandler;\r\n\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate DataSource dataSource;\r\n\r\n\t@Override\r\n\tprotected void configure(final HttpSecurity http) throws Exception {\r\n\r\n\t\thttp.authorizeRequests().antMatchers(\"/api/auth\").permitAll().antMatchers(\"/images/*/**\", \"/css/*/**\", \"/js/*/**\", \"/fonts/*/**\").permitAll()\r\n\t\t\t\t.antMatchers(\"/api/info/properties\", \"/api/info/modules\").hasRole(\"ADMIN\").antMatchers(\"/api/equipaments/**\").hasRole(\"USER\");\r\n        http.exceptionHandling().authenticationEntryPoint(restAuthenticationEntryPoint);\r\n\t\thttp.addFilterBefore(proxyUsernamePasswordAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);\r\n\t\t\r\n\t}\r\n\t\r\n\t@Override\r\n\t@Autowired\r\n\tprotected void configure(final AuthenticationManagerBuilder auth) throws Exception {\r\n\t\tauth.authenticationProvider(gicarProvider());\r\n\t}\r\n\r\n\t@Bean\r\n\t@Autowired\r\n\tpublic ProxyUsernamePasswordAuthenticationFilter proxyUsernamePasswordAuthenticationFilter() {\r\n\t\tfinal ProxyUsernamePasswordAuthenticationFilter proxyUsernamePasswordAuthenticationFilter = new ProxyUsernamePasswordAuthenticationFilter(\"/api/login\",\r\n\t\t\t\tRequestMethod.POST.toString());\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setSiteminderAuthentication(true);\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setAuthenticationManager(authenticationManager);\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setAuthenticationSuccessHandler(restAuthenticationSuccessHandler);\r\n\t\treturn proxyUsernamePasswordAuthenticationFilter;\r\n\t}\r\n\r\n\t@Bean\r\n\tpublic AuthenticationProvider gicarProvider() {\r\n\t\tfinal SiteminderAuthenticationProvider siteminderAuthenticationProvider = new SiteminderAuthenticationProvider();\r\n\t\tsiteminderAuthenticationProvider.setUserDetailsService(gicarUserDetailsService());\r\n\t\treturn siteminderAuthenticationProvider;\r\n\t}\r\n\r\n\t@Bean\r\n\t@Primary\r\n\tpublic UserDetailsService gicarUserDetailsService() {\r\n\t\tfinal GICARUserDetailsServiceImpl gicarUserDetailsService = new GICARUserDetailsServiceImpl();\r\n\t\tgicarUserDetailsService.setHttpGicarHeaderUsernameKey(getHttpGicarHeaderUsernameKey());\r\n\t\tgicarUserDetailsService.setAuthoritiesDAO(authoritiesDAO());\r\n\t\treturn gicarUserDetailsService;\r\n\t}\r\n\r\n\t@Bean\r\n\tpublic AuthoritiesDAO authoritiesDAO() {\r\n\t\tfinal AuthoritiesDAOImpl authoritiesDAOImpl = new AuthoritiesDAOImpl();\r\n\t\tauthoritiesDAOImpl.setDataSource(dataSource);\r\n\t\treturn authoritiesDAOImpl;\r\n\t}\r\n\r\n\t\r\n\r\n\t@Bean\r\n\t@Autowired\r\n\tpublic AuthenticationManager authenticationManager(final AuthenticationManagerBuilder auth) {\r\n\t\treturn auth.getOrBuild();\r\n\t}\r\n\r\n    private String getHttpGicarHeaderUsernameKey() {\r\n\t\tfinal String gicarHeader = propertiesConfiguration.getProperty(\"security.gicar.httpGicarHeaderUsernameKey\");\r\n\t\treturn gicarHeader != null ? gicarHeader : \"NIF\";\r\n\t}\r\n}\r\n\r\n```\r\n\r\nAmb aquesta configuració ha de ser possible autoritzar un usuari que prèviament ha estat auntenticat en el servei de GICAR. Per aquest motiu és necessari rebre certes dades referents a aquesta autenticació ja realitzada. A la capçalera HTML podrem accedir a aquestes dades:\r\n\r\n```\r\nHTTP_GICAR=CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;\r\nUNITAT_MENOR=CTTI Qualitat\r\n```\r\n\r\nOn CODIINTERN és el codi intern, el NIF el NIF, EMAIL l'adreça de correu electrònic registrada al Director Corporatiu, UNITAT_MAJOR és l'organització i UNITAT_MENOR és la unitat.\r\n\r\n<div class=\"message warning\">\r\nEn cas de que l'aplicació utilitzi la separació entre codi estàtic i dinàmic és necessari indicar la següent propietat dintre del bean proxyUsernamePasswordAuthenticationFilter:\r\n<br><br>\r\n\r\n<b>&lt;property name=\"filterProcessesUrl\" value=\"/AppJava/j_spring_security_check\" /&gt;</b>\r\n\r\n</div>\r\n\r\n**Logout**\r\n\r\nPer tots els mètodes d'autenticació, el procediment de logoff consisteix en invalidar la sessió, forçant així que el servei de seguretat intervingui en la següent petició solicitant la nova identificació de l'usuari.\r\n\r\nEn el cas de GICAR, però, aquesta autenticació és realitzada per un sistema extern a l'aplicació i, per tant, s'ha de comunicar a aquest sistema extern la intenció de fer el logoff. El mecanisme previst per fer-ho consisteix en una URL de Gicar que, al ser invocada, realitza el logoff.\r\n\r\nAquest enllaç de logout és depenent de l'agent de SiteMinder que l'aplicació fa servir per a comunicar-se amb el Policy Server.\r\n\r\nAixí doncs, els enllaços de logout són els següents:\r\n\r\n* Per a una aplicació ubicada en els apaches corporatius de internet: http://sso.gencat.cat/siteminderagent/forms/logoff.html\r\n* Per a una aplicació ubicada en els apaches corporatius de intranet: http://sso.gencat.intranet/siteminderagent/forms/logoff.html\r\n* Per a una aplicació amb apache \"pròpi\": http://****.gencat.***/siteminderagent/forms/logoff.html;\r\n\r\n## Eines de Suport\r\n\r\n### Servidor LDAP de proves: openLDAP\r\n\r\nEls diferents passos per a instal- lar openLDAP i importar un directori LDAP d'exemple són:\r\n\r\n* Baixar openLDAP per a Windows http://sourceforge.net/projects/openldapwindows/ i instal- lar-ho.\r\n* Canviar la configuració per defecte de openldap. Copiar les dades següents en un fitxer slapd.conf. Copiarem el slapd.conf en la mateixa carpeta que openLDAP.\r\n\r\n```\r\n#######################################################################\r\n# See slapd.conf(5) for details on configuration options.\r\n# This file should NOT be world readable.\r\n#######################################################################\r\nucdata-path ./ucdata\r\ninclude ./etc/schema/core.schema\r\ninclude ./etc/schema/cosine.schema\r\ninclude ./etc/schema/inetorgperson.schema\r\n\r\n# Define global ACLs to disable default read access.\r\n\r\n# Do not enable referrals until AFTER you have a working directory\r\n# service AND an understanding of referrals.\r\n#referral ldap://root.openldap.org\r\n\r\npidfile ./var/run/slapd.pid\r\nargsfile ./var/run/slapd.args\r\n\r\n#######################################################################\r\n# BDB database definitions\r\n#######################################################################\r\n\r\n###database bdb\r\n###suffix \"dc=my-domain,dc=com\"\r\n###rootdn \"cn=Manager,dc=my-domain,dc=com\"\r\n\r\ndatabase bdb\r\nsuffix dc=\"mycompany\",dc=\"com\"\r\nrootdn \"cn=Manager,dc=mycompany,dc=com\"\r\n\r\nrootpw secret\r\nEines de Suport\r\n\r\ndirectory ./var/openldap-data\r\nindex objectClass eq\r\n```\r\n\r\n* Obrir una pantalla \"DOS command\", anar a la carpeta on hem instal- lat el programa i arrancar openLDAP amb la comanda\r\n\r\n```\r\n.\\slapd -d 1\r\n```\r\n\r\nSi tot ha funcionat bé, hauríem de veure una sortida com la següent:  \r\n    \r\n![Execució Open LDAP](/related/canigo/documentacio/modul-seguretat/ServeiSeguretat_img012.jpg.gif)\r\n\r\n* Copiar les dades següents en un fitxer setup.ldif. Aquest fitxer conté un directori LDAP de l'empresa \"mycompany.com\" amb 2 persones: \"gestoruser\" i \"usuari\". Copiarem el setup.ldif en la mateixa carpeta que openLDAP.\r\n\r\n```\r\n### Top level definition\r\n#dn: dc=mycompany,dc=com\r\n#objectClass: top\r\n#objectClass: dcObject\r\n#objectClass: domain\r\n#dc: mycompany\r\n\r\n### organizationalUnit : PEOPLE\r\n# Definition of people\r\ndn: ou=people,dc=mycompany,dc=com\r\nobjectClass: top\r\nobjectClass: organizationalUnit\r\nou: people\r\n\r\n# Gestor User\r\ndn: uid=gestoruser,ou=people,dc=mycompany,dc=com\r\nobjectClass: person\r\nobjectClass: inetOrgPerson\r\ncn: State App\r\ndisplayName: App Admin\r\ngivenName: App\r\nmail: gestor@fake.org\r\ntitle: ROLE_ADMIN\r\nsn: Gestor\r\nuid: gestoruser\r\nuserPassword: gestorpassword\r\n\r\n# usuario normal\r\ndn: uid=usuario,ou=people,dc=mycompany,dc=com\r\nobjectClass: person\r\nobjectClass: inetOrgPerson\r\ncn: State App\r\ndisplayName: App Admin\r\ngivenName: App\r\nmail: usuario@fake.org\r\ntitle: ROLE_USER\r\nsn: Usuario\r\nuid: usuario\r\nuserPassword: usuariopassword\r\n```\r\n\r\nObrir una altra pantalla \"DOS command\", anar a la carpeta on hem instal- lat el programa i importar les dades amb la comanda:\r\n\r\n```\r\nldapadd -x -D \"cn=Manager,dc=mycompany,dc=com\" -W -f setup.ldif\r\n```\r\n\r\nLa contrasenya per defecte és \"secret\".\r\n\r\n### Jxplorer\r\n\r\nComprovarem que la importació de dades ha funcionat amb Jxplorer, un client LDAP Java i opensource.\r\n\r\n* Baixar Jxplorer a la url http://sourceforge.net/projects/jxplorer/ i instal- lar-ho\r\n* Prémer el botó per a connectar-se al nostre directori LDAP.\r\n\r\nLa contrasenya per defecte és \"secret\". La pantalla següent mostra els valors de la diferents paràmetres:\r\n\r\n![Configuració paràmetres JXplorer](/related/canigo/documentacio/modul-seguretat/ServeiSeguretat_img013.jpg.gif)\r\n\r\nSi tot ha funcionat bé, hauríem de veure la pantalla següent:\r\n\r\n![Resultat JXplorer](/related/canigo/documentacio/modul-seguretat/ServeiSeguretat_img014.jpg.gif)\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1zZWd1cmV0YXQ="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC10cmFjZXM=":{"date":1425571902000,"title":"Mòdul de traces","description":"Mòdul de detecció d'errades i registre de les operacions realitzades a l'aplicació.","sections":"Canigó. Documentació versió 3.x","weight":7,"path":"/canigo-documentacio-versions-3x-core/modul-traces","content":"## Introducció\r\n\r\n### Propòsit\r\n\r\nEl mòdul de traces té com a missió:\r\n\r\n-   Detectar i localitzar amb més facilitat errors de l'aplicació\r\n-   Entrada de dades incorrectes segons la lògica del sistema\r\n-   Seguiment per a auditoria\r\n\r\nPer a què això pugui ser portat a terme, el servei ofereix la\r\npossibilitat de:\r\n\r\n1.  Definir nivells de traces (d'informació, fatals, errors, etc.)\r\n2.  Definir en quines sortides es generarà la traça: consola, fitxers,\r\n    base de dades, correu electrònic, etc.\r\n3.  Canviar en qualsevol moment quin és el mínim nivell de traces que\r\n    volem mostrar, sense haver d'afectar a les classes que generen les\r\n    traces\r\n4.  Definir el format de sortida de les nostres traces: incorporar\r\n    l'hora, el número de línia del codi on s'ha produït i la seva\r\n    classe, etc.\r\n5.  Incorporar informació de context a la traça: usuari, IP del client,\r\n    etc.\r\n\r\n### Documents i Fonts de Referència\r\n\r\nNom          | Adreça\r\n------------ | ------------\r\nLog4J2 Manual | http://logging.apache.org/log4j/2.x/\r\n\r\n### Glossari\r\n\r\n**Log4J2**\r\n\r\nEvolució de Log4J, un dels framework de traces més estès. Es basa en l'ús d'Appenders,\r\nLoggers i Layouts. Veure l'annex per a més informació.\r\n\r\n## Descripció detallada\r\n\r\n### Arquitectura i components\r\n\r\nA més de les funcionalitats oferides per la pròpia API de Log4j2, Canigó\r\ndisposa d'un conjunt de components addicionals:\r\n\r\n1.  Configuració de traces multientorn.\r\n2.  Modificar el nivell de traces en calent d'una aplicació.\r\n3.  Eina de consulta de logs en calent.\r\n4.  Afegir informació contextual als logs.\r\n\r\n### Instal·lació i configuració\r\n\r\n#### Instal·lació\r\n\r\nEl mòdul de traces s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació, l'eina de\r\nsuport al desenvolupament inclourà la referència dins del pom.xml. En\r\ncas d'una instal·lació manual afegir les següents línies al pom.xml de\r\nl'aplicació:\r\n\r\n```java\r\n<canigo.core.version>[3.2.0,3.3.0)</canigo.core.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.core</artifactId>\r\n          <version>${canigo.core.version}</version>\r\n</dependency>\r\n```\r\n\r\n#### Configuració\r\n\r\nL'eina de desenvolupament de Canigó 3 genera de manera automàtica els\r\ndiferents arxius de configuració de traces per entorn:\r\n\r\n-   log4j2.loc.xml Arxiu de configuració per a entorn locals.\r\n-   log4j2.int.xml Arxiu de configuració per a l'entorn d'integració.\r\n-   log4j2.pre.xml Arxiu de configuració per a l'entorn de preproducció.\r\n-   log4j2.pro.xml Arxiu de configuració per a l'entorn de producció.\r\n-   log4j2.xml Arxiu de configuració per defecte. En el cas de no trobar cap configuració específica per a l'entorn, aquesta pasarà a ser la de per defecte.\r\n\r\nDirectori de configuració: <PROJECT_ROOT>/src/main/resources/log4j2/*.xml\r\n\r\nPer cadascun dels entorns els nivells de logs poden variar.\r\n\r\nExemple de configuració log4j2.xml en local:\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<Configuration>\r\n\t<Appenders>\r\n\t    <RollingFile name=\"DAILY_LOG\" fileName=\"/tmp/log.log\" filePattern=\"tmp/%d{ddMMyyyy}_log.log\" append=\"true\">\r\n\t\t\t<PatternLayout pattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\"/>\r\n\t\t    <Policies>\r\n\t\t    \t<TimeBasedTriggeringPolicy interval=\"1\"/>\r\n\t\t    </Policies>                               \r\n\t\t</RollingFile>\r\n\t\t<Console name=\"STDOUT\" target=\"SYSTEM_OUT\">\r\n\t\t\t<PatternLayout\r\n\t\t\t\tpattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\" />\r\n\t\t</Console>\r\n\t</Appenders>\r\n\t<Loggers>\r\n\t\t<Logger name=\"cat.gencat.ctti\" level=\"debug\" additivity=\"false\">\r\n\t\t\t<AppenderRef ref=\"DAILY_LOG\" />\r\n\t\t\t<AppenderRef ref=\"STDOUT\" />\r\n\t\t</Logger>\r\n\t\t<Root level=\"info\">\r\n\t\t\t<AppenderRef ref=\"DAILY_LOG\" />\r\n\t\t</Root>\r\n\t</Loggers>\r\n</Configuration>\r\n\r\n```\r\n\r\nD'aquesta configuració d'exemple destaquem:\r\n\r\n-   Existeixen dos tipus d'appender, un que mostrarà la informació per\r\n    la consola del servidor d'aplicacions, i un altre que inserirà les\r\n    traces a un log que rotarà automàticament cada dia.\r\n-   Les traces provinents del package \"cat.gencat.ctti\" es\r\n    visualitzaran tant en la consola d'arranc del servidor com a un\r\n    arxiu de logs.\r\n-   Els packages restants (aplicació i llibreries de tercers) es\r\n    mostraran només per consola i amb nivell de log INFO.\r\n\r\n#### Appenders\r\n\r\nEls appenders més comuns i utilitzat son Console i RollingFile.\r\n\r\nEl appender Console treu els missatges per consola\r\n```\r\n<Console name=\"STDOUT\" target=\"SYSTEM_OUT\">\r\n\t<PatternLayout\r\n\t\tpattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\" />\r\n</Console>\r\n```\r\n\r\nEl appender RollingFile treu els missatges per un fitxer que es va rotant cada cert temps.\r\nA filePattern s'indica un patró de data pel nom del fitxer que es rota. Al paràmetre TimeBaseTriggeringPolicy s'indica cada quan es rota el fitxer. Aquest número farà referència a la mínima unitat de temps del patró trobat a filePattern.\r\n\r\nPer exemple si en indiquem 1, i el patró és ddMMyyyy, es rotarà cada dia. Si el patró fos MMyyyy, es rotaria cada mes\r\n```\r\n<RollingFile name=\"DAILY_LOG\" fileName=\"/tmp/log.log\" filePattern=\"tmp/%d{ddMMyyyy}_log.log\" append=\"true\">\r\n\t<PatternLayout pattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\"/>\r\n\t<Policies>\r\n\t\t<TimeBasedTriggeringPolicy interval=\"1\"/>\r\n\t</Policies>                               \r\n</RollingFile>\r\n```\r\n\r\nAl següent enllaç es troba la informació de tots els appenders existents a Log4J2.\r\n\r\nhttps://logging.apache.org/log4j/2.x/manual/appenders.html\r\n\r\n#### PatternLayout\r\n\r\nPermet especificar la sortida amb patrons de conversió. El seu ús és equivalent a la funció printf del llenguatje C.\r\n\r\nAlguns dels caràcters de conversió més interessants són (per a més referència consultar la API de la classe):\r\n\r\n**Caràcter** | **Descripció**\r\n------------ | --------------\r\n%c           | Nom del \"logger\"\r\n%C           | Mostrar el nom qualificat de la classe que ha llençat el missatge.\r\n%d           | Mostrar la data en què es va produir el missatge. A continuació opcionalment pot aparèixer el patró de conversió de data. Si no s'especifica s'utilitza per defecte **ISO 8601.** <br>Exemple: %d{dd MMM yyyy HH:mm:ss,SSS}.\r\n%L           | Número de línia a on es va llençar el missatge (**no fer servir si es necessita un bon rendiment**).\r\n%m           | Missatge\r\n%p           | Prioritat/nivell del missatge (WARN,...).\r\n%X{clau}     | Informació contextual \"clau\"\r\n%n           | Separador de línia (un \\n).\r\n\r\nEl resultat de l'aplicació d'aquests patrons són missatges de text pla\r\nuniformement formatejats.\r\n\r\nEl patró per defecte a les aplicacions Canigó és el següent:\r\n\r\n```\r\ncanigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\r\n\r\nQue fa que els logs surten de la següent manera:\r\n\r\ncanigo Message: 10 11 2016 16:25:39,578 DEBUG [http-bio-8081-exec-1] DEBUG [http-bio-8081-exec-1] org.hibernate.hql.internal.ast.ErrorCounter - throwQueryException() : no errors\r\ncanigo Message: 10 11 2016 16:25:39,579 DEBUG [http-bio-8081-exec-1] DEBUG [http-bio-8081-exec-1] org.hibernate.hql.internal.ast.QueryTranslatorImpl - HQL: select equipament.nom from cat.gencat.test.model.Equipament equipament\r\n```\r\n\r\nUtilització del Servei\r\n----------------------\r\n\r\n### Generar Missatges\r\n\r\nPer a generar les traces el framework utilitzat per les aplicacions Canigó 3.2 és SLF4J\r\nPer generar una traça en nivell debug tindríem el següent codi:\r\n\r\n```\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\n\r\npublic class ExempleTrace{\r\n\r\n   private static final Logger LOGGER = LoggerFactory.getLogger(ExempleTrace.class);\r\n\r\n   public void execute(){\r\n      if (LOGGER.isDebugEnabled()){\r\n         LOGGER.debug(\"Traça d'exemple\");\r\n      }\r\n   }\r\n}\r\n```\r\n\r\n### Recomanacions\r\n\r\n#### Recomanacions generals\r\n\r\n-   Mai utilitzar System.out.println.\r\n-   Instància de manera estàtica i final el log per evitar\r\n    instanciacions innecessàries.\r\n-   Sobreescriu sempre el mètode toString() per donar una representació\r\n    de l'objecte. Obtenir una traça del tipus className@16cd7d5 no aporta\r\n    res.\r\n-   Valida el nivell de traces abans d'escriure.\r\n\r\n#### Recomanacions davant excepcions\r\n\r\n-   No utilitzar e.printStackTrace.\r\n\r\ne.printStackTrace només imprimeix en consola. Només es podrà visualitzar\r\naquesta informació si s'ha definit un appender de consola.\r\n\r\n```\r\ntry {\r\n   ................\r\n} catch (MyException e) {\r\n    e.printStackTrace();\r\n}\r\n```\r\n\r\nUtilitzar LOGGER.error(message, t) on t és l'excepció capturada:\r\n\r\n```\r\ntry {\r\n    ................\r\n} catch (MyException e) {\r\n    LOGGER.error(\"S'ha produït un error: \", e);\r\n    .........................\r\n}\r\n```\r\n\r\n-   No utilitzar LOGGER.error i després rellançar l'excepció si no és\r\n    estrictament necessari:\r\n\r\n```\r\ntry {\r\n    ................\r\n} catch (MyException e) {\r\n    LOGGER.error(\"S'ha produït un error: \", e);\r\n    throw e;\r\n}\r\n```\r\n\r\nSi en altres nivells es fa el mateix, s'imprimirà les excepcions\r\ndiverses vegades, portant a la confusió.\r\n\r\n-   No eliminar el stacktrace\r\n\r\n```\r\ntry{\r\n    ......\r\n}catch(MyException e){\r\n    throw new RuntimeException(\"S'ha produït un error: \" + e.getMessage());\r\n}\r\n```\r\n\r\nAquest codi elimina el stacktrace de MyException. Es perd informació\r\nútil sobre l'excepció. L'alternativa correcta és:\r\n\r\n```\r\ntry{\r\n   ...\r\n}catch(MyException e){\r\n   throw new RuntimeException(\"S'ha produït un error: \", e);\r\n}\r\n```\r\n\r\n#### Evitar càlculs innecessaris\r\n\r\nUna de les qüestions més importants del sistema de traces és el cost de\r\ncomputació. Si en un moment donat es desactiven determinats nivells de\r\ntraces, encara que aquesta traça no es generi a la sortida el missatge és\r\navaluat (ja que es troba com un paràmetre de la crida). Si l'avaluació\r\ndel missatge comporta càlculs estem afegint un cost innecessari.\r\n\r\nPer evitar afegir costos addicionals de còmput innecessari es recomana\r\nprèviament comprovar que es troba activat el nivell pel qual generarem\r\nel missatge. Així, per exemple, enlloc de:\r\n\r\n```\r\nLOGGER.debug(\"....\");\r\n```\r\n\r\nHaurem sempre de realitzar:\r\n\r\n```\r\nif (LOGGER.isDebugEnabled())\r\nLOGGER.debug(\"....\");\r\n```\r\n\r\n#### Programació de traces\r\n\r\nCom a recomanació de traces i nivell d'aquestes dins d'un mètode podrien\r\nser les següents:\r\n\r\n1.  Traça a nivell debug al començament del mètode, informant els\r\n    paràmetres d'entrada que poden arribar a ser útils per a detectar\r\n    l'operació realitzada.\r\n2.  Traça a nivell info informant de l'operació realitzada, si\r\n    escau.\r\n3.  Traça a nivell error o warn per a blocs destinats a la captura\r\n    d'excepcions.\r\n\r\n```\r\npublic void inserirUsuari(String nom){\r\ntry {\r\n      if (LOGGER.isDebugEnabled()) {\r\n    LOGGER.debug(\"UsuarioDAOImpl:eliminarUsuario ...identificador del usuario:\" + identificadorUsuario);\r\n      }\r\n\r\n      User user = new User();\r\n      user.setName(nom);\r\n      getUserDAO().insert(user);\r\n\r\n      if (LOGGER.isInfoEnabled()) {\r\n     LOGGER.info(\"Usuari \" + user + \" inserit a la BD\");\r\n      }\r\n\r\n }\r\n catch (Exception e) {\r\n    LOGGER.error(\"S'ha produït un error, e);\r\n    ........\r\n }\r\n}\r\n```\r\n\r\n### Generar Informació Contextual\r\n\r\nMoltes vegades no és suficient amb la informació estàndard que es mostra\r\na les traces i és necessari complementar-la amb informació contextual\r\ncom: usuari que fa la petició, temps d'inici i final, etc. Per afegir\r\naquesta informació, és necessari inicialitzar-la en algun moment de la\r\npetició perquè estigui disponible durant tot el processament d'aquesta. Per tant, el patró de treball a seguir és:\r\n\r\n1.  Inicialització de la informació addicional abans de processar la\r\n    petició.\r\n2.  Processament de la petició (utilització de la informació addicional en\r\n    el mòdul de traces).\r\n3.  Finalització de la petició.\r\n\r\n**Canigó** suporta la inserció d'aquesta informació mitjançant l'extensió del filtre\r\nLoggingFilter.\r\nGràcies al mètode createCustomParameters, el desenvolupador pot afegir o\r\neliminar paràmetres de la Mapped Diagnostic Context (MDC) de SLF4J que\r\nposteriorment seran inserits a les traces de l'aplicació.\r\n\r\nUn exemple de filtre que afegeix informació de l'usuari, adreça i host\r\nremot a les traces podria ser:\r\n\r\n```\r\npublic class ExtendedLoggingFilter extends LoggingFilter {\r\n\r\n     private final static String USERNAME = \"USERNAME\";\r\n     private final static String REMOTEHOST = \"REMOTEHOST\";\r\n     private final static String REMOTEADDR = \"REMOTEADDR\";\r\n\r\n     @Override\r\n     protected Map<String, Object> createCustomParameters( ServletRequest request, ServletResponse response) {\r\n\r\n\t\tMap<String,Object> custom = new HashMap<String, Object>();\r\n\t\tcustom.put(REMOTEHOST, request.getRemoteHost());\r\n        custom.put(REMOTEADDR, request.getRemoteAddr());\r\n\r\n\t\tHttpServletRequest httprequest = (HttpServletRequest) request;\r\n        String userLogin = (String)httprequest .getSession().getAttribute(\"userLogin\");\r\n\r\n        if (userLogin!=null) {\r\n            custom.put(USERNAME, userLoginId);\r\n        }\r\n        return custom;\r\n     }\r\n}\r\n```\r\n\r\nConfiguració del layout per a mostrar les dades:\r\n\r\n```\r\n<Console name=\"STDOUT\" target=\"SYSTEM_OUT\">\r\n\t<PatternLayout\r\n\t\tpattern=\"%X{USERNAME}%n - %X{REMOTEHOST} - %X{REMOTEADDR} canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\" />\r\n</Console>\r\n```\r\n\r\n## Annexos\r\n\r\n### Introducció a Log4J2\r\n\r\nEn aquest annex s'ofereix una breu introducció a conceptes de Log4J2 que\r\ncal entendre per utilitzar el Servei de Traces.\r\n\r\nA Log4J2, existeixen diversos elements clau:\r\n\r\n1.  Prioritats o nivells de les traces. Log4J2 defineix per defecte 5\r\n    nivells: DEBUG, INFO, WARN, ERROR i FATAL. Entre ells existeix una\r\n    jerarquia (DEBUG<INFO<WARN<ERROR<FATAL), de forma que si en\r\n    l'aplicació s'ha configurat que només es mostrin traces de nivell\r\n    WARN, també es mostrarien els de nivell ERROR i FATAL.\r\n    \r\n    ![](/related/canigo/documentacio/modul-traces/ServeiTraces_img014.jpg)\r\n    \r\n2.  Loggers. Els loggers donen control al programador per a\r\n    determinar quins events requereixen ser capturats i quins no. Dins\r\n    de l'aplicació es poden definir diferents loggers organitzats\r\n    per jerarquia que en la majoria dels casos es mapejen amb el nom\r\n    qualificat de les classes java, a on cada classe tindria el seu logger. \r\n    \r\n3.  Appenders. Els \"appenders\" especifiquen a on es desarà la traça\r\n    definida per a la categoria. Un logger pot definir diferents\r\n    sortides o \"appenders\" a la vegada (consola, fitxer, correu\r\n    electrònic, base de dades,etc.)\r\n    \r\n4.  Layouts. Permeten especificar com es mostren els events. Per exemple\r\n    podem especificar que ens aparegui l'hora en la què s'ha produït\r\n    l'event, qui ho ha llençat, la línia en la què s'ha fet, etc.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC10cmFjZXM="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hbnRpdmlydXM=":{"date":1426763195000,"title":"Antivirus","description":"Accés a l'escaneig d'arxius mitjançant el servei d'antivirus Centrals del CTTI.","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-integracio/modul-antivirus","content":"## Propòsit\r\n\r\nAquest mòdul permet l'escaneig d'arxius mitjançant el servei d'antivirus Centrals del CTTI.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'Antivirus es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.antivirus.version>[1.3.0,1.4.0)</canigo.integration.antivirus.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.antivirus</artifactId>\r\n    <version>${canigo.integration.antivirus.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/antivirus.properties\r\n\r\nPropietat                              | Requerit | Descripció\r\n-------------------------------------- | -------- | ----------\r\n*.antivirus.remote                     | Sí       | Paràmetre que indica si l'escaneig dels arxius es realitza de forma remota o no. Si fos de forma remota l'arxiu a escanejar s'ha de pujar abans al servidor d'antivirus centrals, procés que fa automàticament el mòdul. En cas de remote a fals s'enten que l'arxiu ja es troba pujat al servidor d'antivirus centrals. <br>Valor per defecte: true\r\n*.antivirus.serverIp                   | Sí       | IP del Host on es troba el Servidor d'antivirus Centrals.<br>  antivirus.gencat.intranet per entorns productius <br> preproduccio.antivirus.gencat.intranet per entorns preproductius i d'altres\r\n*.antivirus.serverPort                 | Sí       | Port del Host on es troba el Servidor d'antivirus Centrals.<br> Valor per defecte: 1344\r\n*.antivirus.numDayDBExpirationWarning  | Sí       | Número de dies que han de passar per que una definició de virus de la base de dades d'antivirus centrals es consideri caducada. <br>Valor per defecte: 15\r\n\r\n## Utilització del Mòdul\r\n\r\nPer a utilizar aquest mòdul s'ha de demanar la llibreria sym-7.5.jar enviant un correu a la bústia canigó <oficina-tecnica.canigo.ctti@gencat.cat>\r\n\r\n### Exemple d'ús\r\n\r\n**AntivirusServiceController.java**\r\n\r\nEndpoint de l'aplicació que publica el servei de l'antivirus\r\n\r\n```java\r\n\timport java.io.InputStream;\r\n\r\n\timport org.springframework.beans.factory.annotation.Autowired;\r\n\timport org.springframework.http.MediaType;\r\n\timport org.springframework.web.bind.annotation.PostMapping;\r\n\timport org.springframework.web.bind.annotation.RequestMapping;\r\n\timport org.springframework.web.bind.annotation.RestController;\r\n\r\n\timport com.sun.jersey.core.header.FormDataContentDisposition;\r\n\timport com.sun.jersey.multipart.FormDataParam;\r\n\r\n\timport cat.gencat.plantilla32.service.AntivirusService;\r\n\r\n\t@RestController\r\n\t@RequestMapping(\"/antivirus\")\r\n\tpublic class AntivirusServiceController {\r\n\r\n\t\t@Autowired\r\n\t\tAntivirusService antivirusService;\r\n\r\n\t\t@PostMapping(consumes = {MediaType.MULTIPART_FORM_DATA_VALUE}, \r\n\t\t\t\tproduces = { MediaType.APPLICATION_JSON_VALUE })\r\n\t\tpublic String scan(@FormDataParam(\"file\") InputStream inputStream, \r\n\t\t\t\t\t\t\t@FormDataParam(\"file\") FormDataContentDisposition fileDetail) {\r\n\t\t\t\r\n\t\t\treturn antivirusService.scan(inputStream);\r\n\t\t}\r\n\t}\r\n```\r\n\r\n**AntivirusService.java**\r\n\r\nClasse java on es realitza la lògica de la operació i es crida al mòdul de l'antivirus\r\n\r\n```java\r\n\timport java.io.ByteArrayOutputStream;\r\n\timport java.io.IOException;\r\n\timport java.io.InputStream;\r\n\r\n\timport org.h2.util.IOUtils;\r\n\timport org.slf4j.Logger;\r\n\timport org.slf4j.LoggerFactory;\r\n\timport org.springframework.beans.factory.annotation.Autowired;\r\n\timport org.springframework.context.annotation.Lazy;\r\n\timport org.springframework.stereotype.Service;\r\n\r\n\timport cat.gencat.ctti.canigo.arch.integration.antivirus.Antivirus;\r\n\timport cat.gencat.ctti.canigo.arch.integration.antivirus.ResultatEscaneig;\r\n\timport cat.gencat.ctti.canigo.arch.integration.antivirus.beans.InfectionInfo;\r\n\timport cat.gencat.ctti.canigo.arch.integration.antivirus.exceptions.AntivirusException;\r\n\r\n\t@Service(\"antivirusService\")\r\n\t@Lazy\r\n\tpublic class AntivirusService {\r\n\r\n\t\t@Autowired\r\n\t\tprivate Antivirus service;\r\n\t\t\r\n\t\tprivate static final Logger log = LoggerFactory.getLogger(AntivirusService.class);\r\n\r\n\r\n\t\t /**\r\n\t\t * Escaneig de l'arxiu pujat al servidor\r\n\t\t *\r\n\t\t */\r\n\t\t\tpublic String scan(InputStream file){\r\n\t\t\t\tString resultat = null;\r\n\t\t\t\tString message = null;\r\n\t\t\t\tlog.info(\"AntivirusAction [scan] - Inici\");\r\n\t\t\t\tResultatEscaneig res = null;\r\n\t\t\t\ttry {\r\n\t\t\t\r\n\t\t\t\t\tByteArrayOutputStream out = new ByteArrayOutputStream();\r\n\t\t\t\t\t\r\n\t\t\t\t\tIOUtils.copy(file, out);\r\n\t\t\t\t\t\r\n\t\t\t\t\tres = service.scan(out.toByteArray());\r\n\t\t\t\r\n\t\t\t\t\tif (res != null) {\r\n\t\t\t\t\t\tswitch (res.getEstat()) {\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\tlog.info(\"AntivirusAction [scan] - arxiu sense Virus\");\r\n\t\t\t\t\t\t\tresultat = \"Arxiu sense Virus\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase -1:\r\n\t\t\t\t\t\t\tlog.info(\"AntivirusAction [scan] - arxiu amb Virus!\");\r\n\t\t\t\t\t\t\tStringBuffer sb = new StringBuffer();\r\n\t\t\t\t\t\t\tsb.append(\"Arxiu amb Virus!\");\r\n\t\t\t\t\t\t\tif(res.getArrayVirus()!=null){\r\n\t\t\t\t\t\t\t\tfor(InfectionInfo i : res.getArrayVirus()){\r\n\t\t\t\t\t\t\t\t\tsb.append(i.getFileName() + \" - \" + i.getViolationName() + \"; \");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tresultat = sb.toString();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tlog.info(\"AntivirusAction [scan] - Warning\");\r\n\t\t\t\t\t\t\tresultat = res.getMissatge();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tlog.info(\"AntivirusAction [scan] - Error en el procés d'escaneig\");\r\n\t\t\t\t\t\t\tresultat = \"S'ha produit un error\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t\tmessage = \"Resultat del escaneig: \" + resultat;\r\n\t\t\t\r\n\t\t\t\t\tlog.info(\"AntivirusAction [scan] - Final\");\r\n\t\t\t\t} catch (AntivirusException ae) {\r\n\t\t\t\t\tlog.error(\"AntivirusException - Antivirus (\"+ service.getClass()+\"): \" + service\r\n\t\t\t\t\t\t\t+ \" \" + ae.getStackTrace());\r\n\t\t\t\t\tmessage = \"Resultat del escaneig(Error): \" + ae.getMessage();\r\n\t\t\t\t} catch (IOException e) {\r\n\t\t\t\t\tlog.error(\"AntivirusException - Antivirus (\"+ service.getClass()+\"): \" + service\r\n\t\t\t\t\t\t\t+ \" \" + e.getStackTrace());\r\n\t\t\t\t\tmessage = \"Resultat del escaneig(Error): \" + e.getMessage();\r\n\t\t\t\t} \r\n\t\t\t\t\r\n\t\t\t\treturn message;\r\n\t\t\t}\r\n\t}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hbnRpdmlydXM="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hdmlzb3MtaS1hbGVydGVz":{"date":1426853089000,"title":"Avisos i  alertes","description":"Serveisd'enviament de SMS i CORREU del CTTI a través del servei AVISALERT de la PICA.","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-integracio/modul-avisos-i-alertes","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector és el de proporcionar accés als serveis d'enviament de SMS i CORREU del CTTI a través del servei AVISALERT de la PICA.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduïda al connector de la Pica que simplifica l'utilització dels diferents serveis d'enviament de SMS i MAIL oferts per la generalitat.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector PICA-AVISALERT es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet utilitzar les diferents modalitats del servei AVISALERT en les seves modalitats asíncrones i síncrones, a través de les modalitats de sevei següents:\r\n\r\nServeis Síncrons\r\n\r\n* AVISALERT_SMS\r\n* AVISALERT_CORREU-E\r\n\r\nServeis Asíncrons\r\n\r\n* AVISALERT_SMS\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquest component a la següent url:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.avisosalertes.pica/\r\n\r\n#### Requeriments\r\n\r\nEl connector AVISALERT és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector AVISALERT funcioni correctament sobre l'aplicació que l'utilitzi, s'ha de tenir configurat el servei [connector genèric de la PICA](/canigo-documentacio-versions-3x-integracio/modul-pica/) 1.2.0.\r\n\r\n### Configuració\r\n\r\nPer configurar el mòdul d'integració PICA-AVISALERT és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-AVISALERT amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml:\r\n\r\n```\r\n<canigo.integration.avisosalertes.pica.version>[1.2.0,1.3.0)</canigo.integration.avisosalertes.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-AVISALERT -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.integration.avisosalertes.pica</artifactId>\r\n\t<version><version>${canigo.integration.avisosalertes.pica.version}</version></version>\r\n</dependency>\r\n\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/avisalert.properties amb el següent contingut:\r\n\r\n```\r\n*.avisosalertes.pica.finalitat=[finalitat]\r\n*.avisosalertes.pica.urlPica=http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.avisosalertes.pica.nifEmisor=[nifEmisor]\r\n*.avisosalertes.pica.nomEmisor=[nomEmisor]\r\n*.avisosalertes.nomFuncionari=[nomFuncionari]\r\n*.avisosalertes.nifFuncionari=[nifFuncionari]\r\n*.avisosalertes.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-avisalert.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n### Utilització del Connector\r\n\r\n#### Exemple d'utilització d'un Servei Síncron\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate AvisosAlertesConnectorImpl avisalertService;\r\n```\r\n\r\n2.- Escollir una modalitat de servei síncrona i cridar-la amb els paràmetres que necessiti. En aquest cas es mostra un exemple amb la modalitat d'enviament de correu electrònic:\r\n\r\n```java\r\nString from = \"from@cscanigo.com\";\r\nString to = \"to@cscanigo.com\";\r\nString title = \"cscanigo\";\r\nString message = \"Això és una prova\";\r\nString arxiu = null;\r\nString resposta = avisalertService.avisAlertCorreuESincron(from, to, title, message, arxiu);\r\n```\r\n\r\nL'estat de finalització dependrà del codi retornat:\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA **Guia d'us del servei Avisos i Alertes v2.2.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n\r\n#### Exemple d'utilització d'un Servei Asíncron\r\n\r\n1.- La modalitat d'enviament de SMS, AVISALERT_SMS, suporta l'enviament síncron i asíncron, l'exemple que segueix utilitzarà la seva variant asíncrona. Per poder utilitzar aquesta modalitat de consum el connector de Canigó 3 preveu tres mètodes diferents:\r\n\r\n```java\r\npublic DataResponse avisAlertSMSsimpleASincron(String serviceNumber, String mobile, String message) throws AvisosAlertesException;\r\npublic EstatAsincron getEstatAvisAlertSMSASincron(CridaAsincronaResponseDocument response) throws AvisosAlertesException;\r\npublic String getDadesAvisAlertSMSASincron(IPICAServiceAsincron servei) throws AvisosAlertesException;\r\n```\r\n\r\n2.- El primer serveix per carregar les dades de la consulta al servei i fer la primera petició. Donat que és un servei asíncron retorna un objecte amb l'estat actual de la petició i el temps estimat de finalització d'aquesta.\r\n\r\nIgual que en les peticions síncrones, s'inicialitza el bean del servei del connector:\r\n\r\n```java\r\n@Autowired\r\nprivate AvisosAlertesConnectorImpl avisosAlertesConnector;\r\n```\r\n\r\nEs crida al servei amb les dades pertinents;\r\n\r\n```java\r\nString mobile = MOV_NUMBER;\r\nString serviceNumber = \"6666\";\r\nString message = \"Test\";\r\n\t\t\t\r\nDataResponse resposta = avisosAlertesConnector.avisAlertSMSsimpleASincron(serviceNumber, mobile, message);\r\n```\r\n\r\n3.- El segon serveix per anar comprovant l'estat de la consulta de forma periòdica. Igual que el primer mètode retorna un objecte amb l'estat actual de la petició i el temps estimat per la seva resolució.\r\n\r\n```java\r\nEstatAsincron estat = avisosAlertesConnector.getEstatAvisAlertSMSASincron(resposta.getResponse());\r\n```\r\n\r\n4.- Finalment el tercer mètode recupera el resultat de la petició una vegada confirmat que la petició ha finalitzat.\r\n\r\n```java\r\nString dades = avisosAlertesConnector.getDadesAvisAlertSMSASincron(resposta.getServei());\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA **Guia d'us del servei Avisos i Alertes v2.2.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hdmlzb3MtaS1hbGVydGVz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kbmk=":{"date":1426783321000,"title":"DNI","description":"Servei de verificació i consulta de DNI de la DGP.","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-integracio/modul-dni","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector, és el de proporcionar un punt d'accés utilitzant la plataforma PICA cap servei de verificació i consulta de DNI de la DGP.\r\n\r\n## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduida al connector de la Pica que simplifica l'utilització del servei de consulta i verificació de DNI's ofert per la generalitat.\r\n\r\n## Context i Escenaris d'ús\r\n\r\nEl connector PICA-DNI es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n## A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents funcionalitats referents a les següent operacions amb un DNI:\r\n\r\n**Funcionalitats de Consulta**\r\n\r\n* Consulta Bàsica: Funcionalitat que permet la consulta de les dades d'un DNI subministrant un conjunt mínim de dades.\r\n* Consulta Estesa: Funcionalitat que permet la consulta de les dades d'un DNI donant la possibilitat d'escollir d'entre un conjunt més ampli de dades d'entrada.\r\n\r\n**Funcionalitats de Verificació**\r\n\r\n* **Verificació Bàsica:** Funcionalitat que permet la verificació de les dades d'un DNI subministrant un conjunt mínim de dades.\r\n* **Verificació Estesa:** Funcionalitat que permet la verificació de les dades d'un DNI donant la possibilitat d'escollir d'entre un conjunt més ampli de dades d'entrada.\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent aquests components a les següents url's:\r\n\r\nCodi Font : https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.dni.pica/\r\n\r\n### Requeriments\r\n\r\nEl connector DNI és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector DNI funcioni correctament sobre l'aplicació que l'utilitzi, s'ha de tenir configurat el servei [connector genèric de la PICA](/canigo-documentacio-versions-3x-integracio/modul-pica/) 1.2.0.\r\n\r\n## Configuració\r\n\r\nPer configurar el mòdul d'integració PICA-DNI és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-DNI amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml;\r\n\r\n```\r\n<canigo.integration.dni.pica.version>[1.3.0,1.4.0)</canigo.integration.dni.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-DNI -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.dni.pica</artifactId>\r\n    <version>${canigo.integration.dni.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/dni.properties amb el següent contingut:\r\n\r\n```\r\n*.dni.finalitat=[finalitat]\r\n*.dni.urlPica=[urlPica]\r\n*.dni.nifEmisor=[nifEmisor]\r\n*.dni.nomEmisor=[nomEmisor]\r\n*.dni.nomFuncionari=[nomFuncionari]\r\n*.dni.nifFuncionari=[nifFuncionari]\r\n*.dni.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-dni.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n## Utilització del Connector\r\n\r\n### Exemple d'utilització Consulta de DNI\r\n\r\nRecuperar el bean del servei de DNI des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate DniConnectorImpl dniConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nDadesConsultaDni resposta = dniConnector.dniConsultaBasica(numero_document, tipus_document, cognom1, anyNaixement);\r\n```\r\n\r\non, **numero_document** correspon al valor del número del document utilitzat i **tipus_document** correspon al tipus de document que es vol subministrar (Constants.DNI, Constants.NIE, Constants.NIF).\r\nÉs obligatori informar el **cognom1**(primer Cognom) o bé l'**anyNaixement**\r\n\r\nEn cas que es vulgui sobreescriure les dades del funcionari especificats en el fitxer dni.properties, és possible fer-ho abans de fer la crida al servei:\r\n\r\n```java\r\nFuncionari funcionari = new Funcionari();\r\nfuncionari.setNombreFuncionario(\"Nom Cognoms Funcionari\");\r\nfuncionari.setNifFuncionario(\"NIF\");\r\nfuncionari.setEmailFuncionario(\"mail\");\r\n\r\ndniConnector.setFuncionari(funcionari);\r\n\r\nPer consultar l'estat de la resposta;\r\n\r\nEstatResultat estat = resposta.getEstat();\r\n```\r\n\r\n* En cas de que les dades no corresponguin amb un DNI, típicament es retornaran aquestes dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TITULAR NO IDENTIFICADO\", estat.getDescripcio());\r\nAssert.assertEquals(\"0233\", estat.getCodiEstat());\r\n```\r\n\r\n* En cas de que les dades si corresponguin a un DNI, típicament es retornaran les següents dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TRAMITADA\", estat.getDescripcio());\r\nAssert.assertEquals(\"0003\", estat.getCodiEstat());\r\n```\r\n\r\nLes dades associades a la consulta d'un DNI es poden recuperar amb:\r\n\r\n```java\r\nresposta.getTitular();\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn consultar el document de la PICA Guia d'us del servei de DNI v.1.9.pdf disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n\r\n### Exemple d'utilització Verificació DNI\r\n\r\nRecuperar el bean del servei de DNI des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate DniConnectorImpl dniConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nEstatResultat resposta = dniConnector.dniVerificacioBasica(numero_document, tipus_document, nom, cognom1, cognom2, sexe);\r\n```\r\n\r\non, **numero_document** correspon al valor del número del document utilitzat;<br>\r\n**tipus_document** correspon al tipus de document que es vol subministrar (Constants.DNI, Constants.NIE, Constants.NIF);<br>\r\n**nom** nom del titular del DNI;<br>\r\n**cognom1** primer cognom del titular del DNI;<br>\r\n**cognom2** segon cognom del titular del DNI;<br>\r\n**sexe** sexe del titular del DNI (Constants.MASCULI o Constants.FEMENI)\r\n\r\n* En cas de que les dades no corresponguin amb un DNI, típicament es retornaran aquestes dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TITULAR NO IDENTIFICADO\", resposta.getDescripcio());\r\nAssert.assertEquals(\"0233\", resposta.getCodiEstat());\r\n```\r\n\r\n* En cas de que les dades si corresponguin a un DNI, típicament es retornaran les següents dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TRAMITADA\", estat.getDescripcio());\r\nAssert.assertEquals(\"0003\", estat.getCodiEstat());\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn consultar el document de la PICA **Guia d'us del servei de DNI v.1.9.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kbmk="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0td3M=":{"date":1426778360000,"title":"Enotum_WS","description":"Notificacions electròniques Web Service.","sections":"Canigó. Documentació versió 3.x","weight":6,"path":"/canigo-documentacio-versions-3x-integracio/modul-enotum-ws","content":"## Propòsit\r\n\r\nEl propòsit d'aquesta documentació és donar a conèixer el mòdul de WebServices de Canigó3 per Enotum, la seva configuració i el seu ús per part de les aplicacions.\r\n\r\n## Descripció Detallada\r\n\r\nEl Servei de Enotum existeixen dues modalitats de consum especials:\r\n\r\n* NT_ENTREGAR_CANVI_ESTAT_NOTIFICACIO: Permet al sistema que va sol?licitar la creació de la notificació telemàtica ser informat de les transicions automàtiques d'estat. E-Notum gestiona el cicle de vida dels estats associats a les notificacions telemàtiques. És responsable de realitzar certs canvis d'estat sobre la base de timeouts. Quan es produeixen aquests canvis d'estat, és necessari notificar-los al sistema que va sol?licitar la creació de la notificació.\r\n* NT_ERROR_ENVIAMENT_NOTIFICACIO: Aquesta modalitat de consum permet el lliurament des de eNotum als BO dels errors que s'ha produït en el tractament de les trameses de notificacions enviades pels backoffice durant el processament de les notificacions.\r\n\r\nAixí doncs, PICA reb les notificacions de l'emissor amb els diferents errors que s'han produït i els envia al BO corresponent.\r\n\r\nAmbdues necessiten la publicació d'un WebService per part del consumidor del Servei (BO).\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer instal.lar el WebService de notificacions electròniques s'han d'afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.notificacions.electroniques.version.ws>[2.2.0,2.3.0)</canigo.integration.notificacions.electroniques.version.ws>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.notificacions.electroniques.ws</artifactId>\r\n          <version>${canigo.integration.notificacions.electroniques.version.ws}</version>\r\n</dependency>\r\n```\r\n\r\ni en l'apartat de repositoris\r\n\r\n```\r\n<repository>\r\n      <id>org.springframework.security.taglibs.facelets</id>\r\n      <url>http://spring-security-facelets-taglib.googlecode.com/svn/repo/</url>\r\n</repository>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del WS es porta a terme a través de l'arxiu \"app-custom-enotumWS.xml\". Es recomana que es posi en src/main/resources/spring/app-custom-enotumWS.xml.\r\n\r\nEl contingut d'aquest arxiu és el següent:\r\n\r\n```\r\n<bean id=\"notificacionsElectroniquesAppService\" class=\"[Classe on es troba la implementació dels mètodes exposats al WS]\"/>\r\n\r\n    <bean id=\"notificacionsElectroniquesServiceEndpoint\" class=\"cat.gencat.ctti.canigo.arch.integration.notificacionselectroniques.endpoint.NotificacionsElectroniquesEndpoint\">\r\n        <property name=\"NotificacionsElectroniquesService\" ref=\"notificacionsElectroniquesAppService\"/>\r\n    </bean>\r\n\r\n\r\n    <bean id=\"eNOTUMService\" class=\"org.springframework.ws.wsdl.wsdl11.DefaultWsdl11Definition\"\r\n          p:portTypeName=\"eNOTUMService\" //<--Nom del Servei Web (configurable)\r\n          p:locationUri=\"/ws/services/ENotumService/\" //<--Path del Servei Web (configurable)\r\n          p:targetNamespace=\"http://gencat.net/scsp/esquemes/productes/nt/services\">\r\n          <property name=\"SchemaCollection\" ref=\"schemaCollection\"/>\r\n          <property name=\"createSoap11Binding\" value=\"false\"/>\r\n          <property name=\"createSoap12Binding\" value=\"true\"/>\r\n    </bean>\r\n\r\n     <bean id=\"schemaCollection\" class=\"org.springframework.xml.xsd.commons.CommonsXsdSchemaCollection\">\r\n        <property name=\"xsds\">\r\n            <list>\r\n                <value>classpath:cat/gencat/ctti/canigo/arch/support/notificacions/electroniques/config/xsd/NTServices.xsd</value>\r\n               </list>\r\n        </property>\r\n        <property name=\"inline\" value=\"true\"/>\r\n    </bean>\r\n\r\n    <bean id=\"messageFactory\" class=\"org.springframework.ws.soap.saaj.SaajSoapMessageFactory\">\r\n          <property name=\"soapVersion\" value=\"SOAP_12\" />\r\n      </bean>\r\n\r\n     <bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\"\r\n          p:contextPath=\"net.gencat.scsp.esquemes.productes.nt:net.gencat.scsp.esquemes.productes.nt.notificacions:net.gencat.scsp.esquemes.productes.nt.services\"/>\r\n\r\n    <bean id=\"marshallingPayloadMethodProcessor\" class=\"org.springframework.ws.server.endpoint.adapter.method.MarshallingPayloadMethodProcessor\">\r\n        <constructor-arg ref=\"marshaller\"/>\r\n    </bean>\r\n\r\n    <bean id=\"defaultMethodEndpointAdapter\" class=\"org.springframework.ws.server.endpoint.adapter.DefaultMethodEndpointAdapter\">\r\n        <property name=\"methodArgumentResolvers\">\r\n            <list>\r\n                <ref bean=\"marshallingPayloadMethodProcessor\"/>\r\n            </list>\r\n        </property>\r\n        <property name=\"methodReturnValueHandlers\">\r\n            <list>\r\n                <ref bean=\"marshallingPayloadMethodProcessor\"/>\r\n            </list>\r\n        </property>\r\n    </bean>\r\n```\r\n\r\n## Utilització del Web Service\r\n\r\nPer poder utilitzar el WebService de Enotum en una aplicació Canigó3 s'han de seguir els següents passos;\r\n\r\n1.- Modificar el web.xml de l'aplicació per afegir el servlet següent:\r\n\r\n```\r\n<!-- Web Service Enotum -->\r\n    <servlet>\r\n        <servlet-name>NT_WS</servlet-name>\r\n        <servlet-class>org.springframework.ws.transport.http.MessageDispatcherServlet</servlet-class>\r\n        <init-param>\r\n            <param-name>contextConfigLocation</param-name>\r\n            <param-value>classpath:spring/app-custom-enotumWS.xml</param-value>\r\n        </init-param>\r\n        <init-param>\r\n            <param-name>transformWsdlLocations</param-name>\r\n            <param-value>true</param-value>\r\n        </init-param>\r\n    </servlet>\r\n\r\n    <servlet-mapping>\r\n        <servlet-name>NT_WS</servlet-name>\r\n        <url-pattern>/ws/*</url-pattern>\r\n    </servlet-mapping>\r\n```\r\n\r\nPosar immediatament a sobre de:\r\n\r\n```\r\n<!--\r\nSession timeout: 30 minutes\r\n-->\r\n <session-config>\r\n  <session-timeout>30</session-timeout>\r\n </session-config>\r\n```\r\n\r\n2.- Configurar els beans **notificacionsElectroniquesAppService** i **eNOTUMService** de l'arxiu src/main/resources/spring/app-custom-enotumWS.xml de la següent forma:\r\n\r\n* notificacionsElectroniquesAppService: Nom de la classe que implementaran les accions a portar a terme a partir de la resposta rebuda pel servei. Un exemple:\r\n\r\n```java\r\nimport net.gencat.scsp.esquemes.productes.nt.notificacions.NotificacioCanviEstat;\r\nimport net.gencat.scsp.esquemes.productes.nt.notificacions.NotificacioCanviEstat.Notificacio;\r\nimport net.gencat.scsp.esquemes.productes.nt.notificacions.NotificacioError;\r\nimport org.apache.commons.logging.Log;\r\nimport org.apache.commons.logging.LogFactory;\r\nimport cat.gencat.ctti.canigo.arch.integration.notificacionselectroniques.NotificacionsElectroniquesService;\r\nimport cat.gencat.ctti.canigo.arch.integration.notificacionselectroniques.exepcions.NotificacionsElectroniquesModuleExcepcion;\r\n\r\n\r\npublic class NotificacionsElectroniquesServiceBasicImpl implements NotificacionsElectroniquesService {\r\n\r\n    private static final Log LOGGER = LogFactory.getLog(NotificacionsElectroniquesServiceBasicImpl.class);\r\n    public void entregarCanviEstatNotificacio(NotificacioCanviEstat notificacioCanviEstat) throws NotificacionsElectroniquesModuleExcepcion {\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(\"Recepció per part del sistema requeridor de notificacions telemàtiques dels canvis d'estat automàtics de la NT.\");\r\n        }\r\n\r\n        if (notificacioCanviEstat != null && notificacioCanviEstat.getNotificacio() != null) {\r\n            if (LOGGER.isDebugEnabled()){\r\n                for (Notificacio notificacio : notificacioCanviEstat.getNotificacio()) {\r\n                    LOGGER.debug(\"Notificació: \" + notificacio.getIdNotificacio() + \". Estat :\" + notificacio.getDescEstat() + \"(\" + notificacio.getCodiEstat()+ \")\");\r\n                }\r\n            }\r\n        } else {\r\n            LOGGER.error(\"Sense notificacions\");\r\n            throw new NotificacionsElectroniquesModuleExcepcion(\"Sense notificacions\");\r\n        }\r\n    }\r\n\r\n    public void errorEnviamentNotificacio(NotificacioError notificacioError) throws NotificacionsElectroniquesModuleExcepcion {\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(\"Recepció per part del sistema requeridor de notificacions telemàtiques dels errors durant la creació de la NT.\");\r\n        }\r\n\r\n        if (notificacioError != null) {\r\n            if (LOGGER.isDebugEnabled()){\r\n                LOGGER.debug(\"Error en la recepció de la notificació: \" + notificacioError.getIdNotificacio() + \". Codi error: \" + notificacioError.getCodiError());\r\n            }\r\n        } else {\r\n            LOGGER.error(\"Sense error a la notificació\");\r\n            throw new NotificacionsElectroniquesModuleExcepcion(\"Sense error a la notificació\");\r\n        }\r\n    }\r\n}\r\n```\r\n* eNOTUMService: Nom del Bean on es configura el nom del WebService i la ruta d'accés a ell. Un exemple:\r\n\r\n```\r\n<bean id=\"eNOTUMService\" class=\"org.springframework.ws.wsdl.wsdl11.DefaultWsdl11Definition\"\r\n         p:portTypeName=\"eNOTUMService\" //<--Nom del Servei Web (configurable)\r\n         p:locationUri=\"/ws/services/ENotumService/\" //<--Path del Servei Web (configurable)\r\n         p:targetNamespace=\"http://gencat.net/scsp/esquemes/productes/nt/services\">\r\n         <property name=\"SchemaCollection\" ref=\"schemaCollection\"/>\r\n         <property name=\"createSoap11Binding\" value=\"false\"/>\r\n         <property name=\"createSoap12Binding\" value=\"true\"/>\r\n</bean>\r\n```\r\n\r\nEn el cas de l'exemple, el WS es podrà accedir en http://(Host)/(NomApp)/ws/services/ENotumService/eNOTUMService.wsdl\r\n\r\n**IMPORTANT:** Tindre en compte que la url del Servei Web ha de ser coneguda prèviament per Enotum. Normalment s'informa en el document d'alta que la PICA subministra per consumir els serveis d'ENOTUM.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0td3M="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kb2N1bWVudHVt":{"date":1426765232000,"title":"Documentum","description":"Accés al gestor documental corporatiu del CTTI.","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-integracio/modul-documentum","content":"## Propòsit\r\n\r\nEl propósit del connector és proporcionar una interfície Java per accedir a Documentum. Permetent emmagatzemar i recuperar documents a més d'altres operacions relacionades com crear carpetes i associar propietats.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació del DFC\r\n\r\nPrevi a la utilització del servei cal instal.lar a la màquina de desenvolupament/servidor la DFC's de la versió de Documentum que es farà servir :\r\n\r\n* Documentum 5.3 \r\n* Documentum 6.5\r\n* Documentum 7.1 \r\n\r\nEn cas de no comptar amb aquests instal·lable, es pot sol·licitar a la bústia canigó <oficina-tecnica.canigo.ctti@gencat.cat>\r\n\r\n\r\n\r\nEls passos a seguir en l'instal.lació són els següents (similars a les 3 versions):\r\n\r\n![Instal.lació documentum pas 1](/related/canigo/documentacio/modul-documentum/image005.jpg \"Instal.lació documentum pas 1\")\r\n\r\n![Instal.lació documentum pas 2](/related/canigo/documentacio/modul-documentum/image006.jpg \"Instal.lació documentum pas 2\")\r\n\r\n![Instal.lació documentum pas 3](/related/canigo/documentacio/modul-documentum/image007.jpg \"Instal.lació documentum pas 3\")\r\n\r\n![Instal.lació documentum pas 4](/related/canigo/documentacio/modul-documentum/image008.jpg \"Instal.lació documentum pas 4\")\r\n\r\nAquí indicarem el host i el port del docBroker que conté el magatzem de claus.\r\n\r\n![Instal.lació documentum pas 5](/related/canigo/documentacio/modul-documentum/image009.jpg \"Instal.lació documentum pas 5\")\r\n\r\n![Instal.lació documentum pas 6](/related/canigo/documentacio/modul-documentum/image010.jpg \"Instal.lació documentum pas 6\")\r\n\r\n![Instal.lació documentum pas 7](/related/canigo/documentacio/modul-documentum/image011.jpg \"Instal.lació documentum pas 7\")\r\n\r\n![Instal.lació documentum pas 8](/related/canigo/documentacio/modul-documentum/image012.jpg \"Instal.lació documentum pas 8\")\r\n\r\n![Instal.lació documentum pas 9](/related/canigo/documentacio/modul-documentum/image013.jpg \"Instal.lació documentum pas 9\")\r\n\r\n![Instal.lació documentum pas 10](/related/canigo/documentacio/modul-documentum/image014.jpg \"Instal.lació documentum pas 10\")\r\n\r\nCom a resultat de la instalació es generarà un arxiu amb la configuració d'accés a documentum.\r\n\r\nEn el cas de Documentum 5.3,  aquest es generarà per defecte a **C:\\WINDOWS\\dmcl.ini** i tindrà el format següent:\r\n```\r\n[DOCBROKER_PRIMARY]\r\nhost =es-hg2r02j\r\nport =1489\r\n\r\n[DMAPI_CONFIGURATION]\r\ncache_queries = T\r\ntoken_storage_enabled=F\r\ntoken_storage_path=D:\\Documentum\\apptoken\r\n```\r\n\r\nEn el cas de Documentum 6.5 i 7.1, aquest es generarà per defecte a **C:\\Documentum\\config\\dfc.properties** i tindrà el format següent:\r\n```\r\ndfc.data.dir=C\\:/Documentum\r\ndfc.registry.mode=windows\r\ndfc.search.ecis.enable=false\r\ndfc.search.ecis.host=\r\ndfc.search.ecis.port=\r\ndfc.tokenstorage.dir=C\\:/Documentum/apptoken\r\ndfc.tokenstorage.enable=false\r\ndfc.docbroker.host[0]=nomHostDocumentum\r\ndfc.docbroker.port[0]=PortHostDocumentum\r\ndfc.globalregistry.repository=NomRepositoriClaus\r\ndfc.globalregistry.username=usernameRepositoriClaus\r\ndfc.globalregistry.password=passRepositoriClaus\r\n```\r\n\r\n### Instal·lació del connector\r\n\r\n\r\nPer tal d'instal- lar el mòdul de Documentum es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\nPer a la versió 5.3 de Documentum:\r\n\r\n```\r\n<canigo.integration.documentum.version>[1.2.0,1.3.0)</canigo.integration.documentum.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.documentum</artifactId>\r\n          <version>${canigo.integration.documentum.version}</version>\r\n</dependency>\r\n```\r\n\r\nPer a la versió 6.5\r\n\r\n```\r\n<canigo.integration.documentum.version>[2.2.0,2.3.0)</canigo.integration.documentum.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.documentum</artifactId>\r\n          <version>${canigo.integration.documentum.version}</version>\r\n</dependency>\r\n```\r\n\r\nPer a la versió 7.1\r\n\r\n```\r\n<canigo.integration.documentum.version>[3.1.0,3.2.0)</canigo.integration.documentum.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.documentum</artifactId>\r\n          <version>${canigo.integration.documentum.version}</version>\r\n</dependency>\r\n```\r\n\r\n#### Dependències amb llibreries del DFC instal·lat\r\nEls connectors tenen dependències amb llibreries de la versió del DFC instal·lat. Aquestes llibreries s'inclouen amb la instal·lació del DFC, a la carpeta **C:\\Program Files\\Documentum\\Shared\\**. Caldrà afegir-les al repositori .m2 local per tal que Maven les resolgui.\r\n\r\nPer a la versió de DFC 7.1 , serà necessari instal·lar les següents llibreries :\r\n```\r\nmvn install:install-file -Dfile=\"dfc.jar\" -DgroupId=dfc -DartifactId=dfc -Dversion=7.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"certj.jar\" -DgroupId=certj -DartifactId=certj -Dversion=5.2 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"configservice-api.jar\" -DgroupId=configservice -DartifactId=configservice-api -Dversion=7.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"configservice-impl.jar\" -DgroupId=configservice -DartifactId=configservice-impl -Dversion=7.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"jcmFIPS.jar\" -DgroupId=jcmFIPS -DartifactId=jcmFIPS -Dversion=6.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"jcifs-krb5-1.3.1.jar\" -DgroupId=jcifs-krb5 -DartifactId=jcifs-krb5 -Dversion=1.3.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"cryptojce.jar\" -DgroupId=cryptojce -DartifactId=cryptojce -Dversion=6.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"cryptojcommon.jar\" -DgroupId=cryptojcommon -DartifactId=cryptojcommon -Dversion=6.1 -Dpackaging=jar\r\n```\r\n\r\n\r\n\r\n\r\n### Configuració del connector\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\n#### Propietats del connector\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/documentum.properties\r\n\r\nPropietat                   | Requerit | Descripció\r\n--------------------------- | -------- | ----------\r\n*.documentum.user           | Sí       | Usuari de Documentum\r\n*.documentum.password       | Sí       | Password de Documentum\r\n*.documentum.docBase        | Sí       | Doc base\r\n*.documentum.dir            | Sí       | Directori de Documentum\r\n*.documentum.pathDirectori  | No       | Path directori\r\n*.documentum.pathFitxer     | No       | Path arxiu\r\n*.documentum.nomFitxer      | No       | Nom d'arxiu\r\n*.documentum.extFitxer      | No       | Extensió d'arxiu\r\n*.documentum.pathFitxer2    | No       | Path segon arxiu\r\n*.documentum.nomFitxer2     | No       | Nom del segon arxiu\r\n*.documentum.extFitxer2     | No       | Extensió d'un segon arxiu\r\n*.documentum.pathFitxerOut  | No       | Directori de sortida\r\n*.documentum.dir3           | No       | Directori\r\n*.documentum.user2          | No       | Usuari 2\r\n*.documentum.password2      | No       | Password 2\r\n*.documentum.ACL            | No       | ACL\r\n*.documentum.ACLDomain      | No       | ACL Domain\r\n*.documentum.cicleVida      | No       | Cicle vida\r\n*.documentum.estat          | No       | Estat\r\n*.documentum.grup           | No       | Grup\r\n\r\n#### Propietats del dfc\r\nTambé caldrà incloure al CLASSPATH del projecte el dfc.properties generat durant la instla·lació del DFC. \r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/dfc.properties\r\n\r\n## Utilització del Mòdul\r\n\r\n### Exemple\r\n\r\nEn aquest exemple tenim dues classes, DocumentumServiceController que és l'endpoint del servei. I DocumentumAplicacioService, que és la classe Java on es realitza la lògica de la operació i es crida al mòdul de Documentum.\r\n\r\n**DocumentumServiceController.java**\r\n\r\n```java\r\n\timport org.springframework.beans.factory.annotation.Autowired;\r\n\timport org.springframework.http.MediaType;\r\n\timport org.springframework.web.bind.annotation.PostMapping;\r\n\timport org.springframework.web.bind.annotation.RequestMapping;\r\n\timport org.springframework.web.bind.annotation.RestController;\r\n\r\n\timport cat.gencat.plantilla32.service.DocumentumAplicacioService;\r\n\r\n\t@RestController\r\n\t@RequestMapping(\"/documentum\")\r\n\tpublic class DocumentumServiceController {\r\n\r\n\t\t@Autowired\r\n\t\tDocumentumAplicacioService documentumAplicacioService;\r\n\r\n\t\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\t\tpublic String testLogin() throws Exception {\r\n\t\t\treturn documentumAplicacioService.testLogin();\r\n\t\t}\r\n\t}\r\n```\r\n\r\n**DocumentumAplicacioService.java**\r\n\r\n```java\r\n\timport org.slf4j.Logger;\r\n\timport org.slf4j.LoggerFactory;\r\n\timport org.springframework.beans.factory.annotation.Autowired;\r\n\timport org.springframework.context.annotation.Lazy;\r\n\timport org.springframework.stereotype.Service;\r\n\r\n\timport cat.gencat.ctti.canigo.arch.integration.documentum.DocumentumConnector;\r\n\timport cat.gencat.ctti.canigo.arch.integration.documentum.DocumentumService;\r\n\timport cat.gencat.ctti.canigo.arch.integration.documentum.impl.DocumentumConfigurator;\r\n\r\n\t@Service(\"documentumAplicacioService\")\r\n\t@Lazy\r\n\tpublic class DocumentumAplicacioService {\r\n\r\n\t\tprivate static final Logger log = LoggerFactory.getLogger(DocumentumAplicacioService.class);\r\n\r\n\t\t@Autowired\r\n\t\tprivate DocumentumService service;\r\n\t\t\r\n\t\t@Autowired\r\n\t\tprivate DocumentumConnector documentum;\r\n\t\t\r\n\t\t@Autowired\r\n\t\tprivate DocumentumConfigurator configurator;\r\n\t\t\r\n\r\n\t\t/**\r\n\t\t * Comprovem que es pot fer login al sistema de Documentum\r\n\t\t */\r\n\t\tpublic String testLogin(){\r\n\t\t\t\r\n\t\t\tString message = null;\r\n\r\n\t\t\ttry{\r\n\t\t\t\tservice.login(configurator.getUser(), configurator.getPassword(),configurator.getDocBase(), this.documentum);\r\n\t\t\t}catch(Exception e){\r\n\t\t\t\tmessage = \"Error al realitzar login\";\r\n\t\t\t\tlog.error(e.getMessage(), e);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tmessage = \"Login correcte\";\r\n\t\t\t\r\n\t\t\treturn message;\r\n\t\t}\r\n\t\t\r\n\t}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kb2N1bWVudHVt"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wYWRybw==":{"date":1426843687000,"title":"Padró","description":"Serveis d'empadronament publicats de la plataforma PICA.","sections":"Canigó. Documentació versió 3.x","weight":9,"path":"/canigo-documentacio-versions-3x-integracio/modul-padro","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector, és el de proporcionar un punt d'accés utilitzant la plataforma PICA cap serveis d'empadronament publicats en aquesta plataforma.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduïda al connector de la Pica que simplifica l'utilització dels diferents serveis d'empadronament oferts per la generalitat.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector PICA-PADRO es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet utilitzar els diferents serveis del PADRO a través de l'accés a través d'una API de les següents modalitats de consum:\r\n\r\nServeis Síncrons\r\n\r\n* PADRO_COMPROVACIO_CONVIVENTS\r\n* PADRO_DADES_CONVIVENTS_PDF\r\n* PADRO_DADES_CONVIVENTS\r\n* PADRO_DADES_TITULAR\r\n* PADRO_DADES_TITULAR_INE\r\n* PADRO_DADES_TITULAR_PDF\r\n* PADRO_MUNICIPI_RESIDENCIA\r\n* PADRO_NUMERO_CONVIVENTS\r\n* PADRO_RESIDENT\r\n* PADRO_RESIDENT_MUNICIPI\r\n* PADRO_VALIDACIO_CONVIVENTS\r\n\r\nServeis Asíncrons\r\n\r\n* PADRO_TITULAR_CERCA\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent aquests components a la següent url:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.padro.pica/\r\n\r\n### Requeriments\r\n\r\nEl connector PADRO és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector PADRO funcioni correctament sobre l'aplicació que l'utilitzi, s'ha de tenir configurat el servei [connector genèric de la PICA](/canigo-documentacio-versions-3x-integracio/modul-pica/) 1.2.0.\r\n\r\n## Configuració\r\n\r\nPer configurar el mòdul d'integració PICA-PADRO és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-PADRO amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml:\r\n\r\n```\r\n<canigo.integration.padro.pica.version>[1.2.0,1.3.0)</canigo.integration.padro.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-PADRO -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.padro.pica</artifactId>\r\n    <version>${canigo.integration.padro.pica.version}</version>\r\n</dependency>\r\n\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/padro.properties amb el següent contingut:\r\n\r\n```\r\n*.padro.pica.finalitat=[finalitat]\r\n*.padro.pica.urlPica=http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.padro.pica.nifEmisor=[nifEmisor]\r\n*.padro.pica.nomEmisor=[nomEmisor]\r\n*.padro.pica.nomFuncionari=[nomFuncionari]\r\n*.padro.pica.nifFuncionari=[nifFuncionari]\r\n*.padro.pica.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors d finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-padro.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n## Utilització del Connector\r\n \r\n### Exemple d'utilització d'un Servei Síncron\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate PadroConnectorImpl padroService;\r\n```\r\n\r\n2.- Escollir una modalitat de servei síncrona i cridar-la amb els paràmetres que necessiti. En aquest cas es mostra un exemple amb la modalitat padroComprovacioConvivents:\r\n\r\n```java\r\nString numExpedient = \"CAT-1234567890ABCDEF\";\r\nint tipusDocumentacio = Constants.NIE;\r\nString documentacio = \"X02649265X\";\r\nString codMun = \"999\";\r\nint numConv = 99;\r\nString codProv = \"1\";\r\nint idesCat = 0;\r\n\r\nRespuestaComprobacionConvivientes resposta = padroService.padroComprovacioConvivents(\r\n    numExpedient,\r\n    tipusDocumentacio,\r\n    documentacio,\r\n    codMun,\r\n    codProv,\r\n    numConv,\r\n    idesCat\r\n);\r\n```\r\n\r\nL'estat de finalització dependrà del codi retornat:\r\n\r\n```java\r\nresposta.getCodigoResultado();\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA Guia d'us del servei de **PADRO v1.5x.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n\r\n### Exemple d'utilització d'un Servei Asíncron\r\n\r\n1.- L'únic servei asíncron que ofereix el servei de PADRO és el PADRO_TITULAR_CERCA. Per poder utilitzar aquesta modalitat de consum el connector de Canigó 3 preveu tres mètodes diferents:\r\n\r\n```java\r\npublic RespostaCercaTitular  padroTitularCerca(String numExpedient, int tipusDocumentacio, String documentacio) throws PadroException;\r\npublic EstatAsincron getEstatPadroTitularCerca(CridaAsincronaResponseDocument response) throws PadroException;\r\npublic RespostaCercaTitular getDadesPadroTitularCerca(IPICAServiceAsincron servei) throws PadroException;\r\n```\r\n\r\n2.- El primer serveix per carregar les dades de la consulta al servei i fer la primera petició. Donat que és un servei asíncron retorna un objecte amb l'estat actual de la petició i el temps estimat de finalització d'aquesta.\r\n\r\nIgual que en les peticions asíncrones s'inicialitza el bean del servei del connector;\r\n\r\n```java\r\n@Autowired\r\nprivate PadroConnectorImpl padroService;\r\n```\r\n\r\nEs crida al servei amb les dades pertinents:\r\n\r\n```java\r\nString numExpedient = \"123456\";\r\nint tipusDocumentacio = Constants.NIF;\r\nString documentacio = \"46583836G\";\r\n\r\nRespostaCercaTitular resposta = padroConnector.padroTitularCerca(numExpedient, tipusDocumentacio, documentacio);\r\n```\r\n\r\n3.- El segon serveix per anar comprovant l'estat de la consulta de forma periòdica. Igual que el primer mètode retorna un objecte amb l'estat actual de la petició i el temps estimat per la seva resolució.\r\n\r\n```java\r\nEstatAsincron estat = padroConnector.getEstatPadroTitularCerca(resposta.getResponse());\r\n```\r\n\r\n4.- Finalment el tercer mètode recupera el resultat de la peticó una vegada confirmat que la petició ha finalitzat.\r\n\r\n```java\r\nRespostaCercaTitular dades = padroConnector.getDadesPadroTitularCerca(resposta.getServei());\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA **Guia d'us del servei de PADRO v1.5x.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wYWRybw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1waWNh":{"date":1426250442000,"title":"PICA","description":"Interficie d'accés a la PICA (Plataforma d'Integració i Col.laboració Administrativa).","sections":"Canigó. Documentació versió 3.x","weight":10,"path":"/canigo-documentacio-versions-3x-integracio/modul-pica","content":"## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície java per accedir a la PICA (Plataforma d'Integració i Col.laboració Administrativa).\r\n\r\nEl connector amb la PICA disposa de dos tipus de comunicació, un d'ells a través de web service síncron, i l'altre, mitjançant web service asíncron.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de PICA es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.pica.version>[1.2.0,1.3.0)</canigo.integration.pica.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.pica</artifactId>\r\n          <version>${canigo.integration.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nSon necessaris els següents arxius de configuració:\r\n\r\n* pica.properties\r\n* pica.signature.properties\r\n* client.axis2.xml\r\n* modules.list\r\n* rampart-1.3.mar\r\n* certificats.jks\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/pica.properties\r\n\r\nPropietat                      | Requerit | Descripció\r\n-----------------------------  | -------- | ---------\r\n*.pica.modes.passwordType      | No       | Tipus de password per a la PICA. Per defecte: PasswordText\r\n*.pica.requirer.signatureFile  | Sí       | Arxiu de configuració de la seguretat\r\n*.pica.requirer.petitionerId   | Sí       | Identificador del solicitant\r\n*.pica.requirer.transmitionId  | Sí       | Identificador de la transmissió\r\n*.pica.requirer.petitionerName | Sí       | Nom del peticionari\r\n*.pica.requirer.user           | Sí       | Usuari que vol consumir un producte/modalitat de la PICA\r\n*.pica.requirer.password       | Sí       | Password de l'usuari que vol consumir un producte/modalitat de la PICA\r\n*.pica.axisdefinition.location | Sí       | Localització de l'arxiu d'axisdefinition\r\n*.pica.trustStore.location     | No       | Localització de l'arxiu de certificats per a la configuració SSL\r\n*.pica.trustStore.type         | No       | Tipus de keystore\r\n*.pica.trustStore.password     | No       | Password de la keystore\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/client.axis2.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/rampart-1.3.mar\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/modules.list\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/certificats.jks\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/pica.signature.properties\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/app-integration-custom.xml\r\n\r\n\r\n    Important\r\n\r\n    Si l'aplicació ha de ser desplegada en format empaquetat (.war, .ear) caldrà indicar la ubicació de la carpeta de configuració d'axis2 com a Path absolut dins el servidor on desplegarà. Aquest Path s'indicarà sobreescrivint el valor de la propietat pica.axisdefinition.location del fitxer pica.properties amb el Path absolut on s'ha deixat la carpeta d'axis2client als servidors. S'haurà de pactar la ubicació amb els responsables del CPD on desplegarà.\r\n\r\n    Exemple:\r\n    pica.properties:\r\n\r\n        int.pica.axisdefinition.location=file:/export/AppJavaDades/int/.../axis2client/\r\n        pre.pica.axisdefinition.location=file:/export/AppJavaDades/pre/.../axis2client/\r\n        pro.pica.axisdefinition.location=file:/export/AppJavaDades/pro/.../axis2client/\r\n\r\n\r\n\r\n## Utilització del Mòdul\r\n\r\n### REST\r\n\r\n**app-integration-custom.xml**\r\n\r\nAquest arxiu XML conté la configuració de Spring per al servei de PICA. En l'exemple configurem el servei de PICA per invocar el producte/modalitat \"PADRO_MUNICIPI_RESIDENCIA\".\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\r\n\r\n\t<bean id=\"picaCanigoService\" parent=\"abstractPicaService\">\r\n\t\t<property name=\"modalitats\">\r\n\t\t\t<map>\r\n\t\t\t\t<entry key=\"PADRO_MUNICIPI_RESIDENCIA\">\r\n\t\t\t\t\t<bean parent=\"producteModalitatBase\">\r\n\t\t\t\t\t\t<property name=\"signat\" value=\"false\"/>\r\n\t\t\t\t\t\t<property name=\"urlPICA\" value=\"${pica.url}\" />\r\n\t\t\t\t\t\t<property name=\"codCertificado\" value=\"${pica.codCertificado}\"/>\r\n\t\t\t\t\t\t<property name=\"codProducto\" value=\"${pica.codProducto}\"/>\r\n\t\t\t\t\t\t<property name=\"finalidad\" value=\"${pica.finalidad}\"/>\r\n\t\t\t\t\t\t<property name=\"nifEmisor\" value=\"${pica.nifEmissor}\"/>\r\n\t\t\t\t\t\t<property name=\"nombreEmisor\" value=\"${pica.nombreEmisor}\"/>\r\n\t\t\t\t\t</bean>\r\n\t\t\t\t</entry>\r\n\t\t\t</map>\r\n\t\t</property>\r\n\t</bean>\r\n</beans>\r\n```\r\n\r\n<div class=\"message warning\">\r\n<b>Propietats específiques</b>\r\n<br><br>\r\nLes propietats pica.url, pica.codCertificado, pica.codProducto, etc, definides en XML de configuració anterior, son propietats específiques de la modalitat o producte invocat, per lo que s'hauran d'introduir manualment a l'arxiu pica.properties per tal de que el PlaceHolderResolver de Spring pugui resoldre el valor de la propietat durant l'arranc de l'aplicació.\r\n</div>\r\n\r\n**PicaAplicacioService.java**\r\n\r\nClasse Java amb la lògica de les peticions que es realitzin, i la connectivitat amb el mòdul de la PICA.\r\n\r\nEn aquesta classe es pot visualiztar:\r\n\r\n* Injecció del servei de PICA via annotacions (@Autowired/@Qualifier) de Spring.\r\n* Invocació del producte/modalitat \"PADRO_MUNICIPI_RESIDENCIA\" definit en el map de modalitats que es troba al fitxer de configuració xml de Spring.\r\n\r\n```java\r\nimport java.io.IOException;\r\nimport java.io.StringReader;\r\nimport java.util.ArrayList;\r\nimport java.util.Iterator;\r\nimport java.util.List;\r\n\r\nimport javax.xml.parsers.DocumentBuilder;\r\nimport javax.xml.parsers.DocumentBuilderFactory;\r\nimport javax.xml.parsers.ParserConfigurationException;\r\n\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.beans.factory.annotation.Qualifier;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\nimport org.w3c.dom.Document;\r\nimport org.w3c.dom.Element;\r\nimport org.w3c.dom.Node;\r\nimport org.w3c.dom.NodeList;\r\nimport org.xml.sax.InputSource;\r\nimport org.xml.sax.SAXException;\r\n\r\nimport com.generalitat.mp.ws.CridaSincronaResponseDocument;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.pica.IPicaServiceWrapper;\r\nimport cat.gencat.pica.api.peticio.beans.DadesEspecifiques;\r\nimport cat.gencat.pica.api.peticio.beans.Funcionari;\r\nimport cat.gencat.pica.api.peticio.beans.Titular;\r\nimport cat.gencat.pica.api.peticio.core.IPICAServiceSincron;\r\n\r\n@Service(\"picaAplicacioService\")\r\n@Lazy\r\npublic class PicaAplicacioService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(PicaAplicacioService.class);\r\n\r\n\t@Qualifier(\"picaService\")\r\n\t@Autowired\r\n    private IPicaServiceWrapper serviceWrapper;\r\n    \r\n\tprivate static final int TIPO_DOC_TITULAR_NIF = 2;\r\n\r\n\tpublic String testPica(){\r\n\t\t\r\n\t\tString message;\r\n\r\n\t\t try{\r\n\t            IPICAServiceSincron service = serviceWrapper.getPicaWebServiceSincronInstance(\"PADRO_MUNICIPI_RESIDENCIA\");\r\n\r\n\t            Funcionari func = getFuncionari();\r\n\t            Titular tit = creaTitular();\r\n\r\n\t            List<DadesEspecifiques> datosEspecificosXML = createDadesEspecifiques();\r\n\r\n\t            service.setFuncionari(func);\r\n\t            service.setTitular(tit);\r\n\t            service.setDadesEspecifiques(datosEspecificosXML);\r\n\r\n\t                        //Identificador únic de petició\r\n\t            service.crearPeticio(\"PROVA_OTCANIGO_\" + System.currentTimeMillis());\r\n\r\n\t            //fer peticio\r\n\t            CridaSincronaResponseDocument resp = serviceWrapper.ferPeticioAlServei(service);\r\n\t            //extreure resultat\r\n\t            List<DadesEspecifiques> resposta= serviceWrapper.extreuDadesEspecifiques(service,resp);\r\n\r\n\t            Iterator<DadesEspecifiques> it = resposta.iterator();\r\n\t            while (it.hasNext()) {\r\n\t                DadesEspecifiques object = it.next();\r\n\t                String dadesXML = object.getDadesXML();\r\n\r\n\t                // Parsejar resposta\r\n\t                parseXML(dadesXML);\r\n\t            }\r\n\r\n\t            message = \"Test correcte\";\r\n\r\n\t        }catch(Exception e){\r\n\t        \tmessage = \"Test amb errors: \" + e.getMessage();\r\n\t            log.error(e.getMessage(), e);\r\n\t        }\r\n        \r\n        return message;\r\n\r\n    }\r\n\t\r\n    /**\r\n     * Crea un objecte funcionari\r\n     *\r\n     * return funcionari\r\n     **/\r\n    private Funcionari getFuncionari() {\r\n        Funcionari funcionari = new Funcionari();\r\n        funcionari.setNombreFuncionario(\"Nom Funcionari\");\r\n        funcionari.setNifFuncionario(\"55555555A\");\r\n        funcionari.setEmailFuncionario(\"prova@gencat.com\");\r\n        return funcionari;\r\n    }\r\n\r\n    /**\r\n     * Crea un objecte titular\r\n     *\r\n     * return titular\r\n     **/\r\n\tprivate Titular creaTitular() {\r\n\t    Titular tit = new Titular(  );\r\n\t    tit.setTitularTipoDocumentacion(TIPO_DOC_TITULAR_NIF);\r\n\t    tit.setTitularDocumentacion(\"NIF_TITULAR\"); // Es posa el NIF real\r\n\t    tit.setTitularNombreCompleto(\"NOM_COMPLET_TITULAR\"); // Es posa el nom real\r\n\t    return tit;\r\n\t}\r\n\t\r\n\t\r\n\t    /**\r\n\t     * Crea un objecte dades específiques\r\n\t     *\r\n\t     * return DadesEspecifiques\r\n\t     **/\r\n\tprivate List<DadesEspecifiques> createDadesEspecifiques() {\r\n\t    List<DadesEspecifiques> dadesEspecifiquesXML= new ArrayList<DadesEspecifiques>(  );\r\n\t    StringBuffer sb = new StringBuffer( \"<ns1:request xmlns:ns1=\\\"http://www.gencat.net/tfn\\\">\" );\r\n\t    sb.append( \"<ns1:simpleparam name=\\\"NUMTIT\\\">83746573</ns1:simpleparam>\" );\r\n\t    sb.append( \"<ns1:simpleparam name=\\\"NUMNIF\\\">111111111H</ns1:simpleparam>\" );\r\n\t    sb.append( \"</ns1:request>\" );\r\n\t\r\n\t    DadesEspecifiques dades = new DadesEspecifiques(  );\r\n\t    dades.setIdSolicitud( \"1\" );\r\n\t    dades.setDadesXML( sb.toString(  ) );\r\n\t    dadesEspecifiquesXML.add( dades );\r\n\t\r\n\t    return dadesEspecifiquesXML;\r\n\t}\r\n\t\r\n\t    /**\r\n\t     * Parsejar la resposta deixant constància en format de traces si la crida ha finalitzat o no correctament\r\n\t     *\r\n\t     **/\r\n\tprivate void parseXML(String dadesXML) throws ParserConfigurationException, SAXException, IOException {\r\n\t    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\r\n\t    DocumentBuilder builder = factory.newDocumentBuilder();\r\n\t    InputSource inStream = new InputSource();\r\n\t    boolean error = false;\r\n\t\r\n\t    inStream.setCharacterStream(new StringReader(dadesXML));\r\n\t    Document doc = builder.parse(inStream);\r\n\t    NodeList nodes = doc.getElementsByTagName(\"error\");\r\n\t    if(nodes.getLength() == 0) {\r\n\t        nodes = doc.getElementsByTagName(\"sol:SolicitudError\");\r\n\t        error = true;\r\n\t    }\r\n\t\r\n\t    for(int i=0; i<nodes.getLength(); i++) {\r\n\t        Node node = nodes.item(i);\r\n\t        if(node.getNodeType() == Node.ELEMENT_NODE) {\r\n\t            Element element = (Element)node;\r\n\t            if(!error) {\r\n\t                log.info(dadesXML);\r\n\t            } else {\r\n\t                log.info(element.getTextContent());\r\n\t            }\r\n\t        }\r\n\t    }\r\n\t}\r\n}\r\n```\r\n\r\nCal destacar que l'identificador de la petició ha de ser únic, per aquest motiu es concatena un prefix de text qualsevol amb el timestamp del sistema.\r\n\r\nPer a més informació respecte l'especificació tècnica i funcional podeu contactar amb l'OT PICA.\r\n\r\nEn aquest exemple, els mètodes privats crearFuncionari() i crearTitular() (creats simplement per aquest test) s'encarreguen de setejar les propietats del funcionari que fa la petició i titular sobre el que es fa la petició respectivament. El mètode també privat createDadesEspecifiques() conté una llista de les sol.licituds, en format XML, que s'enviaran dins la petició.\r\n\r\nDins una petició (llista de dades específiques) es poden incloure diverses sol- licituds, els identificadors de les quals han de ser únics dins una mateixa petició. Si volguéssim afegir una altra sol- licitud en l'exemple, només caldria instanciar un nou objecte DadesEspecifiques, amb IdSolicitud=\"2\", un nou StringBuffer amb les dades i afegir-lo a la llista dadesEspecifiquesXML dins del mètode createDadesEspecifiques() de l'exemple.\r\n\r\n**PicaServiceController.java**  \r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.PicaAplicacioService;\r\n\r\n@RestController\r\n@RequestMapping(\"/pica\")\r\npublic class PicaServiceController {\r\n\r\n\t@Autowired\r\n\tPicaAplicacioService picaAplicacioService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testPica() throws Exception {\r\n\t\treturn picaAplicacioService.testPica();\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1waWNh"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2dk":{"date":1426783321000,"title":"ARESTA (PSGD)","description":"Plataforma de Serveis de Gestió Documental","sections":"Canigó. Documentació versió 3.x","weight":17,"path":"/canigo-documentacio-versions-3x-integracio/modul-psgd","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector és proporcionar un punt d'accés cap a la Plataforma de Serveis de Gestió Documental (PSGD) també coneguda com a ARESTA.\r\n\r\n## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional que faciliti a les aplicacions l'ús de la PSGD.\r\n\r\n## Context i Escenaris d'ús\r\n\r\nEl connector PSGD es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n## A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Documents i Fonts de Referència\r\n\r\n| Nom Document\r\n| ----------\r\n| [PSGD Manual Integració](/related/canigo/documentacio/modul-psgd/PSGD_Manual_Integració_v5.5.pdf).\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents accions:\r\n\r\n**Funcionalitats de Documents**\r\n\r\n* **Alta Document:** Alta d’un nou document en el sistema.\r\n* **Baixa Document:** Baixa lògica d’un document del sistema.\r\n* **Check-Out Document:** Marcatge d’un document com a no modificable per estar en possessió d’un determinat usuari i obtenció del document i les seves signatures.\r\n* **Check-In Document:** Substitució d’un document existent en el sistema per un de nou i marcatge com a document modificable, amb les seves signatures associades, si s’escau\r\n* **Editar Metadades Document:** Modificació de les metadades d’un document del sistema.\r\n* **Obtenir Document:** Obtenció d’un document existent en el sistema i els identificadors únics de les seves versions prèvies.\r\n* **Cercar Documents:** Cerca de documents en funció de les seves metadades i contingut.\r\n\r\n**Funcionalitats d'Expedients**\r\n\r\n* **Alta Expedient:** Alta d’un nou expedient en el sistema.\r\n* **Baixa Expedient:** Baixa d’un expedient del sistema.\r\n* **Assignar Document:** Assignar un document existent en el sistema a un expedient existent en el sistema.\r\n* **Eliminar Assignació Document:** Eliminar l’assignació d’un document a un expedient.\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font i binaris referent a aquest component a la següent url:\r\n\r\nhttp://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.psgd/\r\n\r\n### Requeriments\r\n\r\nEl connector PSGD és compatible amb les versions 1.6 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\n## Configuració\r\n\r\nPer configurar el mòdul d'integració PSGD és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul psgd incorporant manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml;\r\n\r\n```\r\n<canigo.integration.psgd.version>[1.1.0,1.2.0)</canigo.integration.psgd.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PSGD -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.psgd</artifactId>\r\n    <version>${canigo.integration.psgd.version}</version>\r\n</dependency>\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/psgd.properties amb el següent contingut:\r\n\r\n```\r\n*.psgd.usuari=[usuariPSGD]\r\n*.psgd.password=[passwordPSGD]\r\n*.psgd.url=[urlPSGD]\r\n*.psgd.keystore=[path keystore]\r\n*.psgd.keystore.password=[password keystore]\r\n*.psgd.truststore=[path truststore]\r\n*.psgd.truststore.password=[password truststore]\r\n```\r\n\r\nL’usuari i password per donar d’alta l’aplicació al PSGD s’ha de demanar al gestor del projecte per part de CTTI.\r\n\r\nLa url d'accés dependrà si es vol treballar amb l'entorn de Preproducció (https://preproduccio.gestordocumental.intranet.gencat.cat) o Producció (https://gestordocumental.intranet.gencat.cat).\r\n\r\nEls certificats necessaris per accedir a la url de PSGD s'han de demanar al gestor del projecte per part de CTTI.\r\n\r\nHi ha tres opcions per indicar a l'aplicació on es troba els certificats necessaris:\r\n\r\n* Omplir els valors  referents al keystore/truststore on s'ha incorporat el certificat. S'ha d'indicar si el path pertany al classpath o al sistema de fitxer. Per exemple:\r\n\r\n```\r\n*.psgd.keystore=classpath*:data/psgdKeystore\r\n\r\no\r\n\r\n*.psgd.keystore=file:/aqd/psgd/psgdKeystore\r\n```\r\n\r\n* Deixar sense valor les variables keystore i truststore. L'aplicació utilitzarà el cacerts que tingui configurat JVM. (Per a que funcioni s'ha d'afegir els certificats al cacerts)\r\n\r\n* Deixar sense valor les variables keystore i truststore i indicar el path del keystore a la JVM quan s'inicia l'aplicació amb el següent paràmetre:\r\n\r\n```\r\njavax.net.ssl.trustStore=/aqd/psgd/psgdKeystore\r\n```\r\n\r\n## Utilització del Connector\r\n\r\n### Exemple d'utilització Alta de Document\r\n\r\nRecuperar el bean del servei de PSGD des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate PsgdConnectorImpl psgdConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\n\r\n Document document = new Document();\r\n\t         \r\n DocumentMetaData documentMetaData = new DocumentMetaData();\r\n \r\n documentMetaData.setDocumentName(\"prova.txt\");\r\n documentMetaData.setDocumentTypeCode(\"TD01-010\");\r\n documentMetaData.setTitle(\"Prova\");\r\n documentMetaData.setCreatorID(\"canigo\");\r\n documentMetaData.setDocumentDescriptor(\"descriptor\");\r\n documentMetaData.setOrigin(\"0\");\r\n\r\n InputStream documentData = new FileInputStream(\"pathfitxer\")\r\n \r\n document.setDocumentMetaData(documentMetaData);\r\n \r\n CreateDocumentResponse result = psgdConnector.altaDocument(document, documentData);\r\n\r\n```\r\n El objecte de resposta CreateDocumentResponse retorna el ID del document creat.\r\n\r\n```java\r\n String documentID = result.getResult().getResultData().getDocumentCreated().getDocumentID();\r\n```\r\n\r\n* En cas de que retorni error es pot consultar el code i la descripció de la següent manera:\r\n\r\n```java\r\n String code = result.getResult().getCode();\r\n String descripcio = result.getResult().getDescription();\r\n String descExtended = result.getResult().getExtendedDescription();\r\n```\r\n\r\n### Exemple d'utilització Obtenir Documents\r\n\r\nRecuperar el bean del servei de PSGD des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate PsgdConnectorImpl psgdConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nDocumentGetContentData document = new DocumentGetContentData();\r\n         \r\ndocument.setDocumentID(\"478fbefa-4de5-49c7-881c-1b2e1d1a8535\");\r\ndocument.setReaderID(\"canigo\");\r\n\r\nDocumentResponse result = psgdConnector.descarregarDocument(document);\r\n\r\n```\r\n\r\n El objecte de resposta DocumentResponse retorna el ID, nom, tipus i mida del document demanat. Així com el document en un ByteArrayOutputStream.\r\n\r\n En cas de voler desar el document demanat a disc es podria fer de la següent manera.\r\n\r\n```java\r\nOutputStream outputStream = new FileOutputStream (\"givefilename\"); \r\nresult.getResult().getResultData().getData().writeTo(outputStream);\r\n```\r\n\r\n* En cas de que retorni error es pot consultar el code i la descripció de la següent manera:\r\n\r\n```java\r\n String code = result.getResult().getCode();\r\n String descripcio = result.getResult().getDescription();\r\n String descExtended = result.getResult().getExtendedDescription();\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn consultar el document [PSGD Manual Integració](/related/canigo/documentacio/modul-psgd/PSGD_Manual_Integració_v5.3.pdf).\r\n\r\n## Logs\r\n\r\nSi es vol conéixer la petició JSON que s'està enviant i el JSON que s'està rebent es pot fer a través dels logs.\r\n\r\nAl fitxer Log4j.xml s'ha de posar a debug la classe: cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor\r\n\r\n```xml\r\n<category name=\"cat.gencat.ctti.canigo.arch.integration.psgd.utils\">\r\n\t<level value=\"debug\"/>\r\n</category>\r\n```\r\n\r\nUn exemple de sortida dels logs:\r\n\r\n```\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - ===========================request begin================================================\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - URI : https://preproduccio.gestordocumental.intranet.gencat.cat/service/extendedServices/search/documents\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - Method : POST\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - Request Body : {\"Token\":\"TICKET_fadafc82507d6158937cd2d5a63e667a5d471f0e\",\"Request\":\"SearchDocuments\",\"RequestData\":{\"DocumentSearchCriteria\":{\"DocumentID\":\"476bf6a5-b9ba-4a2f-86c1-665277b31ea0\",\"DocumentDescriptor\":\"a\",\"FolderSetName\":\"C0001\",\"FolderNumber\":\"1\",\"FolderYear\":\"2016\",\"Title\":\"prova\",\"InputRegistryID\":\"1\",\"OutputRegistryID\":\"1\",\"DocumentDateBefore\":\"24/02/2016\",\"DocumentDateAfter\":\"15/02/2016\",\"DocumentTypeName\":\"TD10-010\",\"Text\":\"Mitja\"}}}\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - ==========================request end================================================\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - ============================response begin==========================================\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - status code: 200\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - status text: OK\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - Response Body : {\"Result\":{\"Code\":\"OK\",\"Description\":\"Successful\",\"ResultData\":{\"SearchDocumentsResults\":{\"Found\":\"1\",\"Documents\":[{\"Document\":{\"DocumentMetaData\":{\"DocumentID\":\"476bf6a5-b9ba-4a2f-86c1-665277b31ea0\",\"DocumentName\":\"prova.docx\",\"DocumentTypeName\":\"TD10-010\",\"DocumentDepartmentUnitID\":\"CTT\",\"Title\":\"Prova\",\"OrganName\":\"Organ\",\"CreatorID\":\"canigo\",\"CreationDate\":\"17/02/2016 14:57:09\",\"Signed\":false,\"OwnerID\":\"canigo\",\"ReaderID\":\"canigo\",\"ReadDate\":\"19/02/2016 13:36:14\",\"BinderID\":\"canigo\",\"BindingDate\":\"23/02/2016 09:58:59\",\"UnbinderID\":\"canigo\",\"UnbindingDate\":\"23/02/2016 09:48:19\",\"BindingFolderID\":\"22e77806-349f-4440-a534-cfd6c9ffeeb8\",\"Folders:\":[{\"FolderID\":\"22e77806-349f-4440-a534-cfd6c9ffeeb8\",\"FolderSetName\":\"C0001\",\"FolderNumber\":\"1\",\"FolderYear\":2016,\"OrganName\":\"CTT\",\"OrganCode\":\"CTT\"}]}}}]}}}}\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - =======================response end=================================================\r\n```\r\n\r\nEs recomana no possar el log a nivell de Debug per a Producció.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2dk"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2lz":{"date":1425571902000,"title":"PSIS","description":"Validació de Signatures electròniques mitjançant els serveis de PSIS oferts per CatCert.","sections":"Canigó. Documentació versió 3.x","weight":11,"path":"/canigo-documentacio-versions-3x-integracio/modul-psis","content":"## Propòsit\r\n\r\nAquest mòdul permet la validació de Signatures electròniques mitjançant els serveis de PSIS oferts per CatCert.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal- lar el mòdul de PSIS es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```xml\r\n<canigo.integration.psis.version>[1.2.0,1.3.0)</canigo.integration.psis.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.psis</artifactId>\r\n          <version>${canigo.integration.psis.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/psis.properties\r\n\r\nPropietat          | Requerit | Descripció\r\n------------------ | -------- | -----------\r\n*.psis.urlPica  | Sí       | Url del WebService de PSIS. Valor per defecte: http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.psis.finalitat   | Sí       | Finalitat de l'accés al servei. \r\n*.psis.nifEmisor   | Sí       | Nif de l'emisor\r\n*.psis.nomEmisor   | Sí       | Nom de l'emisor\r\n*.psis.nomFuncionari| Sí      | Nom del funcionari\r\n*.psis.nifFuncionari| Sí      | Nif del funcionari\r\n*.psis.emailFuncionari| Sí    | Email del funcionari\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nAquest mòdul és dependent del [mòdul de la PICA] (/canigo-documentacio-versions-3x-integracio/modul-pica/) amb lo qual també s'ha de configurar aquest.\r\n\r\n## Utilització del Mòdul\r\n\r\n### PicaService\r\n\r\nEl mòdul PSIS requereix de la creació del Bean del servei de la pica, per defecte Psis cerca un bean anomenat picaService. Si es dessitja canviar aquest nom es pot fer afegint al fitxer psis.propierties la següent propietat:\r\n\r\n\tpsis.picaServiceBeanName=[nom del bean]\r\n\t\r\nUn exemple del bean que s'ha de crear:\r\n\r\n\t<!-- BEAN DE LA PICA -->\r\n\t<bean id=\"picaService\" parent=\"abstractPicaService\">\r\n        <property name=\"modalitats\">\r\n            <map>\r\n            </map>\r\n        </property>\r\n    </bean>\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**PsisService.java**\r\n\r\nClasse Java on es realitzarà la lògica de la operació a realitzar.\r\n\r\nEn aquest exemple es valida la caducitat d'un certificat amb PSIS:\r\n\r\n```java\r\nimport java.io.InputStream;\r\n\r\nimport org.apache.commons.io.IOUtils;\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.psis.PSISConnector;\r\nimport cat.gencat.ctti.canigo.arch.integration.psis.exceptions.PSISException;\r\nimport net.gencat.pica.psis.schemes.valCertSimpPICARequest.ValCertSimpPICARequestDocument;\r\nimport net.gencat.pica.psis.schemes.valCertSimpPICARequest.ValCertSimpPICARequestDocument.ValCertSimpPICARequest;\r\nimport net.gencat.pica.psis.schemes.valCertSimpPICAResponse.ValCertSimpPICAResponseDocument;\r\n\r\n@Service(\"psisService\")\r\n@Lazy\r\npublic class PsisService {\r\n\t\r\n\t/** Logger  */  \r\n\tprivate static final Logger logger = LoggerFactory.getLogger(PsisService.class);\r\n\r\n\t@Autowired\r\n\tprivate PSISConnector psisServices;\r\n\t\r\n\tprivate static byte[] certificatCaducat = getBytesFromInputStream(Thread.currentThread().getContextClassLoader().getResourceAsStream(\"config/cert/certificatCaducat.crt\"));\r\n\r\n\r\n\t private static byte[] getBytesFromInputStream(InputStream is) {\r\n\t\t byte[] resultat = null;\r\n\t\t try {\r\n\t\t\t resultat = IOUtils.toByteArray(is);\r\n\t\t } catch (Exception e) {\r\n\t\t\t logger.error(e.getMessage(),e);\r\n\t\t }\r\n\t\t return resultat;\r\n\t }\r\n\t \r\n\t public String testValidarCertificatCaducat() {\r\n\t\t logger.debug(\"[testValidarCertificatCaducat]\");\r\n\t\t \r\n\t\t String message;\r\n\t\t try{\r\n\t\t\t ValCertSimpPICARequestDocument document = ValCertSimpPICARequestDocument.Factory.newInstance();\r\n\t\t\t ValCertSimpPICARequest peticioValidar = ValCertSimpPICARequest.Factory.newInstance();\r\n\t\t\t peticioValidar.setCertificat(certificatCaducat);\r\n\t\t\t document.setValCertSimpPICARequest(peticioValidar);\r\n\t\t\t ValCertSimpPICAResponseDocument resposta = psisServices.validarCertificat(document);\r\n\t\t\t if (resposta!=null && resposta.getValCertSimpPICAResponse()!=null && resposta.getValCertSimpPICAResponse().getResultat()!=null){\r\n\t\t\t\t message = \"S'ha verificat la caducitat del certificat amb el següent resultat: \"+ resposta.getValCertSimpPICAResponse().getResultat();\r\n\t\t\t }else{\r\n\t\t\t\t message = \"No s'ha rebut resposta del servei o el format d'aquesta no es l'esperat\";\r\n\t\t\t }\r\n\t\t } catch (PSISException e) {\r\n\t\t\t message = \"S'ha produït un error al servei\";\r\n\t\t\t logger.error(e.getMessage(), e);\r\n\t\t } catch (Exception e) {\r\n\t\t\t message = \"S'ha produït un error general\";\r\n\t\t\t logger.error(e.getMessage(), e);\r\n\t\t }\r\n\t\t \r\n\t\t return message;\r\n\t }\r\n\t \r\n}\r\n```\r\n\r\n**PsisServiceController.java**  \r\nController que publica les operacions disponibles per a qui hagi de consumir-les\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.GetMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.PsisService;\r\n\r\n@RestController\r\n@RequestMapping(\"/psis\")\r\npublic class PsisServiceController {\r\n\r\n\t@Autowired\r\n\tPsisService psisService;\r\n\r\n\t@GetMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testValidarCertificatCaducat() {\r\n\t\t\r\n\t\tString message = psisService.testValidarCertificatCaducat();\r\n\t\t\r\n\t\treturn message;\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2lz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXA=":{"date":1426760726000,"title":"SAP","description":"Interficie d'accés als Backends SAP de la Generalitat.","sections":"Canigó. Documentació versió 3.x","weight":12,"path":"/canigo-documentacio-versions-3x-integracio/modul-sap","content":"## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície simplificada per accedir a backends SAP de la Generalitat.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer poder utilitzar el connector haurem de configurar el projecte perquè inclogui dues llibreries dll i diferents jars:\r\n\r\nLes llibreries són sapjcorfc.dll i librfc32.dll i s'han de copiar al directori system32.\r\n\r\nPer fer les operacions sobre el sistema SAP és necessària la utilització del jar sapjco-2.1.6, que és el connector propi del SAP per fer les crides a les seves funcions BAPI (RFC).\r\n\r\nLes classes que utilitzarem per fer els objectes d'operacions estan en el jar del connector Gecat09 canigo-connectors-gecat09-2.3.2.jar\r\n\r\nLes classes que utilitzarem per fer les operacions han estat generades amb una eina Open Source anomenada JAXB (Java API for Xml Binding), que genera classes java a partir d'un esquema de xml (XMLSchema). Aquesta eina ens permet no solament generar automàticament classes java sinó també fer validacions per comprovar que les dades que contenen els objectes són vàlides. Per això també haurem d'incloure els jars que necessita JAXB:\r\n\r\n* jaxb-api-1.0.1.jar\r\n* jaxb-libs-1.0.1.jar\r\n* jaxb-impl-1.0.1.jar\r\n* jax-qname-1.1.jar\r\n* namespace-1.0.1.jar\r\n* relaxngDatatype-1.0.1.jar\r\n* xsdlib-1.1.2.jar\r\n\r\nPer tal d'instal-lar el mòdul de SAP es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.sap.version>[1.2.0,1.3.0)</canigo.integration.sap.version>\r\n-\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.sap</artifactId>\r\n          <version>${canigo.integration.sap.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de l'eina de suport al desenvolupament.\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/sap.properties\r\n\r\n| Propietat                | Requerit     | Descripció\r\n| ------------------------ | ------------ | --------------\r\n| *.sap.client             | Sí           | Client\r\n| *.sap.username           | Sí           | Usuari de connexió\r\n| *.sap.password           | Sí           | Password de connexió\r\n| *.sap.language           | Sí           | Idioma\r\n| *.sap.hostname           | Sí           | Nom del servidor\r\n| *.sap.systemNumber       | Sí           | SAP system number\r\n| *.sap.connectionPool     | No           | Connexió amb pool. Per defecte: true\r\n| *.sap.connectionPoolName | No           | Nom del pool. Per defecte: poolCanigoSAP\r\n| *.sap.maxNumConnections  | No           | Número de connexions màximes. Per defecte: 5\r\n| *.sap.repositoryName     | No           | Nom del repository. Per defecte: ARAsoft\r\n\r\n## Utilització del Mòdul\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**SapService.java**\r\n\r\nClasse Java on es realitza la lògica de la operació a realitzar i es connecta amb el mòdul de SAP.\r\n\r\nEn aquest bean es pot veure:\r\n\r\n* Injecció del conector de SAP via annotacions (@Autowired) de Spring.\r\n* Invocació de la funció BAPI_MATERIAL_GETLIST, taula MATNRSELECTION.\r\n* En la classe MaterialBean s'introduirà el resultat de l'invocació de la funció SAP de manera transparent.\r\n\r\n```java\r\nimport java.util.Collection;\r\n\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.sap.SapConnector;\r\nimport cat.gencat.plantilla32.model.MaterialBean;\r\n\r\n@Service(\"sapService\")\r\n@Lazy\r\npublic class SapService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(SapService.class);\r\n\r\n\t@Autowired\r\n    private SapConnector connector;\r\n\r\n    /**\r\n     * Execució de la funció SAP BAPI_MATERIAL_GETLIST\r\n     *\r\n     */\r\n\tpublic String testSap(){\r\n\t\t\r\n\t\tString message;\r\n\r\n\t\t try{\r\n\t            this.connector.connect();\r\n\t            Collection<Object> col = this.connector.executeFunction(\"BAPI_MATERIAL_GETLIST\",\r\n\t                    \"MATNRSELECTION\", null, MaterialBean.class);\r\n\t            \r\n\t            message = \"Test correcte : \" + col.size();\r\n\r\n\t        }catch(Exception e){\r\n\t        \tmessage = \"Test erròni: \" + e.getMessage();\r\n\t        \tlog.error(e.getMessage(), e);\r\n\t        }finally{\r\n\t            this.connector.disconnect();\r\n\t        }      \r\n        return message;\r\n    }\r\n}\r\n```\r\n\r\n**SapServiceController.java**\r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les.\r\n\r\n```\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.SapService;\r\n\r\n@RestController\r\n@RequestMapping(\"/sap\")\r\npublic class SapServiceController {\r\n\r\n\t@Autowired\r\n\tSapService sapService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testSap() throws Exception {\r\n\t\treturn sapService.testSap();\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXA="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXJjYXQ=":{"date":1426781010000,"title":"SARCAT","description":"Serveis que ofereix la plataforma de Sarcat mitjançant la PICA i el seu connector nadiu.","sections":"Canigó. Documentació versió 3.x","weight":13,"path":"/canigo-documentacio-versions-3x-integracio/modul-sarcat","content":"## Propòsit\r\n\r\nAquest mòdul permet consumir els diferents serveis que ofereix la plataforma de Sarcat mitjançant la PICA i el seu connector nadiu. El mòdul permet consumir els serveis oferts pels WebService amb peticions síncrones.\r\n\r\n## Funcionalitats del connector\r\n\r\nEl connector proporciona accés a les següents operacions de Sarcat:\r\n\r\nOperació Sarcat                   | Descripció Funcional | Modalitat PICA | Operació PICA\r\n--------------------------------- | -------------------- | -------------- | -------------\r\nconsultaAssentaments              | Permet obtenir una relació d'assentaments, amb les dades bàsiques, que compleixin uns criteris de filtratge específics. | SARCAT_AL_CONSULTA    | OP_CONSULTA_ASSENTAMENTS\r\ncercaAssentaments                 | Permet obtenir totes les dades d'un assentament concret.                                                               | SARCAT_AL_CONSULTA    |  OP_CERCA_ASSENTAMENTS\r\nrecollirAssentamentsSafataEntrada | Permet recollir assentaments de la safata d'entrada per incorporar-los a d'altres sistemes.                            | SARCAT_AL_CONSULTA    |  OP_RECOLLIR_ENTRADA\r\nrecollirAssentamentsSafataSortida | Permet recollir assentaments de la safata de sortida per incorporar-los a d'altres sistemes.                            | SARCAT_AL_CONSULTA    |  OP_RECOLLIR_SORTIDA\r\nesPresortida                      | Conèixer si un assentament concret és una pre-sortida o una sortida.                                                    | SARCAT_AL_CONSULTA    |  OP_ES_PRESORTIDA\r\ninsertarAssentamentEntrada        | Es registra l'assentament d'entrada i retorna el número d'assentament assignat i la data de registre.                   | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_ENTRADA\r\ninsertarAssentamentSortida        | Es registra l'assentament de sortida i retorna el número d'assentament assignat i la data de registre.                  | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_SORTIDA\r\ninsertarAssentamentSafata         | Donada la informació d'assentaments d'entrada, els grava i retorna el número de registre de cadascun. Addicionalment comprova la validesa de la destinació externa respecte l'unitat de registre associada a l'assentament.                                                                                            | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_SAFATA\r\ninsertarAssentamentPresortida     | Donada la informació X d'assentaments de presortida, els grava i retorna el número de registre de cadascun.             | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_PRESORTIDA\r\nnumExp \t\t\t\t\t\t\t  | Permet modificar el número d'expedient prèviament assignat a un assentament d'entrada o sortida realitzat.              | SARCAT_AL_MODIFICACIO |  OP_CANVI_NUM_EXPEDIENT\r\ngetNumsRegistre                   | Permet obtenir un conjunt de números d'assentaments que són reservats per s@rcat de manera exclusiva pel Backoffice que fa la sol- licitud.                                                                                                                                                                             | SARCAT_AL_RESERVA     |  OP_GET_NUM_REGISTRE\r\ncercaAssentamentsHist             | Permet obtenir totes les dades d'un assentament que ha passat pel repositori d'històrics d'assentaments de S@rcat.      | SARCAT_AP_HISTORIC    |  OP_CERCA_ASSENTAMENT_HISTORIC\r\nbaixaAssentament                  | Permet donar de baixa assentaments d'entrada, sortida o presortida prèviament realitzats.                               | SARCAT_AL_BAIXA       |  OP_BAIXA_ASSENTAMENTS\r\nllistarTaulesMestres              | A partir d'una data concreta, s'obtenen totes les actualitzacions realitzades en les taules mestres de S@rcat a partir d'aquesta data.                                                                                                                                                                                   | SARCAT_AL_LLISTA_REG  |  OP_LLISTA_REG\r\nllistarTaulaMestra                | Recuperació de codis o valors possibles per a un determinat concepte o taula mestra.                                    | SARCAT_AP_LLISTA      |  OP_LLISTA_TAULA_MESTRA\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de Sarcat es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.sarcat.pica.version>[1.2.0,1.3.0)</canigo.integration.sarcat.pica.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.sarcat.pica</artifactId>\r\n    <version>${canigo.integration.sarcat.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/sarcat.properties\r\n\r\nPropietat           | Requerit | Descripció\r\n------------------- | -------- | ----------\r\n*.sarcat.urlPica\t | Sí       | Url del WebService de Sarcat. Valor per defecte: http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.sarcat.user       | Sí       | Usuari de Sarcat\r\n*.sarcat.password   | Sí       | Password de l'usuari de Sarcat\r\n*.sarcat.finalitat  | Sí       | Finalitat de l'ús del servei (TEST, PRODUCTIU...)\r\n*.sarcat.nifEmisor | Sí       | Nif de l'emissor\r\n*.sarcat.nomEmisor       | Sí       | Nom de l'emissor\r\n*.sarcat.nomFuncionari   | Sí       | Nom del funcionari\r\n*.sarcat.nifFuncionari  | Sí       | Nif del funcionari\r\n*.sarcat.emailFuncionari  | Sí       | Email del funcionari\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nAquest mòdul és dependent del [mòdul de la PICA] (/canigo-documentacio-versions-3x-integracio/modul-pica/) amb lo qual també s'ha de configurar aquest.\r\n\r\n## Utilització del Mòdul\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**SarcatService.java**\r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les.\r\n\r\n```java\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.sarcat.pica.SarcatConnector;\r\nimport cat.gencat.ctti.canigo.arch.integration.sarcat.pica.exceptions.SarcatException;\r\nimport net.gencat.scsp.esquemes.peticion.common.OrdreCerca;\r\nimport net.gencat.scsp.esquemes.peticion.common.TipusAssentament;\r\nimport net.gencat.scsp.esquemes.peticion.consulta.AssentamentCerca;\r\nimport net.gencat.scsp.esquemes.peticion.consulta.AssentamentCerca.ParametresCerca;\r\nimport net.gencat.scsp.esquemes.peticion.consulta.SarcatAlConsultaRequestDocument;\r\nimport net.gencat.scsp.esquemes.peticion.consulta.SarcatAlConsultaRequestDocument.SarcatAlConsultaRequest;\r\nimport net.gencat.scsp.esquemes.peticion.consulta.SarcatAlConsultaResponseDocument.SarcatAlConsultaResponse;\r\n\r\n@Service(\"sarcatService\")\r\n@Lazy\r\npublic class SarcatService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(SarcatService.class);\r\n\r\n\t@Autowired\r\n    private SarcatConnector sarcatConnector;\r\n    \r\n\r\n\r\n\tpublic String testSarcat(){\r\n\t\t\r\n\t\tString message;\r\n\r\n\t\ttry {\r\n\r\n            SarcatAlConsultaRequestDocument document = SarcatAlConsultaRequestDocument.Factory.newInstance();\r\n            SarcatAlConsultaRequest request = document.addNewSarcatAlConsultaRequest();\r\n\r\n            AssentamentCerca cerca = request.addNewAssentamentCerca();\r\n            ParametresCerca params =  cerca.addNewParametresCerca();\r\n            params.setDataInici(\"09/03/2011\");\r\n            params.setDataFinal(\"10/03/2011\");\r\n            cerca.setParametresCerca(params);\r\n            cerca.setUrUsuari(\"0001\");\r\n            cerca.setOrdreCerca(OrdreCerca.DATA_ALTA);\r\n            cerca.setTipus(TipusAssentament.ENTRADA);\r\n               cerca.setDescendent(true);\r\n\r\n            SarcatAlConsultaResponse resposta = sarcatConnector.cercaAssentaments(document).getSarcatAlConsultaResponse();\r\n\r\n\t        if (resposta.getError().getCodi() != 0) {\r\n\t        \tmessage = \"Test amb errors: \" + resposta.getError().getCodi()    + \" \" + resposta.getError().getDescripcio();\r\n\t        \tlog.error(resposta.getError().getCodi()    + \" \" + resposta.getError().getDescripcio());\r\n\t        } else {\r\n\t            message = \"Test correcte: \" + resposta.getAssentamentArray().length;\r\n\t        }\r\n\t\r\n\t    } catch (SarcatException e) {\r\n\t    \tmessage = \"Test erròni: \" + e.getMessage();\r\n\t        log.error(e.getMessage(), e);\r\n\t    }\r\n        \r\n        return message;\r\n    }\r\n\t\r\n}\r\n```\r\n\r\n**SarcatServiceController.java**\r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les.\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.SarcatService;\r\n\r\n@RestController\r\n@RequestMapping(\"/sarcat\")\r\npublic class SarcatServiceController {\r\n\r\n\t@Autowired\r\n\tSarcatService sarcatService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testSarcat() throws Exception {\r\n\t\treturn sarcatService.testSarcat();\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXJjYXQ="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zZ2Rl":{"date":1426854475000,"title":"SGDE","description":"Servei de Gestió del Document Electrònic.","sections":"Canigó. Documentació versió 3.x","weight":14,"path":"/canigo-documentacio-versions-3x-integracio/modul-sgde","content":"## Introducció\r\n\r\nL'SGDE o Servei de Gestió del Document Electrònic ofereix una sèrie de serveis relacionats amb la gestió de documents electrònics. Aquests serveis els ofereixen les plataformes que integren l'SGDE. Actualment existeixen dues:\r\n\r\n* Plataforma Adobe\r\n* STD\r\n\r\nPodeu trobar mes informació sobre els serveis i funcionalitats del SGDE [aquí](/sgde/about/).\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una API que pugui ser utilitzada de forma fàcil pels integradors d'aquest connector per consumir els diferents serveis del SGDE.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector SGDE es troba dins els connectors funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector ofereix els següents serveis:\r\n\r\n**Serveis Plataforma Adobe**\r\n\r\n* **renderitzarFormulari:** Fusiona un formulari amb la plantilla pdf.\r\n* **renderitzarSignarPDF:** Fusiona un formulari amb la plantilla pdf i posteriorment el signa.\r\n* **renderitzarFormulariPDFadjunts:** Fusiona un formulari amb la plantilla pdf i afegeix els annexos indicats\r\n* **renderitzarFormulariPDFaplanatForms:** Fusiona un formulari amb la plantilla pdf donant com a resultat un PDF aplanat. Realitzat amb el mòdul Forms de LC.\r\n* **renderitzarFormulariPDFAplanat:** Fusiona un formulari amb la plantilla pdf donant com a resultat un PDF aplanat. Realitzat amb el mòdul d'Output de LC.\r\n* **renderitzarFormulariPDFA:** Fusiona un formulari amb la plantilla pdf donant com a resultat un PDF/A, que garanteix la compatibilitat d’aquest document al llarg del temps.\r\n* **renderitzarFormulariPDFaplanatSignat:** Fusiona un formulari amb la plantilla pdf, després l'aplana i el signa.\r\n* **extreureDadesFormulari:** Servei per extreure dades d'un formulari.\r\n* **extreureDadesXML:** Servei que extreu les dades introduïdes en un formulari dinàmic.\r\n* **extreureComentaris:** Servei que extreu els comentaris d'un document PDF.\r\n* **extreureComplexAnnexos:** Servei que extreu els annexos d'un document PDF.\r\n* **extreureAnnexos:** Servei que extreu els annexos d'un document PDF.\r\n* **convertirPdfaImatge:** Servei per convertir un pdf a imatge.\r\n* **convertirPdfaPdfA:** Servei per convertir un PDF a PDF/A.\r\n* **aplanarPDF:** Servei per aplanar un pdf.\r\n* **signarPDF:** Servei per a signar un pdf pla.\r\n* **aplanarSignarPDF:** Servei per aplanar i signar un pdf.\r\n\r\n**Serveis STD**\r\n\r\n* **generarCSV:** Servei per la generació d'un Codi Segur a partir d'un arxiu i una clau.\r\n* **composarPDFStream:** Servei que composa un PDF a partir d'una plantilla i d'un document PDF enviat en Stream en la mateixa petició.\r\n* **composarPDFRemot:** Servei que composa un PDF a partir d'una plantilla i d'un document PDF previament pujat al filesystem del STD.\r\n* **convertirPDF:** Servei que converteix un document Ofimàtic (Word, Excel, PowerPoint, Imatges, OpenOffice,...) en PDF.\r\n* **convertirPDFCercable:** Servei que converteix un document Ofimàtic (Word, Excel, PowerPoint, Imatges, OpenOffice,...) en PDF Cercable.\r\n* **convertirComposarPDF:** Servei que converteix i posteriorment composa un arxiu ofimàtic.\r\n* **convertirComposarPDFCercable:** Servei que converteix i posteriorment composa un arxiu ofimàtic cercable.\r\n* **ferOCR:** Servei que extrau el text inclòs a una imatge i el retorna.\r\n\r\n\r\n### Alta Servei\r\n\r\nPer poder utilitzar l'SGDE s'ha d'estar donat d'alta en el servei. Per poder fer-ho s'han d'enviar un mail a oficina-tecnica.canigo.ctti@gencat.cat sol.licitant l'alta a qualsevol de les plataformes que integren el SGDE:\r\n\r\n* Plataforma Adobe: El mail a de contenir la sol·licitud d'alta a l'aplicació d'AutoServei disponible [aqui](/related/SGDE/formulari-alta-plataforma-adobe.xls \"Formulari d'alta plataforma Adobe del SGDE\").\r\n* STD: El mail ha de redactar-se tal qual es descriu en el manual d'usuari del servei. Aquest mail ha de contenir una plantilla degudament complimentada que es pot trobar aquí.\r\n    1. El Centre de Frameworks i Solucions d'Arquitectura respondrà a aquest mail una vegada doni d'alta l'aplicació amb un mail tipus,\r\n    2. L'alta a qualsevol de les dues plataformes s'han de realitzar primer sobre l'entorn de PRE i posteriorment a l'entorn de PRO.\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquest components a la següent url:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.sgde/\r\n\r\n#### Requeriments\r\n\r\nEl connector SGDE és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nEl seu ús esta certificat per funcionar correctament en servidors d'aplicacions WL11g i Tomcat6.x.\r\n\r\n### Instal.lació i Configuració\r\n\r\n#### Instal.lació\r\n\r\nLa instal.lació del connector requereix de la utilització de la llibreria 'canigo.integration.sgde' i les dependències indicades a l'apartat 'Introducció-Versions i Dependències'.\r\n\r\nPer afegir aquesta dependència s'ha de modificar el pom.xml de l'aplicació per incloure les llibreries del Connector.\r\n\r\n```\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.integration.sgde</artifactId>\r\n\t<version>[1.3.0,1.4.0)</version>\r\n</dependency>\r\n\r\n```\r\n\r\nIMPORTANT\r\n\r\nEn el cas de que es vulgui integrar aquest connector en una aplicació que disposi del connector de la PICA, és farà necessari afegir les següents exclusions en aquests últim, per exemple el connector PADRÒ.\r\n\r\n```\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.padro.pica</artifactId>\r\n    <version>1.3.0</version>\r\n    <exclusions>\r\n\t\t<exclusion>\r\n\t\t\t<groupId>org.apache.axis2</groupId>\r\n\t\t\t<artifactId>axis2-jaxws</artifactId>\r\n\t\t</exclusion>\r\n\t\t<exclusion>\r\n\t\t\t<groupId>org.apache.woden</groupId>\r\n\t\t\t<artifactId>woden</artifactId>\r\n\t\t</exclusion>\r\n\t\t<exclusion>\r\n\t\t\t<groupId>org.apache.ws.commons.schema</groupId>\r\n\t\t\t<artifactId>XmlSchema</artifactId>\r\n\t\t/exclusion>\r\n    </exclusions>\r\n</dependency>\r\n```\r\n\r\nEl no afegir aquestes exclusions pot provocar que el connector SGDE no funcioni correctament.\r\n\r\n#### Configuració\r\n\r\n\r\n1.- Per poder configurar el connector SGDE és necessari crear un arxiu anomenat app-integration-sgde.xml situat en src/main/resources/spring/ amb el següent contingut:\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n           http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\t<!-- BEAN SGDE -->\r\n\t<bean id=\"sgdeService\" class=\"cat.gencat.ctti.canigo.arch.integration.sgde.impl.SGDEServiceImpl\" init-method=\"setupService\" scope=\"prototype\">\r\n    \t<description>\r\n\t\t\tSGDE implementation:\r\n\t\t\t\t- formsWSDLUrl: Url de l'wsdl del servei de formularis per les operacions de: renderitzar, extracció de dades, aplanat, ...\r\n\t\t\t\t- stdWSDLUrl: Url de l'wsdl del servei de Transformació de Documents(STD)\r\n\t\t</description>\r\n    \t<property name=\"formsWSDLUrl\" value=\"${sgde.forms.wsdl.url:http://eformularis.pre.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl}\" />\r\n\t\t<property name=\"stdWSDLUrl\" value=\"${sgde.std.wsdl.url:http://sgde.pre.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl}\" />\r\n    </bean>\r\n</beans>\r\n```\r\n\r\non les variables **sgde.forms.wsdl.url** i **sgde.std.wsdl.url** són recuperades de l'arxiu **sgde.properties** que s'ha de crear en src/main/resources/config/props/sgde.properties\r\n\r\n2.- Configuració dels arxius de properties.\r\n\r\nNomés es necessita un arxiu de properties a configurar el sgde.properties.\r\n\r\nEl primer conté només dos paràmetres,\r\n\r\n**sgde.forms.wsdl.url:** Url del WSDL del servei de formularis Adobe.\r\n\r\n* PRE: http://eformularis.pre.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\r\n* PRO: http://eformularis.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\r\n\r\n**sgde.std.wsdl.url:** Url del WSDL del STD.\r\n\r\n* PRE: http://sgde.pre.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl\r\n* PRO: http://sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl\r\n\r\n### Utilització del Connector\r\n\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate ISGDEService sgdeService;\r\n```\r\n\r\n2.- Escollir un dels serveis del SGDE, per exemple el de CSV.\r\n\r\n```java\r\nResultSTD res = null;\r\nbyte[] STD_ARXIU_PDF_TEST1 = null;\r\ntry {\r\n    STD_ARXIU_PDF_TEST1 = IOUtils.toByteArray(Thread.currentThread().getContextClassLoader().getResourceAsStream(\"data_sgde/prueba_composar.pdf\"));\r\n    res = sgdeService.generarCSV(\"ctti\", \"cscanigo\", STD_ARXIU_PDF_TEST1, \"cscanigo\");\r\n    log.info(\"[SGDEConnectorService][sgdeGeneracioCSVTest][estat: \" + res.getStatus().intValue() + \"]\");\r\n} catch (Exception e) {\r\n    e.printStackTrace();\r\n}\r\n```\r\n\r\nPer més informació sobre els diferents serveis que ofereix el SGDE consultar la documentació disponible [aquí](/sgde/documentacio/).","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zZ2Rl"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zc2M=":{"date":1426846671000,"title":"SSC","description":"Serveis d'accés al Sistema de Signatura Centralitzada de Catcert.","sections":"Canigó. Documentació versió 3.x","weight":15,"path":"/canigo-documentacio-versions-3x-integracio/modul-ssc","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector és el de proporcionar accés al Sistema de Signatura Centralitzada de Catcert (SSC).\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície que utilitzi l'API SmartWrapper per poder donar accés als diferents tipus de signatura que ofereix l'SSC.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector SSC es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n### Documents i Fonts de Referència\r\n\r\n| Nom Document\r\n| ------------\r\n| [GuiaIntegracioSSC.v1.1.pdf] (/related/canigo/documentacio/modul-ssc/GuiaIntegracioSSC.v1.1.pdf \"Guia Integració SSC\")\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet utilitzar els diferents serveis de signatura del SSC a través d'una API que el mateix connector ofereix. El nucli principal del SSC és el sistema TrustedX que ofereix l'API SmartWrapper per poder trevallar amb ell. És amb aquesta API amb la cual esta constituit aquest connector.\r\n\r\nEls principals serveis que ofereix el connector són els següents:\r\n\r\n* Accés a la plataforma amb certificat: Totes les aplicacions que desitgin utilitzar l'SSC hauran de disposar d'un certificat amb el qual s'autenticaran per utilitzar la plataforma. Aquest certificat s'haurà de demanar a CatCert.\r\n* Us de magatzem de certificats: Una de les principals funcionalitats del SSC és la signatura desatesa. Això s'aconsegueix configurant en el connector un magatzem de certificats que l'SSC utilitzarà pels diferents processos de signatura.\r\n* Tipus de signatura: L'SSC ofereix els següents tipus de signatura.\r\n    * CMS: Attached / Detached\r\n    * CAdES-BES: Attached / Detached\r\n    * CAdES-T: Attached / Detached\r\n    * XMLDSig: enveloping/enveloped/detached\r\n    * XAdES-BES: enveloping/enveloped/detached\r\n    * XAdES-T: enveloping/enveloped/detached\r\n\r\n### Alta Servei\r\n\r\nPer poder utilitzar l'SSC en PRO s'ha d'estar donat d'alta en el servei. Per poder fer-ho s'han de seguir els següents passos:\r\n\r\n1. Enviar un mail a implantacio@aoc.cat sol- licitant l'alta al servei. Aquí s'espera que l'usuari informi del tipus de signatures que vol generar i se l'informarà del tipus de certificats que ha de sol- licitar.\r\n2. Els certificats a sol- litar s'hauran de fer a través de EACAT.\r\n3. Finalment, el client haurà d'omplir un document d'alta al SSC, on haurà d'especificar el certificat amb el que s'autenticarà, així com els certificats de signatura allotjats en TrustedX que utilitzarà per signar.\r\n4. Una vegada validat el document d'alta, se li donarà accés al SSC en PRO.\r\n\r\nDe cara a utilitzar el servei en PRE, els certificats i documentació necessaria es poden demanar obrint una petició a suport@aoc.cat.\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquests component a la següent url:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.ssc/\r\n\r\n#### Requeriments\r\n\r\nEl connector SSC és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nDonat que l'SSC s'ha desenvolupat per substituir altres sistemes de signatura anteriors s'ha desenvolupat per que sigui compatible amb components de Canigo 2.3.5 en endevant. Tot i això, s'ha de tindre en compte que conté una sèrie de dependències que podrien arribar a donar conflicte en una aplicació ja desenvolupada. Per aquest motiu es recomana consultar les seves dependències.\r\n\r\n### Instal.lació i Configuració\r\n\r\n#### Instal.lació\r\n\r\nLa instal.lació del connector requereix de la utilització de la llibreria 'canigo.integration.ssc' i les dependències indicades a l'apartat 'Introducció-Versions i Dependències'.\r\n\r\nPer afegir aquesta dependència s'ha de modificar el pom.xml de l'aplicació per incloure la llibreria del Connector.\r\n\r\n```\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.ssc</artifactId>\r\n    <version>[1.2.0,1.3.0)</version>\r\n</dependency>\r\n```\r\n\r\nEl resultat dels processos de signatura moltes vegades són arrays de bytes que es troben codificats en Base64 amb classes d'Axis. Això fa que per la recuperació d'arxius s'hagi d'incorporar una llibreria més en el proyecte:\r\n\r\n```\r\n<dependency>\r\n\t<groupId>axis</groupId>\r\n\t<artifactId>axis</artifactId>\r\n\t<version>1.2.1</version>\r\n</dependency>\r\n```\r\n\r\n#### Configuració\r\n\r\n\r\n1.- Per poder configurar el connector SSC és necessari crear un arxiu anomenat app-integration-ssc.xml situat en src/main/resources/spring/ amb el següent contingut:\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n           http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\r\n\t<!-- BEAN SSC -->\r\n\t<bean id=\"sscService\" class=\"cat.gencat.ctti.canigo.arch.integration.ssc.impl.SscConnectorImpl\" scope=\"prototype\">\r\n\t\t<description>\r\n\t\t\tSSC Service for Canigo 3\r\n\t\t</description>\r\n\t\t<property name=\"host\" value=\"${ssc.host}\"/>\r\n\t\t<property name=\"distinguishedname\" value=\"${ssc.distinguishedname}\" /> \r\n\t</bean>\r\n\t\r\n</beans>\r\n```\r\n\r\non les variables ssc.host i ssc.distinguishedname són recuperades de l'arxiu ssc.properties que s'ha de crear en src/main/resources/config/props/ssc.properties\r\n\r\n2.- Configuiració dels arxius de properties.\r\n\r\nExisteixen dos arxius de properties per poder confiurar l'SSC. El ssc.properties i el smartwrapper.properties.\r\n\r\nEl primer conté només dos paràmetres,\r\n\r\n* ssc.host: Url del servidor on es troba l'SSC.\r\n    * PRE: https://ssc.preproduccio.catcert.cat:8443/trustedx-gw/SoapGateway\r\n    * PRO: https://ssc.catcert.cat:8443/trustedx-gw/SoapGatewayU1T\r\n\r\n* ssc.distinguishedname: Nom del certificat amb el que l'aplicació s'autentica per consumir els serveis del SSC.\r\n\r\nEl segón, anomenat smartwrapper.properties conté la configuració de l'API SmartWrapper de TrustedX i esta documentat en el document [GuiaIntegracioSSC.v1.1.pdf](/related/canigo/documentacio/modul-ssc/GuiaIntegracioSSC.v1.1.pdf \"Guia Integració SSC\").\r\n\r\nLa ubicació d'aquest últim arxiu es recomana que sigui en el directori src/main/resoruces de l'aplicació que utilitzi el connector.\r\n\r\nNOTA: Les dades de proves del connector relacionades amb certificats de proves s'han de demanar a CatCert\r\n\r\n### Utilització del Connector\r\n\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate SscConnectorImpl sscService;\r\n```\r\n\r\n2.- Escollir una modalitat de signatura i passar-li els paràmetres que necessiti. En el cas d'aquest exemple es farà una signatura CAdES-BES en mode ATTACHED.\r\n\r\n```java\r\nfinal String path_in = \"path_arxiu_entrada\";\r\nfinal String path_out = \"path_arxiu_sortida\";\r\nfinal String filename = \"HelloWorld.txt\";\r\n\t\t\r\nlog.info(\"[INFO][Arxiu a signar: \" + path_in + filename);\r\nString data = Util.readBinaryFileB64(path_in + filename);\r\n\t\t\r\nString resposta = sscService.signCadesBes(data, Constants.ATTACHED);\r\n\t\t\r\nString destFilename = path_out + filename.substring(0, filename.lastIndexOf(\".\")) + \"_Signature_CAdES_BES_Attached.p7b\";\r\nUtil.writeBinaryFileB64(destFilename, resposta);\r\n```\r\n\r\nPer més informació sobre els diferents mètodes que ofereix el connector SSC es pot consultar l'API.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zc2M="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC10cmlidXRz":{"date":1426838963000,"title":"Tributs","description":"Servei de consulta de dades fiscals de la PICA.","sections":"Canigó. Documentació versió 3.x","weight":16,"path":"/canigo-documentacio-versions-3x-integracio/modul-tributs","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector ,es el de proporcionar accés als 3 grans serveis de consulta de dades fiscals que actualment ofereix la PICA. Aquests tres serveis són:\r\n\r\n* AEAT: Agència Estatal de l'Administració Tributària\r\n* ATC: Agència Tributària de Catalunya\r\n* TGSS: Tresoreria General de la Seguretat Social\r\n\r\na més també es troba integrat el servei AEAT_ATC_TGSS que sintetitza una petita suite de les modalitats de servei dels 3 productes anteriors.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduïda al connector de la Pica que simplifica l'utilització del servei de consulta de dades fiscals ofert per la generalitat.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector PICA-TRIBUTS es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\n### Introducció\r\n\r\nCom ja s'ha comentat aquest connector sintetitza peticions als tres grans serveis oferts per la PICA relatius a la consulta de dades fiscals.\r\n\r\n### Serveis\r\n\r\n#### Servei AEAT (Agència Estatal de l'Administració Tributària)\r\n\r\nLa seva finalitat és l'obtenció de dades tributàries de l'AEAT per consultar, per part dels gestors públics, les dades relatives als contribuents que ofereix l'Agència Estatal de l'Administració Tributària.\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei AEAT_PICA v1.7.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> AEAT\"\r\n\r\nModalitats:\r\n\r\n* AEAT_PICA_C1: Està al corrent de pagament/ No està al corrent de pagament.\r\n* AEAT_PICA_C2: Les dades del certificat individual de renda.\r\n* AEAT_PICA_C3: Les dades identificatives del CIF o DNI/NIE corresponent.\r\n* AEAT_PICA_C4: Les dades del certificat de renda per a prestacions socials.\r\n* AEAT_PICA_C5: Les dades del certificat de renda d'agricultors.\r\n* AEAT_PICA_C6: Les dades del certificat de renda per a beques.\r\n* AEAT_PICA_C7: Les dades del certificat de renda per a beques anticipades.\r\n* AEAT_PICA_C8: Les dades del certificat de l'impost d'activitats econòmiques.\r\n\r\nTotes les modalitats anteriors són síncrones.\r\n\r\n#### Servei ATC (Agència Tributària de Catalunya)\r\n\r\nEl servei d'obtenció del certificat de deutes amb la Generalitat de Catalunya té com a objectiu poder consultar per part dels gestors públics les dades que ofereix l'Agència Tributària de Catalunya respecte a deutes amb la Generalitat.\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei de l'ATCv1.4.3.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> ATC\"\r\n\r\nModalitats:\r\n\r\n* ATC_INF_DEUTES_TMP: Modalitat de servei asíncrona que retorna les dades d'un certificat de deutes amb la Generalitat de Catalunya.\r\n\r\n#### Servei TGSS (Tresoreria General de la Seguretat Social)\r\n\r\nEl servei d'obtenció de dades de la seguretat social de la TGSS té com a objectiu poder consultar, per part dels gestors públics, les dades que ofereix la Tresoreria General de la Seguretat Social.\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei de TGSS v1.6.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> TGSS\"\r\n\r\nModalitats:\r\n\r\n* TGSS_AL_CORRENT_PAGAMENT: Especifica si una persona o una organització té algun deute amb la seguretat social en el moment de fer la consulta.\r\n* TGSS_INFORME_SITUACIO: Aquest informe especifica si una persona cotitzava a una data determinada, per tant és un possible sinònim de si la persona treballava o no.\r\n* TGSS_ACREDITACIO_AGRARIA_PROPI: Aquest informe especifica les situacions de les acreditacions de jornades agràries en un període de temps determinat pels valors del filtre.\r\n\r\n#### Servei AEAT_ATC_TGSS\r\n\r\nL'objectiu del Servei de consulta de la situació de deute d'un contribuent respecte de AEAT, ATC i TGSS és l'agrupació dels productes AEAT (Agència Estatal de l'Administració Tributària), ATC(Agència Tributària de Catalunya) i TGSS (Tresoreria General de la Seguretat Social) en una sola consulta per a la obtenció de la situació de deute d'un contribuent a AEAT, ATC i TGSS. En concret, és l'agrupació de les modalitats següents:\r\n\r\n-AEAT: Certificat d'obligacions tributàries (AEAT_PICA_C1)<br>\r\n-ATC: Informe de situació de deutes amb la Generalitat de Catalunya (ATC_INF_DEUTES_TMP)<br>\r\n-TGSS: Informe de situació de deutes de la TGSS (TGSS_AL_CORRENT_PAGAMENT)<br>\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei deutes del contribuent AEAT-ATC-TGSS v1.1.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> AEAT_ATC_TGSS\"\r\n\r\nModalitats:\r\n\r\n* AEAT_ATC_TGSS_CONSULTA_DEUTES: Modalitats de servei asíncrona que llença una petició de consulta sobre les modalitats anteriorment anomenades dels tres serveis de consulta de dades fiscals AEAT, ATC i TGSS.\r\n\r\nTotes les modalitats anteriors són síncrones.\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar tota el codi font referent aquests components a les següents url's:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.tributs.pica/ \r\n\r\n### Requeriments\r\n\r\nEl connector TRIBUTS és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no és garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector TRIBUTS funcioni correctament sobre l'aplicació que l'utilitzi s'ha de tenir configurat el servei [connector genèric de la PICA](/canigo-documentacio-versions-3x-integracio/modul-pica/) 1.2.0.\r\n\r\n## Configuració\r\n\r\n\r\nPer configurar el mòdul d'integració PICA-DNI és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-DNI amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml:\r\n\r\n```\r\n<canigo.integration.tributs.pica.version>[1.2.0,1.3.0)</canigo.integration.tributs.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-TRIBUTS -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.integration.tributs.pica</artifactId>\r\n\t<version>${canigo.integration.tributs.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/tributs.properties amb el següent contingut:\r\n\r\n```\r\n*.tributs.pica.nifEmisor=[nifEmisor]\r\n*.tributs.pica.nomEmisor=[nomEmisor] #normalment:\"CONSORCI AOC\"\r\n*.tributs.pica.nomEmisorCAT365=[nomEmisor] #normalment:\"CONSORCI AOC\"\r\n*.tributs.pica.finalitat=[finalitat]\r\n*.tributs.pica.url=http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.tributs.pica.nomFuncionari=[nomFuncionari]\r\n*.tributs.pica.nifFuncionari=[nifFuncionari]\r\n*.tributs.pica.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors d finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-tributs.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n### Utilització del Connector\r\n\r\n#### Exemple d'utilització d'una modalitat de Servei de AEAT\r\n\r\nRecuperar el bean del servei de AEAT des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate AeatConnectorImpl aeatConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nDadesPeticioAEAT peticio = new DadesPeticioAEAT();\r\npeticio.setNom(\"Cristian\");\r\npeticio.setCognom1(\"Casals\");\r\npeticio.setCognom2(\"Molina\");\r\npeticio.setNomComplet(\"Cristian Casals Molina\");\r\npeticio.setTipusDocument(\"NIF\");\r\npeticio.setDocument(\"39361642V\");\r\n\t\r\nC1PICAResponse resposta = aeatConnector.ObligacionsTributaries(peticio);\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei AEAT_PICA v1.7.pdf\"\r\n\r\n#### Exemple d'utilització del servei ATC\r\n\r\nRecuperar el bean del servei de ATC des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate AtcConnectorImpl atcConnector;\r\n```\r\n\r\nEn aquest cas d'exemple es consumirà la modalitat de servei ATC_INF_DEUTES_TMP que retorna les dades d'un certificat de deutes amb la Generalitat de Catalunya.\r\n\r\nDonat que el servei ATC es consumeix de forma asíncrona la forma correcta per poder consumir-ho es realitza en 3 fases:\r\n\r\n1. Fer petició al Servei\r\n2. Testar l'estat de resolució de la petició\r\n3. Recuperar les dades de la petició\r\n\r\nNOTA: Les dades de nom, cognom1 i 2, nom complet i el valor del document sobre l'exemple son inventades.\r\n\r\n```\r\nDadesPeticioATC peticio = new DadesPeticioATC();\r\n    \t\r\npeticio.setIdioma(\"Català\");\r\npeticio.setNom(\"Nom\");\r\npeticio.setCognom1(\"Cognom1\");\r\npeticio.setCognom2(\"Cognom2\");\r\npeticio.setNomComplet(\"Nom Cognom1 Cognom2\");\r\npeticio.setDocument(\"12341234D\");\r\npeticio.setTipusDocument(\"NIF\");\r\nDataResponse resposta = atcConnector.informeSituacioDeute(peticio); //<-- Petició al servei\r\n    \r\nEstatAsincron estatResposta = atcConnector.getEstatInformeSituacioDeute(resposta.getResponse()); //<-- Comprovació estat petició\r\nint tempsEstimat = estatResposta.getTempsEstimatResposta();\r\n  \r\n...\r\n    \t\r\nInformacio inf = atcConnector.getDadesInformeSituacioDeute(resposta.getServei()); //<-- Recuperació resposta a la petició\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei de l'ATCv1.4.3.pdf\"\r\n\r\n#### Exemple d'utilització d'una modalitat de Servei TGSS\r\n\r\nRecuperar el bean del servei de TGSS des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate TgssConnectorImpl tgssConnector;\r\n```\r\n\r\nEn aquest cas d'exemple es consumirà la modalitat de servei TGSS_AL_CORRENT_PAGAMENT que especifica si una persona o una organització té algun deute amb la seguretat social en el moment de fer la consulta.\r\n\r\nNOTA: Les dades de nom, cognom1 i 2, nom complet i el valor del document sobre l'exemple son inventades.\r\n\r\n```java\r\nDadesPeticioTGSS peticio = new DadesPeticioTGSS();\r\npeticio.setNom(\"Nom\");\r\npeticio.setCognom1(\"Cognom1\");\r\npeticio.setCognom2(\"Cognom2\");\r\npeticio.setNomComplet(null);\r\npeticio.setTipusDocumentacioInt(Constants.TGSS_NIF);\r\npeticio.setDocument(\"12345678B\");\r\n\r\nRespostaAlCorrentDePagament resposta = tgssConnector.alCorrentPagament(peticio);\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei de TGSS v1.6.pdf\"\r\n\r\n#### Exemple d'utilització del servei AEAT_ATC_TGSS\r\n\r\nRecuperar el bean del servei de AEAT_ATC_TGSS des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate TgssConnectorImpl tgssConnector;\r\n```\r\n\r\nEn aquest cas d'exemple es consumirà la modalitat de servei AEAT_ATC_TGSS_CONSULTA_DEUTES que retorna les dades conjuntes de les modalitats següents:\r\n\r\n-AEAT: Certificat d'obligacions tributàries (AEAT_PICA_C1)<br>\r\n-ATC: Informe de situació de deutes amb la Generalitat de Catalunya (ATC_INF_DEUTES_TMP)<br>\r\n-TGSS: Informe de situació de deutes de la TGSS (TGSS_AL_CORRENT_PAGAMENT)\r\n\r\nDonat que el servei AEAT_ATC_TGSS es consumeix de forma asíncrona la forma correcta per poder consumir-ho es realitza en 3 fases:\r\n\r\n1. Fer petició al Servei\r\n2. Testar l'estat de resolució de la petició\r\n3. Recuperar les dades de la petició\r\n\r\nNOTA: Les dades de nom, cognom1 i 2, nom complet i el valor del document sobre l'exemple son inventades.\r\n\r\n```java\r\nDadesPeticioAEAT_ATC_TGSS peticio = new DadesPeticioAEAT_ATC_TGSS();\r\n\t\t\t\r\npeticio.setIdioma(\"Català\");\r\npeticio.setTipusDocumentacio(Constants.AAT_NIF);\r\npeticio.setDocument(\"12345678B\");\r\npeticio.setNom(\"Nom\");\r\npeticio.setNomComplet(\"Nom Cognom1 Cognom2\");\r\npeticio.setCognom1(\"Cognom1\");\r\npeticio.setCognom2(\"Cognom2\");\r\n\t\t\t\r\nresposta = aeatAtcTgssConnector.consultaDeutes(peticio); //<-- Petició al servei\r\n\t\t\r\nEstatAsincron estatResposta = aeatAtcTgssConnector.getEstatConsultaDeutes(resposta.getResponse()); //<-- Consulta de l'estat de la petició\r\nint tempsEstimat = estatResposta.getTempsEstimatResposta();\r\n\t\r\n...\r\n\r\nRespostaConsultaDeutes dadesResposta = aeatAtcTgssConnector.getDadesConsultaDeutes(resposta.getServei()); //<-- recuperació de les dades de la petició\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei deutes del contribuent AEAT-ATC-TGSS v1.1.pdf\"\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC10cmlidXRz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWNvcnJldQ==":{"date":1427456704000,"title":"Correu","description":"Enviament de correu electrònic.","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-suport/modul-correu","content":"## Propòsit\r\n\r\nAquest mòdul té com a objectiu permetre l'enviament de correus electrònics a una o diverses adreces especificades a qualsevol dels següents recipients:\r\n\r\n* Destinataris principals\r\n* Destinataris secundaris\r\n* Destinataris ocults\r\n\r\nPermet diferents modes d'enviament, tant en text pla, com en mode HTML, i en tots 2 casos oferint la possibilitat d'adjuntar un o més fitxers en mode adjunt o inline. \r\n\r\nVersions i Dependències\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'enviament de correu es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.mailing.version>[1.2.0,1.3.0)</canigo.support.mailing.version>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.support.mailing</artifactId>\r\n\t<version>${canigo.support.mailing.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/mail.properties\r\n\r\nPropietat                | Requerit | Valor Defecte | Descripció\r\n------------------------ | -------- | ------------- | -----------\r\n*.mail.host              | Sí       |               | Nom del servidor de correu sortint (smtp).\r\n*.mail.port              | No       |      25       | Port del servidor de correu sortint (smtp). \r\n*.mail.protocol          | No       |     smtp      | Protocol del servidor de correu sortint (smtp).\r\n*.mail.username          | No       |               | Usuari de connexió al servidor de correu sorting (smtp).\r\n*.mail.password          | No       |               | Password de l'usuari de connexió.\r\n*.mail.defaultEncoding   | No       |     UTF-8     | Encoding per defecte del correu.  \r\n*.mail.maxAttachmentSize | No       |0(sense límits)| Tamany màxim permés dels fitxers adjunts. \r\n*.mail.isSmtpSSLEnabled  | No       |     false     | Habilitar o deshabilitar SSL.\r\n*.mail.debug             | No       |     false     | Activar les traces de debug.\r\n*.mail.timeout           | No       |     8500      | Timeout pel servidor de correu(ms).\r\n\r\n\r\n## Utilització del Mòdul\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**MailAplicacioService.java**\r\n\r\nClasse Java on es realitzarà la lògica de la operació a realitzar i es connecta amb el mòdul d'enviament de correus.\r\n\r\n```java\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.support.mailing.MailService;\r\n\r\n@Service(\"mailAplicacioService\")\r\n@Lazy\r\npublic class MailAplicacioService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(MailAplicacioService.class);\r\n\r\n\t@Autowired\r\n\tprivate MailService service;\r\n    \r\n\r\n\r\n\tpublic String testEmail(String from, String subject, String body, boolean isHtml, String to){\r\n\t\t\r\n\t\tString message;\r\n\r\n        try{\r\n        \tthis.service.send(from, subject, body, isHtml, to);\r\n        }catch(Exception e){\r\n        \tmessage = \"Error al test: \" + e.getMessage();\r\n        \tlog.error(e.getMessage(), e);\r\n        }\r\n        \r\n        message = \"Test correcte\";\r\n        return message;\r\n\r\n    }\r\n\t\r\n}\r\n```\r\n\r\n**MailServiceController.java**  \r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RequestParam;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.MailAplicacioService;\r\n\r\n@RestController\r\n@RequestMapping(\"/mail\")\r\npublic class MailServiceController {\r\n\r\n\t@Autowired\r\n\tMailAplicacioService mailAplicacioService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testEnotum(@RequestParam String from, \r\n\t\t\t@RequestParam String subject,\r\n\t\t\t@RequestParam String body,\r\n\t\t\t@RequestParam boolean isHtml,\r\n\t\t\t@RequestParam String to) throws Exception {\r\n\t\treturn mailAplicacioService.testEmail(from, subject, body, isHtml, to);\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWNvcnJldQ=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWZ1c2lvLWRvY3VtZW50cw==":{"date":1427965562000,"title":"Fusió de documents","description":"Mòdul de fusió de documents.","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-suport/modul-fusio-documents","content":"## Propòsit\r\n\r\nAquest servei permet aplicar un conjunt de canvis definits per un diccionari sobre un document en format WordML.\r\n\r\nEs parteix d'un document que conté un o més marcadors que han de ser substituits i d'un conjunt de diccionaris de substitució.\r\n\r\nPer cada un dels diccionaris de substitució, el servei de merging realitza la substitució de cada marcador pel valor indicat en el diccionari i el resultat és un nou document, també en format WordML.\r\n\r\nEls marcadors consisteixen en una marca d'inici, un texte-clau i una marca de final.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de fusió es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.merging.version>[1.2.0,1.3.0)</canigo.support.merging.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.support.merging</artifactId>\r\n    <version>${canigo.support.merging.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/merging.properties\r\n\r\nPropietat              | Requerit | Descripció\r\n---------------------- | -------- | ---------------------------------------------------------------------\r\n*.merging.initBookmark | No       | Marca d'inici del texte a substituir (2 caràcters). Per defecte: @@.\r\n*.merging.endBookmark  | No       | Marca de final del texte a substituir (2 caràcters). Per defecte: ##h2. Utilització del Mòdul.\r\n\r\n### Utilització del Mòdul\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**MergingService.java**\r\n\r\nClasse Java on es realitzarà la lògica de la operació a realitzar i es connecta amb el mòdul de Fusió de documents.\r\n\r\n```java\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.io.File;\r\nimport java.io.FileOutputStream;\r\nimport java.io.InputStream;\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\nimport java.util.Map;\r\n\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.support.merging.MergeTemplateEngine;\r\n\r\n@Service(\"mergingService\")\r\n@Lazy\r\npublic class MergingService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(MergingService.class);\r\n\r\n\t@Autowired\r\n    private MergeTemplateEngine engine;\r\n    \r\n\r\n\r\n\tpublic String testMerging(){\r\n\t\t\r\n\t\tString message;\r\n\r\n\t\tHashMap<String,String> itemsMap = new HashMap<String,String>();\r\n\t\titemsMap.put(\"cosa\", \"Mancha\");\r\n\t\titemsMap.put(\"marca\", \"Funciona\");\r\n\r\n        List<Map<String,String>> dades = new ArrayList<Map<String,String>>();\r\n        dades.add(itemsMap);\r\n\r\n        try{\r\n            InputStream is = Thread.currentThread().getContextClassLoader().getResourceAsStream(\"TestDoc.xml\");\r\n            ByteArrayOutputStream[] os = engine.mergeTemplate(is, dades);\r\n\r\n            FileOutputStream ouputStream = new FileOutputStream(new File(\"c://tmp//file.xml\"));\r\n            ouputStream.flush();\r\n            ouputStream.write(os[0].toByteArray(), 0, os[0].size());\r\n            ouputStream.flush();\r\n            ouputStream.close();\r\n            \r\n\r\n        }catch(Exception e){\r\n        \tmessage = \"Test mergint erroni :\" + e.getMessage();\r\n        \tlog.error(e.getMessage(),e);\r\n        }\r\n        \r\n        message = \"Test merging correcte\";\r\n        \r\n        return message;\r\n\r\n    }\r\n}\r\n```  \r\n\r\n**MergingServiceController.java**\r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.MergingService;\r\n\r\n@RestController\r\n@RequestMapping(\"/merging\")\r\npublic class MergingServiceController {\r\n\r\n\t@Autowired\r\n\tMergingService mergingService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testMerging() throws Exception {\r\n\t\treturn mergingService.testMerging();\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWZ1c2lvLWRvY3VtZW50cw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXNmdHA=":{"date":1427960649000,"title":"SFTP","description":"Transferència d'arxius de manera segura.","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-suport/modul-sftp","content":"## Propòsit\r\n\r\nEl servei de SFTP de Canigó permet enviar i rebre arxius entre el servidor on s'executa l'aplicació a altres servidors de forma segura mitjançant l'intercanvi de claus.\r\n\r\nEl servei està basat en les llibreries JSCH i Commons-VFS, la primera es tracta d'un projecte open source que permet la connexió via SSH a qualsevol màquina. La segona llibrería és un projecte també open_source de la Apache Foundation que permet treballar amb més facilitat amb la JSCH, donant eines per crear connexions SFTP (entre d'altres) contra un servidor.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nNom         | URL\r\n----------- | ------------------------------------\r\nJSCH        | [http://www.jcraft.com/jsch/](http://www.jcraft.com/jsch/)\r\nCommons VFS | [http://commons.apache.org/vfs/](http://commons.apache.org/vfs/)\r\n\r\n## Glossari\r\n\r\n**SFTP**  \r\nSecure File Transfer Protocol (Protocol de Transferència Segura d'Arxius), es tracta d'un protocol de transferència de fitxers entre computadors de forma segura.\r\n\r\n**Download**  \r\nRebre arxius des d'un servidor.\r\n\r\n**Upload**  \r\nEnviar arxius a un servidor.\r\n\r\n**Socket**  \r\nPort del servidor habilitat per realitzar la transferència de fitxers/streams mitjançant el protocol SFTP.  \r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'SFTP es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.sftp.version>[1.2.0,1.3.0)</canigo.support.sftp.version>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.support.sftp</artifactId>\r\n\t<version>${canigo.support.sftp.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/sftp.properties\r\n\r\nPropietat |\tRequerit | Descripció\r\n--------- | -------- | ----------\r\n*.sftp.url |Sí | Host del servidor sftp.\r\n*.sftp.port | No | Port del servidor sftp. Valor per defecte: 22.\r\n*.sftp.username | No | Usuari de connexió al servidor de secure ftp (sftp).\r\n*.sftp.password | No | Password de l'usuari de connexió.\r\n*.sftp.identityPath | No | Path del fitxer de claus privades. El fitxer ha de tenir format OpenSSH (RSA o DSA).\r\n*.sftp.strictHostKeyChecking | No | Indica si volem intercanviar claus amb el servidor o no. Valor per defecte: no.\r\n*.sftp.knownHosts | No | Directori on es troba el fitxer de claus SSH.\r\n*.sftp.proxyType  | No | Tipus de proxy.\r\n*.sftp.proxyHost  | No | Adreça del proxy.\r\n*.sftp.proxyPort  | No | Port del proxy. Valor per defecte: 8080.\r\n*.sftp.userDirIsRoot | No | Possibilitat d'indicar els paths relatius al directori home de l'usuari.<br>true --> Paths relatius a partir del directori home<br>false --> Paths absoluts. Valor per defecte.\r\n*.sftp.uploadChecksum | No | Ofereix la possibilitat de generar i pujar un fitxer de checksum.<br>default --> Generarà i farà l'upload d'un fitxer .md5 a més del fitxer indicat.<br>all --> Generarà i farà l'upload d'un fitxer .md5, .sha1 a més del fitxer indicat.<br>md5 --> Generarà i farà l'upload d'un fitxer .md5 a més del fitxer indicat.<br>sha1 --> Generarà i farà l'upload d'un fitxer .sha1 a més del fitxer indicat.<br>none --> No generarà cap fitxer de checksum. El mateix que si no s'informa aquesta propietat.\r\n*.sftp.uploadChecksumException | No | Serveix per a indicar si un error de checksum és bloquejant o no.<br>true --> Si es produeix un error al generar el fitxer de checksum, es llançarà una excepció i no es pujarà el fitxer al servidor.<br>false --> Si es produeix un error al generar el fitxer de checksum, es mostrarà un log d'error, però continuarà la pujada del fitxer indicat al servidor.\r\n*.sftp.downloadChecksum | No | Ofereix la possibilitat de generar i pujar un fitxer de checksum.<br>default --> Validarà que el fitxer descarregat és correcte mitjançant el fitxer .md5.<br>md5 --> Validarà que el fitxer descarregat és correcte mitjançant el fitxer .md5.<br>sha1 --> Validarà que el fitxer descarregat és correcte mitjançant el fitxer .sha1.<br>none --> No realitzarà cap tipus de validació sobre el fitxer descarregat\r\n*.sftp.downloadChecksumValidation | No | Serveix per a indicar el nivell de bloqueig del checksum.<br>exception --> Si no coincideix el checksum generat del fitxer descarregat amb el que hi ha al servidor es llançarà una excepció.<br>log --> Si no coincideix el checksum generat del fitxer descarregat amb el que hi ha al servidor mostrarà un log d'error.<br>none --> Si no coincideix el checksum generat del fitxer descarregat amb el que hi ha al servidor no farà res..\r\n\r\nEls arxius de configuració que contenen els beans del mòdul i que serán carregats per Spring, son automàticament registrats pel core de Canigó, per lo que el desenvolupador no ha de definir cap arxiu XML per aixecar el servei.\r\n\r\n### Utilització del Mòdul\r\n\r\nPer accedir al mòdul de SFTP, el desenvolupador pot realitzar una crida de forma externa mitjançant el patró 'Dependency Injection'.\r\n\r\nPodem diferenciar dues formes d'injectar-ho:\r\n\r\n* Per XML:\r\n\r\n```\r\n<bean id=\"tractamentClients\"  class=\"cat.gencat.demo.mbean.TractamentClient\">\r\n    <property name=\"sftpService\" ref=\"sftpService\" />\r\n</bean>\r\n```\r\n\r\nLa clase TractamentClient tindria la següent estructura:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.support.sftp.SftpService;\r\npublic class TractamentClient{\r\n   private SftpService sftpService;\r\n\r\n   public void setSftpService(SftpService service){\r\n       this.sftpService = service;\r\n   }\r\n\r\n   public void execute(){\r\n       sftpService.login();\r\n   }\r\n}\r\n```\r\n\r\nInjecció del mòdul de configuració dins del bean \"tractamentClients\". Spring s'encarregarà d'injectar el mòdul de SFTP executant el mètode setSftpService.\r\n\r\n* Per anotacions:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.support.sftp.SftpService;\r\n\r\n@Component(\"tractamentClients\")\r\npublic class TractamentClient{\r\n   @Autowired\r\n   private SftpService sftpService;\r\n\r\n   public void execute(){\r\n       sftpService.login();\r\n   }\r\n}\r\n```\r\n\r\n#### Realitzar connexió\r\n\r\nTenim diferents maneres de realitzar la connexió:\r\n\r\n* Els paràmetres de connexió venen informats a l'arxiu de propietats. El mòdul de SFTP farà servir aquestes propietats per gestionar la connexió al servidor.\r\n\r\n```java\r\nsftpService.login();\r\n```\r\n\r\n\r\n* Si no hem indicat a través de la configuració l'usuari i la contrasenya per realitzar la connexió, s'indicarà manualment en al crida.\r\n\r\n```java\r\nsftpService.login(usuari,contrasenya);\r\n```\r\n\r\n* Servidor, usuari, contrasenya i port no informat.\r\n\r\n```java\r\nsftpService.login(usuari, contrasenya, ftpUrl, ftpPort);\r\n```\r\n\r\nPer realitzar una connexió al servidor a través d'un proxy cal informar les següents propietats a l'arxiu de configuració del mòdul:  \r\n \r\n* sftp.proxyType: Tipus de proxy, pot tenir els valors http o socks.\r\n* sftp.proxyHost: Adreça del host.\r\n* sftp.proxyPort: Port del host.\r\n\r\n\r\n#### Realitzar desconnexió del servidor SFTP\r\n\r\nPer realitzar la desconnexió del servidor FTP seguirem un patró com el mostrat en el següent exemple:\r\n\r\n1. Validem que estem conectats.\r\n2. Desconectem en el cas de estar logats al servidor.\r\n\r\n```java\r\nif (sftpService.isLogged()) {\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\n\r\n#### Realitzar download d'un fitxer\r\n\r\nPer realitzar un download d'un fitxer seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    sftpService.downloadFile(fileName, localPath, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode downloadFile() per realitzar el download del fitxer del servidor remot.\r\n3. Realitzar la desconnexió del servidor SFTP.\r\n\r\nEs crida el mètode downloadFile() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | ------------------------------------------------------------------\r\n1     | Si       | String | Nom del fitxer del servidor remot que es vol realitzar el download.\r\n2     | Si       | String | Directori local on es vol guardar el fitxer.\r\n3     | Si       | String | Directori remot on es troba el fitxer a baixar.\r\n\r\nI retorna:\r\n\r\nOrdre | Requerit | Tipus   | Descripció\r\n----- | -------- | ------- | ----------------------------------------------------------------\r\n1     | Si       | boolean | TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n#### Realitzar upload d'un fitxer\r\n\r\nPer realitzar un upload d'un fitxer seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    sftpService.uploadFile(fileName, localPath, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode uploadFile() per realitzar el upload del fitxer del servidor local al servidor remot.\r\n3. Realitzar la desconnexió del servidor SFTP.\r\n\r\nEs crida el mètode uploadFile() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit  | Tipus  | Descripció\r\n----- | --------- | ------ | -----------------------------------------------------------------\r\n1     | Si        | String | Nom del fitxer del servidor remot que es vol realitzar el upload.\r\n2     | Si        | String | Directori local on es troba el fitxer a pujar.\r\n3     | Si        | String | Directori remot on es vol guardar el fitxer.\r\n\r\n#### Obtenir la llista de noms dels fitxers del servidor remot\r\n\r\nPer obtenir la llista de fitxers en una carpeta d'un servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    FileObject[] listFiles = sftpService.listFiles(remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode listFiles() per obtenir una llista de fitxers en una carpeta d'un servidor remot.\r\n\r\nEs crida el mètode listFiles() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | ----------\r\n1     | Sí       | String | Nom de la carpeta del servidor remot d'on es vol obtenir la llista de fitxers.\r\n\r\nEl mètode retorna un array de FileObject, interfícies de la llibrería Commons VFS que ens donen una sèrie de mètodes per a treballar amb els fitxers remots.\r\n\r\n#### Crear un fitxer al servidor remot\r\n\r\nPer crear un fitxer al servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    createFile(fileName, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode createFile() per crear el fitxer en el servidor remot.\r\n\r\nEs crida el mètode createFile() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | -----------\r\n1     | Si       | String | Nom del fitxer a crear en el servidor remot.\r\n2     | Si       | String | Directori remot on es vol crear el fitxer.\r\n\r\nEl mètode retorna un boolean TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n#### Crear un directori al servidor remot\r\n\r\nPer crear un directori al servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    createFolder(folderName, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode createFolder() per crear el fitxer en el servidor remot.\r\n\r\nEs crida el mètode createFolder() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | -----------\r\n1     | Si       | String | Nom del directori a crear en el servidor remot.\r\n2     | Si       | String | Directori remot on es vol crear el directori.\r\n\r\nEl mètode retorna un boolean TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n#### Esborrar un fitxer al servidor remot\r\n\r\nPer esborrar un fitxer al servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    deleteFile(fileName, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode deleteFile() per crear el fitxer en el servidor remot.\r\n\r\nEs crida el mètode deleteFile() que amb els següents paràmetres: \r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | -----------   \r\n1     | Si       | String | Nom del fitxer a esborrar en el servidor remot.\r\n2     | Si       | String | Directori remot on es troba el fitxer.\r\n\r\nEl mètode retorna un boolean TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n## Exemples\r\n\r\n### Tests Unitaris\r\n\r\nUn exemple d'utilització del mòdul de SFTP són els tests unitaris.\r\n\r\nS'ha de tenir en compte que s'ha de disposar d'accés a un servidor remot mitjançant el protocol SFTP per poder realitzar els tests.\r\n\r\nSuposem que la configuració del\r\n\r\n```java\r\n/**\r\n * Unit test for mailing service\r\n */\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(locations = {\"../../core/config/canigo-core.xml\"})\r\npublic class SftpServiceReleaseTest{\r\n\t// File exchange\r\n\tprivate String fileName\t\t\t\t\t= null;\r\n\tprivate String localPath\t\t\t\t= null;\r\n\tprivate String remotePath\t\t\t\t= null;\r\n\tprivate String tempName \t\t\t\t= null;\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"sftpService\")\r\n\tSftpService sftpService;\r\n\r\n\t@Before\r\n\tpublic void setUp() throws AddressException{\r\n\t\tfileName = \"sftp.properties\";\r\n\t\tremotePath = \"/home/continuum/tmp\";\r\n\t\tlocalPath = this.getClass().getResource(\"/temp/arxiu_pujar.pdf\").getPath();\r\n\t\tlocalPath = localPath.substring(0, (localPath.lastIndexOf(\"/\")+1));\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testLogin() throws Exception {\r\n\t\ttry {\r\n\t\t\tAssert.assertTrue(sftpService.login());\r\n\t\t\tif (sftpService.isLogged()) {\r\n\t\t\t\tsftpService.logout();\r\n\t\t\t}\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testLogout() throws Exception {\r\n\t\ttry {\r\n\t\t\tsftpService.login();\r\n\t\t\tAssert.assertTrue(sftpService.logout());\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testLogoutFailed() throws Exception {\r\n\t\ttry {\r\n\t\t\tAssert.assertFalse(sftpService.logout());\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testUploadFile() throws Exception {\r\n\t\ttry {\r\n\t\t\tsftpService.login();\r\n\t\t\tif(sftpService.isLogged()) {\r\n                                sftpService.uploadFile(fileName, localPath, remotePath);\r\n\t\t\t        Assert.assertTrue(sftpService.existsFile(fileName, remotePath));\r\n\t\t\t\tsftpService.logout();\r\n\t\t\t}else{\r\n                                Assert.fail();\r\n                        }\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXNmdHA="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXVwbG9hZA==":{"date":1427460735000,"title":"Pujada d'arxius","description":"Pujada d'arxius al servidor.","sections":"Canigó. Documentació versió 3.x","weight":5,"path":"/canigo-documentacio-versions-3x-suport/modul-upload","content":"## Propòsit\r\n\r\nAquest mòdul permet al servidor obtenir fitxers adjunts als formularis HTML de client. A més aquest mòdul permet llegir el fitxer de forma directa, deser-lo al sistema de fitxers, emmagatzemar-lo en una base de dades o enllaçar-ho amb altres mòduls com pot ser el servei d'antivirus.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'upload de fitxers es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.fileupload.version>[1.1.0,1.2.0)</canigo.support.fileupload.version>\r\n\r\n<dependency>\r\n  <groupId>cat.gencat.ctti</groupId>\r\n  <artifactId>canigo.support.fileupload</artifactId>\r\n  <version>${canigo.support.fileupload.version}</version>\r\n</dependency>\r\n```\r\n\r\n#### JSF\r\n\r\nPer aplicacions Canigó 3 basades en JSF 2.2 s'ha d'afegir la següent dependència amb la llibreria MyFaces Tomahawk, automàticament a través de l'eina de suport al desenvolupament o bé afegint-la manualment en el pom.xml de l'aplicació:\r\n\r\n```\r\n<tomahawk>1.1.14</tomahawk>\r\n<dependency>\r\n    <groupId>org.apache.myfaces.tomahawk</groupId>\r\n    <artifactId>tomahawk21</artifactId>\r\n    <version>${tomahawk}</version>\r\n    <exclusions>\r\n        <exclusion>\r\n            <artifactId>commons-validator</artifactId>\r\n            <groupId>commons-validator</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>itext</artifactId>\r\n            <groupId>com.lowagie</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>jstl</artifactId>\r\n            <groupId>javax.servlet</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>commons-logging</artifactId>\r\n            <groupId>commons-logging</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>batik-awt-util</artifactId>\r\n            <groupId>org.apache.xmlgraphics</groupId>\r\n        </exclusion>\r\n    </exclusions>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\n#### JSF\r\n\r\nEn el cas d'utilitzar la opció de JSF, el que fa és afegir al web.xml el següent filtre per a interceptar les peticions multipart/form-data:\r\n\r\n```\r\n<filter>\r\n    <filter-name>Extensions Filter</filter-name>\r\n    <filter-class>org.apache.myfaces.webapp.filter.ExtensionsFilter</filter-class>\r\n    <init-param>\r\n        <param-name>uploadMaxFileSize</param-name>\r\n        <param-value>20m</param-value>\r\n        <description>Set the size limit for uploaded files.\r\n            Format: 10 - 10 bytes\r\n                    10k - 10 KB\r\n                    10m - 10 MB\r\n                    1g - 1 GB\r\n        </description>\r\n    </init-param>\r\n</filter>\r\n<filter-mapping>\r\n    <filter-name>Extensions Filter</filter-name>\r\n    <url-pattern>*.jsf</url-pattern>\r\n</filter-mapping>\r\n```\r\n\r\nCal afegir manualment en la jsf la següent capçalera:\r\n\r\n```\r\nxmlns:t=\"http://myfaces.apache.org/tomahawk\"\r\n```\r\n\r\n#### Struts + Taglibs\r\n\r\nEn el cas d'utilitzar la opció d'Struts + Taglibs, la configuració del servei es realitza mitjançant un fitxer de propietats.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/fileupload.properties\r\n\r\nPropietat | Requerit | Descripció\r\n--------- | -------- | ----------\r\n*.fileUpload.defaultEncoding | No | Direcció IP del servidor Engine Scan del CTTI, responsable dels escaneigs.\r\n*.fileUpload.maxUploadSize   | No | Màxim tamany permés abans que es rebutgin els fitxers. Valor per defecte: -1(no hi ha límit).\r\n*.fileUpload.maxInMemorySize | No | Màxim tamany permés en bytes abans de guardar en disc. Valor per defecte: 10240 (bytes).\r\n*.fileUpload.launchExceptionIfVirusDetected | No | Opció només disponible per a la integració del fileupload i antivirus. Indica si es llençarà una excepció al servei en el cas de que es trobi un virus en l'arxiu pujat. Valor per defecte: true.\r\n\r\n## Utilització del Mòdul\r\n\r\n### JSF\r\n\r\nPer a utilitzar aquest mòdul, cal crear un bean i una jsf:\r\n\r\n***fileUploadBean.java***\r\n\r\n```java\r\n@Component(\"fileUploadBean\")\r\n@Scope(\"singleton\")\r\n@Lazy\r\npublic class FileUploadBean {\r\n\r\n\t@Autowired\r\n\tprivate I18nResourceBundleMessageSource messageResource;\r\n\tprivate UploadedFile uploadedFile;\r\n\r\n\tpublic void submit() {\r\n\r\n\t\ttry {\r\n\t\t\tif(getUploadedFile()!=null & getUploadedFile().getBytes()!=null){\r\n\t\t\t\t// Show succes message.\r\n\t\t\t    FacesContext.getCurrentInstance().addMessage(\"uploadForm\", new FacesMessage(\r\n\t\t\t        FacesMessage.SEVERITY_INFO, messageResource.getMessage(\"fileUploadSuccess\"), null));\r\n\t\t\t}else{\r\n\t\t\t\t// Show succes message.\r\n\t\t\t    FacesContext.getCurrentInstance().addMessage(\"uploadForm\", new FacesMessage(\r\n\t\t\t        FacesMessage.SEVERITY_ERROR, messageResource.getMessage(\"fileUploadError\"), null));\r\n\t\t\t}\r\n\t\t} catch (IOException e) {\r\n\t\t\tFacesContext.getCurrentInstance().addMessage(\"uploadForm\", new FacesMessage(\r\n\t\t\t        FacesMessage.SEVERITY_ERROR, messageResource.getMessage(\"fileUploadError\"), null));\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic UploadedFile getUploadedFile() {\r\n\t\treturn uploadedFile;\r\n\t}\r\n\r\n\tpublic void setUploadedFile(UploadedFile uploadedFile) {\r\n\t\tthis.uploadedFile = uploadedFile;\r\n\t}\r\n\r\n}\r\n```\r\n\r\n**fileUpload.jsf**\r\n\r\n```\r\n<h:form id=\"uploadForm\" enctype=\"multipart/form-data\">\r\n    <h:panelGrid columns=\"3\">\r\n        <h:outputLabel for=\"file\" value=\"#{msg.fileUploadSelectFile}\" />\r\n        <t:inputFileUpload id=\"file\" value=\"#{fileUploadBean.uploadedFile}\" required=\"true\" />\r\n        <h:message for=\"file\" style=\"color: red;\" />\r\n        <h:panelGroup />\r\n        <h:commandButton value=\"#{msg.canigoSubmit}\" action=\"#{fileUploadBean.submit}\" />\r\n        <h:message for=\"uploadForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n    </h:panelGrid>\r\n</h:form>\r\n\r\n```\r\n\r\n### STRUTS+TAGLIBS\r\n\r\nPer a utilitzar el mòdul cal crear una Acció i una JSP:\r\n\r\n**app-fileupload.xml**\r\n\r\n```\r\n<bean name=\"/fileUpload\" class=\"cat.gencat.ctti.canigo.demo.fileupload.FileUploadAction\" scope=\"prototype\">\r\n    <property name=\"pojoClass\" value=\"cat.gencat.ctti.canigo.demo.fileupload.FileUploadPojo\"></property>\r\n    <property name=\"fileUpload\" ref=\"fileUploadService\" />\r\n    <!-- Configuració dels tags -->\r\n    <property name=\"tagsConfiguration\">\r\n        <map>\r\n            <entry key=\"*\">\r\n                <list>\r\n                    <bean parent=\"formTag\">\r\n                        <property name=\"styleId\" value=\"actionForm\"></property>\r\n                        <property name=\"layout\" value=\"true\"/>\r\n                        <property name=\"validationProperties\">\r\n                            <props>\r\n                                <prop key=\"validationType\">SERVER</prop>\r\n                                <prop key=\"validatorName\">uploadValidations</prop>\r\n                            </props>\r\n                        </property>\r\n                    </bean>\r\n                    <bean parent=\"submitTag\">\r\n                        <property name=\"styleId\" value=\"uploadSubmit\"/>\r\n                        <property name=\"mode\" value=\"N,D,N\"/>\r\n                        <property name=\"reqCode\" value=\"valida\"/>\r\n                        <property name=\"key\" value=\"forms.buttons.valida\"/>\r\n                        <bean parent=\"fileFieldTag\">\r\n                            <property name=\"styleId\" value=\"fileText\"></property>\r\n                            <property name=\"layout\" value=\"false\"></property>\r\n                            <property name=\"mode\" value = \"E,E,E\"></property>\r\n                        </bean>\r\n                    </bean>\r\n                </list>\r\n            </entry>\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\n**FileUploadAction.java**\r\n\r\n```java\r\npublic class FileUploadAction extends DispatchActionSupport {\r\n\r\n\tprivate final String FORWARD_SUCCESS = \"success\";\r\n\r\n\tprivate static final Log log = LogFactory.getLog(FileUploadAction.class);\r\n\r\n\tprivate FileUploadService fileUpload;\r\n\r\n\r\n\t/**\r\n\t * Mètode que es crida pel reqCode=inici\r\n\t * @param mapping ActionMapping\r\n\t * @param form ActionForm\r\n\t * @param request HttpServletRequest\r\n\t * @param response HttpServletResponse\r\n\t * @return ActionForward\r\n\t * @throws Exception exception\r\n\t */\r\n\tpublic ActionForward upload(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) throws Exception {\r\n\t\tlog.info(\"FileUploadAction [inici] - Inici\");\r\n\r\n\t\tSpringBindingActionForm actionForm = (SpringBindingActionForm)form;\r\n\t\tFileUploadPojo pojo = (FileUploadPojo) actionForm.getTarget();\r\n\r\n\t\tString[] UPLOADED_FILES = new String[] { \"fitxer\" };\r\n\t\tUploadedFiles uploadedFiles = this.fileUpload.getUploadedFiles(request, UPLOADED_FILES);\r\n\t\tUploadedFile fitxerCarregat = uploadedFiles.getFile(\"fitxer\");\r\n\r\n\t\treturn mapping.findForward(FORWARD_SUCCESS);\r\n\t}\r\n\r\n\tpublic FileUploadService getFileUpload() {\r\n\t\treturn fileUpload;\r\n\t}\r\n\r\n\tpublic void setFileUpload(FileUploadService fileUpload) {\r\n\t\tthis.fileUpload = fileUpload;\r\n\t}\r\n}\r\n```\r\n\r\n**fileUpload.jsp**\r\n\r\n```\r\n<fwk:form styleId=\"actionForm\" action=\"sfileUpload.do?reqCode=upload\" method=\"POST\" enctype=\"multipart/form-data\">\r\n\t<fwk:row>\r\n\t\t<fwk:file styleId=\"fileText\" property=\"fitxer\" key=\"label.fileupload.path\"></fwk:file>\r\n\t</fwk:row>\r\n\t<fwk:row>\r\n\t\t<fwk:submit styleId=\"uploadSubmit\"></fwk:submit>\r\n\t</fwk:row>\r\n</fwk:form>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXVwbG9hZA=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0x":{"date":1423239102000,"title":"Versió 1.x","description":"Documentació de la versió 1 del Framework Canigó","sections":"Documentació versions Canigó","taxonomies":[],"weight":2,"path":"/canigo-documentacio-versions-anteriors/versio-1","content":"Des del següent [enllaç](http://gencat.github.io/docs-canigo-v1/) es pot accedir a la darrera versió de la documentació.\r\n\r\n### Changelog\r\n\r\n[1.0.1](https://github.com/gencat/docs-canigo-v1/archive/1.0.1.zip) (15/03/2016)\r\n\r\n- [CAN-2086](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2086): Actualitzada documentació connector Documentum per l'upgrade a v7.1.\r\n\r\n[1.0.0](https://github.com/gencat/docs-canigo-v1/archive/1.0.0.zip) (6/2/2015)\r\n\r\n- Versió inicial exportada del Confluence\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0x"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0y":{"date":1423239102000,"title":"Versió 2.x","description":"Documentació de la versió 2 del Framework Canigó","sections":"Documentació versions Canigó","taxonomies":[],"weight":1,"path":"/canigo-documentacio-versions-anteriors/versio-2","content":"Des del següent [enllaç](http://gencat.github.io/docs-canigo-v2/) es pot accedir a la darrera versió de la documentació.\r\n\r\n### Changelog\r\n\r\n[1.0.2](https://github.com/gencat/docs-canigo-v2/archive/v1.0.2.zip) (28/01/2016)\r\n\r\n- [CAN-2071](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2071): Actualitzada documentació connectors de la PICA.\r\n\r\n[1.0.1](https://github.com/gencat/docs-canigo-v2/archive/v1.0.1.zip) (17/12/2015)\r\n\r\n- [CAN-2057](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2057): Actualitzada documentació connector Documentum per l'upgrade a v7.1.\r\n\r\n[1.0.0](https://github.com/gencat/docs-canigo-v2/archive/v1.0.0.zip) (6/2/2015)\r\n\r\n- Versió inicial exportada del Confluence\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0y"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWxvcGQ=":{"date":1427966947000,"title":"LOPD","description":"Aplicació de protecció de dades.","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-suport/modul-lopd","content":"## Propòsit\r\n\r\nEl servei de LOPD de Canigó permet assignar un determinat nivell de protecció a les dades de l'aplicació que l'utilitzi.\r\n\r\n## Context i Escenaris d'Ús\r\n\r\nEl servei de LOPD es troba dins dels serveis generals de Canigó.  \r\nEl seu ús és necessari en cas de voler protegir dades sensibles de l'aplicació o d'enregistrar el seu accés.\r\n\r\n## A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del servei.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del servei.\r\n\r\n## Glossari\r\n\r\n**LOPD:** Llei Orgànica de Protecció de Dades\r\n\r\n## Descripció Detallada\r\n\r\n###  Arquitectura i Components\r\n\r\n#### Introducció\r\n\r\nEl servei LOPD ofereix suport a les aplicacions basades en Canigó per facilitar el compliment de la LOPD. Donat que l'aplicació dels mecanismes de seguretat afecta únicament a les dades emmagatzemades en la base de dades s'ha definit un sistema d'anotacions per tal de \"marcar\" les dades sensibles en els TO's (Transfer Object).\r\n\r\n#### Instal-lació\r\n\r\nDisposar del mòdul LOPD és pot fer mitjançant dos camins:\r\n\r\n1.- Utilitzar l'eina de l'entorn de treball de Canigó (plugin per l'eclipse). On es podrà seleccionar el servei dintre del grup \"suport\".\r\n\r\nNOTA: L'eina afegeix automàticament un arxiu anomenat lopd.properties situat en src\\main\\resources\\config\\props\\ que conté la llavor utilitzada per fer el xifrat/desxifrat de les dades. En la versió 1.0.0 del servei aquest paràmetre no s'està utilitzant així que no es necessari configurar-lo.\r\n\r\n2.- Afegir de forma manual les dependències del servei.\r\n\r\nModificar el pom.xml afegint:\r\n\r\n```\r\n<properties>\r\n\t<canigo.support.lopd>[1.4.0,1.5.0)</canigo.support.lopd>\r\n</properties>\r\n\r\n<dependency>\r\n      <groupId>cat.gencat.ctti</groupId>\r\n      <artifactId>canigo.support.lopd</artifactId>\r\n      <version>${canigo.support.lopd}</version>\r\n</dependency>\r\n```\r\n\r\n#### Components del Servei\r\n\r\nEl servei defineix tres nivells de seguretat diferents i dos tipus d'operacions amb les dades. L'aplicació dels nivells de seguretat està bassada en l'ús d'una anotació especial de seguretat anomenada LOPDSecure.\r\n\r\n**Nivells de seguretat**\r\n\r\nEls nivells de seguretat creats inicialment són els següents:\r\n\r\n* LOW: Nivell de seguretat baix. Enregistrament de la dada.\r\n* MED: Nivell de seguretat mitjà. Enregistrament de la dada.\r\n* HIGH: Nivell de seguretat alt. Enregistrament i xifrat/desxifrat de la dada.\r\n\r\n**Operacions amb dades**\r\n\r\nS'han definit dos tipus d'operacions possibles aplicables en funció del nivell de seguretat.\r\n\r\n* Enregistrament de les dades: Operació que registra l'accés d'una dada per part d'un usuari.\r\n* Xifrat/desxifrat de les dades: Operació que xifra o desxifra una dada accedida per un usuari.\r\n\r\n### Ús del servei\r\n\r\n#### Configuració del servei\r\n\r\nA spring s'ha de configurar el servei per a indiciar la classe que realitza l'enregistrament de les dades i el xifrat/desxifrat de les dades.\r\n\r\n```\r\n<bean id=\"aspectLOPD\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.annotation.impl.AspectLOPD\">\r\n    <property name=\"levels\" ref=\"levelsBean\"/>\r\n</bean>\r\n\r\n    <!-- Actions -->\r\n<bean id=\"traceOperation\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.operations.trace.impl.TraceImpl\">\r\n</bean>\r\n\r\n <bean id=\"cipherOperation\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.operations.cipher.impl.BouncyCastleAESCipherImpl\">\r\n    <property name=\"key\" value=\"${lopd.secretkey}\"/>\r\n    <!--Optional -->\r\n    <property name=\"charset\" value=\"UTF-8\"/>\r\n</bean>\r\n\r\n<!-- Levels -->\r\n<bean id=\"lowLevel\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.Low\">\r\n    <property name=\"trace\" ref=\"traceOperation\"/>\r\n</bean>\r\n<bean id=\"medLevel\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.Med\">\r\n    <property name=\"trace\" ref=\"traceOperation\"/>\r\n</bean>\r\n<bean id=\"highLevel\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.High\">\r\n    <property name=\"trace\" ref=\"traceOperation\"/>\r\n    <property name=\"cipher\" ref=\"cipherOperation\"/>\r\n</bean>\r\n\r\n<!-- Defined Levels to be used -->\r\n<bean id=\"levelsBean\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.Levels\">\r\n    <property name=\"low\" ref=\"lowLevel\"/>\r\n    <property name=\"med\" ref=\"medLevel\"/>\r\n    <property name=\"high\" ref=\"highLevel\"/>\r\n</bean>\r\n```\r\n\r\n#### Anotacions\r\n\r\nCom s'ha indicat en punts anteriors l'aplicació de la seguretat es fa amb una anotació. Aquesta Anotació està dissenyada per posar-se en els mètodes setter i getter dels TO's (Transfer Objects) responsables de la transferència de les dades entre la base de dades i els objectes de negoci de l'aplicació.\r\n\r\nUn exemple de com utilitzar la nova anotació seria el següent:\r\n\r\n```java\r\npackage cat.gencat.prova.bean.model;\r\n\r\nimport static javax.persistence.GenerationType.IDENTITY;\r\nimport java.util.Date;\r\nimport javax.persistence.*;\r\nimport org.springframework.context.annotation.Scope;\r\nimport org.springframework.stereotype.Component;\r\n*import cat.gencat.ctti.canigo.arch.support.lopd.annotation.LOPDSecure;*\r\n\r\n/**\r\n * TbUsuaris generated by hbm2java\r\n */\r\n@Entity\r\n@Table(name = \"TB_USUARIS\", schema = \"PUBLIC\")\r\n@NamedQueries({\r\n\t@NamedQuery(\r\n\t\t\tname=\"findUsuarisNomCognom\", \r\n\t\t\tquery=\"FROM TbUsuaris u WHERE u.nom like :nomUsuari AND u.cognoms like :cognomsUsuari\"),\r\n\t@NamedQuery(\r\n\t\t\tname=\"findUsuarisNom\", \r\n\t\t\tquery=\"FROM TbUsuaris u WHERE u.nom like :nomUsuari\"),\r\n\t@NamedQuery(\r\n\t\t\tname=\"findUsuarisCognom\", \r\n\t\t\tquery=\"FROM TbUsuaris u WHERE u.cognoms like :cognomsUsuari\")\r\n})\r\n\r\npublic class TbUsuaris implements java.io.Serializable {\r\n\r\n\tprivate static final long serialVersionUID = -3588947496944606464L;\r\n\tprivate Integer idUsuari;\r\n\tprivate String nom;\r\n\tprivate String cognoms;\r\n\tprivate String nif;\r\n\r\n\tpublic TbUsuaris() {\r\n\t}\r\n\r\n\tpublic TbUsuaris(String nom) {\r\n\t\tthis.nom = nom;\r\n\t}\r\n\r\n\tpublic TbUsuaris(String nom, String cognoms, String nif) {\r\n\t\tthis.nom = nom;\r\n\t\tthis.cognoms = cognoms;\r\n\t\tthis.nif = nif;\r\n\t}\r\n\r\n\t@Id\r\n\t@GeneratedValue(strategy = IDENTITY)\r\n\t@Column(name = \"ID_USUARI\", unique = true, nullable = false)\r\n\tpublic Integer getIdUsuari() {\r\n\t\tSystem.out.println(\"getIdUsuari\");\r\n\t\treturn this.idUsuari;\r\n\t}\r\n\r\n\tpublic void setIdUsuari(Integer idUsuari) {\r\n\t\tSystem.out.println(\"setIdUsuari\");\r\n\t\tthis.idUsuari = idUsuari;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"LOW\")//<--Nova Anotació de seguretat\r\n\t@Column(name = \"NOM\", nullable = false)\r\n\tpublic String getNom() {\r\n\t\tSystem.out.println(\"getNom\");\r\n\t\treturn this.nom;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"LOW\")//<--Nova Anotació de seguretat\r\n\tpublic void setNom(String nom) {\r\n\t\tSystem.out.println(\"setNom\");\r\n\t\tthis.nom = nom;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"MED\")//<--Nova Anotació de seguretat\r\n\t@Column(name = \"COGNOMS\")\r\n\tpublic String getCognoms() {\r\n\t\tSystem.out.println(\"getCognoms\");\r\n\t\treturn this.cognoms;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"MED\")//<--Nova Anotació de seguretat\r\n\tpublic void setCognoms(String cognoms) {\r\n\t\tSystem.out.println(\"setCognoms\");\r\n\t\tthis.cognoms = cognoms;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"HIGH\")//<--Nova Anotació de seguretat\r\n\t@Column(name = \"NIF\")\r\n\tpublic String getNif() {\r\n\t\tSystem.out.println(\"getNif\");\r\n\t\treturn this.nif;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"HIGH\")//<--Nova Anotació de seguretat\r\n\tpublic void setNif(String nif) {\r\n\t\tSystem.out.println(\"setNif\");\r\n\t\tthis.nif = nif;\r\n\t}\r\n}\r\n```\r\n\r\nCom es pot apreciar l'anotació\r\n\r\n```\r\n@LOPDSecure(value = [NIVELL_SEGURETAT])\r\n```\r\n\r\nestà informada davant de cada setter i getter on es vol que s'apliqui la seguretat. L'anotació pot posar-se davant d'un getter o davant d'un setter per separat, donant així la possibilitat d'aplicar la seguretat només a un determinat tipus d'accés a la dada.\r\nS'ha de tindre en compte que, en el cas especial de la política de seguretat HIGH, l'anotació ha d'anar en el setter i el getter de la dada en qüestió obligatòriament. Si no es fes així, la dada es xifraria i mai es podria recuperar el seu valor original o bé s'interpretaria com a xifrada quan no ho fos i s'intentaria desxifrar, provocant l'alteració del valor mostrat.\r\n\r\nUn altre aspecte important, també en relació a la política HIGH, és que el tipus de la dada que ha de figurar en la base de dades sempre ha de ser format text. Això és així per que el procés de xifrat transforma la dada (del tipus que sigui) en un array de bytes, perdent qualsevol informació del tipus original. S'haurà de tindre especial atenció en el xifrat de dades del tipus numèric o data, per aquest motiu.\r\n\r\n**Consulta de les dades**\r\n\r\nUna vegada aplicades les anotacions sempre que s'accedeixi a una dada on el seu getter o setter hagi sigut anotat es podrà consultar en el log de l'aplicació una traça com la següent:\r\n\r\n```\r\n[LOPD access entry][Property: Nif][of Class: cat.gencat.prova.bean.model.TbUsuaris][accessed by user: cscanigo][at: 30/11/2011 10:23:12]\r\n```\r\n\r\nDe cara al xifrat de les dades, totes les que hagin sigut anotades amb nivell de seguretat HIGH, apareixeran xifrades en base de dades.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWxvcGQ="},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL21hdHJpdXMtY29tcGF0aWJpbGl0YXRz":{"date":1427760000000,"title":"Matrius de Compatibilitats","description":"","sections":"Canigó","weight":1,"path":"/canigo-download-related/matrius-compatibilitats","content":"## Canigó 3.2.x\r\n\r\n|                                                       \t| 31/03/2017 (3.2.0) \t| 02/06/2017 (3.2.0.1) \t| 26/06/2017 (3.2.1) \t| 29/09/2017 (3.2.2) \t| 20/12/2017 (3.2.3) \t| 05/04/2018 (3.2.4) \r\n|-------------------------------------------------------\t|:------------------:\t|:------------------:\t|:------------------:\t|:------------------:\t|:------------------:\t|:------------------:\r\n| **canigo.core**                                       \t|        3.2.0       \t|        3.2.0          |        3.2.1          |        3.2.2       \t|        3.2.3          |               \r\n|\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t                    |\t\r\n| **canigo.persistance.jpa**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|        1.2.2          |                \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|    [3.2.0,3.3.0)      |                    \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.security**                                   \t|        1.2.0       \t|               \t    |        1.2.1       \t|        1.2.2       \t|        1.2.2       \t|               \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|       \t            |    [3.2.0,3.3.0)   \t|    [3.2.0,3.3.0)   \t|    [3.2.0,3.3.0)   \t|                      \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.web.core**                                   \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.web.jsf**                                    \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.web.rs**                                      \t|        1.0.0       \t|                       |                       |        1.1.0       \t|        1.1.1          |        1.1.2                 \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|    [3.2.0,3.3.0)      |    [3.2.0,3.3.0)           \r\n| canigo.web.core\t\t\t\t\t\t\t\t\t\t\t|    [1.2.0,1.3.0)      |                       |                       |    [1.2.0,1.3.0)      |    [1.2.0,1.3.0)      |    [1.2.0,1.3.0)          \r\n|\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\t\t\t\t\t\t|                       |                       |\t\t\t\t\t\t|                       |                     \r\n| **canigo.support.fileupload**                         \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.web.core                                       \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n| canigo.integration.antivirus                          \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.support.lopd**                               \t|        1.4.0       \t|                       |                       |        1.4.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.security                                       \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.support.mailing**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |        1.2.2          \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |    [3.2.0,3.3.0)             \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.support.merging**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.support.ole**                                \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.support.sftp**                               \t|        1.2.0       \t|        1.2.1          |        1.2.1          |        1.2.2       \t|                       |                 \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|    [3.2.0,3.3.0)      |    [3.2.0,3.3.0)      |    [3.2.0,3.3.0)   \t|                       |          \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.operation.instrumentation**                  \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |        1.2.2             \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |    [3.2.0,3.3.0)              \r\n| canigo.web.core                                       \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |    [1.2.0,1.3.0) \r\n|\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\t\t\t\t\t\t|                       |                       |\t\t\t\t\t\t|                       |                     \r\n| **canigo.operation.instrumentation.jsf**                  |        1.0.0       \t|                       |                       |        1.0.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.web.jsf                                       \t\t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.operation.logging**                          \t|       1.1.0          \t|                       |                       |       1.1.1          \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)     \t|                       |                       |    [3.2.0,3.3.0)     \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.antivirus**                      \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.avisosalertes.pica**             \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.dni.pica**                       \t|        1.3.0       \t|                       |                       |        1.3.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.documentum(5.3)**                \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.documentum(6.5)**                \t|        2.2.0       \t|                       |                       |        2.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.documentum(7.1)**                \t|        3.1.0         \t|                       |                       |        3.1.1         \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)     \t|                       |                       |    [3.2.0,3.3.0)     \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.gecat**                          \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.integration.sap                                \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.icc**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.integration.icc.datatypes                      \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.icc.datatypes**                  \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.notificacions.electroniques**    \t|        1.4.0       \t|                       |                       |        1.4.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.notificacions.electroniques.ws** \t|        2.2.0       \t|                       |                       |        2.2.0       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.integration.notificacions.electroniques        \t|    [1.2.0,1.3.0)    \t|                       |                       |    [1.2.0,1.3.0)      |                       |                     \t\r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.padro.pica**                     \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.pica**                           \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.psgd**                           \t|       1.2.0         \t|                       |                       |       1.2.1         \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)     \t|                       |                       |    [3.2.0,3.3.0)     \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.psis**                           \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.sap**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.sarcat**                         \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.support.sftp                                   \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.sarcat.pica**                    \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.sgde**                           \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.operation.instrumentation                      \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.ssc**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.operation.instrumentation                      \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n| **canigo.integration.tributs.pica**                   \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                     \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                     \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                     \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                     \r\n\r\n\r\n## Canigó 3.1.x\r\n\r\n|                                                       \t| 07/11/2014 (3.1.0) \t| 20/11/2014 (3.1.1) \t| 25/10/2015 (3.1.2) \t| 25/05/2016 (3.1.3) \t| 25/10/2016 (3.1.4) \t|\r\n|-------------------------------------------------------\t|:------------------:\t|:------------------:\t|:------------------:\t|:------------------:\t|:------------------:\t|\r\n| **canigo.core**                                       \t|        3.1.0       \t|        3.1.1       \t|                    \t|                    \t|                    \t|\r\n| **canigo.persistance.jpa**                            \t|        1.1.0       \t|                    \t|                    \t|        1.1.1       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.security**                                   \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.web.core**                                   \t|        1.1.0       \t|                    \t|        1.1.1       \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.web.jsf**                                    \t|        1.2.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.web.core                                       \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.web.validators**                             \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.web.jsf                                        \t|    [1.2.0,1.3.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.fileupload**                         \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.web.core                                       \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.integration.antivirus                          \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.lopd**                               \t|        1.1.0       \t|                    \t|        1.3.0       \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|\r\n| canigo.security                                       \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.mailing**                            \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.merging**                            \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.ole**                                \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.resizeimg**                          \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.sftp**                               \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.operation.instrumentation**                  \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.web.core                                       \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.operation.logging**                          \t|                    \t|                    \t|                    \t|                    \t|        1.0.1       \t|\r\n| canigo.core                                           \t|                    \t|                    \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.antivirus**                      \t|        1.1.0       \t|                    \t|        1.2.0       \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.avisosalertes.pica**             \t|        1.1.0       \t|                    \t|        1.1.1       \t|        1.1.2       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.dni.pica**                       \t|        1.1.0       \t|                    \t|                    \t|        1.2.0       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.documentum(5.3)**                \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.documentum(6.5)**                \t|        2.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.documentum(7.1)**                \t|                    \t|                    \t|                    \t|        3.0.0       \t|                    \t|\r\n| canigo.core                                           \t|                    \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.gecat**                          \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.integration.sap                                \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.icc**                            \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.integration.icc.datatypes                      \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.icc.datatypes**                  \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.notificacions.electroniques**    \t|        1.2.0       \t|                    \t|                    \t|        1.3.1       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.notificacions.electroniques.ws** \t|        2.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.integration.notificacions.electroniques        \t|        1.2.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.padro.pica**                     \t|        1.1.0       \t|                    \t|                    \t|        1.1.1       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.pica**                           \t|        1.1.0       \t|                    \t|        1.1.1       \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.psgde**                          \t|                    \t|                    \t|                    \t|        1.1.0       \t|        1.1.2       \t|\r\n| canigo.core                                           \t|                    \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|    [3.1.0,3.2.0)   \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.psis**                           \t|        1.1.0       \t|                    \t|        1.1.1       \t|        1.1.2       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.sap**                            \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.sarcat**                         \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.support.sftp                                   \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.sarcat.pica**                    \t|        1.1.0       \t|                    \t|        1.1.1       \t|        1.1.2       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.sgde**                           \t|        1.1.0       \t|                    \t|        1.2.0       \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|\r\n| canigo.operation.instrumentation                      \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.ssc**                            \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.operation.instrumentation                      \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.tributs.pica**                   \t|        1.1.0       \t|                    \t|        1.1.1       \t|        1.1.2       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n\r\n\r\n## Canigó 3.0\r\n\r\n- [Matriu Compatibilitat 3.0.x](/related/canigo/download/Matriu+Compatibilitat+Canigó3.0.6.pdf)\r\n\r\n\r\n\r\n\r\n\r\n\r\n","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL21hdHJpdXMtY29tcGF0aWJpbGl0YXRz"},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3BsdWdpbi1jYW5pZ28=":{"date":1490918400000,"title":"Plugin Canigó per a Eclipse","description":"Plugin d'eclipse per a generar una aplicació Canigó.","sections":"Canigó.","weight":1,"path":"/canigo-download-related/plugin-canigo","content":"## Introducció\r\n\r\n### Propòsit\r\n\r\nEl plugin de Canigó per a Eclipse permet crear de forma automàtica l'esquelet d'una aplicació Canigó. L'aplicació que es crea està orientada a servir com a punt de partida per a la creació d'una aplicació més complexe, però des del moment de la seva creació ja es desplegable i funcional.\r\n\r\n#### Eclipse Mars\r\n\r\nLa última versió del plugin està certificada amb la versió d'Eclipse Mars, que podeu trobar al següent enllaç: https://eclipse.org/downloads/packages/eclipse-ide-java-ee-developers/marsr\r\n\r\n### Prerequisit\r\n\r\nAbans de realitzar la instal·lació del plugin Canigó s'ha de configurar el settings.xml del Maven per a tenir referenciats el [repositori de Canigó] (/canigo/download)\r\n\r\n### Instal·lació\r\n\r\nA la pestanya Help de l'Eclipse seleccionar \"Install New Software...\"\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img1.jpg)\r\n\r\nPrèmer sobre el botó Add i afegir el respository de Canigó:\r\nhttp://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.plugin/update-site/\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img2.jpg)\r\n\r\nSeleccionar **Plug-in Canigo 3.2 - Canigo 3.2**\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img13.jpg)\r\n\r\n## Crear Aplicació Canigó\r\n\r\nA la vista Package Explorer de l'Eclipse fer botó dret: New -> Other\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img4.jpg)\r\n\r\nSeleccionar Assistent Projectes Canigó -> Crear un Projecte Canigó\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img10.jpg)\r\n\r\nEl plugin genera una aplicació REST amb un CRUD de demo implementat amb HTML5/Javascript. \r\n\r\nEs dóna llibertat per triar la tecnologia per a realitzar el front-end (AngularJS, Bootstrap, EmberJS...) sempre que es compleixi el PIV de Gencat.\r\n\r\nL'aplicació inicial que es crea amb el plugin inclou d'inici:\r\n\r\n* mòdul de persistència (Base de dades a memòria H2)\r\n* mòdul d'administració de logs\r\n\r\nPer a desplegar l'aplicació només s'ha de compilar \"mvn install\" i arrencar l'aplicació utilitzant Spring Boot.\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img11.jpg)\r\n\r\nL'aplicació demo porta incorporat Swagger i és aquesta la pantalla que es carrega quan s'accedeix a http://localhost:8080/canigo-api.html\r\n\r\nPer defecte, les APIs REST es publiquen a http://localhost:8080/api/*:\r\n\r\nExemples:\r\n\r\n* http://localhost:8080/api/equipaments/\r\n* http://localhost:8080/api/equipaments/1\r\n\r\nLa url per accedir al mòdul d'administració de logs és http://localhost:8080/loggingAdministration.html \r\n\r\nPer a més informació sobre aquest mòdul consultar la [documentació](/canigo-documentacio-versions-3x-core/modul-logging-admin/)\r\n\r\n## Afegir/Esborrar nous mòduls\r\n\r\nPer afegir o treure mòduls de Canigó el plugin proporciona la possibilitat de fer-ho de forma automàtica.\r\n\r\nS'ha de prèmer sobre el projecte, botó dret -> Canigó\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img9.jpg)\r\n\r\nPer exemple, per a afegir el mòdul de seguretat el plugins ens donarà la opció a triar si es desitja utilitzar JWT i el provider de seguretat a utilitzar (Arxiu, BBDD, Gicar o LDAP)\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img12.jpg)\r\n\r\n","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3BsdWdpbi1jYW5pZ28="},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTI=":{"date":1427760000000,"title":"Release Notes Canigó 2.3.20","description":"","sections":"Canigó","weight":1,"path":"/canigo-download-related/release-notes-canigo-2","content":"#### Canvis\r\n\r\n- Canvi [CAN-1726](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1726): Notificacions electròniques <br>\r\n<b>Context</b>: Actualització del connector de la PICA amb el producte NT <br>\r\n<b>Connector afectat</b>: canigo-connectors-nt <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n- Canvi [CAN-1735](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1735): Actualització connector AEAT PICA  <br>\r\n<b>Context</b>: Actualització del connector de la PICA amb el producte AEAT <br>\r\n<b>Connector afectat</b>: canigo-connectors-pica-tributs <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n- Canvi [CAN-1745](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1745): Actualització connector AEAT-TGSS  <br>\r\n<b>Context</b>: Actualització del connector de la PICA amb el producte TGSS <br>\r\n<b>Connector afectat</b>: canigo-connectors-pica-tributs <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n- Canvi [CAN-1824](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1824): Consulta error connector pica  <br>\r\n<b>Context</b>: Arrel d'una consulta sobre el connector de PSIS es detecta que cal actualitzar-ho donat que un dels camp que s'envia a la petició ha passat de ser opcional a obligatori i el connector no deixava informar-ho. <br>\r\n<b>Servei afectat</b>: canigo-connectors-psis <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n#### Bugs sol·lucionats\r\n\r\n- Bug [CAN-1683](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1683) El connector de DNI no permet informar el camp funcionari <br>\r\n<b>Context</b>: Problemes amb la impossibilitat de poder informar un valor a les crides del connector de la PICA-DNI.<br>\r\n<b>Servei afectat</b>: canigo-connectors-pica-dni<br>\r\n<b>Solució</b>: Modificació del connector <br>\r\n\r\n- Bug [CAN-1765](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1765) Problemàtica en l'enviament d'e-mails <br>\r\n<b>Context</b>: Problemes del servei a l'hora d'obtenir el Transport<br>\r\n<b>Servei afectat</b>: canigo-services-mailing<br>\r\n<b>Solució</b>: Modificació del connector <br>\r\n\r\n- Bug [CAN-1884](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1884) Canigó integracions externes per Proxy<br>\r\n<b>Context</b>: Problemes al intentar informar un campal desplegar amb Weblogic si es sobreescriuen certes variables a nivell global d'instància de JVM.<br>\r\n<b>Servei afectat</b>: canigo-services-webservices<br>\r\n<b>Solució</b>: Modificació del servei <br>\r\n\r\n- Bug [CAN-1789](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1789) Botó submit bloquejat a google chrome<br>\r\n<b>Context</b>: Problemes amb el volum de dades que s'envien a validar mitjançant un formulari.<br>\r\n<b>Servei afectat</b>: canigo-services-client<br>\r\n<b>Solució</b>: Modificació de scripts que intervenen a l'enviament de dades de formularis <br>","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTI="},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTMx":{"date":1427760000000,"title":"Release Notes Canigó 3.1","description":"","sections":"Canigó","weight":1,"path":"/canigo-download-related/release-notes-canigo-31","content":"#### Release Note\r\n\r\n[Canigó 3.1.0](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10420)\r\n\r\n[Canigó 3.1.1](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10430)\r\n\r\n[Canigó 3.1.2](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10431)\r\n\r\n[Canigó 3.1.3](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10438)\r\n\r\n[Canigó 3.1.4](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10460)\r\n\r\n\r\n\r\n","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTMx"},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTMy":{"date":1525392000000,"title":"Release Notes Canigó 3.2","description":"","sections":"Canigó","weight":1,"path":"/canigo-download-related/release-notes-canigo-32","content":"#### Release Notes\r\n\r\n[Canigó 3.2.4] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10494) (05/04/2018)\r\n\r\n- [No incloure per defecte els endpoints infoProperties i infoModules] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2287)\r\n- [Incorporar Bean mailSender a Canigo support mailing configurable] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2269)\r\n- [Ampliar l'endpoint de canigo.operation.instrumentation] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2273)\r\n\t\r\n[Canigó 3.2.3] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10464) (20/12/2017)\r\n\r\n- [Desenvolupament de jars amb test unitaris per als mòduls Canigó] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2221)\r\n\r\n[Canigó 3.2.2] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10463) (29/09/2017)\r\n\r\n- [Augmentar el logs existents en els mòduls de Canigó] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2244)\r\n- [Actualització Llibreries] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2239)\r\n- [Millores per donar suport a les millors pràctiques d'APIs REST] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2218)\r\n\r\n[Canigó 3.2.1](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10461) (26/06/2017)\r\n\r\n- [Actualització llibreries del mòdul SFTP] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2207)\r\n- [Fer configurable l'scan del Controller AuthController] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2193)\r\n- [Fer configurable el path d'on es carreguen les propietats al Servei de configuració] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2189)\r\n\r\n[Canigó 3.2.0.1](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10462) (02/06/2017)\r\n\r\n- [Actualització llibreries del mòdul SFTP] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2207)\r\n\r\n[Canigó 3.2.0](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10450) (31/03/2017)\r\n\r\n- [Actualització plantilla Canigó i plugin Eclipse] (http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2146)\r\n- [Suport REST i deprecar JSF] (http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2127)\r\n- [Incorporació noves llibreries] (http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2125)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTMy"},"L2NlbnRyZS1kZS1zdXBvcnQvYWNjZXM=":{"date":1422115902000,"title":"Accés a les eines de suport","description":"Eines de les que disposem per a comunicar-nos amb el CS Canigó","sections":"Centre de Suport","weight":2,"path":"/centre-de-suport/acces","content":"Per obtenir suport de l'Oficina Tècnica del Framework J2EE s'han de seguir els seguents passos: \r\n\r\n - Accedir a l'eina de Gestió d'Incidències: Es pot accedir mitjançant l'enllaç [Obtenir Suport](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN).\r\n \r\n <CENTER>![PHP](/images/cstd/jira.jpg)</center>\r\n\r\n - Donar d'alta una incidència: Podeu trobar més informació [aquí] (/centre-de-suport-related/obertura-peticions)\r\n - Fer el seguiment\r\n - Tancar la incidència\r\n \r\nPer veure en detall quins son els procediments i protocols que segueix el Centre de Suport Canigó per a cadascuna de les activitats ho pots trobar [aquí] (/centre-de-suport-related/procediments-protocols)","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvYWNjZXM="},"L2NlbnRyZS1kZS1zdXBvcnQvY29udGFjdGE=":{"date":1465575102000,"title":"Contacta amb el CS Canigó","description":"","weight":10,"path":"/centre-de-suport/contacta","content":"* [oficina-tecnica.canigo.ctti@gencat.cat](mailto://oficina-tecnica.canigo.ctti@gencat.cat)\r\n* [Centre de Suport Tecnològic al Desenvolupament](http://cstd.ctti.gencat.cat/)","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvY29udGFjdGE="},"L2NlbnRyZS1kZS1zdXBvcnQvZmFx":{"date":1422115902000,"title":"Preguntes freqüents","description":"Preguntes i peticions més freqüents adreçades al CS Canigó","sections":"Centre de Suport","weight":3,"path":"/centre-de-suport/faq","content":"## Accés al portal\r\n### Com demanar un usuari d'accés?\r\nEnviant un correu a la bústia <oficina-tecnica.canigo.ctti@gencat.cat> amb el següent [formulari](/related/cs/formulari-altes.xls) omplert.\r\n\r\n## Formació\r\n### Com capacitar-se en Canigó?\r\nMitjançant la realització de cursos presencials que es poden sol- licitar a través de la bústia del Centre de Suport\r\n\r\n### Com inscriure's en un curs presencial?\r\nEnviar un correu a la bústia <oficina-tecnica.canigo.ctti@gencat.cat> indicant:\r\n\r\n- Curs i data\r\n- Nombre de persones a inscriure i llistat dels seus noms, dnis i correus eletrònics\r\n- Departament/proveïdor\r\n- Projecte\r\n- Motius de la necessitat\r\n\r\n\r\n### Com sol.licitar un curs presencial fora de calendari?\r\nEnviar un correu a la bústia <oficina-tecnica.canigo.ctti@gencat.cat> indicant:\r\n\r\n- Curs sol.licitat\r\n- Motius de la necessitat de formació\r\n- Projecte associat\r\n- Proveïdor destinatari de la formació\r\n- Data d'inici desitjada\r\n- Nombre d'assistents previstos\r\n\r\n\r\n## Incidències, Peticions de canvi, Consultes i Suport\r\n### Com introduir una incidència, petició de canvi, consulta o petició de suport?\r\nDes del portal escollir l'opció [Obtenir Suport](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN).\r\n\r\n## Col.laboracions\r\n### Com informar d'una col- laboració a Canigó?\r\nSi es considera que una funcionalitat pot ser incorporada a Canigó enviar un correu a la bústia <oficina-tecnica.canigo.ctti@gencat.cat> informant dels objectius de la col.laboració, així com de la informació tècnica si es considera necessari. Qualsevol col.laboració serà avaluada per l'Oficina Tècnica.\r\n\r\nEn cas d'aprovació s'adaptarà als estàndards de qualitat, codificació i documentació de Canigó, i es procedirà a la seva integració per una posterior versió.\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvZmFx"},"L2NlbnRyZS1kZS1zdXBvcnQvcXVlLWVzLWVsLWNz":{"date":1422115902000,"title":"El Centre de suport Canigó","description":"Què és el Centre de suport Canigó?","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport/que-es-el-cs","content":"El Centre de Suport Canigó s'orienta a proporcionar serveis d'acompanyament als Departaments oferint el suport i assessorament tecnològic necessaris per tal d'assolir l'èxit de les seves noves iniciatives tecnològiques així com donar suport al correcte funcionament de les aplicacions i serveis actualment desplegats.\r\n\r\nActualment el Centre de Suport ofereix aquests serveis per a 3 productes diferents:\r\n\r\n* **Framework Canigó**: espai comú de treball per al desenvolupament de noves aplicacions amb tecnologia JEE basades en entorn web. Aquest framework es composa de diferents serveis i proporciona una arquitectura d'aplicacions consistent i única per tots els desenvolupaments.\r\n* **Servei d'Integració Contínua (SIC)**: està composat per diferents sistemes que ens permeten, entre d'altres, el repositori controlat del codi font dels diferents sistemes d'informació de la Generalitat, i la construcció de l'aplicació a partir d'aquest codi i el seu desplegament a les infraestructures de la Generalitat.\r\n* **Plataforma formularis electrònics**: plataforma que permet la interacció amb formularis electrònics basats en Adobe Livecycle ES4. Ofereix les funcionalitats d'extracció de dades dels formularis o la seva renderització, a més de la publicació i activació de nous formularis.\r\n\r\n## Quins són els seus objectius?\r\n\r\nEls objectius principals del Centre de Suport es poden resumir en els següents aspectes:\r\n\r\nPel que fa als usuaris dels productes del Centre de Suport Canigó:\r\n\r\n* Assegurar l'èxit en la construcció i implantació de les aplicacions basades en els nostres productes.\r\n* Garantir la qualitat dels sistemes que es desenvolupin sobre Canigó.\r\n* Assegurar que tota la informació relacionada amb els productes del centre de suport arriba als col- lectius que la necessiten.\r\n* Oferir formació i suport tècnic especialitzat (incidències, consultes, ...)\r\n\r\nPel que fa als propis productes del Centre de Suport Canigó:\r\n\r\n* Asegurar la seva evolució tant a nivell correctiu com evolutiu.\r\n* Garantir la màxima qualitat dels nostres productes, tant pel que fa al codi com al material de suport.\r\n* Planificar, controlar i produir de forma continuada noves versions o evolucions, seguint les necessitats de la Generalitat.\r\n* Garantir la total integració de Canigó, i els altres productes, en l'entorn TIC de la Generalitat de Catalunya.\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvcXVlLWVzLWVsLWNz"},"L2NlbnRyZS1kZS1zdXBvcnQvcm9hZG1hcA==":{"date":1443139200000,"lastmod":"2018-04-16","title":"Roadmap CS Canigó","description":"Roadmap del CS Canigó: Canigó, SIC i SGDE","sections":"Roadmap","weight":5,"categories":["canigo","sic","sgde"],"path":"/centre-de-suport/roadmap","content":"<!--Aquest és el Roadmap del CS Canigó per als serveis Canigó, SIC i SGDE:\r\n<iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1ycTBuP_02_fFQYHePMhAxAnNt70R4GyTP4phJn3EHi8&font=Default&lang=ca&initial_zoom=1&height=600&start_at_slide=20' width='100%' height='600' frameborder='0'></iframe-->\r\n\r\n\r\n<link title=\"timeline-styles\" rel=\"stylesheet\" href=\"https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css\" />\r\n\r\n<script src=\"/js/sheet2array.js\"></script>\r\n<script src=\"https://cdn.knightlab.com/libs/timeline3/latest/js/timeline.js\"></script>\r\n\r\n<div id='timeline-embed' style=\"width: 100%; height: 600px;\"></div>\r\n\r\n<script type=\"text/javascript\">\r\n\r\n\t   $.getJSON(\"https://script.google.com/macros/s/AKfycbwXOwdyefmpRayODliduXDI2m0wCm_TKMiB_tQkkDDKaA4l9WQ/exec?callback=?\", null, function(results){\r\n\t   \t\t\t\r\n\t\t\t\tvar additionalOptions = {\r\n\t\t\t    \tstart_at_slide: 43,\r\n\t\t\t        timenav_height: 200,\r\n\t\t\t        height : 650,\r\n\t\t\t        initial_zoom: 12,\r\n\t\t\t        language : \"ca\"\r\n\t\t\t    }\t   \t\t\t\r\n\r\n\t\t\t    console.log(additionalOptions)\r\n\r\n\t\t\t  \ttimeline = new TL.Timeline('timeline-embed', 'https://docs.google.com/spreadsheets/d/1ycTBuP_02_fFQYHePMhAxAnNt70R4GyTP4phJn3EHi8/pubhtml', additionalOptions);\r\n\t   });\r\n\r\n\r\n</script>\r\n\r\n*Aquest Roadmap està subjecte a canvis*\r\n<br><br>\r\nAl següent [enllaç](/canigo/roadmap/) es pot trobar el roadmap del Framework Canigó\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvcm9hZG1hcA=="},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9lc3RhdC13b3JrZmxvdyBlc3BhaSBzdXBvcnQ=":{"date":1422115902000,"title":"Estats i workflow de l'espai de suport (incidències, consultes i peticions de canvi)","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/estat-workflow espai suport","content":"### Introducció \r\n\r\nL'espai de suport permet reportar diferents activitats relacionades amb el Framework Canigó. Una activitat pot ser una incidència, una consulta o una petició de canvi.\r\n\r\n - Una incidència informa d'un bug en un servei, i per una versió concreta, del Framework Canigó. Aquest bug, si finalment és tal, ha d'acabar generant una petició de canvi (s'ha de fer una actualització del codi font de Canigó).\r\n - Una consulta planteja un dubte relacionat amb l'ús del Framework Canigó o bé amb el propi Framework Canigó.\r\n - De vegades, un projecte concret necessita una funcionalitat no desenvolupada en el Framework Canigó. En aquests casos, es pot sol- licitar una petició de canvi demanant aquesta nova funcionalitat. Per tal de poder valorar correctament la necessitat d'aquesta petició cal que s'informi amb el màxim detall possible el context (situació inicial que requereix del canvi), i necessitat del canvi (per què s'hauria de fer aquest canvi en el Framework. Si s'han provat solucions alternatives, resultat d'aquestes proves, ...).\r\n \r\n Aquests tipus d'activitats tenen definit un workflow que ens permet, en cada moment, identificar l'estat en què es troba l'activitat (si està assignada, si està en progrés, si està pendent, ...).\r\n\r\nEn els següents apartats s'expliquen els diferents estats pels quals pot passar una activitat i el que signifiquen cadascun d'ells. \r\n\r\n#### 1. Incidències i consultes.\r\n\r\n<b>Estats</b>\r\n\r\n - <b>Nou</b>: el reportador ha donat d'alta una nova incidència o consulta. L'OT de Canigó s'encarregarà de classificar (indicar la seva prioritat) i assignar a una persona de l'Oficina Tècnica de Canigó la nova incidència o consulta.<br>\r\n\t\t- Estats següents: <b>Assignat</b>.\r\n - <b>Assignat</b>: la incidència o consulta ha estat assignada a una persona de l'Oficina Tècnica de Canigó que serà l'encarregada de la resolució i seguiment de la mateixa.<br>\r\n\t\t- Estats següents: En <b>progrés</b> (s'ha iniciat la resolució de la incidència o consulta), <b>Assignat</b> (es reassigna aquesta activitat a una altra persona de l'Oficina Tècnica de Canigó).\r\n - <b>En progrés</b>: la persona encarregada de l'activitat ha passat a estudiar la seva resolució.<br>\r\n\t\t- Estats següents: <b>Resolt</b> (la persona encarregada de l'activitat proposa una solució pel problema reportat), <b>Pendent</b> (la persona encarregada de l'activitat considera que falten dades per arribar a la resolució de la mateixa), <b>Assignat</b> (s'escala el problema perquè no es considera una incidència o consulta sinò una petició de canvi que cal estudiar i avaluar, en aquest cas l'activitat s'assignarà a la persona de l'equip encarregada dels Evolutius del Framework Canigó).\r\n - <b>Pendent</b>: l'OT de Canigó està en espera de què el reportador de l'activitat afegeixi les dades que se li han demanat.<br>\r\n\t\t- Estats següents: En <b>progrés</b> (el reportador ha afegit les dades que se li han demanat i es continua amb la resolució de l'activitat), <b>Tancat</b> per \"<b>Falta d'informació</b>\" (en aquest cas han passat tres o més dies des que es va sol- licitar més informació per la resolució de l'activitat i el reportador de la mateixa no l'ha afegida), <b>Assignat</b> (el reportador de l'activitat ha afegit les dades i així ho comunica, opció \"<b>Dades afegides</b>\").\r\n - <b>Resolt</b>: des de l'OT de Canigó s'ha donat una solució per l'activitat reportada.<br>\r\n\t\t- Estats següents: <b>Tancat</b< en aquest cas el reportador de l'activitat pot tancar-la indicant el grau de satisfacció de la solució proposada, valorant-la d'1 a 5. Anàlogament, l'OT de Canigó pot tancar l'activitat per \"<b>Tancada automàticament</b>\" en el cas que el reportador de l'activitat no l'hagi tancat havent transcorregut tres o més dies. Finalment, un altre estat al que es pot arribar a partir d'aquest és \"<b>Assignat</b>\", aquest és l'estat al que s'arriba quan el reportador de l'activitat no queda conforme amb la resolució donada, amb ell indica que vol que la persona encarregada de la resolució de l'activitat proposi una altra solució.\r\n\t\t\r\n####  2. Peticions de canvi.\r\n\r\n<b>Estats</b>\r\n\r\n - <b>Nou</b>: el reportador ha donat d'alta una petició de canvi. L'OT de Canigó s'encarregarà de classificar (indicar la necessitat d'aquest canvi) i assignar-la a una persona de l'Oficina Tècnica de Canigó la nova<br>\r\nEstats següents: <b>Assignat, Resolt.</b>\r\n - <b>Classificat</b>: l'OT ha classificat la necessitat de la petició de canvi.<br>\r\nEstats següents: <b>En valoració</b> en aquest estat, l'OT valora la necessitat del canvi i estudia la seva planificació.\r\n - <b>En valoració</b>: l'OT indica el temps inicial estimat per dur a terme el canvi demanat així com la versió en què es publicarà el canvi.<br>\r\nEstats següents: <b>Aprovat</b> (el canvi demanat s'implementarà per futures versions de Canigó), <b>Pendent</b> (es requereixen mes dades per part del reportador de la petició de canvi per poder fer una valoració correcta de la petició de canvi), <b>Resolt</b> (no cal dur a terme el canvi indicat perquè aquest ja està resolt).\r\n - <b>Aprovat</b>: el canvi demanat s'implementarà per futures versions de Canigó.<br>\r\nEstats següents: <b>Assignat</b>\r\n - <b>Assignat</b>: la petició de canvi ha estat assignada a una persona de l'Oficina Tècnica de Canigó que serà l'encarregada de la implementació del canvi.<br>\r\nEstats següents: <b>En progrés</b>\r\n - <b>En progrés</b>: la persona encarregada de la petició de canvi comença la seva implementació.<br>\r\nEstats següents: <b>Pendent</b> (manca informació per part del reportador del canvi per dur a terme la implementació del canvi) i <b>Resolt</b> (s'ha dut a terme el canvi sol- licitat).\r\n - <b>Pendent</b>: la implementació de la petició de canvi s'ha aturat momentàniament per falta de dades per part del reportador del canvi.<br>\r\nEstats següents: <b>En Progrés</b> (el reportador ha indicat la nova informació i es continua amb la implementació del canvi) i <b>Tancat</b> (el reportador de la petició de canvi no inclou les dades demanades, es tanca la petició de canvi).\r\n - <b>Resolt</b>: s'ha finalitzat el canvi en el codi font del Framework Canigó.<br>\r\nEstats següents: <b>Tancat</b> (s'ha finalitzat el canvi) i <b>Classificat</b> (es reobre la petició de canvi, cal tornar a estudiar-la per classificar-la convenientment).\r\n - <b>Tancat</b>: s'ha finalitzat el canvi.<br>","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9lc3RhdC13b3JrZmxvdyBlc3BhaSBzdXBvcnQ="},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9taWxsb3Jlcy1lc3BhaS1zdXBvcnQ=":{"date":1422115902000,"title":"Millores en l'espai de suport (incidències, consultes i peticions de canvi).","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/millores-espai-suport","content":"S'han afegit les següents funcionalitats en l'espai de suport:\r\n\r\n - S'ha afegit un apartat on es poden consultar les activitats més populars (aquelles activitats no resoltes ordenades per vots). Aquest nou apartat es troba a <b>\"Visualitzar Serveis\"</b> > <b>\"Activitats Populars\"</b>.\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9taWxsb3Jlcy1lc3BhaS1zdXBvcnQ="},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9vYmVydHVyYS1wZXRpY2lvbnM=":{"date":1422115902000,"title":"Obertura de peticions","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/obertura-peticions","content":"#### Tipus de peticions\r\n\r\nExisteixen 4 tipus diferents de peticions que es poden obrir pel servei Canigó (Framework J2EE).\r\n\r\n#### Peticions de Canvi\r\n\r\nPeticions indicades quan es creu interessant que el Framework reflecteixi algun canvi important en algun dels seus components o bé sorgeix la necessitat de crear algun component nou.\r\n\r\nTotes les peticions de canvi han d'anar acompanyades d'una explicació detallada dels motius pels quals es sol- licita el canvi.\r\n\r\nEl Centre de Suport avaluarà aquesta petició i conclourà si la desenvolupa o no en base a les necessitats de l'aplicació e impacte que aquest tingui sobre el Framework.\r\n\r\nEn cas de que es desenvolupi el canvi, normalment aquest estarà disponible en la següent versió de Canigó.\r\n\r\n#### Peticions de Consulta\r\n\r\nPeticions orientades a la resolució de qüestions relacionades amb la utilització del Framework de Canigó. En aquest tipus de peticions es poden redactar preguntes relacionades amb problemes derivats de l'ús dels components del Framework, errors de desenvolupament i dubtes varis.\r\n\r\nEl mateix Centre de suport s'encarregarà de canviar la categorització de Consulta a Incidència si es detectés un problema a nivell del Framework dintre de la petició.\r\n\r\n#### Peticions d'Incidència\r\n\r\nPeticions relacionades amb errors detectats dintre d'algun component del Framework. Aquests errors poden ser deguts a un ús incorrecte dels components del Framework. Per tal motiu es recomana llegir la documentació del Framework disponible en el portali en cas de dubte, obrir una petició de Consulta.\r\n\r\n#### Peticions de Suport\r\n\r\nPeticions que sol- liciten que el Centre de Suport de Canigó faci un seguiment més proper de l'aplicació per tal de resoldre algun problema específic o bé acompanyar i assessorar a l'aplicació en el transcurs d'un desenvolupament especial amb Canigó.\r\n\r\n\r\n### Dades de les Peticions\r\n\r\nInicialment s'han d'informar una sèrie de dades en el moment de la creació de la petició. Aquestes dades tot i que no siguin obligatòries per tal de crear la petició en el JIRA si ho són de cara a la resolució d'aquesta.\r\nLa carència d'aquestes dades allarga la resolució de la petició en molts casos i és per aquest motiu que es molt recomanable que s'omplin.\r\n\r\nLes peticions de canvi, incidència i consulta tenen les mateixes dades inicials per poder omplir-se. Comentarem aquelles que no són obligatòries i que es molt recomanable omplir per tal de facilitar la seva resolució per part del Centre de Suport.\r\n\r\n - Sumari: Breu descripció del motiu de la petició.\r\n - Urgència: Urgència que l'implica a l'aplicació la resolució de la petició.\r\n - Àmbit: Indica l'entorn on s'està produint el motiu de la petició si aplica.\r\n - Organisme / Projecte Afectat: Organisme i projecte al qual pertany l'aplicació que està obrint la petició.\r\n - Versions afectades: Informa la versió de Canigó que s'està utilitzant si aplica.\r\n - Components: Informa dels components del Framework afectats pel motiu de la petició si aplica.\r\n - Informador: Persona que informa la petició.\r\n - Descripció: Descripció detallada del motiu de la petició.\r\n - Adjunció: Dona la posibilitat d'afegir arxius adjunts a la petició en el moment de la seva creció.\r\n - Telèfon: Telèfon de contacte amb la persona/es responsables de l'aplicació o creadors de la petició.\r\n - Nivell de bloqueig: Grau de bloqueig que la petició provoca en les tasques a desenvolupar dintre de l'aplicació.\r\n - Servidor d'aplicacions: Servidor d'aplicacions que s'està utilitzant per desplegar l'aplicació si aplica.\r\n - JDK: Versió del Java Development Kit que s'està utilitzant per compilar l'aplicació si aplica.","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9vYmVydHVyYS1wZXRpY2lvbnM="},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9wcm9jZWRpbWVudHMtcHJvdG9jb2xz":{"date":1422115902000,"title":"Procediments i protocols en la gestió d'activitats (incidències, consultes i peticions de canvis)","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/procediments-protocols","content":"### Pel que fa a l'espai de suport (incidències, consultes i peticions de canvi).\r\n\r\nEn els següents pàgines s'expliquen diferents qüestions de l'espai de suport (incidències, consultes i peticions de canvis).\r\n\r\n - [Estats i workflow de l'espai de suport.] (/centre-de-suport-related/estat-workflow espai suport)\r\n - [Millores en l'espai de suport.] (/centre-de-suport-related/millores-espai-suport)\r\n \r\n### Procediment per classificar un canvi.\r\n\r\nAquí podrà consultar els procediments que es segueixen per classificar i atendre les peticions de canvis: [Procediment de Canvis] ()\r\n\r\n### Procediment per classificar una incidència.\r\n\r\nEn primera instància es tenen en compte el següents paràmetres: <b>àmbit, bloqueig i risc del projecte</b>. D'aquests paràmetres, i consultant unes taules, s'extreu <b>l'impacte del projecte</b>.\r\nEn segona instància es consideren dos paràmetres més: <b>l'impacte del projecte</b> (obtingut al pas anterior) i la <b>urgència de la incidència</b>, d'aquests dos paràmetres, i de nou consultant una altra taula, s'extreu la <b>prioritat de la incidència</b>.\r\n\r\n### Acord de nivell de servei i procediments.\r\n\r\nEl nivell de servei de l'Oficina Tècnica de Canigó considera la prioritat de la incidència per establir uns temps de resposta tant per part de l'OT com per part de l'usuari reportador de la incidència. Es considera, doncs, la següent taula:\r\n\r\n<b>Acords de nivell de servei (en hores)</b>\r\n\r\nPrioritat de la incidència | T0 | T1 | T2\r\n----|----|----|----\r\nMàxima|2|8|4\r\nAlta|2|16|8\r\nMitja|16|24|16\r\nBaixa|16|24|24\r\n\r\nPrioritat de les consultes | T0 | T1 | T2\r\n----|----|----|----\r\nNormal|16|24|24\r\n\r\nOn T0 és el temps màxim que pot transcorre des que es genera una activitat fins que es classifica i s'assigna a una persona de l'equip de l'OT, T1 és el temps màxim que pot transcorre per resoldre l'activitat i T2 és el temps màxim que pot transcorre pel tancament, per part del reportador, de l'activitat.\r\n\r\nPer tant, si una activitat RESOLTA no es tanca en el temps previst, aquesta es tancarà per <b>\"Defecte de forma\"</b>, doncs, implica que l'equip de l'OT ha donat una solució temporal a l'activitat reportada i que la persona reportadora de l'activitat no ha comentat res al respecte; s'entèn, doncs, que la resposta donada ha estat satisfactòria.\r\n\r\nAddicionalment, l'Oficina Tècnica de Canigó podrà tancar activitats reportades per:\r\n\r\n - \"<b>Fora d'àmbit.</b>\"Independentment de l'estat en que es trobi l'activitat, es considera que l'assumpte tractat en l'activitat no és de la competència de l'Oficina Tècnica de Canigó.\r\n - \"<b>Desconeixement del Framework</b>\".Independentment de l'estat en què es trobi l'activitat, es considera que el reportador de l'activitat demostra un desconeixement del framework Canigó, en aquests casos, s'acostumarà a redirigir a l'usuari reportador al Portal de Canigó a l'apartat de [documentació] (/canigo-documentacio).","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9wcm9jZWRpbWVudHMtcHJvdG9jb2xz"},"L2Nsb3VkL2Fx":{"date":1462924800000,"title":"Arquitectures tipus","description":"Exemples d'arquitectures","sections":"Container Cloud","weight":5,"toc":true,"categories":["cloud","docker","container","paas"],"path":"/cloud/aq","content":"## Introducció\r\n\r\n### Docker-compose\r\n\r\nEls diferents stacks tecnològics descrits en aquesta plana utilitzen [Docker Compose](https://docs.docker.com/compose/).\r\n\r\n#### Desplegament en entorns de desenvolupament\r\n\r\nCal haver [instal·lat](https://docs.docker.com/compose/install/) prèviament Docker Compose.\r\n\r\n#### Desplegament a Bluemix\r\n\r\n- Bluemix suporta la creació d'aplicacions multicontainer mitjançant Docker Compose.\r\n- A diferència que els grup de contenidors, si es vol escalar una de les capes (per exemple, la capa d'aplicació), cal aprovisionar un balancejador, en aquest cas es proposa HAProxy.\r\n- A Bluemix, és necessari configurar un procés d'espera entre els contenidors que tinguin relacions entre ells (per exemple l'aplicació ha d'esperar que la bbdd estigui operativa per a funcionar). Per a realitzar aquesta espera s'utiliza el procés wait-for-it.sh. Un exemple del seu ús es pot veure al [Stack “arquitectura moderna” JEE]({{< relref \"#stack-arquitectura-moderna-jee\" >}})\r\n- En un futur proper serà possible desplegar aplicacions en contenidors definides amb docker-compose a Bluemix mitjançant el [SIC](http://canigo.ctti.gencat.cat/sic/).\r\n\r\n## Stack \"tradicional\" JEE\r\n\r\n![Spring](/related/cloud/spring.png \"Spring\") ![JSF](/related/cloud/jsf.jpg \"JSF\")\r\n\r\nAplicació JSF (Java Server Faces) amb context \"/AppJava\" per separació contingut estàtic i dinàmic.\r\n\r\n<div class=\"message warning\">\r\n<b>Avís</b>\r\n<br>\r\nAquest és un stack que ja no s'hauria d'utilitzar per noves aplicacions.\r\n</div>\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencatcloud/demo-JEE-AppJava).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencatcloud/demo-JEE-AppJava.git demo-JEE-AppJava\r\n$ cd demo-JEE-AppJava\r\n$ mvn package\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d\r\n```\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-JEE-AppJava/src/main/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\ngicar:\r\n build: ./gicarAppJava/\r\n links:\r\n  - demo\r\n ports:\r\n  - 80:80\r\n environment:\r\n  PS_IP: 169.50.103.27\r\n  AgentConfigDocker: a6-demoFORM\r\n  ContainerHostName: [nom del contenidor]\r\n  AGENTNAME: a6-demoform,[nom de domini.gencat.cat]\r\n  HCOGICAR: a6\r\n  GICARUSER: registre\r\n  GICARPWD: registre\r\n  APPSERVER_PORT_8080_TCP_ADDR: demo\r\n  APPSERVER_PORT_8080_TCP_PORT: 8080 \r\n  context: canigoJSF\r\n volumes:\r\n  - /home/canigo/demo-JEE-AppJava/target/canigoJSF-static:/var/www/html/canigoJSF\r\ndb:\r\n  build: ./bbdd/\r\n  ports:\r\n    - 3306:3306\r\n  environment:\r\n    MYSQL_USER : user\r\n    MYSQL_PASSWORD : password\r\n    MYSQL_ROOT_PASSWORD: root\r\n    MYSQL_DATABASE: demo\r\n  volumes:\r\n   - /home/canigo/demo-JEE-AppJava/mysql-datadir:/var/lib/mysql\r\ndemo:\r\n  build: ./app/\r\n  links:\r\n    - db:mybbdd\r\n  volumes:\r\n   - /home/canigo/demo-JEE-AppJava/target/canigoJSF-dynamic:/opt/tomcat/webapps/canigoJSF\r\n  ports:\r\n   - 8080:8080\r\n   - 8000:8000\r\n```\r\nEls paths \"/home/canigo/...\" han d'adaptar-se als locals.\r\n\r\n- _canigoJSF-static_: directori amb el contingut estàtic de l'aplicació\r\n- _canigoJSF-dynamic_: directori amb el contingut dinàmic de l'aplicació\r\n- _mysql-datadir_: directori amb les dades del MySQL. Es crearà amb tot el contingut en iniciar per primera vegada l'aplicació\r\n\r\n<div class=\"message information\">\r\n<b>Informació</b>\r\n<br>\r\nEl valor \"nom del contenidor\" i el \"nom de domini\" els tria l'usuari. Per exemple:<br><br>\r\n<i>ContainerHostName</i>: dev<br>\r\n<i>AGENTNAME</i>: a6-demoform, provademo.gencat.cat<br><br>\r\nEn cas de voler accedir per domini en comptes de localhost, s'ha de mappejar aquest domini/ip al fitxer host\r\n(En linux /etc/host, en Windows C:\\Windows\\System32\\drivers\\etc\\hosts)\r\n</div>\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir des d'un navegador web a http://localhost/canigoJSF i introduïr l'usuari \"NIFDEMO\" i contrasenya \"12345678\". Els contenidors triguen a aixecar-se entre 30s i 60s, i per tant, cal esperar a realitzar l'accés aquest temps ja que en cas contrari l'aplicació no respondrà.\r\n\r\n## Stack \"arquitectura moderna\" JEE\r\n\r\n![Spring](/related/cloud/springboot.png \"Spring Boot\") ![Resftul API](/related/cloud/resftulapi.jpg \"Resftul API\") ![HTML5 JS CSS](/related/cloud/htmljscss.png \"HTML5 JS CSS\")\r\n\r\nAplicació basada en serveis REST i presentació desacoblada\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencatcloud/demo-JEE-REST).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencatcloud/demo-JEE-REST.git demo-JEE-REST\r\n$ cd demo-JEE-REST\r\n$ mvn package\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d\r\n```\r\n\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-JEE-REST/src/main/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\nlb:\r\n image: gencatcloud/haproxy:1.5.1\r\n links:\r\n  - bookstore\r\n ports:\r\n  - 80:80\r\ndb:\r\n  image: gencatcloud/postgres:9.5.3\r\n  ports:\r\n    - 5432:5432\r\n  environment:\r\n    POSTGRES_USER: demospringboot\r\n    POSTGRES_PASSWORD: password\r\n  volumes:\r\n    - /home/canigo/demo-JEE-REST/postgres-datadir:/var/lib/postgresql/data\r\nbookstore:\r\n  build: ./app/\r\n  links:\r\n    - db:postgres\r\n  volumes:\r\n   - /home/canigo/demo-JEE-REST/target/:/tmp\r\n  ports:\r\n    - 8080:8080\r\n    - 8000:8000\r\n  command: bash -c \"/wait-for-it.sh postgres:5432 -t 240 && /entrypoint.sh\"\r\n```\r\n\r\nEl paths “/home/canigo/…” han d’adaptar-se als locals.\r\n\r\n- /home/canigo/demo-JEE-REST/target/: directori on es troba el war de l'aplicació\r\n- /home/canigo/demo-JEE-REST/postgres-datadir: directori amb les dades del Postgres. Es crearà amb tot el contingut en iniciar per primera vegada l'aplicació.\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir des d'un navegador web a http://localhost/ i introduïr l'usuari \"admin\" i contrasenya \"admin\". Els contenidors triguen a aixecar-se entre 30s i 60s, i per tant, cal esperar a realitzar l'accés aquest temps ja que en cas contrari s'obtindrà un error \"503 Service Unavailable\".\r\n\r\n## Stack MEAN\r\n\r\n![MEAN](/related/cloud/stack_mean.png \"MEAN\")\r\n\r\nAplicació basada en MongoDB+Express+AngularJS+NodeJS\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencatcloud/demo-MEAN).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencatcloud/demo-MEAN.git demo-MEAN\r\n$ cd demo-MEAN\r\n$ docker-compose -f ./docker/docker-compose.yml up -d\r\n```\r\n\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-MEAN/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\ndb:\r\n  image: gencatcloud/mongodb:3.2\r\n  ports:\r\n    - 27017:27017\r\n    - 28017:28017\r\n  environment:\r\n    MONGODB_USER : user\r\n    MONGODB_PASS : password\r\n    MONGODB_DATABASE : contactlist\r\n  volumes:\r\n    - /home/canigo/demo-MEAN/datadir:/data/db\r\ndemo:\r\n  image: gencatcloud/nodejs:4.2.6\r\n  links:\r\n    - db:mybbdd\r\n  volumes:\r\n   - /home/canigo/demo-MEAN:/app\r\n  ports:\r\n   - 3000:3000\r\n  command: bash -c \"cd /app && npm install && node server\"\r\n```\r\n\r\nEl paths “/home/canigo/…” han d’adaptar-se als locals.\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir a http://localhost:3000/.\r\n\r\n## Stack LAMP \r\n\r\n![LAMP](/related/cloud/lamp.gif \"LAMP\")\r\n\r\nAplicació basada en Linux+PHP+MySQL\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencatcloud/demo-LAMP).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencatcloud/demo-LAMP.git demo-LAMP\r\n$ cd demo-LAMP\r\n$ docker-compose -f ./docker/docker-compose.yml up -d\r\n```\r\n\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-LAMP/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\ndb:\r\n  build: ./bbdd/\r\n  ports:\r\n    - 3306:3306\r\n  environment:\r\n    MYSQL_USER : user\r\n    MYSQL_PASSWORD : password\r\n    MYSQL_ROOT_PASSWORD: root\r\n    MYSQL_DATABASE: demo\r\n  volumes:\r\n   - /home/canigo/demo-LAMP/mysql-datadir:/var/lib/mysql\r\ndemo:\r\n  build: ./app/\r\n  links:\r\n    - db:mybbdd\r\n  volumes:\r\n   - /home/canigo/demo-LAMP:/var/www/html/demo-LAMP\r\n  ports:\r\n   - 80:80\r\n```\r\n\r\nEl paths “/home/canigo/…” han d’adaptar-se als locals.\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir a http://localhost/demo-LAMP/.\r\n\r\n## Altres\r\n\r\nA més de contenidors Docker, també és possible utilitzar xPaaS i DBaaS. Aquests són alguns casos d'èxit:\r\n\r\n### xPaaS + DBaaS\r\n\r\n- Exemple d'aplicació: http://serveisoberts.gencat.cat\r\n- Desplegat a Bluemix\r\n- Composat per:\r\n\t- Buildpack: NodeJS, amb **escalat automàtic**\r\n\t- DBaaS: MongoDB\r\n\r\n### Docker aplicació + Docker base de dades\r\n\r\n- Exemple d'aplicació: https://jocdelsdrets.gencat.cat\r\n- Desplegat a Bluemix\r\n- Composat per:\r\n\t- Grup de contenidors Docker per a la capa d'aplicació, amb **escalat automàtic**\r\n\t- Contenidor MySQL per a la capa de base de dades\r\n","objectID":"L2Nsb3VkL2Fx"},"L2Nsb3VkL2NhdGFsZWc=":{"date":1462924800000,"title":"Elements del catàleg","description":"Docker, xPaaS, DBaaS","sections":"Container Cloud","weight":2,"toc":true,"categories":["cloud","docker","container","paas"],"path":"/cloud/cataleg","content":"L'objectiu del \"Container Cloud\" - anomenarem així a les solucions basades en containers (CaaS, Containers as a Service) a cloud públic i privat - , es disposar d'una sèrie d'elements que ens permetin fer córrer el nostre software sobre entorns d'execució \"commodity\", sense conèixer la infraestructura subjacent.\r\n\r\nEn aquest sentit, treballarem amb dos elements principals - xPaaS i Docker - i amb altres solucions com a servei -com algunes bases de dades-:\r\n\r\n## **xPaaS**\r\n\r\nEls xPaaS són runtimes d'execució estàndards i, segons el \"gust\" sobre el que treballem, tindrà denominacions diferents. Anomenarem a tots d'aquesta manera per a unificar conceptes. Actualment, els nostres xPaaS es basaran en Cloud Foundry i OpenShift: \r\n\r\n- **buildpack** (Cloud Foundry), disponible a **cloud públic**\r\n\t* Liberty for Java\r\n\t* Node.js\r\n\t* Go\r\n\t* PHP\r\n\t* Python\r\n\t* Ruby\r\n\t* Static site (Nginx)\r\n\r\n<br />\r\n\r\n- **xpaas** (OpenShift), disponible a **cloud privat**\r\n\t* Tomcat\r\n\t* Node.js\r\n    * Perl\r\n\t* PHP\r\n\t* Python\r\n\t* Ruby\r\n\r\nLes denominacions en altres clouds són:\r\n\r\n- Elastic Beanstalk (Amazon Web Services)\r\n- App Service (Azure)\r\n- App Engine (Google)\r\n\r\nEn aquests xPaaS, quan es fa un \"push\" del codi o de l'artefacte, s'aixeca un entorn d'execució amb una potència i nombre d'instàncies prefixades.\r\n\r\n\r\n### Configuració de l'engine\r\n\r\nCada xPaaS dona suport a diferents versions de l'engine que ha d'executar el codi. Posem com a exemple el [buildpack Node.js de Cloud Foundry](https://github.com/cloudfoundry/nodejs-buildpack). Per tal de configurar la versió 4.x de l'engine de Node.js corresponent a la versió actual CTTI del [full de ruta](https://portic.ctti.gencat.cat/les_tic/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf), cal fer la següent configuració en el fitxer \"package.json\" ubicat a l'arrel de l'aplicació:\r\n\r\n_package.json_\r\n\r\n```\r\n{\r\n\tname: \"AppDemoNodeJS\",\r\n\tversion: \"0.0.1\",\r\n\tprivate: true,\r\n\tscripts: {\r\n\t\tstart: \"node app.js\",\r\n\t\ttest: \"make test\"\r\n\t},\r\n\tengines: {\r\n\t\tnode: \"4.6.0\"\r\n\t},\r\n\tdependencies: {\r\n\t\texpress: \"^4.13.3\",\r\n\t\t...\r\n\t},\r\n\tdevDependencies: {\r\n\t\tmocha: \"^2.4.5\",\r\n\t\t...\r\n\t}\r\n}\r\n```\r\n\r\nCom es pot observar, en la secció engines cal especificar la versió exacte de Node.js amb que volem que s'executi l'aplicació. En cas que no s'especifiqui, el buildpack executarà la versió per defecte que tingui establerta. En el cas del buildpack Node.js de Cloud Foundry coincideix amb la versió que hem indicat en el descriptor \"package.json\" de l'aplicació:\r\n\r\n_manifest.yml_ (veure a [Github](https://github.com/cloudfoundry/nodejs-buildpack/blob/master/manifest.yml))\r\n\r\n```\r\nlanguage: nodejs\r\ndefault_versions:\r\n- name: node\r\n  version: 4.6.0\r\n...\r\n```\r\n\r\n## **Contenidors (Docker)**\r\n\r\nEn quant als contenidors Docker, inicialment, aliniarem les versions del software del Full de Ruta de Programari amb les versions dels contenidors certificats per CTTI. Podeu trobar aquestes imatges certificades a [DockerHub](https://hub.docker.com/r/gencatcloud/).\r\n\r\n**Element**  | **Versió (1) (2)**   | **Docker**\r\n------------ | ------------ |-----------\r\nApache \t\t | actual FRP    | https://hub.docker.com/r/gencatcloud/httpd/\r\nApache GICAR | 2.0    | Demanar a [suport.cloud@gencat.cat](mailto:suport.cloud@gencat.cat)    | -\r\nHAProxy\t\t | 1.5.1        | https://hub.docker.com/r/gencatcloud/haproxy/\r\nJava\t\t | actual FRP   | https://hub.docker.com/r/gencatcloud/java/\r\nMongoDB \t | 3.2.7   | https://hub.docker.com/r/gencatcloud/mongodb/\r\nMySql \t\t | actual FRP   | https://hub.docker.com/r/gencatcloud/mysql/\r\nNodeJS \t\t | actual FRP   | https://hub.docker.com/r/gencatcloud/node/\r\nPHP \t\t | actual FRP   | https://hub.docker.com/r/gencatcloud/apache-php/\r\nPostgres\t | 9.5.3    | https://hub.docker.com/r/gencatcloud/postgres/\r\nTomcat  \t | actual FRP   | https://hub.docker.com/r/gencatcloud/tomcat/\r\n\r\n(1) Per a tots els elements presents al [Full de Ruta del Programari (FRP) del CTTI](https://portic.ctti.gencat.cat/les_tic/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf) està disponible la versió actual CTTI.\r\n\r\n(2) Per als elements que no estan presents al [Full de Ruta del Programari (FRP) del CTTI](https://portic.ctti.gencat.cat/les_tic/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf) s'especifica la versió disponible més actual.\r\n\r\n\r\nLa llista anterior no exclou que no es puguin lliurar contenidors que corrin altres productes i personalitzacions. En qualsevol cas, les imatges construïdes passaran per un servei d'avaluació de vulnerabilitats per a garantir en una primera instància la qualitat de les mateixes.\r\n\r\nMés informació sobre Docker: https://www.docker.com/\r\n\r\n### Bases de dades a contenidors\r\n\r\nLes bases de dades a contenidors no disposen de cap servei com backups o gestió d'usuaris. El proveïdor d'aplicacions haurà de fer-se càrrec d'aquests serveis.\r\n\r\nTampoc ofereix un entorn en alta disponibilitat. És una modalitat no recomanada per entorns productius.\r\n\r\n## SaaS\r\n\r\n### DBaaS - Base de dades com a servei\r\n\r\n- MongoDB, disponible a **cloud públic**\r\n- ElasticSearch, disponible a **cloud públic**\r\n- PostgreSQL, disponible a **cloud públic**\r\n- SQLServer, disponible a **cloud públic**\r\n\r\nA diferència de les bases de dades a contenidors, els DBaaS si que incorporen serveis de backups i gestió d'accés entre d'altres, a més de proporcionar un entorn en alta disponibilitat. És per aquest motiu que per entorns productius és recomanable el seu ús enlloc de bases de dades en contenidors.\r\n","objectID":"L2Nsb3VkL2NhdGFsZWc="},"L2Nsb3VkL2NvbXVuaWNhY2lvLXN1cG9ydC1jbG91ZA==":{"date":1516147200000,"title":"Comunicació proveïdors d'aplicacions amb Suport Cloud","description":"Canals de comunicació disponibles pels proveïdors d'aplicacions amb Suport Cloud","sections":"Container Cloud","categories":["cloud"],"path":"/cloud/comunicacio-suport-cloud","content":"S'oficialitzen el [**CSTD (Centre de Suport Tecnològic al Desenvolupament)**](https://cstd.ctti.gencat.cat/) i [**Remedy**](https://pautic.gencat.cat/) com a canals de comunicació amb l'equip de Suport Cloud. A continuació es descriu quin és l'ús que s'ha de fer de cadascun d'ells:\r\n\r\n<br/>\r\n\r\n#### Aplicacions en \"running\"\r\n\r\nPer les aplicacions que estiguin en running:\r\n\r\n- **Remedy**\r\n\r\n_Incidències_ i _Canvis_ que es vulguin fer arribar a l'equip de Suport Cloud s'han de crear a Remedy informant l'aplicació afectada com a \"Service\" i \"A6-N3-CLOUD\" com a \"Assigned Group\".\r\n\r\n<div class=\"message information\">\r\nDonat que a les plataformes Cloud gestionades des de Suport Cloud es dóna accés a <b>logs</b> i <b>monitorització</b> de l'aplicació, per l'agilitat en la resolució de les incidències és vital que el proveïdor d'aplicacions hagi revisat abans tota la informació de la qual disposa. També gràcies als <b>jobs de desplegament</b> del <a href=\"http://canigo.ctti.gencat.cat/sic/\">SIC</a> és autònom per redesplegar el servei afectat. Per tant, només haurien d'arribar incidències a Suport Cloud relacionades amb la plataforma (Ex. indisponibilitat global de la plataforma), que ni tan sols redesplegant el servei puguin resoldre's.\r\n</div>\r\n\r\n- **CSTD**\r\n\r\n_Consultes_ i _Suports_ han de realitzar-se al servei [**CS Suport Cloud**](https://cstd.ctti.gencat.cat/jiracstd/browse/CLD).\r\n\r\n<br/>\r\n\r\n#### Aplicacions en \"fase de projecte\"\r\n\r\nPer les aplicacions en fase de projecte, la comunicació sempre s'ha de fer via **CSTD** al servei [**Servei Acompanyament Suport Cloud**](https://cstd.ctti.gencat.cat/jiracstd/browse/ACOCLD). El proveïdor d'aplicacions ha de crear una petició en aquest servei informant el camp Sumari \"Suport projecte NOM_PROJECTE\". Mentre l'aplicació estigui en fase de projecte tot el suport (Ex. definició imatges Docker, definició descriptors de desplegament,...) es canalitzarà en aquesta petició.\r\n\r\n<br/>\r\n\r\n#### Aplicacions que no han iniciat el procés d'alta dins CTTI\r\n\r\n_Consultes_ i _Suports_ han de realitzar-se al servei [**CS Suport Cloud**](https://cstd.ctti.gencat.cat/jiracstd/browse/CLD).\r\n\r\n<br/>\r\n\r\nEn cas que no es disposi d'usuari al CSTD, cal que el gestor de projecte CTTI de l'aplicació faci arribar la petició d'alta d'usuari al propi [servei CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CSTD) o bé enviant un correu a la bústia [cstd.ctti@gencat.cat](mailto:cstd.ctti@gencat.cat).\r\n\r\nA partir de l'**1 de Març de 2018**, totes les peticions que s'enviïn a la bústia [suport.cloud@gencat.cat](mailto:suport.cloud@gencat.cat) seràn redirigides al canal adient.\r\n","objectID":"L2Nsb3VkL2NvbXVuaWNhY2lvLXN1cG9ydC1jbG91ZA=="},"L2Nsb3VkL2NvbnRlbmlkb3JzX2FwcGFnaWxl":{"date":1509580800000,"title":"Contenidors AppAgile","description":"Consideracions i exemples respecte els contenidors a AppAgile","sections":"Container Cloud","weight":7,"categories":["cloud","docker","container","paas","openshift","appagile"],"path":"/cloud/contenidors_appagile","content":"## Introducció\nAppAgile és un orquestrador d'imatges docker basat en Openshift que addicionalment està basat en Kubernetes. La versió actual d'AppAgile es basa concretament en la versió OpenShift Container Platform 3.4.1.12 i Kubernetes 1.4.0.\n\nEn aquest article es defineix l'arquitectura tipus d'una aplicació a AppAgile i es proporcionen diversos exemples.\n\n## Imatges\nA l'hora de construir les imatges docker, cal tenir present els criteris definits per la Generalitat de Catalunya i que Openshift, tot i que està basat en docker, té les seves particularitats.\n\nA la plana [Criteris creació contenidors docker](http://canigo.ctti.gencat.cat/cloud/dockerImages/) podeu trobar més informació al respecte. \n\n## Arquitectura\n### Conceptes bàsics\nL'arquitectura bàsica d'una aplicació a AppAgile és bàsicament la mateixa que la de Kubernetes, però amb algunes petites particularitats.\nA grans trets es poden distingir els següents components:\n\n* **Enrutador:** És el punt d'entrada i sortida del tràfic http/https de la plataforma i l'exterior. És responsable d'enrutar el tràfic a cada contenidor concret.\n* **Ruta:** És l'element de configuració on és defineix quin domini correspondrà a un Servei. Permet també la configuració del SSL. Informa a l'enrutador per a que aquest pugui redirigir el tràfic correctament.\n* **Servei:** És l'element de configuració que permet exposar un servei basat en contenidors dins de la plataforma Openshift. Permet mapping de ports\n* **Desplegament:** És l'element de configuració que defineix com es desplegaran els contenidors:\n\n    * Nombre de rèpliques\n    * Imatge a desplegar\n    * Polítiques de recàrrega\n    * Quotes\n    * Variables d'entorn\n    * Ports\n    * Emmagatzematge lògic\n    * Health checks\n    * ...\n\n* **Controlador:** És el component responsable de mantenir els contenidors sempre disponibles seguint els paràmetres configurats al Desplegament.\n* **Pod:** És el conjunt de contenidors que tenen el mateix cicle de vida i és necessari desplegar sempre conjuntament.\n* **Contenidor:** És el component mínim de la plataforma. És el contenidor docker.\n* **Petició d'emmagatzematge:** S'utilitza quan és necessari emmagatzematge persistent. És l'element de configuració que actua de pont entre el emmagatzematge físic i l'emmagatzematge lògic.\n* **Emmagatzematge:** És l'element de configuració responsable de definir l'emmagatzematge físic.\n* **Secret:** És l'element de configuració responsable de gestionar els elements de configuració amb informació sensible, com poden ser contrasenyes.\n* **Mapa de configuració:** Permet agrupar múltiples variables de configuració. Seria equivalent a un fitxer de propietats en una aplicació.\n\n### Arquitectura AppAgile\nA continuació es realitza la correlació entre els diferents components arquitectònics i els elements concrets a AppAgile i Openshift.\n\n  Component genèric |  Component AppAgile | Observacions  |\n|:-----------------|:---------|:-----------|\n| Enrutador  |  Router | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res.|\n| Ruta  |  Route | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Servei  |  Service | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Desplegament  |  DeploymentConfig | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Controlador  |  ReplicationController | És generat directament pel DeploymentConfig. No és necessari configurar res.|\n| Pod  |  Pod | És generat directament pel ReplicationController. No és necessari configurar res.|\n| Contenidor  |  Container | És generat directament pel Pod. No és necessari configurar res.|\n| Petició d'emmagatzematge  |  PersistentVolumeClaim | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Emmagatzematge  |  PersistentVolume | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res. Cal fer una petició al fer la sol·licitut inicial de recursos.|\n| Secret  | Secret | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Mapa de configuració  | ConfigMap | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n\n![Components Openshift](/related/cloud/ArquitecturaOpenshift.png)\n\n## Informació necessària al crear l'aplicació\nQuan és sol·licita la creació d'una aplicació a AppAgile és necessària la següent informació:\n\n* **Unitats i mida de discos persistents** necessaris. Amb aquesta informació l'administrador de la plataforma crearà els PersistentVolume necessaris i farà arribar als responsables de l'aplicació el nom d'aquests Volums.\n* **Memòria RAM** total necessaria per tots els contenidors de l'aplicació. Amb aquesta informació s'assignarà una CPU proporcional i es definiran les quotes globals de l'aplicació.\n## Exemples\n### PersistentVolumeClaim\nEn una aplicació el primer element que cal configurar és el PersistentVolumeClaim. Mapejarà PersistentVolume amb el volumes lògics que s'utilitzaran als pods.\n\nTenint present que el PersistentVolume s'anomena per exemple **XXXX-app1-data01-pre** el fitxer yaml seria:\n\n```\napiVersion: v1\nkind: List\nitems:\n- apiVersion: v1\n  kind: PersistentVolumeClaim\n  metadata:\n    name: XXXX-app1-data01-claim\n  spec:\n    accessModes:\n      - ReadWriteOnce\n    resources:\n      requests:\n        storage: 1Gi\n    volumeName: XXXX-app1-data01-pre\n```\n\n### DeploymentConfig\nEl DeploymentConfig és el principal element de configuració de l'aplicació.\n\nConfiguració de l'exemple:\n\n* Nom del projecte: **XXXX-app1-pre**\n* Nom de l'aplicació: **XXXX-app1-server**\n* Nom del deploymentConfig: **XXXX-app1-server-deployment**\n* Nombre de rèpliques: **2**\n* **El pod conté un únic contenidor**.\n* Estratègia de desplegament: **Rolling**. No es recomana modificar, ni variar els seus paràmetres.\n* Quotes: **100 milicores de CPU** i **1024Mb de RAM**\n* Nom de la imatge dels contenidors: **XXXX-app1-pre/XXXX-app1-server:1.0.0**\n* Variables d'entorn dels contenidors:\n\n    * **ENV1_NAME** amb valor **env1_value**\n    * **ENV2_NAME** amb valor **env2_value**\n* Port del contenidor: **8080**\n* **readinessProbe** per validar que el servidor està inicialitzat.\n* **livenessProbe** per validar que el servidor proporciona servei.\n* Volum persistit: dins del contenidor es monta a **/data**. Fà referència al PersistentVolumeClaim anomenat **XXXX-app1-data01-claim** (creat a l'exemple anterior)\n\n```\napiVersion: v1\nkind: List\nitems:\n- apiVersion: v1\n  kind: DeploymentConfig\n  metadata:\n    labels:\n      app: XXXX-app1-server\n    name: XXXX-app1-server-deployment\n  spec:\n    replicas: 2\n    selector:\n      app: XXXX-app1-server\n      deploymentconfig: XXXX-app1-server-deployment\n    strategy:\n      type: Rolling\n      rollingParams:\n        updatePeriodSeconds: 1\n        intervalSeconds: 1\n        timeoutSeconds: 600\n        maxUnavailable: 25%\n        maxSurge: 25%    \n      resources:\n        limits:\n            cpu: 0\n            memory: 0\n        requests:\n            cpu: 0\n            memory: 0\n    template:\n      metadata:\n        labels:\n          app: XXXX-app1-server\n          deploymentconfig: XXXX-app1-server-deployment\n      spec:\n        containers:\n        - image: XXXX-app1-pre/XXXX-app1-server:1.0.0\n          name: XXXX-app1-server\n          env:\n          - name: ENV1_NAME\n            value: env1_value\n          - name: ENV2_NAME\n            value: env2_value            \n          ports:\n          - containerPort: 8080\n            protocol: TCP\n          resources:\n            limits:\n                cpu: 100m\n                memory: 1024Mi\n            requests:\n                cpu: 100m\n                memory: 1024Mi\n          readinessProbe:\n            httpGet:\n                path: /healthz\n                port: 8080\n            initialDelaySeconds: 15\n            timeoutSeconds: 1\n          livenessProbe:\n            tcpSocket:\n                port: 8080\n            initialDelaySeconds: 15\n            timeoutSeconds: 1                                              \n          volumeMounts:\n              - name: XXXX-app1-server-volume\n                mountPath: /data\n        terminationGracePeriodSeconds: 60                \n        volumes:\n          - name: XXXX-app1-server-volume\n            persistentVolumeClaim:\n              claimName: XXXX-app1-data01-claim           \n    test: false\n    triggers:\n    - type: ConfigChange\n    - imageChangeParams:\n        automatic: true\n        containerNames:\n        - XXXX-app1-server\n        from:\n          kind: ImageStreamTag\n          name: XXXX-app1-server:1.0.0\n          namespace: XXXX-app1-pre\n      type: ImageChange\n```\n\n### Service\nA l'exemple es crea un servei per el DeploymentConfig creat anteriorment.\n\nAppAgile només suporta serveis amb protocol HTTP/HTTPS, no suporta altres protocols, com per exemple SSH, JDBC, ...\n\nConfiguració de l'exemple:\n\n* Port exposat per servei: **80**\n* Port intern dels pods: **8080**\n\n```\napiVersion: v1\nkind: List\nitems:\n- apiVersion: v1\n  kind: Service\n  metadata:\n    labels:\n      app: XXXX-app1-server\n    name: XXXX-app1-server\n  spec:\n    ports:\n    - name: 80-tcp\n      port: 80\n      protocol: TCP\n      targetPort: 8080\n    selector:\n      app: XXXX-app1-server\n      deploymentconfig:  XXXX-app1-server-deployment\n```\n\n### Route\nA l'exemple es crea una ruta pel servei creat anteriorment.\n\nConfiguració de l'exemple:\n\n* host: **app1-server.gencat.cat**\n\n```\napiVersion: v1\nkind: Route\nmetadata:\n  name: app1-route\n  namespace: XXXX-app1-pre\n  labels:\n    app: app1-server\nspec:\n  host: app1-server.gencat.cat\n  to:\n    kind: Service\n    name:  XXXX-app1-server\n    weight: 100\n  port:\n    targetPort: 80-tcp\n  wildcardPolicy: None\n```\n\n\n## Informació relacionada\n\n* http://appagile.io/\n* https://docs.openshift.com/container-platform/3.4/","objectID":"L2Nsb3VkL2NvbnRlbmlkb3JzX2FwcGFnaWxl"},"L2Nsb3VkL2NvbnRlbmlkb3JzX2t1YmVybmV0ZXM=":{"date":1509580800000,"title":"Contenidors Kubernetes","description":"Consideracions i exemples respecte els contenidors a Kubernetes","sections":"Container Cloud","weight":7,"categories":["cloud","docker","container","paas","kubernetes"],"path":"/cloud/contenidors_kubernetes","content":"## Introducció\nKubernetes és un orquestrador desenvolupat inicialment per Google. Sembla que actualment és l'orquestrador que presenta més futur. Recentment ha rebut el suport oficial de Docker.\n\nEn aquest article es defineix l'arquitectura tipus d'una aplicació a Kubernetes i es proporcionen diversos exemples.\n\nA la Generalitat de Catalunya, actualment, Kubernetes està disponible a la plataforma d'IBM Bluemix. \n\nLa versió de Kubernetes disponible és la  **1.7.4_1503**.\n\n## Imatges\nA l'hora de construir les imatges docker, cal tenir present els criteris definits per la Generalitat de Catalunya i que Openshift, tot i que està basat en docker, té les seves particularitats.\n\nA la plana [Criteris creació contenidors docker](http://canigo.ctti.gencat.cat/cloud/dockerImages/) podeu trobar més informació al respecte. \n\n## Arquitectura\n### Conceptes bàsics\nL'arquitectura bàsica d'una aplicació a AppAgile és bàsicament la mateixa que la de Kubernetes, però amb algunes petites particularitats.\nA grans trets es poden distingir els següents components:\n\n* **Enrutador:** És el punt d'entrada i sortida del tràfic http/https de la plataforma i l'exterior. És responsable d'enrutar el tràfic a cada contenidor concret.\n* **Ruta:** És l'element de configuració on és defineix quin domini correspondrà a un Servei. Permet també la configuració del SSL. Informa a l'enrutador per a que aquest pugui redirigir el tràfic correctament.\n* **Servei:** És l'element de configuració que permet exposar un servei basat en contenidors dins de la plataforma Openshift. Permet mapping de ports\n* **Desplegament:** És l'element de configuració que defineix com es desplegaran els contenidors:\n\n    * Nombre de rèpliques\n    * Imatge a desplegar\n    * Polítiques de recàrrega\n    * Quotes\n    * Variables d'entorn\n    * Ports\n    * Emmagatzematge lògic\n    * Health checks\n    * ...\n\n* **Controlador:** És el component responsable de mantenir els contenidors sempre disponibles seguint els paràmetres configurats al Desplegament.\n* **Pod:** És el conjunt de contenidors que tenen el mateix cicle de vida i és necessari desplegar sempre conjuntament.\n* **Contenidor:** És el component mínim de la plataforma. És el contenidor docker.\n* **Petició d'emmagatzematge:** S'utilitza quan és necessari emmagatzematge persistent. És l'element de configuració que actua de pont entre el emmagatzematge físic i l'emmagatzematge lògic.\n* **Emmagatzematge:** És l'element de configuració responsable de definir l'emmagatzematge físic.\n* **Secret:** És l'element de configuració responsable de gestionar els elements de configuració amb informació sensible, com poden ser contrasenyes.\n* **Mapa de configuració:** Permet agrupar múltiples variables de configuració. Seria equivalent a un fitxer de propietats en una aplicació.\n\n### Arquitectura Kubernetes\nA continuació es realitza la correlació entre els diferents components arquitectònics i els elements concrets a Kubernetes.\n\n  Component genèric |  Component Kubernetes | Observacions  |\n|:-----------------|:---------|:-----------|\n| Enrutador  |  Router | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res.|\n| Ruta  |  Ingress | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Servei  |  Service | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Desplegament  |  Deployment | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Controlador  |  ReplicaSet | És generat directament pel Deployment. No és necessari configurar res.|\n| Pod  |  Pod | És generat directament pel ReplicationController. No és necessari configurar res.|\n| Contenidor  |  Container | És generat directament pel Pod. No és necessari configurar res.|\n| Petició d'emmagatzematge  |  PersistentVolumeClaim | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Emmagatzematge  |  PersistentVolume | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res. Cal fer una petició al fer la sol·licitut inicial de recursos.|\n| Secret  | Secret | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Mapa de configuració  | ConfigMap | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n\n![Components Kubernetes](/related/cloud/ArquitecturaKubernetes.png)\n\n## Informació necessària al crear l'aplicació\nQuan és sol·licita la creació d'una aplicació a Kubernetes és necessària la següent informació:\n\n* **Unitats i mida de discos persistents** necessaris. Amb aquesta informació l'administrador de la plataforma crearà els PersistentVolume necessaris i farà arribar als responsables de l'aplicació el nom d'aquests Volums.\n* **Memòria RAM** total necessaria per tots els contenidors de l'aplicació. Amb aquesta informació s'assignarà una CPU proporcional i es definiran les quotes globals de l'aplicació.\n## Exemples\n### PersistentVolumeClaim\nEn una aplicació el primer element que cal configurar és el PersistentVolumeClaim. Mapejarà PersistentVolume amb el volumes lògics que s'utilitzaran als pods.\n\nConfiguració de l'exemple:\n\n* Namespace del projecte: **XXXX-app1-data01-pre**\n* Nom del volum lògic: **XXXX-app1-data01-claim**\n* Mida del disc: **20Gb**\n\n```\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: XXXX-app1-data01-claim\n  namespace: XXXX-app1-pre\nspec:\n  accessModes:\n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 20Gi\n```\n\n### Deployment\nEl Deployment és el principal element de configuració de l'aplicació.\n\nConfiguració de l'exemple:\n\n* Namespace del projecte: **XXXX-app1-data01-pre**\n* Nom de l'aplicació: **XXXX-app1-server**\n* Nom del deployment: **XXXX-app1-server-deployment**\n* Nombre de rèpliques: **2**\n* **El pod conté un únic contenidor**.\n* Estratègia de desplegament: **RollingUpdate**. No es recomana modificar, ni variar els seus paràmetres.\n* Quotes: **100 milicores de CPU** i **1024Mb de RAM**\n* Nom de la imatge dels contenidors: **XXXX-app1-pre/XXXX-app1-server:1.0.0**\n* Variables d'entorn dels contenidors:\n\n    * **ENV1_NAME** amb valor **env1_value**\n    * **ENV2_NAME** amb valor **env2_value**\n* Port del contenidor: **8080**\n* **readinessProbe** per validar que el servidor està inicialitzat.\n* **livenessProbe** per validar que el servidor proporciona servei.\n* Volum persistit: dins del contenidor es monta a **/data**. Fà referència al PersistentVolumeClaim anomenat **XXXX-app1-data01-claim** (creat a l'exemple anterior)\n* Nom del defaultToken: **default-token-rwj8z**\n\n```\napiVersion: apps/v1beta1\nkind: Deployment\nmetadata:\n  name: XXXX-app1-server-deployment\n  namespace: XXXX-app1-data01-pre\n  labels:\n    app: XXXX-app1-server\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: XXXX-app1-server\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxSurge: 25%\n      maxUnavailable: 25%\n  minReadySeconds: 0\n  revisionHistoryLimit: 3       \n  template:\n    metadata:\n      labels:\n        app: XXXX-app1-server\n    spec:\n      containers:\n      - name: XXXX-app1-server\n        image: XXXX-app1-pre/XXXX-app1-server:1.0.0\n        resources:\n          limits:\n            cpu: 100m\n            memory: 1024Mi\n          requests:\n            cpu: 100m\n            memory: 1024Mi\n        imagePullPolicy: Always\n        env:\n        - name: ENV1_NAME\n          value: env1_value                       \n        - name: ENV2_NAME\n          value: env2_value                       \n        ports:\n        - containerPort: 8080\n        readinessProbe:\n          tcpSocket:\n            port: 8080\n          initialDelaySeconds: 5\n          periodSeconds: 10\n        livenessProbe:\n          httpGet:\n            path: /healthz\n            port: 8080\n            httpHeaders:\n            - name: X-Custom-Header\n              value: Awesome\n          initialDelaySeconds: 3\n          periodSeconds: 3      \n        volumeMounts:\n        - mountPath: /data\n          name: XXXX-app1-server\n        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount\n          name: default-token-rwj8z\n          readOnly: true           \n      imagePullSecrets:\n        - name: uk-docker-registry-secret      \n      volumes:\n      - name: *XXXX-app1-server\n        persistentVolumeClaim:\n          claimName: XXXX-app1-data01-claim\n      - name: default-token-rwj8z\n        secret:\n          defaultMode: 420\n          secretName: default-token-rwj8z\n```\n\n### Service\nA l'exemple es crea un servei per el DeploymentConfig creat anteriorment.\n\nKubernetes suporta tant serveis amb protocol HTTP/HTTPS com  serveis amb altres tipus de protocols, com per exemple SSH, JDBC, ...\n\n#### Servei HTTP\nL'aplicació exposa un servei HTTP a través de la IP de l'Ingress.\nConfiguració de l'exemple:\n\n* Port exposat per servei: **80**\n* Port intern dels pods: **8080**\n\n```\napiVersion: v1\nkind: Service\nmetadata:\n  name: XXXX-app1-server\n  namespace: XXXX-app1-data01-pre\n  labels:\n    name: XXXX-app1-server\nspec:\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 8080\n  type: NodePort    \n  selector:\n    app: XXXX-app1-server\n\n```\n\n#### Servei No HTTP\nL'aplicació exposa un servei no HTTP a través d'una IP pròpia.\nConfiguració de l'exemple:\n\n* Port exposat per servei: **3030**\n* Port intern dels pods: **3731**\n* IP on s'exposa el servei: **169.45.10.144**\n\n```\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    name: XXXX-app1-server\n  name: XXXX-app1-data01-pre\n  namespace:  XXXX-app1-server\nspec:\n  ports:\n  - protocol: TCP\n    port: 3030\n    targetPort: 3731\n  selector:\n    app: XXXX-app1-server\n  type: XXXX-app1-server\n  loadBalancerIP: 169.45.10.144\n```\n\n\n### Ingress\nA l'exemple es crea una ruta pel servei creat anteriorment.\n\nConfiguració de l'exemple:\n\n* host: **app1-server.gencat.cat**\n\n```\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: app1-route\n  namespace: XXXX-app1-pre\nspec:\n  rules:\n  - host: app1-server.gencat.cat\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: XXXX-app1-server\n          servicePort: 80   \n```\n\n\n## Informació relacionada\n\n* https://v1-7.docs.kubernetes.io/docs/home/","objectID":"L2Nsb3VkL2NvbnRlbmlkb3JzX2t1YmVybmV0ZXM="},"L2Nsb3VkL2RvY2tlckltYWdlcw==":{"date":1495584000000,"title":"Criteris creació contenidors docker","description":"Criteris per crear les imatges dels contenidors docker que es desplegaran als diferents clouds públics i privats","sections":"Container Cloud","weight":6,"categories":["cloud","docker","container","paas","openshift"],"path":"/cloud/dockerImages","content":"## Introducció\n\nA l'hora de crear les imatges dels diferents contenidors docker per les aplicacions gencat cal establir un conjunt de criteris que garanteixin la seva estabilitat i seguretat.\n\n## Criteris per escollir la imatge base\n\n* Les imatges de docker es crearan sempre a partir del fitxer Dockerfile, en cap cas es crearan imatges a partir de contenidors.\n* En cas que existeixin imatges homologades pel CTTI de la tecnologia requerida, el Dockerfile particular de cada aplicació haurà de tenir com a base la imatge homologada, utilitzant la directiva **FROM**.\n* En cas que no existeixin imatges homologades pel CTTI de la tecnologia requerida, a l'hora d'escollir les imatges de base es faran servir els següents criteris:\n\t* Imatge oficial de fabricant al [docker hub](https://hub.docker.com/).\n\t* En cas que existeixi una imatge oficial basada en **[Alpine](https://hub.docker.com/_/alpine/)**, s'escollirà aquesta.\n    * En cas que no existeixi una imatge oficial basada en Alpine, s'escollirà la imatge basada en Centos, substituint Centos per la versió d'Oracle Linux Slim corresponent. Aquesta substitució és necessaria pel support de pegats de seguretat que ofereix Oracle Linux i no ofereix Centos.\n\t* En cas que no existeixi una imatge oficial basada en Alpine ni Centos, s'escollirà la que recomani el fabricant. Sol ser la que al tag només s'indica la versió.\n* Mai s'escollirà el tag latest. És una versió que va canviant en el temps i genera inestabilitat a les aplicacions. Escollir sempre la versió més tancada possible.\n\n## Criteris generals per la creació de les imatges\n\nAlguns d'aquests criteris no apliquen en cas d'utilitzar les imatges homologades pel CTTI.\n\n* Deixar instal·lat el nombre mínim de paquets al docker, si és necessari instal·lar paquets per realitzar compilacions, desinstal·lar-los un cop realitzada aquesta.\n* Actualitzar els packets del sistema operatiu a la última versió disponible amb tots els pegats de seguretat aplicats.\n* No deixar el codi font al docker, un cop compilat, eliminar-lo.\n* Incloure a la imatge el script **wait-for-it.sh**, adjuntat a baix, per poder testejar les comunicacions. Notar que requereix tenir el bash instal·lat.\n* No executar mai el procés final de les aplicacions amb l'usuari **root**. La majoria de tecnologies inclouen scripts que utilitzen usuaris específics per arrencar-les.\n* Fixar els uid i gid dels usuaris i grups utilitzats per executar els processos, amb l'objectiu d'evitar escalat de privilegis.\n* Assegurar la seguretat dels directoris definint el propietari i els permisos explícitament. S'adjunta a baix l'script **docker-setup.sh** d'exemple.\n* Executar el procés principal des d'un script, mai directament al Dockerfile.\n* Utilitzar el volum **/data** per desar la informació que cal persistir.\n* No executar múltiples processos a dins de la imatge docker. Docker està pensat per executar un únic procés.\n* **No escriure els logs de l'aplicació a fitxers. Enviar els logs sempre a la sortida estàndard**. D'aquesta manera la plataforma capturarà els logs i no caldrà entrar als contenidors per veure'ls.\n\n## Criteris de seguretat\n\n* Intentar utilitzar l'última versió del producte, sol ser la que té menys vulnerabilitats de seguretat.\n* Per validar la seguretat de les imatges creades, utilitzar l'eina [Clair](https://github.com/coreos/clair). En cas que es detectin vulnerabilitats, intentar eliminar-les instal·lant els patches necessaris.\n* Aplicar totes les configuracions de seguretat recomanades pel fabricant o la comunitat per cada producte en particular.\n\nAbans de desplegar un contenidor a producció, es realitzarà una validació de seguretat utilitzant l'eina Clair. En cas de detectar vulnerabilitats de caràcter greu la imatge no serà desplegada.\n\n## Criteris específics de Openshift\n\n[Openshift](https://www.openshift.com/), tot i que suporta desplegar imatges de docker, presenta uns criteris més restrictius de seguretat que cal tenir present a l'hora de construir el Dockerfile.\n\n* No utilitzar l'usuari **root** ni per executar l'script principal del docker (normalment s'utilitza l'usuari root). Utilitzar la directiva **USER uid** per definir amb quin usuari s'executarà el procés.\n* Cal tenir present que openshift executa el procés amb un id d'usuari aleatori que pertany al grup **root**.\n\t* Aquest usuari es crea a l'executar el docker. No existeix, ni es coneix, en etapa de construcció de la imatge de docker.\n\t* A causa de la característica anterior, és possible que algunes accions que habitualment es fan en etapa de construcció calgui fer-les en etapa d'execució amb alguna shell.\n\t* Cal que les carpetes on el procés escriu dades, pertanyin al grup root. Es pot veure a l'script **docker-setup.sh** inclòs abaix.\n\t* Algunes aplicacions necessiten que l'usuari estigui definit al fitxer /etc/passwd. En aquest cas és necessari utilitzar el paquet **[nss_wrapper](https://cwrap.org/nss_wrapper.html)** per emular els canvis en aquest fitxer. Es pot veure un exemple a la imatge docker [postgres-openshift](https://github.com/gencat/postgres-openshift). Veure la plana web [Openshift. Creating Images. Guidelines. OpenShift Origin-Specific Guidelines. Support Arbitrary User IDs] (https://docs.openshift.org/latest/creating_images/guidelines.html#openshift-origin-specific-guidelines) per més detalls.\n* Utilitzar variables d'entorn per la configuració.\n* Més informació de com construir les imatges de docker està disponible a [Openshift. Creating Images. Guidelines](https://docs.openshift.org/latest/creating_images/guidelines.html).\n\n## Exemples\nPodeu trobar exemples de diferents imatges de docker seguint aquests criteris al [docker hub de gencatcloud](https://hub.docker.com/u/gencatcloud/).\nLes imatges amb extensió **-openshift* són les compatibles amb la plataforma de xPaaS del mateix nom.\n\n## Annexos\n_wait-for-it.sh_\n```\n#!/usr/bin/env bash\n#   Use this script to test if a given TCP host/port are available\n\ncmdname=$(basename $0)\n\nechoerr() { if [[ $QUIET -ne 1 ]]; then echo \"$@\" 1>&2; fi }\n\nusage()\n{\n    cat << USAGE >&2\nUsage:\n    $cmdname host:port [-s] [-t timeout] [-- command args]\n    -h HOST | --host=HOST       Host or IP under test\n    -p PORT | --port=PORT       TCP port under test\n                                Alternatively, you specify the host and port as host:port\n    -s | --strict               Only execute subcommand if the test succeeds\n    -q | --quiet                Don't output any status messages\n    -t TIMEOUT | --timeout=TIMEOUT\n                                Timeout in seconds, zero for no timeout\n    -- COMMAND ARGS             Execute command with args after the test finishes\nUSAGE\n    exit 1\n}\nwait_for()\n{\n    if [[ $TIMEOUT -gt 0 ]]; then\n        echoerr \"$cmdname: waiting $TIMEOUT seconds for $HOST:$PORT\"\n    else\n        echoerr \"$cmdname: waiting for $HOST:$PORT without a timeout\"\n    fi\n    start_ts=$(date +%s)\n    while :\n    do\n        (echo > /dev/tcp/$HOST/$PORT) >/dev/null 2>&1\n        result=$?\n        if [[ $result -eq 0 ]]; then\n            end_ts=$(date +%s)\n            echoerr \"$cmdname: $HOST:$PORT is available after $((end_ts - start_ts)) seconds\"\n            break\n        fi\n        sleep 1\n    done\n    return $result\n}\nwait_for_wrapper()\n{\n    # In order to support SIGINT during timeout: http://unix.stackexchange.com/a/57692\n    if [[ $QUIET -eq 1 ]]; then\n        timeout -t $TIMEOUT $0 --quiet --child --host=$HOST --port=$PORT --timeout=$TIMEOUT &\n    else\n        timeout -t $TIMEOUT $0 --child --host=$HOST --port=$PORT --timeout=$TIMEOUT &\n    fi\n    PID=$!\n    trap \"kill -INT -$PID\" INT\n    wait $PID\n    RESULT=$?\n    if [[ $RESULT -ne 0 ]]; then\n        echoerr \"$cmdname: timeout occurred after waiting $TIMEOUT seconds for $HOST:$PORT\"\n    fi\n    return $RESULT\n}\n# process arguments\nwhile [[ $# -gt 0 ]]\ndo\n    case \"$1\" in\n        *:* )\n        hostport=(${1//:/ })\n        HOST=${hostport[0]}\n        PORT=${hostport[1]}\n        shift 1\n        ;;\n        --child)\n        CHILD=1\n        shift 1\n        ;;\n        -q | --quiet)\n        QUIET=1\n        shift 1\n        ;;\n        -s | --strict)\n        STRICT=1\n        shift 1\n        ;;\n        -h)\n        HOST=\"$2\"\n        if [[ $HOST == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --host=*)\n        HOST=\"${1#*=}\"\n        shift 1\n        ;;\n        -p)\n        PORT=\"$2\"\n        if [[ $PORT == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --port=*)\n        PORT=\"${1#*=}\"\n        shift 1\n        ;;\n        -t)\n        TIMEOUT=\"$2\"\n        if [[ $TIMEOUT == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --timeout=*)\n        TIMEOUT=\"${1#*=}\"\n        shift 1\n        ;;\n        --)\n        shift\n        CLI=\"$@\"\n        break\n        ;;\n        --help)\n        usage\n        ;;\n        *)\n        echoerr \"Unknown argument: $1\"\n        usage\n        ;;\n    esac\ndone\nif [[ \"$HOST\" == \"\" || \"$PORT\" == \"\" ]]; then\n    echoerr \"Error: you need to provide a host and port to test.\"\n    usage\nfi\nTIMEOUT=${TIMEOUT:-15}\nSTRICT=${STRICT:-0}\nCHILD=${CHILD:-0}\nQUIET=${QUIET:-0}\nif [[ $CHILD -gt 0 ]]; then\n    wait_for\n    RESULT=$?\n    exit $RESULT\nelse\n    if [[ $TIMEOUT -gt 0 ]]; then\n        wait_for_wrapper\n        RESULT=$?\n    else\n        wait_for\n        RESULT=$?\n    fi\nfi\nif [[ $CLI != \"\" ]]; then\n    if [[ $RESULT -ne 0 && $STRICT -eq 1 ]]; then\n        echoerr \"$cmdname: strict mode, refusing to execute subprocess\"\n        exit $RESULT\n    fi\n    exec $CLI\nelse\n    exit $RESULT\nfi\n```\n\n_docker-setup.sh_\n```\n#!/bin/sh\n\n# setup directory for data\nmkdir -p /data\nchown -R nginx:0 /data\nchmod g+w -R /data\nchown -R nginx:0 /usr\nchown -R nginx:0 /var\n\nchgrp -R 0 /usr\nchmod -R g+rw /usr\nfind /usr -type d -exec chmod g+x {} +\n\nchgrp -R 0 /var\nchmod -R g+rw /var\nfind /var -type d -exec chmod g+x {} +\n```","objectID":"L2Nsb3VkL2RvY2tlckltYWdlcw=="},"L2Nsb3VkL2VudG9ybnMtZGV2":{"date":1496966400000,"title":"Entorns de desenvolupament","description":"Entorns de desenvolupament recomanats compatibles amb les Plataformes Cloud","sections":"Container Cloud","weight":7,"categories":["cloud","docker","container","paas"],"path":"/cloud/entorns-dev","content":"## Openshift\r\n\r\nPer les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes/) basades en OpenShift, es recomana utilitzar [Minishift](https://www.openshift.org/minishift/). La versió a instal·lar ha de ser compatible amb la versió d'OpenShift.\r\n\r\n**Plataforma Cloud**  | **Versió Openshift Origin**   | **Versió Minishift compatible**\r\n------------ | ------------ | ------------\r\nCPD3 Containers (privat)\t\t|  1.3.1 (OpenShift 3.3)  | 0.9.0\r\nCPD4 AppAgile (privat)  |  1.4.1 (OpenShift 3.4)  | 1.0.0\r\n\r\n## Bluemix\r\n\r\nEn el cas de Bluemix:\r\n\r\n* _Contenidors_: per els contenidors Docker es pot treballar amb l'engine [Docker](https://www.docker.com/community-edition/) i [Docker Compose](https://docs.docker.com/compose/) directament, sense necessitat de cap orquestrador específic ni plataforma \"minimalista\".\r\n* _Apps_: per les apps (xPaaS de CloudFoundry) es recomana utilitzar [PCF Dev](https://pivotal.io/pcf-dev).\r\n\r\nLa versió a instal·lar de Docker, Docker-Compose i PCF Dev en entorns de desenvolupament, ha de ser compatible amb la versió utilitzada en les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes/).\r\n\r\n**Plataforma Cloud**  | **Versió Cloud Foundry**   | **Versió PCF Dev**\r\n------------ | ------------ | ------------\r\nBluemix - Apps\t| 1.7.0 (v235) | 0.18.0\r\n\r\n**Plataforma Cloud**  | **Versió Docker**   |  **Versió Docker-Compose**\r\n------------ | ------------ | ------------\r\nBluemix - Containers  |  1.10 o posterior  | 1.6 o posterior\r\n","objectID":"L2Nsb3VkL2VudG9ybnMtZGV2"},"L2Nsb3VkL2xpZmVjeWNsZQ==":{"date":1462924800000,"title":"Cicle de vida","description":"Cicle de vida de les aplicacions Cloud containeritzades i xPaas/buildpack","sections":"Container Cloud","weight":4,"categories":[],"path":"/cloud/lifecycle","content":"Gràcies a l'ús del Container Cloud el cicle de vida de les aplicacions pot automatitzar-se de forma fàcil. És aquí on el SIC (Servei d'Integració Continua) té un paper essencial, ja que és l'encarregat de proporcionar els processos per assolir aquesta automatització.\n\nExpliquem, des d'un inici, quines són les passes que segueix una aplicació fins a arribar a executar-se en el Container Cloud:\n\n### Definició d'Arquitectura\n\nÉs en aquesta fase on el proveïdor d'aplicacions, conjuntament amb Integració de Solucions, analitzaran si l'aplicació és susceptible d'anar al Container Cloud. Amb el suport de l'equip d'Administració Cloud i Arquitectura CTTI es prendrà una decisió i es determinarà quin és el cloud destí més apropiat.\n\nEls proveïdors d'aplicacions poden adreçar qualsevol petició de consulta o suport al [CS Suport Cloud del CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CLD).\n\n### Alta projecte\n\nUn cop el document d'arquitectura hagi estat aprovat, així com el pressupost associat als elements a aprovisionar al cloud, es procedirà a l'alta del projecte.\n\nEn aquesta fase s'aprovisionaran els recursos necessaris en el cloud destí i en el SIC per al desplegament de l'aplicació, així com els usuaris d'accés pels proveïdors d'aplicacions per la monitorització de l'aplicació (logs, consum recursos, ...) i el seu desplegament.\n\n### Construcció i desplegament\n\nLes aplicacions es construiran i desplegaran sempre des del SIC. Els elements utilitzats per la \"containerització\" de les aplicacions seran els següents:\n\n#### _xPaaS_\n\n* Els xPaaS utilitzats seran els buildpacks oficials de CloudFoundry per IBM Bluemix i els xPaaS d'OpenShift per CPD3 Containers. Més informació al [catàleg cloud](http://canigo.ctti.gencat.cat/cloud/cataleg/#xpaas:60ff5dd56c9d5f883640685f4f912b83). \n\n#### _Contenidors (Docker)_\n\n* Les imatges utilitzades per les aplicacions han de ser les [oficials de Gencat](http://canigo.ctti.gencat.cat/cloud/cataleg/#contenidors-docker:60ff5dd56c9d5f883640685f4f912b83), o bé extensions d'aquestes. Aquestes imatges han estat certificades per l'equip d'Administració del Cloud. Qualsevol extensió d'aquestes imatges passarà un procés de validació de vulnerabilitats en el procés de construcció al SIC. En cas que l'extensió introdueixi alguna vulnerabilitat l'aplicació no es desplegarà.\n\nPel que fa als entorns, per defecte existirà un de PROductiu i un altre de PREproductiu. Els desplegaments en aquests entorns es realitzaran seguint l'estratègia de [blue-green deployment](http://martinfowler.com/bliki/BlueGreenDeployment.html).\n\n  \n  \n\nA continuació mostrem un diagrama on s'il·lustra el flux i els diferents equips que intervenen en el cicle de vida d'una aplicació al Container Cloud:\n\n![Cicle de Vida Container Cloud](/related/cloud/lifecycle.png)\n","objectID":"L2Nsb3VkL2xpZmVjeWNsZQ=="},"L2Nsb3VkL21hdHJpdS1jYXRhbGVnLWNsb3Vk":{"date":1523491200000,"title":"Matriu catàleg cloud","description":"Elements de catàleg disponibles en els diferents CPDs/Clouds","sections":"Container Cloud","weight":3,"categories":["cloud","docker","container","paas"],"path":"/cloud/matriu-cataleg-cloud","content":"Element            |Tipus       | Capa  |Versió (1)   |CPD1   |CPD2   |CPD3   |CPD4   |Bluemix |Azure  |Observacions\r\n-------            |------      |:-----:|:-----------:|:-----:|:-----:|:-----:|:-----:|:------:|:-----:|-------------\r\nApache             | PaaS       |Web    | 2.4   |x      |x      |x      |x      |        |       |Inclou GICAR\r\nApache             | Contenidor |Web    | 2.2   |x      |       |       |x      |x       |       |Obsolet\r\nApache             | Contenidor |Web    | 2.4   |x      |       |       |x      |x       |       |Amb o sense GICAR   \r\nNginx              | xPaaS      |Web    |1.12   |       |       |       |       |x       |       |   \r\nNginx              | Contenidor |Web    |1.10   |x      |       |       |x      |x       |       |Obsolet   \r\nNginx              | Contenidor |Web    |1.12   |x      |       |       |x      |x       |       |   \r\nIIS                | PaaS       |Web    |8.5    |x      |x      |x      |x      |        |       | \r\nTomcat             | PaaS       |App    |8      |x      |x      |x      |x      |        |       | \r\nTomcat             | xPaaS      |App    |8      |       |       |x      |x      |x       |       | \r\nTomcat             | xPaaS      |App    |8.5    |       |       |       |       |x       |       | \r\nTomcat             | xPaaS      |App    |9      |       |       |       |       |x       |       | \r\nTomcat             | Contenidor |App    |7      |x      |        |      |x      |x       |       |Obsolet\r\nTomcat             | Contenidor |App    |8      |x      |        |      |x      |x       |       | \r\nTomcat             | Contenidor |App    |8.5    |x      |        |      |x      |x       |       | \r\nWeblogic           | PaaS       |App    |12.1   |x      |x      |x      |x      |        |       | \r\nWebsphere          | PaaS       |App    |8.5    |x      |x      |x      |x      |        |       | \r\nWebsphere          | xPaaS      |App    |-      |       |       |       |       |x       |       | \r\nHAProxy            | Contenidor |-      |1.5.1  |x      |       |       |x      |x       |       |Balanceig de contenidors arrencats amb docker-compose a Bluemix \r\nJava               | xPaaS      |-      |8      |       |       |       |       |x       |       | \r\nJava               | xPaaS      |-      |9      |       |       |       |       |x       |       | \r\nJava               | Contenidor |-      |7      |x      |       |       |x      |x       |       |Obsolet \r\nJava               | Contenidor |-      |8      |x      |       |       |x      |x       |       | \r\nJBoss              | PaaS       |App    |6.x    |x      |x      |x      |x      |        |       | \r\nJBoss              | xPaaS      |App    |6      |       |       |x      |x      |        |       | \r\n.Net               | PaaS       |App    |4.5.2  |x      |x      |x      |x      |        |       | \r\n.Net               | xPaaS      |App    |       |       |       |       |       |x       |x      | \r\nNodeJS             | xPaaS      |App    |4.2    |       |       |x      |x      |        |       | \r\nNodeJS             | xPaaS      |App    |4.9    |       |       |       |       |x       |       | \r\nNodeJS             | xPaaS      |App    |6.14   |       |       |       |       |x       |       | \r\nNodeJS             | xPaaS      |App    |8.11   |       |       |       |       |x       |       | \r\nNodeJS             | Contenidor |App    |4.8    |x      |       |       |x      |x       |       | \r\nNodeJS             | Contenidor |App    |6.12   |x      |       |       |x      |x       |       | \r\nNodeJS             | Contenidor |App    |8.9    |x      |       |       |x      |x       |       | \r\nPHP                | PaaS       |App    |5.6    |x      |       |       |       |        |       |    \r\nPHP                | xPaaS      |App    |>5.5   |       |       |x      |x      |        |       |    \r\nPHP                | xPaaS      |App    |5.6    |       |       |       |       |x       |       |    \r\nPHP                | xPaaS      |App    |7.1    |       |       |       |       |x       |       |    \r\nPHP                | Contenidor |App    |5.6    |x      |       |       |x      |x       |       |    \r\nPHP                | Contenidor |App    |7.1    |x      |       |       |x      |x       |       |    \r\nOracleDB           | PaaS       |DB     |12.1   |x      |x      |x      |x      |        |       |    \r\nMySQL              | PaaS       |DB     |5.7    |x      |x      |x      |x      |        |       |    \r\nMySQL              | Contenidor |DB     |5.7    |x      |       |       |x      |x       |       | Opció d'administració a CPD4   \r\nMySQL              | DBaaS      |DB     |-      |       |       |       |       |x       |       |Beta\r\nMySQL              | DBaaS      |DB     |-      |       |       |       |       |        |x      |En proves     \r\nSQLServer          | PaaS       |DB     |2014   |x      |x      |x      |x      |        |       |    \r\nSQLServer          | DBaaS      |DB     |v12    |       |       |       |       |        |x      | \r\nMongoDB            | DBaaS      |DB     |3.2    |       |       |       |       |x       |       |    \r\nMongoDB            | DBaaS      |DB     |3.4    |       |       |       |       |x       |       |    \r\nMongoDB            | PaaS       |DB     |3.2    |x      |       |       |x      |        |       |Adhoc\r\nMongoDB            | Contenidor |DB     |3.2    |x      |       |       |x      |x       |       |    \r\nPostgreSQL         | Contenidor |DB     |9.5    |x      |       |       |x      |x       |       | Opció d'administració a CPD4    \r\nPostgreSQL         | DBaaS      |DB     |9.5    |       |       |       |       |x       |       |    \r\nPostgreSQL         | DBaaS      |DB     |9.6    |       |       |       |       |x       |       |    \r\nPostgreSQL         | DBaaS      |DB     |-      |       |       |       |       |        |x      |En proves    \r\nElasticSearch      | DBaaS      |DB     |2.4    |       |       |       |       |x       |       |Obsolet    \r\nElasticSearch      | DBaaS      |DB     |5.6    |       |       |       |       |x       |       |    \r\nElasticSearch      | DBaaS      |DB     |6.2    |       |       |       |       |x       |       |    \r\nContenidors a mida | Contenidor |-      |-      |x      |       |       |x      |x       |       |\r\nMàquines virtuals  | IaaS       |-      |-      |x      |x      |x      |x      |        |x      |  \r\n\r\n(1) Les versions s'alineen, en la mesura del possible, amb la versió actual CTTI del [Estàndard pel full de ruta del programari](https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/) per a tots els elements que hi estiguin presents\r\n<br><br>\r\n\r\nLlegenda \"Tipus\":\r\n\r\n- **xPaaS**: és un entorn d'execució que s'arrenca en el moment de fer el push de l'artefacte que volem fer córrer. No hi ha pre-aprovisionament. Talles flexibles. Escalat automàtic.\r\n- **Contenidor**: artefacte de software que inclou tots les dependències necessàries per a dur a terme la seva funció i és portable entre clouds que els suportin (Docker)  \r\n- **DBaaS**: base de dades com a servei, és un subtipus de xPaaS. Escala automàticament.\r\n- **IaaS**: màquines virtuals, on s'aprovisiona fins al nivell de SO.\r\n\r\n<style>\r\n\ttable tr:first-child th:first-child, table tr:first-child th:last-child{\r\n\t\tbackground-color:#fff;\r\n\t}\r\n\ttable tr:first-child th:first-child{\r\n\t\tborder-top: none!important;\r\n\t\tborder-left:none!important;\r\n\t}\r\n\ttable tr:first-child th:last-child{\r\n\t\tborder-top: none!important;\r\n\t\tborder-right:none!important;\r\n\t}\r\n\r\n\ttable tr:nth-child(1) th:nth-child(1), \r\n\ttable tr:nth-child(1) th:nth-child(2), \r\n\ttable tr:nth-child(1) th:nth-child(3),\r\n\ttable tr:nth-child(2) th:nth-child(4),\r\n\ttable tr:nth-child(2) th:nth-child(8), \r\n\ttable tr:nth-child(2) th:nth-child(10),\r\n\ttable tr td:nth-child(4), \r\n\ttable tr td:nth-child(8), \r\n\ttable tr td:nth-child(10){\r\n\t\tborder-right: 3px solid #aaa;\r\n\t}\r\n</style>\r\n\r\n<script src=\"https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js\"></script>\r\n<script>\r\n\t$(document).ready(function() {\r\n\t\t//Data table plugin\r\n    \t$('table').DataTable( {\r\n\t        \"paging\": false,\r\n\t        \"info\" : false,\r\n\t        \"ordering\": false,\r\n\t        \"language\":{\r\n\t        \t\"search\" : \"<strong>Cerca:</strong> \",\r\n\t\t        \"infoEmpty\": \"No hi ha registres\",\r\n\t        \t\"zeroRecords\": \"No s'han trobat registres\"\r\n\t        },\r\n\t        initComplete: function () {\r\n\t            this.api().columns().every( function (col_index) {\r\n\t                var column = this;\r\n\t                if(col_index===10){\r\n\t                \t$(\"<p>&nbsp;</p>\").appendTo($(column.header()));\r\n\t                \treturn;\r\n\t                }\r\n\t                var select = $('<select><option value=\"\"></option></select>')\r\n\t                    .appendTo( $(column.header()) )\r\n\t                    .on( 'change', function () {\r\n\t                        var val = $.fn.dataTable.util.escapeRegex(\r\n\t                            $(this).val()\r\n\t                        );\r\n\t \r\n\t                        column\r\n\t                            .search( val ? '^'+val+'$' : '', true, false )\r\n\t                            .draw();\r\n\t                    } );\r\n\t \r\n\t                column.data().unique().sort().each( function ( d, j ) {\r\n\t                    select.append( '<option value=\"'+d+'\">'+d+'</option>' )\r\n\t                });\r\n\t            });\r\n\r\n\t            //adds header private/public\r\n\t            $(\"<tr><th colspan='4'></th><th colspan='4'>Privat</th><th colspan='2'>Públic</th><th colspan='1'></th></tr>\").insertBefore($(\"table thead tr\"));\r\n\t        }\t        \r\n    \t});\r\n\t});\r\n</script>\r\n","objectID":"L2Nsb3VkL21hdHJpdS1jYXRhbGVnLWNsb3Vk"},"L2Nsb3VkL29ycXVlc3RyYWRvcnNfY29udGVuaWRvcnM=":{"date":1509580800000,"title":"Orquestradors de contenidors","description":"Consideracions respecte als orquestradors de contenidors","sections":"Container Cloud","weight":6,"categories":["cloud","docker","container","paas","openshift","kubernetes","swarm"],"path":"/cloud/orquestradors_contenidors","content":"## Introducció\n\nEn un entorn productiu, el desplegament utilitzant contenidors, moltes vegades no és suficient, és necessari disposar d'un conjunt de recursos addicionals que siguin capaços d'oferir un nivell de servei prou bo.\nAquests recursos són oferts pels orquestradors.\nAl mercar existeixen diferents eines per orquestrar els contenidors docker.\nLa Generalitat de Catalunya dóna suport als següents orquestradors:\n\n* AppAgile (basat en Openshift)\n* Kubernetes\n* SwarmMe (basat en Swarm)\n\nTot i que conceptualment tenen molts punts en comú, cadascun d'aquests orquestradors presenta components i maneres de treballar particulars.\nEn aquest article es defineix la manera de treballar i els components a utilitzar en cada orquestrador amb l'objectiu de minimitzar l'esforç necessari.\n\n## Aspectes bàsics\nEn un entorn productiu de contenidors, cal tenir present un conjunt d'aspectes més enllà dels propis contenidors.\nEls orquestradors ens ajudaran a assolir alguns dels següents aspectes.\n\n### Registre\nLes imatges de contenidors, un cop creades a partir del Dockerfile, cal repositar-les en un registre.\nDocker ofereix un registre públic amb imatges de tot tipus oferides per fabricants de productes i col·laboradors particulars. És el [Docker Hub](https://hub.docker.com/).\nPer repositar les imatges privades fruit dels diferents desenvolupaments de projectes, cal tenir un registre privat que només permeti accedir a les imatges als usuaris autoritzats.\n\n### Seguretat\nEls contenidors docker s'executen sobre el Docker Engine. Tot i que els contenidors són bastant segurs i cap a fora de la màquina on s'executen només exposen els ports que es defineixen al Dockerfile, si tenim diverses aplicacions, cadascuna amb diversos contenidors cal afegir una capa de seguretat entre elles.\nAddicionalment cal establir una capa de seguretat a la gestió de les diferents aplicacions de manera que cada aplicació pugui ser administrada per un tenant sense que altres tenants puguin accedir a ella. \n\n### Alta disponibilitat i escalat\nEls contenidors docker en si, no ofereixen alta disponibilitat. No està inclòs al concepte de contenidor. La idea per alta disponibilitat és realitzar escalat horitzontal de 2 o més contenidors idèntics.\nÉs necessari un component extern que controli el nombre de contenidors aixecats contínuament.\n\n### Balanceig\nQuan es disposen de més d'un contenidor d'un tipus, és necessari disposar d'un element que faci balanceig entre els diversos contenidors.\n\n### Serveis\nEls contenidors de docker s'exposen com a serveis a través de paràmetres a la comanda d'execució dels contenidors, mapejant ports interns del container amb ports externs del host. És necessària una capa addicional que permeti gestionar d'una manera una mica més àgil i flexible aquesta exposició.  \n\n### Enrutament\nAddicionalment al balanceig, és necessari disposar d'un element enrutador que permeti:\n\n* Configurar certificats SSL\n* Enrutar el transit entre diferents xarxes per oferir per exemple serveis només intranet o internet\n\n### Emmagatzematge\nL'emmagatzematge als contenidors s'estableix a través dels volums. És necessària una gestió addicional dels mateixos que ofereixin una millor granularitat a l'hora de proveir l'emmagatzematge des de diferents fonts.\n\n### Monitorizació de recursos i logs\nEls contenidors Docker normalment es configuren per a què els logs s'enviïn a la sortida estàndard. Quan existeix un volum elevat de containers, la monitorització es pot complicar molt. És necessària algun tipus d'eina que faciliti aquesta monitorització.\n\n### Quotes\nEls contenidors dockers, no tenen cap tipus de quota definida. Poden consumir tots els recursos de maquinari que requereixin. Per garantir l'estabilitat dels entorns productius, és necessari que hi hagi algun component que pugui limitar el consum de recursos de cada contenidor.\n\n### Desplegament\nActualment els cicles de vida de desenvolupament d'aplicacions van cap a models CI/CD i DevOps.\nLa Generalitat de Catalunya disposa de l'eina SIC per realitzar els desplegaments.\nSón necessàries eines que facilitin la integració d'un model de basat en contenidors amb eines de CI/CD com el SIC. \n\n## Comparativa entre orquestradors\n\n### Característiques\n\nAl següent diagrama es descriu:\n\n* Principals components de cada orquestrador\n* Correspondències entre els components de cada orquestrador\n* Components permesos a la Generalitat de Catalunya  \n\n![comparativa entre Orquestradors docker](/related/cloud/comparativaOrquestradors.png)\n\n## Descripció dels orquestradors\n### SwarmMe\nEstà basat en Swarm.\nSwarm és l'orquestrador oficial de docker. Actualment és el menys evolucionat dels tres.\nSwarmMe complementa alguna de les mancances que Swarm presenta (Registre, Sistema centralitzat de logs, eines de desplegament, ...)\n\nPer més informació podeu consultar https://docs.docker.com/engine/swarm/\n\n### Kubernetes\nVa ser creat per Google.\nActualment està evolucionant molt.\nRecentment ha rebut el suport oficial de docker.\n\nPer detalls i exemples podeu visitar la plana http://canigo.ctti.gencat.cat/cloud/contenidors_kubernetes/\n\nPer més informació podeu consultar la web https://kubernetes.io/\n\n### AppAgile\nAppAgile està basat en Openshift Container Platform.\nDesenvolupat per Red Hat, basat en Kubernetes.\nAfegeix funcionalitat addicional a Kubernetes (gestió d'usuaris, segmentació de xarxa, sistema centralitzat de logs).\nAcostuma a portar un endarreriment respecte a l'última versió de kubernetes d'uns tres o quatre mesos.\n\nPer detalls i exemples podeu visitar la plana http://canigo.ctti.gencat.cat/cloud/contenidors_appagile/\n\nPer més informació podeu consultar les webs http://appagile.io/ i https://docs.openshift.com/container-platform/3.4/\n\n## Imatges\nA l'hora de construir les imatges docker, cal tenir present els criteris definits per la Generalitat de Catalunya i que cada orquestrador, tot i que totes les plataformes es basen en docker, té les seves particularitats.\n\nA la plana [Criteris creació contenidors docker](http://canigo.ctti.gencat.cat/cloud/dockerImages/) podeu trobar més informació al respecte. \n\n\n","objectID":"L2Nsb3VkL29ycXVlc3RyYWRvcnNfY29udGVuaWRvcnM="},"L2Nsb3VkL3BsYXRhZm9ybWVz":{"date":1462924800000,"title":"Plataformes Cloud","description":"Bluemix, OpenShift, Azure, ...","sections":"Container Cloud","weight":1,"categories":["cloud","docker","container","paas"],"path":"/cloud/plataformes","content":"## Plataformes Cloud\r\n\r\n### Cloud Públic\r\n\r\n* **Bluemix**\r\n\t- https://www.ibm.com/cloud-computing/bluemix/, basat en Cloud Foundry\r\n\t- Concepte xPaaS: buildpack/runtime, https://console.ng.bluemix.net/docs/cfapps/runtimes.html\r\n\t- Contenidors: Docker, Docker-compose\r\n\r\n* **Compose.io**\r\n\t- DBaaS: ElasticSearch, MongoDB, PostgreSQL\r\n\r\n_Tot i que és una plataforma Cloud independent a Bluemix, és propietat d'IBM, i s'espera a curt termini que hi estigui totalment integrat donant les mateixes prestacions (monitoratge, backups, etc) que com a plataforma independent_\r\n\r\n* **Azure**\r\n\t- https://azure.microsoft.com\r\n\t- VM: màquines virtuals Windows/Linux\r\n\t- xPaaS: websites/appservice, principalment les .NET\r\n\t- DBaaS: SQL Database\r\n\t\r\n### Cloud Privat\r\n\r\n* **Openshift**\r\n\r\n\t- https://www.openshift.com/\r\n\t- xPaaS: runtimes preparats per a fer córrer aplicacions https://www.openshift.com/features/cartridges.html\r\n\t- Contenidors: Docker i orquestració amb Kubernetes\r\n","objectID":"L2Nsb3VkL3BsYXRhZm9ybWVz"},"L2NzL3N1YnNjcmlwY2lvbnM=":{"date":1523635902000,"title":"Subscripcions al butlletí de Comunicacions Canigó","description":"Gestió de la subscripció al butlletí d'un usuari","draft":false,"sections":"","weight":4,"path":"/cs/subscripcions","content":"El CS Canigó publica mensualment un Comunicat amb articles, tutorials i notificacions sobre els serveis tractats al portal:\n\n* CS Canigó\n* SIC\n* SGDE\n* GICAR\n* Cloud\n* CSTD\n\nA continuació, es descriu com un usuari pot gestionar la seva subscripció.\n\n## Creació de l'usuari per a la gestió de subscripcions als butlletins\n\nLa gestió de subscripcions es duu a terme a través del portal [https://butlletins.gencat.cat](https://butlletins.gencat.cat).\n\nPrimer de tot, cal destacar que l'usuari s'ha de donar d'alta (si no està ja) en aquest web. Per fer-ho cal que s'intenti subscriure al butlletí desitjat. Durant el procés, haurà de loginar-se si ja té un usuari existent o haurà de crear-ne un de nou en cas contrari.\n\n## Procediment de subscripció\n\nPer donar-se d'alta com a subscriptor de les Comunicacions Canigó, cal seguir les següents passes:\n\n1. Accedir amb un navegador web a: [https://butlletins.gencat.cat](https://butlletins.gencat.cat).\n2. Desplegar el grup **Administració Pública** i sel·leccionar **Comunicacions Canigó**.\n3. Prémer el botó **Següent** (situat al final de la pàgina, cantó dret).\n4. Si mai s'ha donat d'alta com a suscriptor, haurà d'omplir el formulari inferior. En cas contrari, ha de fer login.\n5. Si s'ha hagut de donar d'alta, rebrà un correu de validació al compte de correu indicat. Haurà de confirmar accedint a l'enllaç **Confirmar alta** en el correu rebut.\n6. Finalment, caldrà confirmar al web la suscripció d'alta al butlletí sel·leccionat.\n\n## Procediment de baixa de subscripció\n\nPer donar-se de baixa com a subscriptor de les Comunicacions Canigó, cal seguir les següents passes:\n\n1. Accedir amb un navegador web a: [https://butlletins.gencat.cat](https://butlletins.gencat.cat).\n2. Fer login amb el seu usuari.\n3. A la pantalla de benvinguda, apareixeran totes les subscripcions que tingui actives. Cercar la subscripció de **Comunicacions Canigó** i prémer el botó de **Baixa** corresponent.\n\nEn cas de dubte, podeu contactar al correu `oficina-tecnica.canigo.ctti@gencat.cat`, on us podrem resoldre els dubtes o problemes que tingueu associats a la subscripció del nostre butlletí.\n\n","objectID":"L2NzL3N1YnNjcmlwY2lvbnM="},"L2Rlc3RhY2F0cy8yMDE3LTA4LTAzLVJlY29yZF9wZXRpY2lvbnNfZUZvcm11bGFyaXM=":{"date":1501718400000,"title":"Milió de peticions al servei d'eFormularis","description":"Durant el mes de Juliol s'ha arribat al milió de peticions al servei d'eFormularis, sent el nombre més elevat en la història del servei","key":"AGOST2017","path":"/destacats/2017-08-03-Record_peticions_eFormularis","content":"","objectID":"L2Rlc3RhY2F0cy8yMDE3LTA4LTAzLVJlY29yZF9wZXRpY2lvbnNfZUZvcm11bGFyaXM="},"L2Rlc3RhY2F0cy8yMDE3LTEwLTEwLUFkdmVydGltZW50cy1DaHJvbWUtSFRUUA==":{"date":1507593600000,"title":"Advertiments a Chrome en llocs web HTTP","description":"A partir d'aquest mes d'octubre, Chrome v62 mostrarà l'advertiment 'No segura' quan els usuaris introdueixin text en un formulari d'una pàgina HTTP. Es recomana que els llocs web amb aquestes característiques migrin a HTTPS","sections":["canigo"],"key":"OCTUBRE2017","path":"/destacats/2017-10-10-Advertiments-Chrome-HTTP","content":"","objectID":"L2Rlc3RhY2F0cy8yMDE3LTEwLTEwLUFkdmVydGltZW50cy1DaHJvbWUtSFRUUA=="},"L2Rlc3RhY2F0cy9lbnRvcm4tZGV2LWNhbmlnby0xXzBfMw==":{"path":"/destacats/entorn-dev-canigo-1_0_3","content":"+++\ndate        = \"2017-03-21\"\ntitle       = \"Publicació entorn de desenvolupament Canigó v1.0.3\"\nenllac\t    = \"http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/\"\ndescription = \"Ha estat publicada la versió 1.0.3 de l'entorn de desenvolupament de Canigó. S'ha actualitzat la versió d'Ubuntu a 16.04 LTS\"\nno_index \t  = true\nkey \t\t    = \"ABRIL2017\"\n+++\n","objectID":"L2Rlc3RhY2F0cy9lbnRvcm4tZGV2LWNhbmlnby0xXzBfMw=="},"L2Rlc3RhY2F0cy9zaWMtdHJhc3Bhcy1zYXU=":{"date":1435622400000,"title":"Traspàs a SAU CTTI","description":"Aquest mes de Juny s'ha començat ha treballar en el traspàs de certes tasques operatives (alta d'usuaris, repositoris al SVN, ...) que realitza l'equip del SIC a SAU CTTI. El traspàs no es farà efectiu fins a l'últim trimestre de l'any.","key":"JULIOL2015","path":"/destacats/sic-traspas-sau","content":"Aquest mes de Juny s'ha començat ha treballar en el traspàs de certes tasques operatives (alta d'usuaris, repositoris al SVN, ...) que realitza l'equip del SIC a SAU CTTI. El traspàs no es farà efectiu fins a l'últim trimestre de l'any.","objectID":"L2Rlc3RhY2F0cy9zaWMtdHJhc3Bhcy1zYXU="},"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1pYmlibGlvLW5vdQ==":{"date":1450396800000,"title":"Canvi de domini del repositori ibiblio a Maven","description":"","sections":"Canigó","path":"/destacats-related/domini-ibiblio-nou","content":"Recentment el repositori Maven d'*ibiblio* ha canviat de domini. Per tal que les aplicacions Canigó que accedeixen a aquest repositori puguin continuar resolent les dependències en aquest, caldrà actualitar-ne la referència.\r\n\r\nLa manera més fàcil de fer-ho sense modificar codi de l'aplicació és mitjançant el fitxer de configuració \"settings.xml\" de la instal·lació de Maven. S'ha d'afegir un mirror al nou domini:\r\n\r\n```\r\n<mirrors>\r\n   \t<mirror>\r\n\t\t<id>repoibiblio</id>\r\n\t\t<name>Repositori ibiblio</name>\r\n\t\t<url>http://maven.ibiblio.org/maven2/</url>\r\n\t\t<mirrorOf>ibiblio</mirrorOf>\r\n\t</mirror>\r\n</mirrors>\r\n\r\n```","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1pYmlibGlvLW5vdQ=="},"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1ub3U=":{"date":1430092800000,"title":"Nou domini per repositoris Maven","description":"","sections":"Canigó","path":"/destacats-related/domini-nou","content":"Es recomana que les aplicacions Caniǵo accedeixin als repositoris Maven de Canigó utilitzant el nou domini \"repos.canigo.ctti.gencat.cat\".\r\n\r\nLa manera més fàcil de fer-ho sense modificar codi de l'aplicació és mitjançant el fitxer de configuració \"settings.xml\" de la instal·lació de Maven. S'ha d'afegir un mirror al nou domini:\r\n\r\n```\r\n<mirrors>\r\n    <mirror>\r\n      <id>repocanigo</id>\r\n      <name>Repositori Canigo</name>\r\n      <url>http://repos.canigo.ctti.gencat.cat/repository/maven2</url>\r\n      <!-- id del repositori Canigo definit a l'aplicació: http://canigo.ctti.gencat.cat/repository/maven2 -->\r\n      <mirrorOf>canigo</mirrorOf>\r\n    </mirror>\r\n  </mirrors>\r\n\r\n```","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1ub3U="},"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdS1mb3JtYXQtY29tdW5pY2F0cw==":{"date":1432857600000,"title":"Nou format dels comunicats del CS Canigó","description":"Des del mes de Juny de 2015 els comunicats que s'emeten des del CS Canigó tenen una nous estils adaptats als corporatius","sections":"Canigó","path":"/destacats-related/nou-format-comunicats","content":"Des del mes de Juny de 2015 els comunicats del CS Canigó tenen una nous estils adaptats als corporatius. Aquesta és la maqueta per els nous butlletins:\r\n\r\n<CENTER>![maqueta_butlleti](/images/destacats/maqueta_butlleti.png)</center>\r\n\r\nAquesta plantilla ha estat modificada per adaptar-la als tipus de continguts que s'emeten en els comunicats del CS Canigó: temes d'interés, notícies, gràfiques d'activitat i howto's.\r\n\r\nPer qualsevol suggeriment per tal de millorar aquests comunicats ens podeu fer arribar els vostres comentaris a la [Bústia del CS Canigó](mailto:oficina-tecnica.canigo.ctti@gencat.cat).","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdS1mb3JtYXQtY29tdW5pY2F0cw=="},"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdmEtdmVyc2lvLXBpY2E=":{"date":1453939200000,"title":"Nova versió connector canigó PICA DNI","description":"","sections":"Canigó","key":"FEBRER2016","path":"/destacats-related/nova-versio-pica","content":"S'han publicat les versions 1.1.0 de canigo-connectors-pica-dni per a canigó 2 i 1.2.0 de canigo.integration.dni.pica per a canigó 3.\r\n\r\nAmb els nous canvis per a realitzar una consulta de DNI s'ha d'informar el primer cognom o l'any de naixement de la persona que es cerca, juntament amb els actuals camps obligatoris de documentació i tipus de documentació.\r\n\r\nPer a més informació podeu consultar la [documentació del connector](/canigo-documentacio-versions-3x-integracio/modul-dni/)","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdmEtdmVyc2lvLXBpY2E="},"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtY2FtcHNyZXF1ZXJpdHM=":{"date":1436140800000,"title":"Recordatori: Obligatorietat de camps àmbit i aplicació als serveis de SGDE","description":"","sections":"SGDE","path":"/destacats-related/sgde-campsrequerits","content":"Us recordem que els camps `ambit` i `aplicacio` passaran a ser obligatoris per a totes les versions del WS publicades a la plataforma. El desplegament d'aquest canvi està planificat pel **28/09/2016** a l'entorn de PRE i el **28/11/2016** a l'entorn de PRO. Per tant, **totes les aplicacions hauran d'haver estat adaptades per informar aquests camps i desplegades en el corresponent entorn abans no es faci efectiu el canvi. En cas contrari les crides seran rebutjades**. Destacar que la validació afegida per aquests camps no suposa  regenerar de nou el client del WS, ja que els camps existeixen, només cal informar-los.\r\n","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtY2FtcHNyZXF1ZXJpdHM="},"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtZGVwcmVjYWNpb3Y4":{"date":1436140800000,"title":"Recordatori: Eliminació de la versió v8 del servei d'Eformularis","description":"","sections":"SGDE","path":"/destacats-related/sgde-deprecaciov8","content":"Us recordem que tenim prevista l'eliminació per aquest any 2016 de la versió v8 del WS del servei d'eFormularis. Aquesta és la versió més antiga del WS, la URL de la qual és la següent per als entorns de PRE i PRO respectivament:\r\n\r\n* http://eformularis.pre.intranet.gencat.cat/ServeisInvocacio/services/ServeisAdobe?wsdl\r\n* http://eformularis.intranet.gencat.cat/ServeisInvocacio/services/ServeisAdobe?wsdl\r\n\r\nPreguem que tots els consumidors d'aquesta versió del WS d'eFormularis es posin en contacte amb el CS Canigó enviant-nos un correu a la bústia o bé creant una tasca de Suport al servei STF del JIRA CSTD. En data 15/7 es recopilaran totes les sol·licituds rebudes per ambdós canals i es planificarà conjuntament amb els responsables CTTI de les aplicacions afectades els deadlines per aquesta versió del WS als entorns de PRE i PRO.\r\n","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtZGVwcmVjYWNpb3Y4"},"L2Rlc3RhY2F0cy1yZWxhdGVkL3NpYy1uZXQ=":{"date":1435622400000,"title":".NET al SIC","description":"","sections":"SIC","path":"/destacats-related/sic-net","content":"La integració del llenguatge .NET al SIC s'està realitzant gràcies a l'ús dels diferents slaves Windows que formen part del nou SIC Multi-CPD. Aquests slaves amb SO Windows permeten la compilació de .NET. Per més informació del nou model SIC MUlti-CPD podeu seguir el següent [enllaç](http://canigo.ctti.gencat.cat/noticies/2015-04-30-SIC-Master-Slave-CPD4/) on es presenta el primer slave posat en marxa a CPD4-TSystems.\r\n\r\nDes de l'equip del SIC s'està treballant en els següents punts:\r\n\r\n* *Custodia de codi*: gestió de versions al SVN del codi font de les aplicacions. Caldrà sol·licitar excepcions per poder emmagatzemar fitxers .dll al SVN.\r\n* *Compilació*: ús del plugin MSBuild de Jenkins per la compilació d'aplicacions .NET. Caldrà especificar la versió de .NET i Visual Studio (mòduls Web i WebApplications). Gestió de dependències amb [NuGet](https://www.nuget.org/).\r\n* *Auditories*: integració amb Fortify (Anàlisi de Seguretat) i CAST (Anàlisi de Qualitat) per auditories de codi.\r\n* *Desplegaments*: desplegaments a IIS amb MSDeploy.\r\n\r\nUn cop hagi finalitzat aquesta integració, es notificarà en un comunicat amb tot el detall pel seu ús per part dels proveïdors d'aplicacions.","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3NpYy1uZXQ="},"L2Rlc3RhY2F0cy1yZWxhdGVkL3Rlc3QtamFycy1jYW5pZ28=":{"date":1515542400000,"title":"Canigó. Tests unitaris integrats als binaris de Canigó","description":"Amb l'objectiu que els proveïdors d'aplicacions puguin provar el funcionament dels mòduls de Canigó, podent sobreescriure versions de llibreries, es proporcionen binaris amb els tests unitaris integrats. A aquests binaris els coneixem com a test-jars","sections":["Canigó"],"categories":["canigo"],"key":"GENER2018","path":"/destacats-related/test-jars-canigo","content":"Amb l'objectiu que els proveïdors d'aplicacions puguin provar el funcionament dels mòduls de Canigó, podent sobreescriure versions de llibreries, es proporcionen binaris amb els tests unitaris integrats. A aquests binaris els coneixem com a **test-jars**.\r\n\r\nEn ocasions, pot sorgir la necessitat per part del proveïdor d'aplicacions d'utilitzar una versió més recent d'alguna llibreria respecte a la que incorpora Canigó, sense poder esperar a una nova versió del framework que la incorpori. Exemples de llibreries poden ser Spring Framework o Hibernate. Els motius poden ser diversos, principalment:\r\n\r\n- Actualització a una fix version que soluciona algun **bug** que afecta a alguna funcionalitat de l'aplicació\r\n- Actualització a una minor o major version que incorpora alguna **nova funcionalitat** requerida per l'aplicació\r\n\r\nAixò pot presentar un problema si el proveïdor d'aplicacions reemplaça la llibreria sense garanties que els serveis de Canigó afectats continuin funcionant de forma satisfactòria. És per aquest motiu que des del CS Canigó es proporcionen els test-jars i es defineix com utilitzar-los. Un exemple d'ús pràctic el podeu trobar en el [how-to](http://canigo.ctti.gencat.cat/drafts/2018-01-howto-test_jars_canigo/) publicat aquest mes.\r\n\r\nD'inici, no es proporcionen test-jars per a tots els serveis Canigó, sino només pels considerats com a principals:\r\n\r\n- *Servei Core*: \"canigo.core\" versió 3.2.3 o superior\r\n- *Servei Web REST*: \"canigo.web.rs\" versió 1.1.1 o superior\r\n- *Servei de Persistència*: \"canigo.persistence.jpa\" versió 1.2.2 o superior\r\n- *Servei de Seguretat*: \"canigo.security\" versió 1.2.3 o superior\r\n\r\nAquests binaris estan publicats al Nexus del SIC. Els podeu trobar al [repositori Maven públic](https://hudson.intranet.gencat.cat/nexus/#browse/search/maven) cercant pel groupId \"cat.gencat.ctti\", i \"artifactId\" i \"version\" especificats al llistat anterior.\r\n\r\nPer qualsevol dubte relatiu a l'ús dels test-jars a Canigó 3.2, us podeu posar en contacte amb el CS Canigó enviant un correu a [oficina-tecnica.canigo.ctti@gencat.cat](mailto:oficina-tecnica.canigo.ctti@gencat.cat) o bé fent-nos arribar una petició de consulta/suport al [CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/).\r\n","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3Rlc3QtamFycy1jYW5pZ28="},"L2Rlc3RhY2F0cy1yZWxhdGVkL3VwZ3JhZGUtbmV4dXM=":{"date":1437523200000,"title":"Upgrade Nexus al SIC","description":"","sections":"SIC","path":"/destacats-related/upgrade-nexus","content":"Amb la finalitat de disposar d'un servei actualitzat a les darreres versions de les diferents eines que en formen part s'ha realitzat una actualització del Nexus del SIC. La versió [2.11.3-01](https://support.sonatype.com/entries/94172767-Sonatype-Nexus-2-11-3-Release-Notes) instal·lada, a diferència de la versió anterior existent al SIC, permet configurar repositoris [NuGet](https://www.nuget.org/). NuGet és el gestor de paquets que s'utilitza a .NET, i d'aquesta manera, es segueix preparant el SIC per possibilitar la integració d'aquesta tecnologia.","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3VwZ3JhZGUtbmV4dXM="},"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9JbnRybw==":{"date":1504887102000,"title":"Introducció","description":"Introducció a l'arquitectura de Directoris de la Generalitat","section":"directoris-integracio","taxonomies":[],"toc":false,"weight":2,"path":"/directoris-integracio/Intro","content":"Tota aplicació que requereixi autenticació als Active Directory de la Generalitat de Catalunya (en endavant, directoris) ha de integrar-se als mateixos de la manera més estàndard possible, aprofitant les eines i bones pràctiques posades a disposició del desenvolupament per part de la Generalitat de Catalunya.\r\n\r\nAquesta guia descriu les directrius i recomanacions més rellevants que han de complir els productes i les aplicacions, per portar a terme la integració d’aplicacions que requereixin de Windows Authentication amb els directoris de la Generalitat, per a assolir l’objectiu de poder implementar els serveis d’autenticació i autorització que es requereixin. \r\n\r\nAquesta guia no està dirigida a aplicacions J2EE estàndard, sinó que està pensada específicament per aplicacions i productes tancats que requereixin Windows Authentication per a poder autenticar i autoritzar. Per aquestes aplicacions es recomana fer servir el model que es descriu en la Guia d’Integració d’Aplicacions amb GICAR, donat que el model d’autenticació és molt més escalable, versàtil, flexible i senzill. \r\n\r\nLes directrius indicades en aquest document apliquen:\r\n\r\n- A tots els productes i aplicacions que utilitzin Windows Autentication o susceptibles d’autenticar usuaris amb Directori Actiu.\r\n- A tots els proveïdors de desenvolupament i manteniment d’aplicacions, i també als proveïdors de CPD.\r\n\r\nA continuació, a mode de glossari, es defineixen diversos dels tecnicismes que es citen a la Guia\r\n- AD: Active Directory.\r\n- CN: Common Name. Atribut que identifica un objecte personal d’un directori o un grup.\r\n- CMO: Current Model Operation: infraestructures heretades dels models TIC de la Generalitat anteriors.\r\n- FMO: Future Model Operation: infraestructures noves desplegades arrel del model TIC actual de la Generalitat de Catalunya.\r\n- GICAR: Gestió d’Identitats I Control d’Accés als Recursos. Sistema de gestió d’identitats corporatiu de la Generalitat.\r\n- OU: Unitat Organitzativa d’un directori. És la unitat d’agregació d’un directori sota el qual poden haver-hi altres objectes d’un directori, com podrien ser objectes personals o grups.\r\n- Proxy Invers: configuració que es pot fer en un frontal web (apache o IIS) que permet fer servir el frontal com a punt d’accés únic per accedir als continguts de diversos servidors d’aplicacions.\r\n- Relació de confiança: configuració que es pot dur a terme a dins de un domini, on es permet a els usuaris d’un domini a fer certes operacions en recursos d’un altre domini. Amb aquestes configuracions es permet la interoperabilitat d’operacions d’usuaris entre diferents dominis.\r\n- TIC: Tecnologies de la Informació i les Comunicacions.\r\n- Windows Authenticacion: protocols d’autenticació propis dels sistemes operatius Windows i suportats per la majoria de productes Microsoft.\r\n \r\n","objectID":"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9JbnRybw=="},"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9pbnRhcHNkaXI=":{"date":1504887102000,"title":"Integració d'aplicacions per autenticació en el nou model de directoris ","description":"","section":"directoris-integracio","taxonomies":[],"toc":false,"weight":4,"path":"/directoris-integracio/intapsdir","content":"Les aplicacions objecte d’aquesta guia i que autentiquin usuaris a través del protocol de Windows Authentication, seguiran les següents directrius per a integrar-se en el model de directoris:\r\n\r\n### Entorns de desenvolupament per a provar les solucions\r\n\r\nEl proveïdor d’aplicacions haurà de fer les proves unitàries de l’aplicació/producte sobre un entorn de desenvolupament que ell mateix haurà de construir-se, i que haurà de reproduir de forma fidedigna a l’arquitectura de directoris i d’usuaris descrita en el capítol 1.\r\n\r\n### Ús dels dominis per part dels servidors de les aplicacions\r\n\r\n- El servidor Windows (ja sigui per a un IIS, o per a un SQL Server) sobre el qual estigui desplegada l’aplicació, ha d’estar registrat sobre un dels dominis de CPD (cpdx.intranet.gencat.cat). En cap cas el servidor Windows es podrà registrar directament en el domini de lloc de treball (a excepció dels serveis propis de Lloc de treball). El domini de CPD no té usuaris nominals, ja que estan definits a LT2 (domini de lloc de treball).\r\n- El servidor Windows i l’aplicació han d’utilitzar la relació de confiança existent amb els directoris de lloc de treball de LT2 (FMO) per a cercar els usuaris nominals a validar. La relació de confiança sempre serà seguint la següent direcció: AD CPD --> AD LT2.\r\n\r\n### Autenticació\r\n\r\n- L’aplicació ha d’autenticar els usuaris seguint la següent nomenclatura:\r\n• Nom d’usuari: GCA\\<DNI usuari> o  GCB\\<DNI usuari> o  GCC\\<DNI usuari>.\r\n• Contrasenya: ha de ser la de GICAR.\r\n- El proveïdor d’aplicacions, per a la correcta autenticació de l’usuari, haurà de suportar-se en els proveïdors de Lloc de treball per a validar la implantació de les següents recomanacions en les estacions de treball:\r\n• Existència d’un controlador de domini, que li pugui generar els tiquets Kerberos, o que li serveixi per a poder atendre a peticions d’autenticació NTLM. \r\n• Tenir capacitat per a resoldre els dominis dels directoris de lloc de treball de LT2 (FMO). GCA, GCB, i GCC\r\n\r\n### Autorització\r\n\r\n- Quan sigui necessari autoritzar als usuaris, l’aplicació ha d’utilitzar grups de seguretat locals del directori de CPD.\r\n- Els grups locals del directori de CPD, podran contenir:\r\n• Grups universals dels directoris de LT2. \r\nAquesta és l’opció òptima, donat que d’aquesta manera el manteniment de l’autorització dels usuaris sobre el grup local de CPD podrà fer-lo de forma autònoma l’administrador del directori de LT2, posant els usuaris a dins dels grups universals d’autorització de LT2.\r\n• Objectes usuari dels directoris de LT2.\r\nEn el següent esquema s’il·lustra el plantejament dut a terme.\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - grups.PNG)\r\n\r\n### Consulta de dades d’usuaris\r\n\r\n• L’aplicació no ha de fer consultes LDAP directament contra els directoris de lloc de treball de la Generalitat.\r\n• L’aplicació ha d’utilitzar els mecanismes proporcionats per GICAR per a la consulta d’usuari (Web Service de GDI). A través d’aquest Web Service es podran consultar les dades dels usuaris de la Generalitat de Catalunya.\r\n\r\nPer a més detall veure el document “Integració amb el Webservice de GICAR”\r\n","objectID":"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9pbnRhcHNkaXI="},"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9hcnFyZWNvZGly":{"date":1504887102000,"title":"Arquitectures d'autenticació recomanades per aplicacions que requereixen de Windows Authentication","description":"","section":"directoris-integracio","taxonomies":[],"toc":false,"weight":5,"path":"/directoris-integracio/arqrecodir","content":"## Arquitectures d'autenticació recomanades per aplicacions que requereixen de Windows Authentication\r\n\r\nNormalment la infraestructura de les aplicacions de la Generalitat de Catalunya, segueix una arquitectura de tres capes, on tenim un Apache + Servidor d’aplicacions + Base de dades.\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - 3capes.PNG)\r\n\r\nEn cas que es necessiti que l’aplicació faci servir Windows Authentication, cal revisar bé com resoldre-la, de cara a que els tokens d’autenticació facin “pass-through” dels frontals i arribin als servidors d’aplicacions que és on es processa aquest token.\r\n \r\nLa implementació de Windows Authentication (Kerberos, Negotiate, o NTLM) es pot dur a terme segons la seva compatibilitat amb “Basic Authentication”.\r\n\r\n### Producte compatible amb “Basic Authentication”.\r\n\r\nActivant “Basic Authentication” les peticions d’autenticació passen a fer-se via HTTP, i com a resultat d’això, les peticions flueixen a través de l’Apache.\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - 3capesBasicAuth.PNG)\r\n\r\n•\tAquesta és una solució senzilla, i és la recomanada en cas que el producte o aplicació ho suporti. \r\n•\tTé, com a contrapartida, la pèrdua del Single Sign On amb l’estació de treball de l’usuari, tot i que l’usuari de la màquina i el que es faci servir per a accedir a l’aplicació sigui el mateix.\r\n•\tAquesta opció obliga a instal·lar un certificat digital de servidor a la màquina de l’Apache, per a assegurar que el pas de credencials des del navegador de l’usuari cap al servidor Web de la Generalitat es fa de forma xifrada.\r\n•\tEl proveïdor d’aplicacions ha de validar:\r\no\tQue el producte a integrar sigui compatible amb aquest esquema d’autenticació, i en cas que no, buscar altres maneres de realitzar l’autenticació.\r\no\tQue encara que el producte sigui compatible amb aquest esquema d’autenticació, quan es necessita que diversos servidors recullin els tokens d’autenticació, no sigui un problema el fet de passar els tokens d’autenticació a través d’aquest protocol per a mantenir el Single Sign on entre capes.\r\n\r\n\r\n### Producte no compatible amb “Basic Authentication”.\r\n \r\nDepenent de la tipologia d’autenticació de l’aplicació, es defineixen les següents alternatives: \r\n\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - 3capeskerbAuth.PNG)\r\n\r\n\r\n- **Vàlid per Kerberos, Negotiate o NTLM:**\r\n\r\nS’utilitzarà el  IIS com a frontal. Els IIS de forma nativa ja gestionen i recullen la Windows Authentication, aprofitant aquesta funcionalitat per a posar un IIS de frontal, i recollir el testimoni d’autenticació de les aplicacions.\r\n\r\n•\tNativament el IIS pot fer proxy invers dels tokens d’autenticació.\r\n•\tEl proveïdor de l’aplicació ha de validar la solució en entorns de desenvolupament, per tal d’assegurar que l’aplicació és compatible amb aquesta arquitectura.\r\n\r\n\r\n- **Vàlid per Kerberos o Negotiate:**\r\n\r\nS’utilitzarà un Apache com a frontal. L’Apache recull els tiquets Kerberos i els passa a les capes inferiors.\r\n•\tL’Apache ha de fer servir el mòdul que permet autenticació via Kerberos / Negotiate Authentication .\r\n•\tUtilitzant aquest mòdul, l’Apache recull el tiquet Kerberos que s’ha generat en el PC de l’usuari per passar-lo a capes inferiors.\r\n•\tEl proveïdors d’aplicacions ha de \r\n\to\tValidar com l’aplicació a través del seu IIS pot recollir el tiquet de Kerberos i utilitzar-lo per a autenticar. \r\n\to\tValidar la solució en entorns de desenvolupament, per tal d’assegurar que l’aplicació és compatible amb aquesta arquitectura.\r\n\r\nEn cas que cap de les anteriors opcions d’arquitectura pugui ser implantada, l’Àrea d’Arquitectura del CTTI validarà si és possible que l’aplicació pugui funcionar sense frontal, fent que l’IIS jugui el rol de frontal i de servidor d’aplicacions alhora.\r\n","objectID":"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9hcnFyZWNvZGly"},"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9zaXRhY3R1YWw=":{"date":1504887102000,"title":"Descripció de la situació actual dels directoris de la Generalitat","description":"Mapa actual de Directoris de la Generalitat","section":"directoris-integracio","taxonomies":[],"toc":false,"weight":3,"path":"/directoris-integracio/sitactual","content":"### Context organitzatiu:\r\n\r\nL’actual organització TIC de la Generalitat, contempla els següents elements que són decisius a l’hora d’exposar l’arquitectura de directoris definida:\r\n\r\nProveïdors de Lloc de Treball: cada proveïdor de lloc de treball disposa d’un directori que dóna servei a cadascun dels Lots de lloc de treball, definint els següents interlocutors:\r\n\r\n\t- LT1:  proveïdor  que  gestiona  els  serveis  de  lloc  de  treball  transversals  (Correu, Sharepoint, Lynk, i File)\r\n\r\n\t- LT2A: proveïdor que gestiona el servei de lloc de treball d’Ensenyament ( Plataforma, PC, i Printing)\r\n\t- LT2B: proveïdor que gestiona el servei de lloc de treball de Governació, Empresa i Ocupació, Benestar Social i Família, Economia i Coneixement, Presidència, i Salut ( Plataforma, PC, i Printing)\r\n\t- LT2C: proveïdor que gestiona el servei de lloc de treball de Justícia, Agricultura, Cultura, Territori i Sostenibilitat ( Plataforma, PC, i Printing).\r\n\r\n\tAquests directoris de LT2A, LT2B i LT2C, contenen:\r\n\t- Les identitats de les persones que treballen en cadascun d’aquests departaments de la Generalitat.\r\n\t- Els objectes de les màquines (màquines, impressores, etc)  que s’utilitzen per a treballar en aquests departaments.\r\n\t- Els grups de seguretat que tenen associades totes aquestes persones i objectes de màquina anteriorment definits.\r\n\r\nProveïdors de CPD: cada proveïdor de CPD disposa d’un directori (CPD1 o  CPD2 o  CPD3 o  CPD4).\r\n\r\n\tAquests directoris contenen:\r\n\t- Els objectes de les màquines i servidors que hi ha a cada CPD.\r\n\t- Els usuaris tècnics de servei d’aquests servidors i màquines.\r\n\t- Els grups de seguretat corresponents als anteriors objectes i usuaris tècnics.\r\n\r\nA banda d’això, els directoris de CPD:\r\n\r\n\t- Actuaran fent les funcions de DNS pels servidors del propi CPD (resolent els dominis interns de les màquines del CPD). Així doncs, el servidors DNS centrals del nus XCAT, delegaran la zona cpdx.intranet.gencat.cat i cpdxpre.intranet.gencat.cat als directoris de CPD.\r\n\r\n\t- Actuaran fent funcions de NTP pels servidors del propi CPD. Recolliran l’hora dels servidors NTP de nus i seran els encarregats de distribuir-la pels servidors del propi CPD.\r\n\r\n### La gestió d'identitats corporativa:\r\n\r\nA l’hora d’avaluar les relacions entre directoris de lloc de treball de LT1 i LT2, cobra un paper clau la Gestió d’Identitats Corporativa (Gestió d’Identitats i Control d’Accés als Recursos – GICAR), donat que és l’element encarregat d’automatitzar i normalitzar les següents tasques:\r\n- Alta, baixa, i modificació dels usuaris de la Generalitat en els corresponents directoris de lloc de treball LT2 (FMO).\r\n- Canvi de contrasenya i suspensió dels usuaris en els diferents directoris.\r\n\r\nEn la següent il·lustració es mostra el flux de propagació de la informació dels usuaris establert:\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - gicar.PNG)\r\n\r\n•\tEls  interlocutors  de  RRHH  dels  diferents  departaments  treballen  sobre  les  eines  que  tenen establertes a per a dur a terme l’alta, la baixa i la modificació dels usuaris (GIP/SIP i GDI).\r\n\r\n•\tL’eina de gestió d’identitats corporativa (GICAR), detecta els canvis produïts per les diferents eines de RRHH, i a través d’aquests canvis gestiona el cicle de vida de les identitats.\r\n\r\n•\tGICAR aprovisiona aquests canvis als directoris de Lloc de treball de forma automàtica (LT1, i LT2A, LT2B, i LT2C).\r\n\r\n### Els directoris de LT1 i LT2\r\n\r\nEls noms de domini que tenen els directoris de lloc de treball de LT1 i LT2, són els següents:\r\n\r\n\t\tLT1\t\t•\tPRO: ssccit.gencat\r\n\r\n\t\tLT2A\t•\tPRE: GCAPRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: GCA.intranet.gencat.cat\r\n\r\n\t\tLT2B\t•\tPRE: GCBPRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: GCB.intranet.gencat.cat\r\n\r\n\t\tLT2C\t•\tPRE: GCCPRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: GCC.intranet.gencat.cat\r\n\r\nL’estructura lògica interna dels directoris de lloc de treball, ha de ser, la que es descriu a continuació.\r\nA més de les OUs i contenidors generats per defecte per un domini basat en Windows (com els contenidors \"Users\" i \"Computers\" o la unitat organitzativa \"Domain Controllers\"), el directori ha de contenir les següents cinc Unitats Organitzatives:\r\n\r\n\t- Persones\r\n\t- Grups\r\n\t- Usuaris Tècnics Funcionals\r\n\t- Usuaris Tècnics de Servei\r\n\t- Equips\r\n\r\n, tal com es mostra en el dibuix:\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir-ous.PNG)\r\n\r\n\r\n\r\n- **Branca Persones**\r\n\r\nLa OU de \"Persones\" ha de contenir tots els comptes d'usuari que han d’estar en els directoris, i que han d’estar vinculats amb identitats donades d'alta a GICAR. La OU de “Persones” estarà organitzada pels departaments als quals dóna suport el LOT en qüestió. Dins de cada una d’aquestes OU departamentals existiran 3 unitats organitzatives:\r\n\r\n•\t“Pendents  Alta”  la  qual  serà  la  OU  on  GICAR  deixa  els  usuaris  pertanyents  a  cada  un  dels departaments quan són creats i previ pas a ser mogut manualment per un administrador a la seva OU definitiva (es mouran a una dels OUs corresponents als organismes pertanyents a aquest departament).\r\n•\t“Pendents Baixa” la qual allotjarà els usuaris que en breu seran donats de baixa. GICAR gestiona automàticament i de forma automatitzada l’alimentació d’aquestes OU’s.\r\n•\t“Organismes”  la  qual  estarà  composta  per  una  OU  per  cadascun  dels  organismes  dependents d'aquest departament.\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir-ous-persones.PNG)\r\n  \r\nLa branca d’Organisme tindrà definida l’estructura d’arbre que el lot hagi definit per a gestionar el lloc de treball d’aquell departament. És una branca la qual la seva estructura serà definida segons criteri del proveïdor de lloc de treball, tanmateix es demana que aquesta estructura es defineixi el més semblant possible a la estructura organitzativa del departament o organisme al qual se li doni servei, i que aquesta estructura pugui facilitar implementar polítiques de seguretat sobre els usuaris que estiguin dins d’aquesta branca.\r\n\r\nLa clau pública del certificat X509 de l’usuari podrà estar emmagatzemada en els directoris de lloc de treball, com un atribut més de la identitat. Aquesta clau pública s’emmagatzemarà en l’atribut “X509-Cert” de la identitat. \r\n\r\n\r\n- **Branca de Grups**\r\n\r\nLa OU \"Grups\" ha d’estar dividida per la OU \"Departamentals\" i la OU “Corporatius\". \r\n\r\nLa OU \"Departamentals\" estarà organitzada per departament, i dins d'aquesta OU es proposa l'estructura:\r\n\r\n\t•\tUna OU per organisme: l’estructura d'OU’s ubicada dins d'aquesta és una aproximació a l'actual estructura d'OUs existents dins dels dominis actuals, i facilita la identificació dels grups migrats dins del nou domini.\r\n\r\n\t•\tUna OU per aplicació o accés a recurs (\"Aplicació N\"): es crearan tantes OUs com aplicacions o accessos a tipus de recurs. Per exemple, si es requereix crear grups d'usuaris per crear unitat de xarxa, es crearà una OU anomenada \"Assignació Unitats de xarxa\", i dins d'aquesta es crearien els grups d'usuari necessaris als quals se'ls configurarà una unitat de xarxa.\r\n\r\nAddicionalment els següents grups es generaran a la OU “Departamentals”:\r\n\r\n\t•\tNadiu_DeptN: donarà accés a les aplicacions/recursos propis d'un departament amb el rol d'usuari intern del departament. Tot usuari intern del departament tindrà aquest grup.\r\n\r\n\t•\tConvidat_DeptN: donarà accés a les aplicacions/recursos propis d'un departament amb el rol d'usuari convidat. Tot usuari extern del departament tindrà aquest grup.\r\n\r\n\t•\tDeshabilitat_DeptN: donarà accés a les aplicacions/recursos propis d'un departament amb el rol que sigui, a posteriori que aquests usuaris s'hagin donat de baixa.\r\n\r\nLa OU \"Corporatius\" inclou tres grups generats per GICAR i els membres del grup també seran subministrats per la mateixa eina. Són grups d'ús optatiu:\r\n\r\n\t•\tNadiu_Corporatiu: donarà accés a les aplicacions/recursos corporatius amb el rol d'usuari intern de la Generalitat. Tot usuari intern de la Generalitat tindrà aquest grup.\r\n\r\n\t•\tConvidat_Corporatiu:  donarà  accés  a  les  aplicacions/recursos  corporatius  amb  el  rol d'usuari extern a la Generalitat. Tot usuari extern de la Generalitat tindrà aquest grup.\r\n\r\n\t•\tDeshabilitat_Corporatiu: donarà accés a les aplicacions/recursos corporatius encara que l'usuari ja no formi part de la Generalitat.\r\n\r\n\r\nA través d’aquests grups definits en la branca de grups és possible fer que les aplicacions puguin autoritzar a un conjunt d’usuaris en concret.\r\n\r\nEs recomana que les aplicacions corporatives que hagin de ser usades per personal intern utilitzin els grups Nadiu_Corporatiu per a treballar.\r\n\r\nPer altra banda, es recomana que les aplicacions departamentals que hagin de ser usades per personal intern dels departaments, utilitzin el grup Nadiu_DeptN per a poder treballar.\r\n\r\n\r\n- **Branca d’usuaris tècnics funcionals.**\r\n\r\nAquesta branca tindrà una estructura igual a la OU ‘Departamentals’ de dins de la OU de ‘Grups’. D’aquest arbre d’OU’s penjarà una OU per a cada aplicació. Dins de cadascuna d’aquestes OU’s d’aplicació estaran ubicats els usuaris tècnics funcionals. La nomenclatura d’aquests usuaris es deixarà a criteri del proveïdor de Lloc de Treball.\r\n\r\n\r\n- **Branca d’usuaris tècnics de servei.**\r\n\r\nAquesta branca tindrà una estructura igual a la OU ‘Departamentals’ de dins de la OU de ‘Grups’. D’aquest arbre d’OU’s penjarà una OU per a cada aplicació. Dins de cadascuna d’aquestes OU’s d’aplicació, estaran ubicats els usuaris tècnics de serveis. La nomenclatura d’aquests usuaris es deixarà a criteri del proveïdor de Lloc de Treball.\r\n\r\n\r\n- **Branca d’equips**\r\n\r\nAquesta branca serà lliure, a partir dels criteris de gestió de la mateixa que defineixi el proveïdor de Lloc de Treball.\r\n\r\n\r\n- **Convivència amb els directoris de lloc de treball NO TRANSFORMATS (CMO)**\r\n\r\nFins al desplegament del nou model TIC, cada departament tenia el seu directori departamental NO TRANSFORMAT (CMO). Aquests directoris són els utilitzats per les estacions de treball no transformades (antics lots de lloc de treball de l’anterior model TIC, que s’extingiran un cop s’hagi fet la transformació de lloc de treball dels PC’s d’aquell departament), i per les aplicacions que encara no s’han migrat cap al directori de CPD.\r\n\r\nMentre el lloc de treball de l’usuari no s’hagi transformat, s’ha de considerar que els PC’s dels usuaris estaran al domini de lloc de treball CMO. Això és clau tenir-ho present de cara a avaluar si les aplicacions podran funcionar correctament en aquest entorn.\r\n\r\nEls directoris de lloc de treball CMO contenen:\r\n•\tUsuaris.\r\n•\tEquips PC no transformats.\r\n•\tServidors.\r\n•\tGrups d’autorització (aplicacions i servidor de fitxers).\r\n\r\nL’estructura i nomenclatura de dominis d’aquests directoris és No Homogènia entre departaments, i no és objectiu d’aquest document descriure-la.\r\n\r\n### Els directoris de CPD\r\n\r\nCada CPD disposa d’un directori que té com a objectiu donar suport als servidors Windows que calgui donar d’alta en cada CPD.\r\n\r\nAquests directoris tenen les següents funcions:\r\n•\tRegistrar en domini els servidors donats d’alta.\r\n•\tDisposar de grups d’autorització d’accés als serveis de CPD.\r\n•\tDisposar d’usuaris tècnics per a aixecar serveis i arrencar processos.\r\n\r\nL’estructura d’aquests directoris de CPD és la mateixa que els directoris LT1 i LT2 FMO, amb la diferència de que els directoris de CPD no contenen usuaris personals (únicament disposen d’usuaris tècnics), donat que aquests usuaris es troben definits als directoris de LT1 i de LT2.\r\n\r\nEls noms de domini que tenen els directoris de CPD, són els següents:\r\n\r\n\t\tCPD1\t•\tPRE: CPD1PRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: CPD1.intranet.gencat.cat\r\n\t\tCPD2\t•\tPRE: CPD2PRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: CPD2.intranet.gencat.cat\r\n\t\tCPD3\t•\tPRE: CPD3PRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: CPD3.intranet.gencat.cat\r\n\t\tCPD4\t•\tPRE: CPD4PRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: CPD4.intranet.gencat.cat\r\n\r\n\r\n### Relacions de confiança entre els directoris de la Generalitat\r\n\r\nEl model preveu que existeixin les següents relacions de confiança entre les diferents tipologies de directori:\r\n\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - relconf.PNG)\r\n  \r\n\r\nEn el següent diagrama es mostren les relacions de confiança previstes entre directoris.\r\n\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - relconf - diag.PNG)\r\n\r\n","objectID":"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9zaXRhY3R1YWw="},"L2dpY2FyL2Rlc2NyaXBjaW8=":{"date":1465402302000,"title":"Descripció del servei","description":"Informació general del servei GICAR","sections":"GICAR","taxonomies":[],"toc":true,"weight":1,"path":"/gicar/descripcio","content":"Aquesta guia descriu els aspectes més rellevants per portar a terme la integració d’aplicacions amb la plataforma de Gestió d’Identitats i Control d’Accés als Recursos (en endavant GICAR). GICAR és l’eina amb que s’ha dotat a la Generalitat de Catalunya per a la gestió centralitzada de les identitats de persones que interactuen amb els sistemes d’informació.\n\nGICAR proveeix principalment dos grans funcionalitats:\n\n<br />\n\n1. **Autenticació**: on es descriuen els mecanismes per integrar el model d’autenticació de GICAR amb les aplicacions que s’hi vagin integrant. \n\n\tEn el següent esquema s’especifica a mode general quines són les aplicacions que es recomana que siguin integrades amb GICAR a nivell d’autenticació, i quines es recomana que s’integrin per altres sistemes d’autenticació.\n\n\t![Integració Aplicacions GICAR](/related/gicar/tipus-autenticacio.png)\n\n\tPer aplicacions que calgui integrar-les amb sistemes d’autenticació basats en Windows Autentication, caldria adreçar-se a la “Guia d’Integració amb els directoris del nou model TIC”\n\n\t<br /><br />\n\n1. **Provisió**: on es descriuen els mecanismes per poder gestionar els recursos (aplicacions) a les que té accés una identitat del Directori Corporatiu.\n\n\tEs important remarcar que el Directori Corporatiu és el dipòsit central d’identitats de GICAR i que, per tant, és requisit indispensable estar al Directori Corporatiu per poder gaudir de tots els serveis i funcionalitats que aporta la plataforma.\n\n### Esquema general de GICAR\n\nPer facilitar la comprensió de la plataforma de Gestió d’Identitats, s’inclou a continuació un esquema de l’arquitectura de capes que configuren la plataforma GICAR.\n\n\n![Integració Aplicacions GICAR](/related/gicar/esquema-general-gicar.png)\n\n\nLa plataforma GICAR es fonamenta bàsicament en dos objectius principals:\n- Facilitar la gestió de les identitats (persones) de treballen o col•laboren amb la Generalitat de Catalunya (funcionaris, interins, empreses públiques, externs, etc).\n- Facilitar la gestió i el control de l’accés als recursos per part de les identitats, entenent com a recurs qualsevol eina, sistema d’informació o aplicació necessari per a què el professional desenvolupi les seves funcions.\n\nTal i com s’ha indicat, el dipòsit central d’identitats de GICAR és el Directori Corporatiu de la Generalitat de Catalunya. Aquest Directori permet gestionar els següents tipus de col•lectius d’identitats:\n\n- El col·lectiu T1: professionals de la Generalitat de Catalunya gestionats des de l’aplicació de personal GIP/SIP, és a dir, tots aquells que cobren la seva nòmina des de l’aplicació de personal.  En general, funcionaris que treballen als departaments.\n\n- El col·lectiu T2: professionals de la Generalitat no gestionats des de l’aplicació de personal GIP/SIP, és a dir, tots aquells que no cobren la seva nòmina des de GIP/SIP.  En general, personal d’empreses públiques, consorcis, ...\n\n- El col·lectiu T3: professionals que col•laboren amb la Generalitat. En general, treballadors temporals, oficines liquidadores, personal d’altres administracions / organismes / ens locals, becaris, ...\n\n\nActualment es disposa de dues vies per donar d’alta/baixa/modificar identitats del Directori Corporatiu, que es descriuen a continuació:\n\n1.\tVia GIP/SIP: utilitzat només per identitats del col.lectiu T1. Quan una identitat modifica el seu estat en el GIPSIP (Alta/Baixa/Modificació), es llança un procés batch que alimenta el Directori Corporatiu amb els canvis que han tingut lloc. El GIPSIP sempre actuarà com a mestre de dades del Directori per identitats tipus T1.\n\n2.\tVia GDI (Gestió d’Identitats): eina que permet fer l’alta / baixa / modificació d’identitats T1, T2, T3 i no-nominals al Directori Corporatiu. Per les identitats T1, un cop se’ls ha assignat un Lloc de Treball, passaran a dependre exclusivament de GIP/SIP i amb GDI no es podran modificar. \n\nPel que fa als mecanismes d’autenticació d’usuaris, la plataforma disposa de la següent eina:\n\n- SiteMinder: que s’ocupa de l’autenticació d’identitats al Directori Corporatiu que intenten accedir a aplicacions Web (ja sigui amb usuari i contrasenya o bé amb certificat Digital). És una eina, com es veurà en el següent punt, que permet disposar de Single Sign On d’aplicacions Web. A banda del Directori Corporatiu, aquest component també permet autenticar usuaris de les administracions locals de Catalunya (a través del directori de l’EACAT), i permet autenticar certificats digitals vàlids, a través del servei de PSIS del Consorci AOC.\n\nPel que fa als mecanismes de provisió i control d’accés a recursos, GICAR aporta les següents funcionalitats:\n\n- Disposa d’una eina de Workflow per gestionar les peticions d’alta/baixa/modificació d’accés a recursos (aplicacions)\n- Disposa d’una eina de recordatori de contrasenya, que permet que cada identitat del Directori Corporatiu es gestioni la seva pròpia contrasenya.\n- Disposa d’una eina per sincronitzar la contrasenya de diferents aplicacions.\n- Permet controlar i administrar l’accés a les aplicacions integrades en GICAR\n\nActualment la plataforma de Gestió d’Identitats disposa de dos entorns:\n\n- Entorn de Pre-Producció\n- Entorn de Producció\n","objectID":"L2dpY2FyL2Rlc2NyaXBjaW8="},"L2dpY2FyL2ludGVncmFjaW8td3M=":{"date":1465402302000,"title":"Webservice","description":"Com integrar-se amb el Webservice de GICAR","sections":"GICAR","taxonomies":[],"toc":true,"weight":3,"path":"/gicar/integracio-ws","content":"Actualment, l’aplicació GDI permet realitzar una sèrie d’actuacions sobre les identitats presents en el Directori Corporatiu. L’objectiu del Web Service de GDI es proporcionar aquestes mateixes funcionalitats, per tal que tant usuaris i/o aplicacions puguin disposar d’elles de manera externa a l’eina GDI. Així doncs, el Web Service servirà de connector per a terceres persones, permetent la seva integració amb GICAR.\r\n\r\nLa solució adoptada proporciona una comunicació senzilla mitjançant missatges i documents amb format XML entre les diferents aplicacions Web. En concret, es fa ús del protocol SOAP, que es una particularització de XML.\r\n\r\nEl xifrat de tots els missatges està assegurat a nivell del servidor d’aplicacions (jboss) i es força la comunicació TLS/SSL en totes les comunicacions amb el Web Service, amb certificat de servidor i sense requeriment de certificat en el client.\r\n\r\nA continuació s’especifiquen les dades de connexió al WebService dels diferents entorns PRE i PRO\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/connexio-ws-gicar.png)\r\n\r\n## Arquitectura\r\n\r\nA continuació s’exposa un senzill diagrama indicant les connexions entre les màquines:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/esquema-ws.png)\r\n\r\nTota comunicació cap al GDI vindrà proporcionada pel Web Service, utilitzant preferiblement per a les comunicacions un canal segur SSL per tal d’assegurar protecció a nivell de transport. Tal i com ja s’ha indicat, totes les operacions s’indicaran mitjançant documents XML amb protocol SOAP i amb una estructura predefinida. A més a més, tot document XML caldrà que inclogui l’estàndard ‘Username Token’ per tal de transmetre un identificador junt amb una contrasenya que servirà per a autenticar-se en el sistema (més informació sobre l’estructura de les peticions en 4.3 Llistat d’operacions disponibles).\r\n\r\nAltres sistemes que intervenen en els processos i que s’exposen en el diagrama són:\r\n\r\n- Directori Corporatiu: sistema final a on s’emmagatzemen les dades dels diferents usuaris.\r\n- Oracle Identity Manager (OIM): l’altre sistema final a on es controlen els diferents estats dels usuaris.\r\n- Repositori de gestors: base de dades a on consten els diferents usuaris / aplicacions que tenen permès accedir a les funcionalitats que s’ofereixen, així com de quins privilegis disposen.\r\n\r\n## Flux de peticions\r\n\r\nA continuació es mostra la interacció entre els sistemes per a una petició genèrica al Web Service:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/flux-ws.png)\r\n\r\n1. S’envia la petició en un document amb format XML i protocol SOAP. \r\n\r\n2. El Web Service extraurà la capçalera que inclou la informació relativa a l’autenticació. Es realitza una validació contra el Directori Corporatiu. Per tal de consumir el WebService caldrà doncs disposar d’un usuari de connexió al WS i caldrà ser demanar a l’Equip GICAR.\r\n\r\n3. Si l’usuari o aplicació passa aquest primer control d’autenticació, es procedirà a comprovar si aquest disposa dels privilegis necessaris per a la petició en qüestió. Per tant, es realitza una segona validació contra el repositori de gestors.\r\n\r\n4. Una vegada s’hagi autenticat correctament a l’usuari o aplicació, es farà una primera validació del contingut del missatge. Es comprovarà que la seva estructura es la correcta i que el format dels camps especificats compleix les especificacions donades (Annex A).\r\n\r\n5. Si la petició supera tots els punts anteriors, es procedirà a executar la sol•licitud. En el cas de que la petició no passi correctament alguna de les comprovacions anteriors, es retornarà a l’usuari un missatge indicant l’error i es procedirà a finalitzar el flux.\r\n\r\n6. Un cop s’ha executat l’acció requerida, s’informarà al peticionari a través d’un missatge de resposta amb una estructura predefinida.\r\n\r\n## Llistat d’operacions disponibles\r\n\r\nLes operacions que s’implementaran en el Web Service són:\r\n\r\n- enableUser: activa la identitat d’un usuari del Directori Corporatiu.\r\n- disableUser: desactiva a un usuari present en el Directori.\r\n- setPasswordUser: insereix una nova contrasenya per a l’usuari indicat.\r\n- lookupUser: busca a un usuari en el Directori i retorna informació sobre ell.\r\n- searchUsers: retorna un llistat amb els usuaris del Directori que compleixin una sèrie de condicions.\r\n\r\nS’ha predefinit per a cadascuna d’aquestes operacions una estructura determinada així com una sèrie de variables que es poden inserir. El Web Service validarà per a cada petició que aquesta s’ajusti al format requerit. \r\n\r\nA continuació es detalla per a cada operació quina estructura ha de tenir, així com les possibles respostes que es retornarà.\r\n\r\n## Capçalera d’autenticació\r\n\r\nTal i com ja s’ha introduït en punts anteriors d’aquest mateix document, el Web Service requereix que totes les operacions incorporin unes credencials per tal d’autenticar els peticionaris contra el Directori Corporatiu. Posteriorment es realitzarà una segona validació d’aquestes credencials per a comprovar si l’usuari/aplicació en qüestió està autoritzat per a demanar-les. \r\nMés informació sobre els diferents mètodes de protecció del Web Service es pot trobar a:\r\n\r\nhttp://www.oasis-open.org/committees/tc_home.php?wg_abbrev=wss\r\n\r\nEn concret, es demana que s’incorporin en els missatges enviats l’estàndard “Username Token” per tal d’informar d’un identificador i una contrasenya. Aquest element vindrà incorporat en una capçalera en el inici de totes les peticions, tal i com es mostra en l’exemple següent:\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t\t<soapenv:Envelope\r\n\t\txmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"\r\n\t\txmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\r\n\t\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\r\n\r\n\t<soapenv:Header>\r\n\r\n\t<wsse:Security xmlns:wsse=\"http://docs.oasisopen.\r\n\torg/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\r\n\tsoapenv:mustUnderstand=\"1\">\r\n\t<wsse:UsernameToken xmlns:wsu=\"http://docs.oasisopen.\r\n\torg/wss/2004/01/oasis-200401-wss-wssecurity-utility-\r\n\t1.0.xsd\" wsu:Id=\"UsernameToken-20201168\">\r\n\t<wsse:Username>11111111H</wsse:Username>\r\n\t<wsse:Password Type=\"http://docs.oasisopen.\r\n\torg/wss/2004/01/oasis-200401-wss-username-tokenprofile-\r\n\t1.0#PasswordText\">xxxxxxxx</wsse:Password>\r\n\t</wsse:UsernameToken>\r\n\t</wsse:Security>\r\n\r\n\r\n\t</soapenv:Header>\r\n\r\n\t<soapenv:Body>\r\n\r\n\t<spmlRequest xmlns=\"http://ws.gdi.sia.es\">\r\n\r\n\t...... ......\r\n\t...... ......\r\n\r\n\t</spmlRequest>\r\n\t</soapenv:Body>\r\n\t</soapenv:Envelope>\r\n\r\nCom es pot observar, les credencials d’autenticació estan presents en la capçalera i, per tant, són visibles per a qualsevol que sigui capaç de capturar el missatge. Es per això que es força que tota comunicació que s’estableixi amb el Web Service es realitzi a través d’un canal segur TLS/SSL amb certificat de servidor i sense necessitat de certificat al client. D’aquesta manera s’incorpora una capa de seguretat a nivell de transport que acaba de protegir del tot la comunicació.\r\n\r\n## Mètode enableUser\r\n\r\n- L’objectiu del mètode es habilitar a un usuari ja present el Directori Corporatiu.\r\n- Cal especificar el NIF de la identitat afectada (camp psoID).\r\n\r\nUn exemple de petició seria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<resumeRequest xmlns=”urn:oasis:names:tc:SPML:2:0” xmlns:dsml=”urn:oasis:names:tc:DSML:2:0:core”>\r\n\t<psoID ID=”11111111H”>\r\n\t<targetID ID=”GICAR”/>\r\n\t<containerID ID=”Persones”/>\r\n\t</psoID>\r\n\t</resumeRequest>\r\n\r\n•\tUn exemple de resposta confirmant que s’ha realitzat el canvi seria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:resumeResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0:core” status=”success”/>\r\n\r\nEn el cas de que aparegui algun error es retornarà:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:resumeResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:core” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:resumeResponse>\r\n\r\n## Mètode disableUser\r\n\r\n- Mètode encarregat de desactivar a un usuari en el Directori Corporatiu.\r\n- Cal indicar el NIF de la identitat (camp psoID).\r\n\r\nA continuació es mostra un exemple de petició:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<suspendRequest xmlns=”urn:oasis:names:tc:SPML:2:0” xmlns:dsml=”urn:oasis:names:tc:DSML:2:0:core”>\r\n\t<psoID ID=”11111111H”>\r\n\t<targetID ID=”GICAR”/>\r\n\t<containerID ID=”Persones”/>\r\n\t</psoID>\r\n\t</suspendRequest>\r\n\r\nSi tot es correcte, es retorna:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:suspendResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0:core” status=”success”/>\r\n\r\nEn cas de que es trobi algun error, aquest es notificarà:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:suspendResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:core” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:suspendResponse>\r\n\r\n## Mètode setPasswordUser\r\n\r\n- Mètode encarregat de modificar la contrasenya d’un usuari del Directori Corporatiu.\r\n- Cal indicar el NIF de l’usuari (camp psoID) i la nova contrasenya (camp password).\r\n\r\nUn exemple de petició seria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<setPasswordRequest xmlns=”urn:oasis:names:tc:SPML:2:0”\r\n\txmlns:dsml=”urn:oasis:names:tc:DSML:2:0:password”>\r\n\t<psoID ID=”11111111H”>\r\n\t<targetID ID=”GICAR”/>\r\n\t<containerID ID=”Persones”/>\r\n\t</psoID>\r\n\t<password>contrasenya</password>\r\n\t</setPasswordRequest>\r\n\r\nSi tot es correcte, es retornarà:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:setPasswordResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:password” status=”succes”/>\r\n\r\nPer finalitzar, en el cas de que hagi sorgit un error es retornarà el seu codi així com una breu descripció del mateix:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:setPasswordResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:password” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:setPasswordResponse>\r\n\r\n\r\n## Mètode lookupUser\r\n\r\n- Mètode usat per a fer una cerca d’un usuari en el Directori Corporatiu i recuperar informació de certs atributs.\r\n- Cal indicar el NIF de la identitat a buscar informació dins de la petició.\r\n- Annexat a aquest mateix document es troba un llistat dels camps disponibles en el GDI que són els que es podran retornar en aquesta consulta\r\n\r\nL’estructura de la petició es:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<lookupRequest returnData=”everything” xmlns=”urn:oasis:names:tc:SPML:2:0”>\r\n\t<psoID ID=”11111111H” xmlns=”urn:oasis:names:tc:SPML:2:0”/>\r\n\t</lookupRequest>\r\n\r\nSi tot es correcte, la informació es retornarà estructurada com un llistat tal i com es mostra a continuació:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:lookupResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0” status = “succes”>\r\n\t<ns1:pso>\r\n\t<ns1:psoID ID=”11111111H”/>\r\n\t<ns1:data>\r\n\t<ns2:attr xmlns:ns2=”urn:oasis:names:tc:DSML:2:0:core” name=”employeeID”>\r\n\t<ns2:value>11111111H</ns2:value>\r\n\t</ns2:attr>\r\n\t<ns3:attr xmlns:ns3=”urn:oasis:names:tc:DSML:2:0:core” name=”gencatFirstCognom”>\r\n\t<ns3:value>Martinez</ns3:value>\r\n\t</ns3:attr>\r\n\t<ns4:attr xmlns:ns4=”urn:oasis:names:tc:DSML:2:0:core” name=”gencatSecondCognom”>\r\n\t<ns4:value>Delgado</ns3:value>\r\n\t</ns4:attr>\r\n\r\n\t...           ...         ...\r\n\r\n\t</ns1:data>\r\n\t</ns1:pso>\r\n\t</ns1:lookupResponse>\r\n\r\n\r\nEn cas d’error en algun punt de la validació o en l’execució de la petició es retornarà:\t\r\n\t\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:lookupResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:core” status=”failure”>\r\n\t<ns1:pso>\r\n\t<ns1:psoID ID=”11111111H”/>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:pso>\r\n\t</ns1:lookupResponse>\r\n\r\n## Mètode searchUsers\r\n\r\n\r\n- Mètode encarregat de realitzar una cerca d’usuaris en el Directori Corporatiu. Retorna el NIF i el codi intern (identificador) dels usuaris que compleixin amb els paràmetres de la cerca especificats.\r\n- Caldrà establir com a mínim un paràmetre per a fer la cerca.\r\n- Es podrà utilitzar varis paràmetres de cerca units mitjançant els operadors lògics AND i/o OR.\r\n\r\nCas d’us 1: saber quins usuaris compleixen amb els criteris demanats sense obtenir el detall dels atributs dels usuaris:\r\n\r\nPer exemple, podríem enviar com a petició:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<searchRequest returnData=”identifier” xmlns=”urn:oasis:names:tc:SPML:2:0:search” xmlns:dsml=”urn:oasis:names:tc:DSML:2:0:core”>\r\n\t<query scope=”pso”>\r\n\t<basePsoID ID=””/>\r\n\t<and>\r\n\t<dsml:filter>\r\n\t<dsml:equalityMatch name=”givenName”>\r\n\t<dsml:values>Perico</dsml:values>\r\n\t</dsml:equalityMatch>\r\n\t</dsml:filter>\r\n\t<dsml:filter>\r\n\t<dsml:equalityMatch name=”gencatFirstCognom”>\r\n\t<dsml:values>Martínez</dsml:values>\r\n\t</dsml:equalityMatch>\r\n\t</dsml:filter>\r\n\t</and>\r\n\t</query>\r\n\t</searchRequest>\r\n\r\nUna petició com l’anterior retornaria una resposta com:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:searchResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0:search” status=”success”>\r\n\t<ns1:pso>\r\n\t<ns2:psoID xmlns:ns2=”urn:oasis:names:tc:SPML:2:0” ID=”11111111H”/>\r\n\t<ns3:data xmlns:ns3=”urn:oasis:names:tc:SPML:2:0”>\r\n\t<ns4:attr xmlns:ns4=”urn:oasis:names:tc:DSML:2:0:core” name=”codiintern”>\r\n\t<ns4:value>JPNX0001</ns4:value>\r\n\t</ns4:attr>\r\n\t</ns3:data>\r\n\t</ns1:pso>\r\n\t<ns1:pso>\r\n\t<ns5:psoID xmlns:ns5=”urn:oasis:names:tc:SPML:2:0” ID=”12345678Z”/>\r\n\t<ns6:data xmlns:ns6=”urn:oasis:names:tc:SPML:2:0”>\r\n\t<ns7:attr xmlns:ns7=”urn:oasis:names:tc:DSML:2:0:core” name=”codiintern”>\r\n\t<ns7:value>JTNX0001</ns4:value>\r\n\t</ns7:attr>\r\n\t</ns6:data>\r\n\t</ns1:pso>\r\n\t</ns1:searchResponse>\r\n\r\n\r\nObtenint el NIF i el codi intern dels usuaris.\r\n\r\nEn canvi, si hi hagués algun problema es retornaria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:searchResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:search” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:searchResponse>\r\n\r\n\r\nCas d’us 2: obtenir dades de detall dels usuaris que compleixen amb els criteris de cerca:\r\n\r\nEn aquest cas cal informar el valor searchRequest returnData a Everything.\r\n\r\nPer exemple, podríem enviar com a petició:\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t<searchRequest returnData=\"everything\" xmlns=\"urn:oasis:names:tc:SPML:2:0:search\" xmlns:dsml=\"urn:oasis:names:tc:DSML:2:0:core\">\r\n\t\t<query scope=\"pso\">\r\n\t\t\t<basePsoID ID=\"\" />\r\n\t\t\t\t<dsml:filter>\r\n\t\t\t\t\t<dsml:equalityMatch name=\"employeeID\">\r\n\t\t\t\t\t\t<dsml:values>257*</dsml:values>\r\n\t\t\t\t\t</dsml:equalityMatch>\r\n\t\t\t\t</dsml:filter>\t\t\r\n\t\t</query>\r\n\t</searchRequest>\r\n\r\n\r\nUna petició com l’anterior retornaria una resposta com:\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t<ns1:searchResponse xmlns:ns1=\"urn:oasis:names:tc:SPML:2:0:search\" status=\"success\">\r\n\t\t<ns1:pso>\r\n\t\t\t<ns2:psoID xmlns:ns2=\"urn:oasis:names:tc:SPML:2:0\" ID=\"25711341D\" />\r\n\t\t\t<ns3:data xmlns:ns3=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns4:attr xmlns:ns4=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"codiintern\">\r\n\t\t\t\t\t<ns4:value>GCNRMR0001</ns4:value>\r\n\t\t\t\t</ns4:attr>\r\n\t\t\t</ns3:data>\r\n\t\t\t<ns5:data xmlns:ns5=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns6:attr xmlns:ns6=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"carLicense\">\r\n\t\t\t\t\t<ns6:value>actiu</ns6:value>\r\n\t\t\t\t</ns6:attr>\r\n\t\t\t</ns5:data>\r\n\t\t\t<ns7:data xmlns:ns7=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns8:attr xmlns:ns8=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"givenName\">\r\n\t\t\t\t\t<ns8:value>Marta</ns8:value>\r\n\t\t\t\t</ns8:attr>\r\n\t\t\t</ns7:data>\r\n\t\t\t<ns9:data xmlns:ns9=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns10:attr xmlns:ns10=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"gencatFirstCognom\">\r\n\t\t\t\t\t<ns10:value>Cano</ns10:value>\r\n\t\t\t\t</ns10:attr>\r\n\t\t\t</ns9:data>\r\n\t\t\t<ns11:data xmlns:ns11=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns12:attr xmlns:ns12=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"gencatSegonCognom\">\r\n\t\t\t\t\t<ns12:value>Rodríguez</ns12:value>\r\n\t\t\t\t</ns12:attr>\r\n\t\t\t</ns11:data>\r\n\t\t\t<ns13:data xmlns:ns13=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns14:attr xmlns:ns14=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"physicalDeliveryOfficeName\">\r\n\t\t\t\t\t<ns14:value>Centre de Treball Entitat Externa</ns14:value>\r\n\t\t\t\t</ns14:attr>\r\n\t\t\t</ns13:data>\r\n\t\t\t<ns15:data xmlns:ns15=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns16:attr xmlns:ns16=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"department\">\r\n\t\t\t\t\t<ns16:value>ECONOMIA I FINANCES</ns16:value>\r\n\t\t\t\t</ns16:attr>\r\n\t\t\t</ns15:data>\r\n\t\t\t<ns17:data xmlns:ns17=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns18:attr xmlns:ns18=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"gencatResponsable\">\r\n\t\t\t\t\t<ns18:value>40953247E</ns18:value>\r\n\t\t\t\t</ns18:attr>\r\n\t\t\t</ns17:data>\r\n\t\t</ns1:pso>\r\n\t</ns1:searchResponse>\r\n \r\n\r\n","objectID":"L2dpY2FyL2ludGVncmFjaW8td3M="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1nZWNhdA==":{"date":1426250442000,"title":"GECAT","description":"Utilització del connector al sistema SAP del Gecat.","sections":"Canigó. Documentació versió 3.x","weight":7,"path":"/canigo-documentacio-versions-3x-integracio/modul-gecat","content":"## Propòsit\r\n\r\nL'objectiu del present document és descriure la metodologia a seguir en la utilització del connector al sistema SAP del Gecat des de qualsevol aplicació Java del Framework J2EE.\r\n\r\nL'abast d'aquest connector es basa en la utilització de les funcions d'alta de factures, consultes i reserves online del SAP de Gecat, així com totes les funcions batch.\r\n\r\nEl connector permet l'accés al SAP mitjançant objectes de consulta. El connector transforma aquests objectes en una cadena de caràcters vàlida per al SAP. La cadena de retorn és transformada novament en un objecte que conté els registres de retorn.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer poder utilitzar el connector haurem de configurar el projecte perque inclogui dues llibreries dll i diferents jars:\r\n\r\nLes llibreries són sapjcorfc.dll i librfc32.dll i s'han de copiar al directori system32.\r\n\r\nPer fer les operacions sobre el sistema SAP del Gecat és necessària la utilització del jar sapjco-2.1.6, que és el connector propi del SAP per fer les crides a les seves funcions BAPI (RFC).\r\n\r\nLes classes que utilitzarem per fer els objectes d'operacions estan en el jar del connector Gecat09 canigo-connectors-gecat09-2.3.2.jar\r\n\r\nLes classes que utilitzarem per fer les operacions han estat generades amb una eina Open Source anomenada JAXB (Java API for Xml Binding), que genera classes java a partir d'un esquema de xml (XMLSchema). Aquesta eina ens permet no solament generar automàticament classes java sinó també fer validacions per comprovar que les dades que contenen els objectes són vàlides. Per això també haurem d'incloure els jars que necessita JAXB:\r\n\r\n* jaxb-api-1.0.1.jar\r\n* jaxb-libs-1.0.6.jar\r\n* jaxb-impl-1.0.5.jar\r\n* jax-qname-1.1.jar\r\n* namespace-1.0.1.jar\r\n* relaxngDatatype-20020414.jar\r\n* xsdlib-2013.6.1.jar\r\n\r\nPer tal d'instal-lar el mòdul de GECAT es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.gecat.version>[1.2.0,1.3.0)</canigo.integration.gecat.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.gecat</artifactId>\r\n          <version>${canigo.integration.gecat.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de l'eina de suport al desenvolupament.\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/sap.properties\r\n\r\nPropietat                | Requerit | Descripció\r\n------------------------ | -------- | ----------\r\n*.sap.client \t         | Sí       | Client\r\n*.sap.username \t         | Sí       | Usuari de connexió\r\n*.sap.password \t         | Sí       | Password de connexió\r\n*.sap.language \t         | Sí       | Idioma\r\n*.sap.hostname \t         | Sí       | Nom del servidor\r\n*.sap.systemNumber \t     | Sí       | SAP system number\r\n*.sap.connectionPool     | No       | Connexió amb pool. Per defecte: true\r\n*.sap.connectionPoolName | No       | Nom del pool. Per defecte: poolCanigoSAP\r\n*.sap.maxNumConnections  | No       | Número de connexions màximes. Per defecte: 5\r\n*.sap.repositoryName     | No       | Nom del repository. Per defecte: ARAsoft\r\n\r\n## Utilització del Mòdul\r\n\r\nLa utilització del Connector es basa principalment en la configuració. L'ús directe des dels clients es permet mitjançant les interfícies definides.\r\n\r\nEl connector del Gecat ofereix tres operacions: alta de factures online, consultes i reserves. Cada operació té una classe que conté tota la informació de l'operació (o crida) i un altra amb la informació que retorna SAP per aquesta operació. Cada classe conté un altra classe per cada línia que tingui l'operació.\r\n\r\nSi per exemple tenim l'operació consultaFactura, que conté una sola línia, daddadesConsulta, haurem de crear un objecte de la classe DadesConsultaFacturaType i un altre de DadesConsultaType. Aquesta última l'omplirem amb totes les dades que facin falta mitjançant els seus mètodes setters (setSocietat, setCodiCreditor, etc..). Un cop omplert del tot aquest objecte (que representa una sola línia), l'assignarem a l'altre (que és el que representa tota la consulta) mitjançant també un mètode setter: dadesConsultaFactura.setDadesConsulta(dadesConsulta). Si tingués més línies, hauríem de fer el mateix per a totes.\r\n\r\nEn el cas en que una mateixa línia pugui aparèixer més d'una vegada la forma de fer les operacions canvia, ja que el conjunt de totes les línies del mateix tipus aniran dins d'una llista.\r\n\r\nUn cop hem creat l'objecte de crida amb totes les dades necessàries, utilitzarem un objecte de la classe GecatConnector per obtenir l'objecte de retorn amb les dades retornades pel SAP.\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**GecatService.java**\r\n\r\nClasse Java on es realitzarà la lògica de la operació a realitzar i es connecta amb el mòdul de Notificacions electròniques.\r\n\r\n```java\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.gecat.connector.GecatConnector;\r\nimport cat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaTerritori.DadesConsultaTerritoriType;\r\nimport cat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaTerritori.DadesConsultaType;\r\nimport cat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaTerritori.ObjectFactory;\r\nimport cat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaTerritoriRetorn.DadesConsultaTerritoriRetornType;\r\n\r\n@Service(\"gecatService\")\r\n@Lazy\r\npublic class GecatService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(GecatService.class);\r\n\r\n\t@Autowired\r\n    private GecatConnector gecatConnector;\r\n    \r\n\r\n\tpublic String testGecat(){\r\n\t\t\r\n\t\tString message;\r\n\r\n\t\ttry {\r\n\r\n            ObjectFactory objectFactory = new ObjectFactory();\r\n\r\n            /**\r\n             * creem l'objecte per fer la consulta\r\n             **/\r\n            DadesConsultaTerritoriType dadesConsultaTerritori = objectFactory.createDadesConsultaTerritoriType();\r\n            DadesConsultaType dadesConsulta = objectFactory.createDadesConsultaType();\r\n            dadesConsulta.setCodiTerritori(\"0217188\");\r\n            dadesConsultaTerritori.setDadesConsulta(dadesConsulta);\r\n            DadesConsultaTerritoriRetornType dadesConsultaRetorn = gecatConnector.consultaTerritori(dadesConsultaTerritori);\r\n\r\n            log.info(\"getCodiTerritori():\" +\r\n                    dadesConsultaRetorn.getDadesRetorn().getCodiTerritori());\r\n            log.info(\"getNomTerritori():\" +\r\n                    dadesConsultaRetorn.getDadesRetorn().getNomTerritori());\r\n\r\n            message = \"Resultat test : \" + dadesConsultaRetorn.getDadesRetorn().getNomTerritori();\r\n          } catch (Exception e) {\r\n        \t  message = \"Error al test : \" + e.getMessage();\r\n        \t  log.error(e.getMessage(),e);\r\n          }\r\n\t\t\r\n\t\treturn message;\r\n    }\r\n\t\r\n}\r\n```\r\n\r\n**GecatServiceController.java**  \r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les.\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.GecatService;\r\n\r\n@RestController\r\n@RequestMapping(\"/gecat\")\r\npublic class GecatServiceController {\r\n\r\n\t@Autowired\r\n\tGecatService gecatService;\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testGecat() throws Exception {\r\n\t\treturn gecatService.testGecat();\r\n\t}\r\n}\r\n```\r\n\r\n\r\n### Consideracions\r\n\r\nCrides a Gecat sense línies repetides\r\n\r\n* Retorn sense línies repetides\r\n\r\nPer mostrar aquest tipus de crida agafarem com exemple la consulta de partida pressupostària.\r\n\r\nPrimerament crearem tots els objectes que necessitarem per fer el procediment:\r\n\r\n```java\r\ncat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaPartidaPressupostaria.ObjectFactory objectFactory = new cat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaPartidaPressupostaria.ObjectFactory();\r\n```\r\n\r\nLa classe ObjectFactory és, com el seu nom indica, una classe per crear objectes d'altres classes. Aquestes classes són les que ofereix JAXB per crear objectes amb una certa estructura predefinida. Crearem un objecte de la classe ObjectFactory per crear els objectes que serviran per fer la crida (objectFactory).\r\n\r\nSeguidament crearem un objecte que representarà la crida completa. Aquest objecte contindrà un objecte per a cada línia que tingui la crida. Aquests objectes són els que s'han de completar amb la informació de la crida.\r\n\r\n```java\r\nDadesConsultaPartidaPressupostariaType dadesConsultaPartidaPressupostaria = objectFactory.createDadesConsultaPartidaPressupostariaType();\r\n\r\nDadesConsultaType dadesConsulta = objectFactory.createDadesConsultaType();\r\ndadesConsulta.setCentreGestor(\"1006\");\r\ndadesConsulta.setEntitatCP(\"1000\");\r\ndadesConsulta.setExercici(\"2002\");\r\ndadesConsulta.setPosicioPressupostaria(\"D/220100100/4551\");\r\ndadesConsulta.setVinculacio(\"S\");\r\ndadesConsultaPartidaPressupostaria.setDadesConsulta(dadesConsulta);\r\n```\r\n\r\nAmb aquest objecte ja podem fer la crida al SAP mitjançant el mètode consultaPartidaPressupostaria de la classe GecatConnector. Aquesta funció requereix de l'objecte de consulta.\r\n\r\n```java\r\nDadesConsultaPartidaPressupostariaRetornType dadesConsultaRetorn = gecatConnector.consultaPartidaPressupostaria(dadesConsultaPartidaPressupostaria);\r\n```\r\n\r\nEn aquest punt ja tenim l'objecte de retorn llest per a ser utilitzat per l'aplicació.\r\n\r\n```java\r\nSystem.out.println(\"getDenominacio():\" + dadesConsultaRetorn.getDadesRetorn().getDenominacio());\r\n```\r\n\r\n* Retorn amb línies repetides\r\n\r\nPer mostrar aquest tipus de crida agafarem com exemple la consulta de creditor.\r\n\r\nPrimerament crearem tots els objectes que necessitarem per fer el procediment:\r\n\r\n```java\r\nnet.gencat.gecat.consultes.ConsultaCreditor.ObjectFactory objectFactory = new net.gencat.gecat.consultes.ConsultaCreditor.ObjectFactory();\r\n```\r\n\r\nLa classe ObjectFactory és, com el seu nom indica, una classe per crear objectes d'altres classes. Aquestes classes són les que ofereix JAXB per crear objectes amb una certa estructura predefinida. Crearem un objecte de la classe ObjectFactory per crear els objectes que serviran per fer la crida (objectFactory).\r\n\r\nSeguidament crearem un objecte que representarà la crida completa. Aquest objecte contindrà un objecte per a cada línia que tingui la crida.\r\n\r\n```java\r\nDadesConsultaCreditorType dadesConsultaCreditor = objectFactory.createDadesConsultaCreditorType();\r\nDadesConsultaType dadesConsulta = objectFactory.createDadesConsultaType();\r\ndadesConsulta.setNIFoCodiCreditor(\"A53062927\");\r\ndadesConsulta.setRegistreInicial(\"001\");\r\ndadesConsulta.setSocietat(\"1000\");\r\ndadesConsultaCreditor.setDadesConsulta(dadesConsulta);\r\n```\r\n\r\nHaurem de passar al connector l'objecte de consulta mitjançant el mètode consultaCreditor de l'objecte gecatConnector:\r\n\r\n```java\r\nDadesConsultaCreditorRetornType dadesConsultaRetorn = gecatConnector.consultaCreditor(dadesConsultaCreditor);\r\n```\r\n\r\nAra ja tenim l'objecte de retorn llest per a ser utilitzat:\r\n\r\n```java\r\nList finalList = dadesConsultaRetorn.getDadesRetorn().getDadaRetorn();\r\nSystem.out.println(\"dadaRetorn.getAdreca:\" + ((DadaRetornType)finalList.get(0)).getAdreca());\r\n```\r\n\r\n**Crides a Gecat amb línies repetides**\r\n\r\nPer mostrar aquest altre tipus de crida prendrem com exemple l'alta de factures habilitats.\r\n\r\nCrearem tots els objectes que necessitarem per fer el procediment:\r\n\r\n```java\r\ncat.gencat.ctti.canigo.arch.integration.gecat.factures.FacturesHabilitatsOnline.ObjectFactory objectFactory = new cat.gencat.ctti.canigo.arch.integration.gecat.factures.FacturesHabilitatsOnline.ObjectFactory();\r\n```\r\n\r\nLa classe ObjectFactory és, com el seu nom indica, una classe per crear objectes d'altres classes. Aquestes classes són les que ofereix JAXB per crear objectes amb una certa estructura predefinida. Crearem un objecte de la classe ObjectFactory per crear els objectes que serviran per fer la crida (objectFactory).\r\n\r\nSeguidament crearem un objecte que representarà la crida completa. Aquest objecte contindrà un objecte per a cada línia (o conjunt de línies) que tingui la crida.\r\n\r\n```java\r\nDadesAltaFacturesHabilitatsOnlineType dadesAltaFacturaHabilitats = objectFactory.createDadesAltaFacturesHabilitatsOnlineType();\r\nDadesGeneralsFacturaType dadesGeneralsFactura = objectFactory.createDadesGeneralsFacturaType();\r\ndadesGeneralsFactura.setDataCompt(\"24051980\");\r\ndadesGeneralsFactura.setDataDocument(\"01\");\r\n.\r\n.\r\n.\r\ndadesGeneralsFactura.setTransaccio(\"ZD21\");\r\ndadesAltaFacturaHabilitats.setDadesGeneralsFactura(dadesGeneralsFactura);\r\n```\r\n\r\nSi la línia pot estar repetida, com en el cas de retencions habilitat subhabilitat, haurem de crear una llista d'objectes que representen una línia:\r\n\r\n```java\r\nRetencionsHabilitatSubhabilitatType retencionsHS = objectFactory.1createRetencionsHabilitatSubhabilitatType();\r\nList retencionsHSList = retencionsHS.getRetencioHabilitatSubhabilitat();\r\nRetencioHabilitatSubhabilitatType retencioHS = objectFactory.\r\ncreateRetencionsHabilitatSubhabilitatTypeRetencioHabilitatSubhabilitatType();\r\n\r\nretencioHS.setImportBase(\"1500\");\r\nretencioHS.setImportRetencio(\"25000\");\r\nretencioHS.setIndicadorRetencio(\"01\");\r\nretencioHS.setTipusRegistre(\"3\");\r\nretencioHS.setOrder(0);\r\nretencionsHSList.add(retencioHS);\r\n\r\nretencioHS = (RetencioHabilitatSubhabilitatType)retencioHS.getClass().newInstance();\r\nretencioHS.setImportBase(\"1600\");\r\nretencioHS.setImportRetencio(\"26000\");\r\nretencioHS.setIndicadorRetencio(\"01\");\r\nretencioHS.setTipusRegistre(\"3\");\r\nretencioHS.setOrder(1);\r\nretencionsHSList.add(retencioHS);\r\n\r\ndadesAltaFacturaHabilitats.setRetencionsHabilitatSubhabilitat(retencionsHS);\r\n```\r\n\r\nFixem-nos que és important donar un ordre a les línies contingudes en la llista:\r\n\r\n```java\r\nretencioHS.setOrder(0);\r\n```\r\n\r\nAmb aquest objecte ja podem fer la crida al SAP, mitjançant el mètode altaFacturesHabilitats de l'objecte gecatConnector:\r\n\r\n```java\r\nDadesConsultaCreditorRetornType dadesConsultaRetorn = gecatConnector.consultaCreditor(dadesConsultaCreditor);\r\n```\r\n\r\nAra ja disposem de l'objecte de retorn per a ser utilitzat:\r\n\r\n```java\r\nList finalList = dadesAltaFacturaRetorn.getDadesRetorn().getDadaRetorn();\r\nSystem.out.println(\"dadaRetorn.getClasseDocument():\" +\r\n((DadaRetornType)finalList.get(0)).getClasseDocument());\r\n```\r\n\r\n### Usuaris de prova\r\n\r\nS'han habilitat dos usuaris per a fer proves amb el connector de Gecat. Aquests usuaris es poden fer servir en les proves de desenvolupament, però mai per a producció.\r\n\r\n* ZBTCCANIGO per a les interfases \"batch\".\r\n* ZINTCANIGO per a les interfases \"on-line\".\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1nZWNhdA=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0=":{"date":1426777297000,"title":"Enotum","description":"Connector de la Pica que simplifica l'utilització del servei de Notificacions Telemàtiques de la Generalitat.","sections":"Canigó. Documentació versió 3.x","weight":5,"path":"/canigo-documentacio-versions-3x-integracio/modul-enotum","content":"## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduida al connector de la Pica que simplifica l'utilització del servei de Notificacions Telemàtiques de la Generalitat.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents funcionalitats referents a les notificacions telemàtiques:\r\n\r\nFuncionalitats per a l'empleat públic:\r\n\r\n* Enviar tramesa: Creació d'una nova tramesa de notificacions telemàtiques al sistema E-Notum per part del sistema requeridor de notificacions telemàtiques.\r\n* Consultar estat tramesa: Consulta de l'estat d'una tramesa de notificacions telemàtiques per part del sistema requeridor de notificacions telemàtiques.\r\n* Consultar notificacions destinatari: Consulta de les notificacions telemàtiques adreçades al destinatari.\r\n* Consultar detall notificació: Visualització d'una notificació telemàtica per part d'un empleat públic.\r\n* Consultar evidències notificació: Consulta de les evidències d'una notificació telemàtica gestionades per eNotum.\r\n\r\nFuncionalitats per al ciutadà:\r\n\r\n* Consultar detall notificació: Visualització d'una notificació telemàtica per part del destinatari.\r\n* Consultar notificacions destinatari: Consulta de les notificacions telemàtiques adreçades al destinatari.\r\n* Modificar estat notificació: Permet canviar l'estat d'una notificació telemàtica, per qüestions de seguretat un usuari només pugui canviar d'estat les seves pròpies notificacions.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de notificacions electròniques es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.notificacions.electroniques.version>[1.4.0,1.5.0)</canigo.integration.notificacions.electroniques.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.notificacions.electroniques</artifactId>\r\n          <version>${canigo.integration.notificacions.electroniques.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nSon necessaris els següents arxius de configuració:\r\n\r\n* pica.properties\r\n* pica.signature.properties\r\n* client.axis2.xml\r\n* modules.list\r\n* rampart-1.3.mar\r\n* certificats.jks\r\n* notificacions-electroniques.properties\r\n* app-enotum-config.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/client.axis2.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/rampart-1.3.mar\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/modules.list\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/certificats.jks\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/pica.signature.properties\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/app-enotum-config.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/notificacions-electroniques.properties\r\n\r\nPropietat                                         | Requerit | Descripció\r\n------------------------------------------------- | -------- | ----------\r\n*.notificacions.electroniques.picaServiceBeanName | No       | Nom del bean de Spring per a PICA. Per defecte: picaService\r\n*.notificacions.electroniques.urlPica             | Sí       | URL del servei de la PICA\r\n*.notificacions.electroniques.nomEmissor\t\t  | Sí\t\t | Nom de l'emissor\r\n*.notificacions.electroniques.nifEmissor\t\t  | Sí\t     | Nif de l'emissor\r\n\r\nEls valors de urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nAquest mòdul és dependent del [mòdul de la PICA] (/canigo-documentacio-versions-3x-integracio/modul-pica/) amb lo qual també s'ha de configurar aquest.\r\n\r\n## Utilització del Mòdul\r\n\r\n### PicaService\r\n\r\nEl mòdul ENOTUM requereix de la creació del Bean del servei de la pica, per defecte Enotum cerca un bean anomenat picaService. Si es dessitja canviar aquest nom es pot fer afegint al fitxer notificacions-electroniques.propierties la següent propietat:\r\n\r\n\tnotificacions.electroniques.picaServiceBeanName=[nom del bean]\r\n\t\r\nUn exemple del bean que s'ha de crear:\r\n\r\n\t<!-- BEAN DE LA PICA -->\r\n\t<bean id=\"picaService\" parent=\"abstractPicaService\">\r\n        <property name=\"modalitats\">\r\n            <map>\r\n            </map>\r\n        </property>\r\n    </bean>\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**EnotumService.java**\r\n\r\nClasse Java on es realitzarà la lògica de la operació a realitzar i es connecta amb el mòdul de Notificacions electròniques.\r\n\r\n```java\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.notificacionselectroniques.NotificacionsElectroniquesConnector;\r\nimport cat.gencat.pica.api.peticio.beans.Funcionari;\r\nimport net.gencat.scsp.esquemes.productes.nt.PeticioNtConsultarDetallNotificacioEPDocument;\r\nimport net.gencat.scsp.esquemes.productes.nt.PeticioNtConsultarDetallNotificacioEPDocument.PeticioNtConsultarDetallNotificacioEP;\r\nimport net.gencat.scsp.esquemes.productes.nt.RespostaNtConsultarDetallNotificacioEPDocument;\r\n\r\n@Service(\"enotumService\")\r\n@Lazy\r\npublic class EnotumService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(EnotumService.class);\r\n\r\n\t@Autowired\r\n    private NotificacionsElectroniquesConnector enotum;\r\n    \r\n\r\n\r\n\tpublic String testEnotum(){\r\n\t\t\r\n\t\tString message;\r\n\r\n        try{\r\n\r\n        \tString idTramesaNT = \"101230\";\r\n        \t\r\n        \tPeticioNtConsultarDetallNotificacioEPDocument dades = PeticioNtConsultarDetallNotificacioEPDocument.Factory.newInstance();\r\n    \t\tPeticioNtConsultarDetallNotificacioEP peticioNotificacio = PeticioNtConsultarDetallNotificacioEP.Factory.newInstance();\r\n\r\n    \t\t// Petició\r\n    \t\tpeticioNotificacio.setIdNotificacioNT(idTramesaNT);\r\n\r\n    \t\tdades.setPeticioNtConsultarDetallNotificacioEP(peticioNotificacio);\r\n\r\n    \t\tRespostaNtConsultarDetallNotificacioEPDocument resposta = enotum\r\n    \t\t\t\t.getServeisEmpleatPublic(getFuncionari())\r\n    \t\t\t\t.consultarDetallNotificacio(dades);\r\n        \t\r\n            if(resposta.getRespostaNtConsultarDetallNotificacioEP().getErrors() != null){\r\n            \tmessage = resposta.getRespostaNtConsultarDetallNotificacioEP().getErrors().getPICAErrorArray(0).getDescripcio();\r\n            }else{\r\n            \tmessage = resposta.getRespostaNtConsultarDetallNotificacioEP().getDetallNotificacio().getNotificacio().getEstat();\r\n            }\r\n\r\n        }catch(Exception e){\r\n        \tmessage = \"Error al test: \" + e.getMessage();\r\n        \tlog.error(e.getMessage(), e);\r\n        }\r\n        \r\n        return message;\r\n\r\n    }\r\n\t\r\n\t /**\r\n     * Get funcionari\r\n     * @return\r\n     */\r\n    private Funcionari getFuncionari() {\r\n        Funcionari funcionari = new Funcionari();\r\n        funcionari.setNombreFuncionario(\"Nom Funcionari\");\r\n        funcionari.setNifFuncionario(\"55555555A\");\r\n        funcionari.setEmailFuncionario(\"prova@gencat.com\");\r\n        return funcionari;\r\n    }\r\n}\r\n```\r\n\r\n**EnotumServiceController.java**  \r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.EnotumService;\r\n\r\n@RestController\r\n@RequestMapping(\"/enotum\")\r\npublic class EnotumServiceController {\r\n\r\n\t@Autowired\r\n\tEnotumService enotumService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testEnotum() throws Exception {\r\n\t\treturn enotumService.testEnotum();\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0="},"L2dpY2FyL3Byb3Zpc2lvLXJlY3Vyc29z":{"date":1465402302000,"title":"Provisió de recursos i aplicacions","description":"","sections":"GICAR","taxonomies":[],"toc":false,"weight":4,"path":"/gicar/provisio-recursos","content":"La plataforma GICAR ofereix un altre ventall de funcionalitats relacionades amb el Control d’Accés a Recursos. Els conceptes bàsics a conèixer es descriuen a continuació:\r\n\r\n1. **Provisió d’usuaris**: GICAR disposa d’un dipòsit central d’informació on s’emmagatzemen atributs relatius al tipus d’autorització que té l’usuari per accedir als repositoris/directoris finals (recursos). Mitjançant aquesta eina es pot aprovisionar/ deprovisionar informació de l’usuari en cadascun dels recursos als que té accés. D’aquesta manera, el sistema permet gestionar l’accés a recursos finals i disposar d’una eina de traçabilitat i control centralitzada.\r\n\r\n1. **Reconciliació**: és el procés mitjançant el qual la plataforma de provisioning garanteix la integritat entre la informació del dipòsit central i la informació d’usuari en el recurs/directori final. Solen ser processos nocturns o de cap de setmana per l’elevat volum de comprovacions que es realitzen.\r\n\r\n1. **Workflow**: eina de la plataforma GICAR utilitzada per aplicar controls de negoci i tecnològics prèviament al provés de provisió/ deprovisió de comtes d’usuari en els recursos/ directori finals. És un portal tipus self-service al que tots els usuaris del Directori Corporatiu poden accedir per efectuar les seves peticions d’accés a recursos. Les fases d’autorització i validació estan reservades a identitats concretes per cada recurs.\r\n\r\n1. **Autogestió de Contrasenyes**: eina de la plataforma GICAR que permet que una identitat del Directori Corporatiu (DC) s’autogestioni la contrasenya del DC mitjançant la resposta de desafiaments prèviament configurats per l’usuari. Actualment, l’usuari ha de respondre 3 preguntes i, en el cas de respondre-les correctament, pot canviar-se la contrasenya.\r\n\r\n1. **Sincronització de Contrasenyes**: eina de la plataforma GICAR que permet sincronitzar la contrasenya d’un recurs/ directori amb la contrasenya del Directori Corporatiu. Es tracta d’un mecanisme bidireccional. \r\n\r\n## Arquitectura i elements pel Control d’Accés a Recursos.\r\n\r\nEn el següent esquema s’inclouen els diferents elements de la plataforma GICAR que intervenen en la gestió del control d’accés a recursos:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/arq_apr.png)\r\n\r\nTal i com s’observa en l’esquema anterior, els elements de la plataforma són:\r\n\r\n1. **OIM (Oracle Identity Manager)**: és l’eina de Gestió d’Identitats i control d’accés a recursos de la Generalitat de Catalunya. Es descriuen a continuació algunes de les característiques més remarcables:\r\n\r\n\t- És eina sincronitzada amb el Directori Corporatiu de la Generalitat per garantir la integritat de la informació.\r\n\r\n\t- La seva funció més important és la provisió de comptes d’usuaris o deprovisió en els recursos finals integrats a la plataforma. Aquesta funció facilita enormement els procesos de gestió i administració d’usuaris de les aplicacions finals.\r\n\r\n\t- Permet disposar de traçabilitat d’accions realitzades en els recursos integrats (alta en un recurs, baixa, modificació, bloqueig, sincronisme de contrasenya, etc)\r\n\r\n\t- Disposa d’un mòdul de sincronisme de contrasenyes amb el Directori Corporatiu que propaga la contrasenya en cas que es vegi modificada cap a o des dels recursos integrats.\r\n\r\n\t- Es poc intrusiu amb els recursos/ aplicacions finals donat que els connectors d’aprovisionament es troben integrats dins la pròpia plataforma i no cal cap tipus d’instal.lació en l’aplicació client.\r\n\r\n\t- Permet activar automatismes de control que analitzen l’estat de les identitats i que poden forçar canvis d’estat en funció de paràmetres prèviament definits.\r\n\r\n\t- Integrat amb l’eina de workflow (explicada posteriorment). OIM recull informació de l’estat d’una identitat pel que fa a l’accés a recursos (bloquejat, actiu, etc)\r\n\r\n\t- Fa servir una base de dades Oracle com a dipòsit d’informació.\r\n\r\n\t- Disposa d’una eina d’autogestió de contrasenyes, que li permet a tot usuari del Directori Corporatiu modificar-se la contrasenya en el cas de respondre correctament al 3 preguntes prèviament emmagatzemades en OIM (desafiaments-resposta)\r\n\r\n1.\t**Workflow**: eina que controla l’estat de les peticions, autoritzacions i aprovacions d’accés a recursos. Fa ús de la mateixa BBDD d’OIM per emmagatzemar tota la informació (Estats de la petició, validadors, etc) \r\n\r\n\tLa provisició o deprovisió de recursos requereix en la majoria de casos d’aprovacions parcials per a que aquestes accions es portin a terme. La funció del portal de workflow és precisament aquesta: permet fer peticions d’alta, baixa i modificació d’accés a recursos, veure quines peticions té pendents d’aprovar un responsable, aprovador o autoritzador, saber a quins recursos ja té accés una identitat, quin és l’estat de les peticions, etc.\r\n\r\n\tLa implantació d’una eina de fluxos de treball (Workflow) aporta molts beneficis:\r\n\r\n\t- Obliga a ordenar i estructurar els fluxos de treball per tal de poder automatitzar la seqüència d’accions a portar a terme i identificar a totes les persones que hi intervenen.\r\n\t- Permet establir mecanismes de control i seguiment dels procediments organitzatius.\r\n\t- Independitza el mètode i flux de treball de les persones que l’executen.\r\n\t- Facilita la mobilitat del personal.\r\n\t- Agilitza el procés d’intercanvi d’informació i agilitza la pressa de decisions d’una organització.\r\n\t- Redueix el paper i les accions manuals, a través de l’automatització.\r\n\t- Es guarden traces de totes les accions portades a terme dins d’un flux.\r\n\t- Els actors d’un flux poden consultar l’estat de les peticions en què hi intervenen.\r\n\t- L’eina permet delegació de funcions\r\n\r\n\tLes fases d’un flux de treball (workflow) per demanar accés, modificació o baixa d’un recurs/ Identitat es descriuen a continuació:\r\n\r\n\t- Creació d’una sol·licitud (petició): en aquesta fase, una identitat del Directori Corporatiu fa una petició d’accés/baixa a un recurs per ell mateix o per una persona que depèn d’ell. \r\n\r\n\t- Autorització orgànica: és l’autorització de la sol·licitud per part d’un responsable orgànic (responsable d’identitat). Aquesta validació es podrà escalar tantes vegades com sigui necessari, fins que algú l’aprovi o denegui.\r\n\r\n\t- Validació tècnica: aquesta validació serà portada a terme per part del responsable del recurs implicat en la petició (pot ser alta o baixa del recurs). Aquesta validació podrà incloure tantes validacions consecutives com calgui ja sigui de responsables funcionals, de responsables de dades, d’administradors d’aplicació, etcètera.\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/wf-fases.png)\r\n\r\n\tEs mostra a continuació una mostra de l’aspecte visual del portal de workflow que podrà ser usat pels usuaris per fer peticions, veure autoritzacions pendents, fer aprovacions tècniques, etc:\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/wf-home.png)\r\n\r\n\tEsmentar que l’eina de workflow, addicionalment a la realització de peticions d’alta o baixa de recursos, també permet sol.licitar l’alta i baixa d’identitats tipus T3 al Directori Corporatiu.\r\n\r\n1.\t**BBDD OIM**: Base de dades on es guarda tota la informació relativa a una identitat:\r\n\r\n\t- Recursos als que té accés\r\n\r\n\t- Estat de les peticions de recursos per una identitat\r\n\r\n\t- Rols amb els que s’ha aprovisionat la identitat\r\n\r\n\t- Etc.\r\n\r\n1.\tRecursos Finals: recursos gestionats per OIM. OIM té la capacitat de connectar-se a aquests recursos per aprovisionar o eliminar comptes d’usuari, així com per validar la integritat de la informació entre OIM i el recurs final (procés de reconciliació).\r\n\r\n## Tipus d'aprovisionament\r\n\r\nTal i com s’ha indicat, l’aprovisionament és l’acció de crear comptes d’usuari en els recursos finals. D’igual forma, el deprovisionament és l’acció d’eliminar comptes d’usuari en els recursos prèviament aprovisionats.\r\n\r\nTant l’aprovisionament com el deprovisionament de comptes d’usuari acostuma a efectuar-se com a resultat d’un procés de workflow. Aquest aprovisionament, deprovisionament pot ser:\r\n\r\n- **Automàtic**: a través d’un connector entre OIM i la taula/repositori de comptes d’usuari i rols de l’aplicació, OIM enviarà la informació establerta a l’aplicació per crear o eliminar una compte d’usuari o bé modificar-ne el rol. Tots aquests canvis, quedaran registrats en OIM i es disposarà de traçabilitat de totes les accions efectuades.\r\n\r\n- **Semi-Automàtic**: pràcticament idèntic a l’Automàtic, però en aquest cas es considera necessària la intervenció humana per perfilar el compte d’usuari aprovisionat en el recurs.\r\n\r\n- **Manual**: a diferència dels altres mecanismes, en aquest cas l’administrador de l’aplicació rep notificació com a resultat del workflow, realitza les modificacions en el recurs afectat i finalment és l’administrador qui tanca el workflow. En aquest cas, no és necessari el desenvolupament de cap connector donat que totes les accions són manuals. Amb el tancament del workflow, OIM té coneixment de les accions que s’han efectuat en el recurs final.\r\n\r\n<img src=\"/related/gicar/modes-aprov.png\" style=\"width:75%\" />\r\n\r\n## Fases per donar accés a un recurs\r\n\r\nUn cop descrites les eines que formen part de la Plataforma GICAR per gestionar els recursos als que té accés una identitat, es descriu a continuació el procés que es segueix (des de l’inici) per donar accés a una identitat a un recurs:\r\n\r\n- Alta de la Identitat al Directori Corporatiu (requisit indispensable): mitjançant l’eina GDI o bé via procés de càrrega des de GIPSIP, es dóna d’alta la identitat al Directori Corporatiu.\r\n\r\n- Accés al Portal de Workflow per sol.licitar accés al recurs (per exemple, la intranet)\r\n\tUna identitat del DC (qualsevol) accedeix al porta i sol.licita un recurs per ell o per una altra identitat.\r\n\tUn autoritzador orgànic s’ocuparà d’autoritzar l’alta.\r\n\tUn validador tècnic s’ocuparà d’una segona validació.\r\n\r\n- Finalitzat correctament el workflow, OIM aprovisiona dades de la identitat al recurs final (creació del compte d’usuari i assignació d’un rol determinat)\r\n\r\n- Si es considera necessari, un administrador de l’aplicació perfila el rol de l’usuari.\r\n\r\n- A partir d’aquest moment, en OIM consta que aquest usuari té accés al recurs aprovisionat i amb el rol que s’hagi sol.licitat.\r\n\r\nEn cas d’estar interessats amb la modalitat d’integració d’aprovisionament d’usuaris amb GICAR poseu-nos amb contacte amb el responsables del servei GICAR de cara a avaluar l’abast del projecte.","objectID":"L2dpY2FyL3Byb3Zpc2lvLXJlY3Vyc29z"},"L2dpY2FyLWludGVncmFjaW8vYXV0aC1hbm9uaW1h":{"date":1465402302000,"title":"Servei d’autenticació anònima amb GICAR","description":"","sections":"GICAR","taxonomies":[],"weight":4,"path":"/gicar-integracio/auth-anonima","content":"GICAR ofereix també un servei per tal d’autenticar usuaris amb certificat digital (autenticació per a col·lectiu de ciutadania) independentment de que estiguin o no en el Directori Corporatiu de la Generalitat. Aquest servei és útil per a aplicacions que han de ser accedides per col·lectius d’usuaris que no poden ser identificats ni com a T1, T2, ni com a T3, i que per tant no tenen relació laboral amb la Generalitat.\r\n\r\nHi ha la possibilitat d’indicar a GICAR que, per una aplicació en concret, permeti, amb certificat digital, l’accés a usuaris que no pertanyin al Directori Corporatiu de la Generalitat. Això s’aconsegueix protegint el recurs en qüestió amb l’esquema d’autenticació anònima.\r\n\r\n- Descripció del procés d’autenticació utilitzant l’esquema d’autenticació anònima.\r\n  \r\nEl procés que segueix GICAR per a autenticar usuaris és el que s’indica en el següent esquema:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/diagrama-autenticacio-anonima.png)\r\n\r\nA continuació es descriuen els passos que segueix GICAR en aquest esquema d’autenticació:\r\n\r\nSi l’usuari no té cap sessió activa li apareixerà un formulari de login, per tal d’introduir les seves credencials, o autenticar-se amb certificat digital. En aquest punt, i tenint en compte l’esquema d’autenticació anònima hi ha tres opcions, que retornen la següent informació:\r\n\r\n\r\n1.\t**Autenticació amb usuari i contrasenya per usuaris que estan en el DC**:\r\n\r\n\tAquesta opció només serà vàlida si l’usuari està donat d’alta en el Directori Corporatiu. SiteMinder validarà que les credencials introduïdes per l’usuari siguin les correctes en el DC, i, si això es compleix, retornarà la informació bàsica de l’usuari a l’aplicació a través de la capçalera HTTP_GICAR i HTTP_GICAR_ID. Exemples de les capçaleres\r\n\r\n\r\n\t\tHTTP_GICAR (conté les dades de l’usuari al DC) = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n\t\tHTTP_GICAR_ID (conté el NIF de l’usuari al DC) --> 11112222W\r\n\r\n\r\n2.\t**Autenticació amb certificat per usuaris que estan en el DC**:\r\n\r\n\tAquesta casuística es dóna quan un usuari intenta accedir al recurs protegit per GICAR amb certificat digital, i aquest es troba en el Directori Corporatiu de la Generalitat. Les capçaleres que es rebran en aquest cas seran les següents:\r\n\r\n\t\tHTTP_GICAR (conté les dades de l’usuari al DC) = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n\t\tHTTP_GICAR_ID (conté el NIF de l’usuari) --> 11112222W\r\n\r\n\t\tDe forma opcional i sota petició es podran sol·licitar les següents capçaleres:\r\n\r\n\t\tHTTP_GICAR_CERT (conté el classification level, el issuer, el subject, i el OID del certificat)  --> CLASIFICATIONLEVEL=4;CERTISSUER=C=ES, O=Agencia Catalana de Certificacio (NIF Q-0801176-I), L=Passatge de la Concepcio 11 08008 Barcelona, OU=Serveis Publics de Certificacio ECV-2, OU=Vegeu https://www.catcert.net/verCIC-2 (c)03, OU=Secretaria d'Administracio i Funcio Publica, CN=EC-SAFP;CERTSUBJECT=C=ES, O=Centre Telecomunicacions i Tecnologies de la Informació, OU=Serveis Públics de Certificació CPISR-1, OU=Vegeu https://www.catcert.cat/verCPISR-1 (c)03, SN=GARCIA GARCIA, G=ALBERT, SERIALNUMBER=46587898A, CN=CPISR-1 ALBERT GARCIA GARCIA;CERTIFICATEPOLICY=1.3.6.1.4.1.15096.1.3.1.81\r\n\r\n\t\tHTTP_GICAR_PSIS: que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’annex D.\r\n\r\n\tCal destacar que la capçalera HTTP_GICAR_PSIS és la única capçalera indicada per a obtenir la informació de les diferents entitats de certificació que permet autenticar GICAR, o de nom i cognoms d’usuari autenticat, donat que és la única que conté les dades de forma estructurada.\r\n\r\n\r\n3.\t**Autenticació amb certificat per usuaris que no estan en el DC (Autenticació Anònima)**:\r\n\r\n\tAquesta casuística es dóna quan un usuari intenta accedir al recurs protegit per GICAR amb certificat digital, i aquest no pertany al Directori Corporatiu de la Generalitat. Les capçaleres que es rebran en aquest cas seran les següents:\r\n\r\n\t\tHTTP_GICAR_ID (conté el NIF de l’usuari) --> 11112222W\r\n\r\n\t\tHTTP_GICAR_CERT (conté el classification level, el issuer, el subject, i el OID del certificat)  --> CLASIFICATIONLEVEL=4;CERTISSUER=C=ES, O=Agencia Catalana de Certificacio (NIF Q-0801176-I), L=Passatge de la Concepcio 11 08008 Barcelona, OU=Serveis Publics de Certificacio ECV-2, OU=Vegeu https://www.catcert.net/verCIC-2 (c)03, OU=Secretaria d'Administracio i Funcio Publica, CN=EC-SAFP;CERTSUBJECT=C=ES, O=Centre Telecomunicacions i Tecnologies de la Informació, OU=Serveis Públics de Certificació CPISR-1, OU=Vegeu https://www.catcert.cat/verCPISR-1 (c)03, SN=GARCIA GARCIA, G=ALBERT, SERIALNUMBER=46587898A, CN=CPISR-1 ALBERT GARCIA GARCIA;CERTIFICATEPOLICY=1.3.6.1.4.1.15096.1.3.1.81\r\n\r\n\t\tHTTP_GICAR_PSIS: que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’annex D.\r\n\r\n\tCal destacar que la capçalera HTTP_GICAR_PSIS és la única capçalera indicada per a obtenir la informació de les diferents entitats de certificació que permet autenticar GICAR, o de nom i cognoms d’usuari autenticat, donat que és la única que conté les dades de forma estructurada.\r\n\r\n\tEn el cas de voler obtenir si un usuari s’ha autenticat amb usuari o contrasenya, o amb certificat:\r\n\r\n\t- Si la capçalera GICAR_PSIS ve informada, l’usuari s’haurà autenticat amb certificat.\r\n\r\n\t- Si la capçalera GICAR_PSIS NO ve informada, l’usuari NO s’haurà autenticat amb certificat. La capçalera GICAR_PSIS només apareix quan un usuari s’ha autenticat amb certificat.\r\n\r\n\tEn cas de voler obtenir el nom i cognoms de la persona que s’ha autenticat amb certificat, o altres dades del Certificat (excepte el DNI de l’usuari autenticat el qual es pot recuperar fàcilment amb la capçalera HTTP_GICAR_ID), es recomana fer-ho sempre amb la capçalera HTTP_GICAR_PSIS.\r\n\r\n\r\n- Tipus de certificats admesos pel servei d’autenticació anònima de GICAR.\r\n\r\nEl servei d’autenticació anònima de GICAR està preparat per a poder realitzar l’autenticació de qualsevol certificat reconegut per CatCert (Agència Catalana de Certificació). Actualment les següents entitats són reconegudes per CatCert:\r\n\r\n- Agència Catalana de Certificació (CATCert)\r\n\t\r\n\t- Entitat de certificació Secretaria d'Administració i Funció Pública (EC-SAFP)\r\n\t- Entitat de certificació Administració Local (EC-AL)\r\n\t- Entitat de certificació Parlament (EC-PARLAMENT)  \r\n\t- Entitat de certificació Universitats i Recerca (EC-UR)\r\n\t- Entitat de certificació Universitat Rovira i Virgili (EC-URV)\r\n\t- Entitat de certificació idCAT (EC-idCAT)\r\n\t- Entitat de certificació Sector Públic (EC-SectorPublic)\r\n\t- Entitat de certificació Ciutadania (EC-Ciutadania)\r\n\r\n- Autoridad de Certificación de la Abogacía (AC Abogacía)\r\n- Autoritat de Certificació de la Comunitat Valenciana (ACCV)\r\n- Agencia Notarial de Certificación (ANCert)\r\n- Asociación Nacional de Fabricantes - Autoridad de Certificación (ANF)\r\n- Camerfima - Certificados Camerales\r\n- Ceres Fábrica Nacional de Moneda y Timbre - Real Casa de la Moneda FNMT - RCM)\r\n- Direcció General de Policia (DNI-E)\r\n- Firmaprofesional\r\n- HealthSign\r\n- Intercambio Electrónico de Datos i Comunicaciones, SL (AC EDICOM)\r\n- Izenpe\r\n- Netfocus (no dóna serveis com a Prestador de Serveis de Certificació)\r\n- AC Organización Médica Colegial de España (OMC)\r\n- Servicio de Certificación de Registradores del Colegio de Registradores de la Propiedad y Mercantiles de España (SCR- CORPME)\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vYXV0aC1hbm9uaW1h"},"L2dpY2FyLWludGVncmFjaW8vYXV0aC1taXh0YQ==":{"date":1465402302000,"title":"Servei d’autenticació mixt","description":"Descripció del servei per a usuaris de la Generalitat i per usuaris de l’Administració local (EACAT)","sections":"GICAR","taxonomies":[],"weight":5,"path":"/gicar-integracio/auth-mixta","content":"A través d’aquest mecanisme, les aplicacions de la Generalitat que així ho necessitin, podran delegar la seva autenticació, alhora i de forma federada, contra el directori de usuaris de la Generalitat, i el directori d’usuaris de l’EACAT (Administració Local – Ajuntaments i Consells Comarcals), amb usuari i contrasenya. \r\n\r\nAquesta modalitat d’integració permetrà que les aplicacions que s’integrin amb GICAR i que així ho requereixin, amb una sola integració, puguin delegar l’autenticació contra el col·lectiu d’identitats de GENCAT o, en cas que la identitat no es trobi a GENCAT, contra l’EACAT.\r\n\r\nL’atribut que s’utilitza per a establir el login contra els dos directoris és el NIF (ja és l’atribut que ara mateix s’utilitza per a fer login actualment per les aplicacions integrades amb GICAR i és l’atribut que l’AOC ens ha posat a disposició de l’EACAT per a fer aquesta integració).\r\n\r\nCal destacar que quan l’usuari s’hagi identificat ok contra el Directori de l’EACAT, GICAR només podrà retornar a les aplicacions integrades, com a atribut de resposta, el DNI de l’usuari autenticat (només assegurem que l’usuari és qui diu ser). \r\n\r\nEl que fa GICAR en aquest nou muntatge és:\r\n\r\n- Primer autenticar l’usuari si ve amb certificat (capçaleres estàndard de GICAR): GICAR_ID --> NIF\r\n- En cas que s’hagi autenticat amb usuari i contrasenya, l’anem a buscar primer a DC: GICAR_ID --> NIF\r\n- En cas que no estigui a DC l’anem a buscar a l’EACAT: GICAR_ID, EACAT_ID --> NIF (L’usuari només s’autenticarà al directori del EACAT, si i només si, no està al directori de la Generalitat)\r\n\r\nEs pot veure aquest funcionament en la següent figura:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/diagrama-autenticacio-eacat.png)\r\n\r\nApuntar que hi ha una capçalera que indica a quin directori s’ha autenticat l’usuari, que és la capçalera HTTP_SM_AUTHDIRNAME. Contindrà els valors “DC” o “EACAT” en funció d’on s’hagi autenticat l’usuari.\r\n\r\nEn resum, les capçaleres HTTP que es lliuraran a l’aplicació final integrada, en funció de com s’hagi autenticat l’usuari seran:\r\n\r\n1. Accés amb certificat:\r\n\r\n\t- GICAR_ID --> 00000000T\r\n\r\n \t- HTTP_GICAR_PSIS --> que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’annex D.\r\n\r\n    - SM_AUTHDIRNAME  Contindrà la cadena “Policy Store”\r\n\r\n1. Accés amb usuari del Directori Corporatiu GENCAT\r\n\r\n\t- GICAR_ID --> 00000000T\r\n\r\n \t- GICAR --> CODIINTERN=NFCTPR0001;NIF=00000000T;EMAIL=;UNITAT_MAJOR=CTTI (Cent.Telec.i Tecnol.Inf);UNITAT_MENOR=CTTI (Cent.Telec.i Tecnol.Inf)\r\n\r\n\t- SM_AUTHDIRNAME --> Contindrà la cadena “DC”\r\n\r\n1. Accés amb usuari EACAT (Directori EACAT)\r\n\r\n\t- EACAT_ID --> 00000000T\r\n\r\n\t- GICAR_ID --> 00000000T\r\n\r\n\t- SM_AUTHDIRNAME --> Contindrà la cadena “EACAT”\r\n\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vYXV0aC1taXh0YQ=="},"L2dpY2FyLWludGVncmFjaW8vYXV0aC1zYW1sMg==":{"date":1465402302000,"title":"Servei d’autenticació amb SAML2","description":"","sections":"GICAR","taxonomies":[],"toc":true,"weight":6,"path":"/gicar-integracio/auth-saml2","content":"En cas que l’aplicació a integrar estigui preparada per a treballar amb mecanismes de delegació de l’autenticació a través de protocol SAML2, GICAR disposa de mecanismes per a possibilitar aquesta delegació de l’autenticació a través d’aquest protocol. El producte que utilitza GICAR per a proveir aquesta funcionalitat és el Shibboleth.\r\n\r\nEl Shibboleth de GICAR recull les capçaleres HTTP generades en una sessió de SiteMinder, i genera un ticket SAML2 amb la informació continguda en aquestes capçaleres, que pot rebre una aplicació.\r\n\r\nEn aquests casos és recomanable que l’equip tècnic de l’aplicació contacti amb l’Equip GICAR, per tal de fer un estudi de les possibilitats reals de que l’aplicació delegui l’autenticació a un identity provider extern. Un cop fet aquest estudi en cas que sigui viable es configurarà en l’aplicació aquesta delegació de l’autenticació contra el servei GICAR.\r\n\r\nEs detalla a continuació com funciona una integració mitjançant protocol SAML. Cal comentar abans de descriure el funcionament a què fan referència els següents conceptes:\r\n\r\n- El \"ServiceProvider\" és l’aplicació integrada que demana l’autenticació.\r\n- El “User Agent” és el navegador de l’usuari.\r\n- L’\"Identity Provider\" és el proveïdor d’identitats de GICAR.\r\n\r\n1. Al protocol SAML2, el fluxe el comença l’aplicació integrada que demana l’autenticació (Service Provider). Aquesta, a través d’un HTTP Redirect, sol·licita al Identity Provider un tiquet SAML2.\r\n\r\nD’aquesta manera, l’aplicació consumidora (service provider) de tiquets SAML2 farà un posts a les URL del Identity Provider per a obtenir un tiquet SAML2 vàlid de la següent manera, utilitzant el servei de Redirect/SSO.\r\n\r\n\thttps://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO?SAMLRequest=7b0HYBxJliUmL23Ke39K9UrX4HShCIBgEyTYkEAQ7MGIzeaS7B1pRyMpqyqBymVWZV1mFkDM7Z28995777333nvvvfe6O51OJ%2fff%2fz9cZmQBbPbOStrJniGAqsgfP358Hz8iHjfZolw9Ol638%2bWr%2fBet86ZNz55%2b9lEx2957uPPpw%2f2HD7YPZvn%2b9v7O3mz74MHu%2bfbu%2fZ17ef7w%2fvnO7N5H6U%2fmdVNUy88%2b2hvvfJSeNc06P1s2bbZs6aOd3f3tnQfbuw%2fe7N57tL%2f36P7%2b%2bP7ew5%2f6KH1K%2fRTLrOU35227ah7dvbuq81VdzdbTaVGNi9lq%2b6KYZvX4Il9Os3ZM%2f79LH1Kr6rwo87uvj794vnf3VT4r6nza3n39%2bsuP0pNq2eToeV0vH1VZUzSPltkibx6100do%2f4iQfDSVRo%2fWy2aVT4vzIp99lL5blMvmERNj89vUfVtNq%2fKjo8c82Fpe3fxS1jR5jcF%2bdITByljH2ey8GU%2fbtvCHiA%2fvUuvLYpo3d9t63bSP70pPRzpZLwj%2b2dOXVVlMr9NnVb3INox4d7zLn9CEnnPTcNzHZVldndR51uaffUS95R%2bld48e3%2b1zxdH%2fAw%3d%3d&RelayState=dab8b17c-460d-455e-ac8d-6d8f763afe43\r\n\r\nLes URLs de petició del Identity Provider: https://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO\r\n\r\nEl paràmetre SAMLRequest, el qual conté les dades del servidor que demana el tiquet SAML2: \r\n\r\n\tSAMLRequest=7b0HYBxJliUmL23Ke39K9UrX4HShCIBgEyTYkEAQ7MGIzeaS7B1pRyMpqyqBymVWZV1mFkDM7Z28995777333nvvvfe6O51OJ%2fff%2fz9cZmQBbPbOStrJniGAqsgfP358Hz8iHjfZolw9Ol638%2bWr%2fBet86ZNz55%2b9lEx2957uPPpw%2f2HD7YPZvn%2b9v7O3mz74MHu%2bfbu%2fZ17ef7w%2fvnO7N5H6U%2fmdVNUy88%2b2hvvfJSeNc06P1s2bbZs6aOd3f3tnQfbuw%2fe7N57tL%2f36P7%2b%2bP7ew5%2f6KH1K%2fRTLrOU35227ah7dvbuq81VdzdbTaVGNi9lq%2b6KYZvX4Il9Os3ZM%2f79LH1Kr6rwo87uvj794vnf3VT4r6nza3n39%2bsuP0pNq2eToeV0vH1VZUzSPltkibx6100do%2f4iQfDSVRo%2fWy2aVT4vzIp99lL5blMvmERNj89vUfVtNq%2fKjo8c82Fpe3fxS1jR5jcF%2bdITByljH2ey8GU%2fbtvCHiA%2fvUuvLYpo3d9t63bSP70pPRzpZLwj%2b2dOXVVlMr9NnVb3INox4d7zLn9CEnnPTcNzHZVldndR51uaffUS95R%2bld48e3%2b1zxdH%2fAw%3d%3d \r\n\r\nA continuació es presenta una petició típica d’un tiquet SAML2, decodificada en Base64\r\n\r\n1.\tUn cop enviada la sol·licitud d’autenticació del service provider cap al Identity Provider, en funció dels paràmetres continguts en el SAMLRequest, salta el formulari de login de GICAR. L’usuari s’autentica amb usuari i contrasenya o certificat.\r\n\r\n1.\tUn cop l’usuari s’ha autenticat, el identity provider torna a redirigir a l’usuari cap a la URL del service provider retornant via POST al service provider dos paràmetres:\r\n\r\n\t- SAMLResponse: la qual conté la resposta a la petició d’autenticació feta amb anterioritat, codificada en base 64. Després d’haver estat decodificat un valor tipus d’aquesta resposta podria ser el següent:\r\n\r\n\t\t\t<?xml version=\"1.0\" encoding=\"UTF-8\"?><saml2p:Response xmlns:saml2p=\"urn:oasis:names:tc:SAML:2.0:protocol\" Destination=\"https://adfs.ctti.gencat.cat/adfs/ls/\" ID=\"_133a920d5ca854a8a7979f1c3162eb60\" InResponseTo=\"id-5f5c7321-fe8a-4941-a5ec-4d48f027a7c8\" IssueInstant=\"2014-10-07T06:13:51.250Z\" Version=\"2.0\"><saml2:Issuer xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:entity\">https://idp-gicar.gencat.cat/idp/shibboleth</saml2:Issuer><saml2p:Status><saml2p:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></saml2p:Status><saml2:EncryptedAssertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\"><xenc:EncryptedData xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\" Id=\"_cf60828ecfbe1f9a1630ecfd411180e5\" Type=\"http://www.w3.org/2001/04/xmlenc#Element\"><xenc:EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"/><ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><xenc:EncryptedKey Id=\"_57045e4cf2bdf58b89dc50bf71741783\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><xenc:EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"/></xenc:EncryptionMethod><ds:KeyInfo><ds:X509Data><ds:X509Certificate>.............DADES XIFRADES..................................... =</xenc:CipherValue></xenc:CipherData></xenc:EncryptedKey></ds:KeyInfo><xenc:CipherData xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><xenc:CipherValue>...................................DADES XIFRADES.............................................==</xenc:CipherValue></xenc:CipherData></xenc:EncryptedData></saml2:EncryptedAssertion></saml2p:Response>\r\n\r\n\t- RelayState: El qual torna a prendre el mateix valor que amb anterioritat.\r\n\r\n1.\tL’aplicació captura el SAMLResponse, i decodifica el contingut d’aquest tiquet. Si el resultat del SAML Response significa que el Identity Provider dóna per bona l’autenticació, el Service Provider deixarà passar a l’usuari.\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/saml.png)\r\n\r\nA continuació es detallen els casos d’ús més comuns:\r\n\r\n## Consumidor de SAML2 fet a mida\r\n\r\nCom es deia en la introducció, GICAR disposa d’un “Identity Provider”, construït amb la tecnologia Shibboleth, amb capacitat de facilitar tiquets SAML2 a les aplicacions. \r\n\r\nA continuació es detalla quins són els dominis del Identity Provider als que caldrà accedir per a generar el tiquet de SAML2.\r\n\r\nPRE: https://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO i https://preproduccio.idp4-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO\r\n\r\nPRO: https://idp1-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO i https://idp4-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO\r\n\r\nEn cas que l’aplicació que vulgui cridar via SAML2 a GICAR ha de construir un SAMLRequest que ha de contenir exactament la següent informació, estructurada de la següent forma:\r\n\r\n\t<?xml version=\"1.0\"?> <samlp:AuthnRequest xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Consent=\"urn:oasis:names:tc:SAML:2.0:consent:unspecified\" Version=\"2.0\" Destination=\"https://DOMINI _A_ESPECIFICAR_PER_L’EQUIP_GICAR/idp/profile/SAML2/Redirect/SSO\" ID=\"xxxxxxxxxxxxxxxxxxxxx\" IssueInstant=\"2014-12-24T10:35:25.4269359Z\" IsPassive=\"false\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\"> <saml:Issuer>https://URL del servei peticionari</saml:Issuer> <samlp:NameIDPolicy AllowCreate=\"True\" Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\" /> </samlp:AuthnRequest>\r\n\r\nEn cas que l’aplicació no pugui generar un SAMLRequest amb aquesta parametrització, no podrà integrar-se directament contra GICAR via SAML2, i haurà d’analitzar una altra via d’integració.\r\n\r\nA continuació es proporciona un fragment de codi Javascript que, posat a dins d'una aplicació, permet redirigir a l'usuari cap a GICAR, generant automàticament un SAMLRequest.\r\n\r\n\t<script src=\"rawdeflate.js\"></script>\r\n\r\n\t<script>\r\n\r\n\t//dades de l aplicacio a integrar\r\n\tvar entityid=\"entity ID de l'aplicació integrada definida a GICAR\";\r\n\tvar AssertionConsumerServiceURL=\"URL de refirecció on espera el POST amb el SAMLResponse l'aplicació\";\r\n\r\n\t//url endpoint de GICAR a utilitzar\r\n\tvar endpointGICAR=\"https://A-DEFINIR-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO?SAMLRequest=\";\r\n\r\n\t//calculem el id de la peticio\r\n\tvar randomnumber = +new Date();\r\n\t//calculem la data d'emissio de la peticio. El desitjable és que la data de la petició es calculi en el servidor web i no en Javascript. Aquest fragment de codi per a calcular la data en Javascript és només per a fer proves, en entorn de producció la data s'hauria de calcular al servidor web de cara a assegurar que estigui generada per un rellotge sincronitzar amb un servidor NTP.\r\n\tvar d = new Date();\r\n\tvar curr_date = d.getDate();\r\n\tvar curr_month = d.getUTCMonth()+1;\r\n\tvar curr_month2 = (curr_month<10?'0':'') + curr_month;\r\n\tvar curr_year = d.getFullYear();\r\n\tvar ymd= curr_year+\"-\"+curr_month2+\"-\"+ curr_date+\"T\";\r\n\tvar curr_hour = d.getUTCHours();\r\n\tvar curr_min = d.getUTCMinutes();\r\n\tvar curr_min2 = (curr_min<10?'0':'') + curr_min;\r\n\tvar curr_sec = d.getUTCSeconds();\r\n\tvar curr_msec = d.getUTCMilliseconds();\r\n\tvar hms=curr_hour + \":\" + curr_min2 + \":\" + curr_sec + \".\" + curr_msec;\r\n\tvar datasaml=ymd+hms;\r\n\r\n\t//generem samlrequest en pla\r\n\tvar samlrequestpla=\"<?xml version=\\\"1.0\\\"?> <samlp:AuthnRequest xmlns:saml=\\\"urn:oasis:names:tc:SAML:2.0:assertion\\\" Version=\\\"2.0\\\" ID=\\\"b\"+randomnumber+\"a\\\" IssueInstant=\\\"\"+datasaml+\"\\\" AssertionConsumerServiceURL=\\\"\"+AssertionConsumerServiceURL+\"\\\" ProtocolBinding=\\\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\\\" IsPassive=\\\"false\\\" xmlns:samlp=\\\"urn:oasis:names:tc:SAML:2.0:protocol\\\"> <saml:Issuer>\"+entityid+\"</saml:Issuer> </samlp:AuthnRequest>\";\r\n\r\n\t//fem deflate i codificacio en base64\r\n\tvar samlrequestb64 = btoa(RawDeflate.deflate(samlrequestpla));\r\n\r\n\t//codifiquem url\r\n\tvar samlrequest=encodeURIComponent(samlrequestb64);\r\n\r\n\r\n\tvar targeturl=endpointGICAR+samlrequest;\r\n\r\n\t//fem el redirect\r\n\twindow.location.replace(targeturl);\r\n\t</script>\r\n\r\nAquest fragment de codi font té una dependència amb la llibreria \"rawdeflate.js\" que pot ser descarregada del següent [enllaç] (/related/gicar/rawdeflate.js)\r\n\r\nCaldrà que l'equip desenvolupador faci una petició a l’equip GICAR per a incorporar aquesta aplicació com a consumidora del Identity Provider. Com a mínim els responsables de l'aplicació hauran de facilitar la següent informació a l’equip GICAR per a poder autenticar aquest servei:\r\n\r\n- entityID = Haurà de contenir el valor del SAML:Issuer indicat en el SAMLRequest de les peticions que farà l’aplicació. Serà normalment la URL del servei peticionari.\r\n\r\n- Certificat = Certificat X509 que farà servir l’aplicació consumidora per a desencriptar els tiquets SAML que haurà emès GICAR.\r\n\r\n- AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" = S’haurà d’indicar a quina URL de l’aplicació GICAR haurà de redirigir un cop feta l’autenticació. Serà la URL on es farà la corresponent redirecció, i on es passarà per paràmetre l’atribut SAMLResponse amb el contingut de les respostes que haurà de decodificar i desencriptar l’aplicació.\r\n\r\nCaldrà addicionalment que el desenvolupador especifiqui quina informació voldrà rebre referent a l’usauri que s’haurà autenticat.\r\n\r\n\r\n## Aplicació Sharepoint de Microsoft\r\n\r\nÉs possible tècnicament la integració d’una aplicació Sharepoint 2010 i superior amb GICAR. Per a fer aquesta integració és necessari disposar d’un servidor Windows Server que faci les funcions de Active Directory Federation Services (ADFS).\r\n\r\nL’ADFS és el component de Microsoft que permet la federació dels seus productes amb Identity Providers tercers.\r\n\r\nEn el cas de Sharepoint s’ha provat amb èxit la integració entre GICAR – Shibboleth – ADFS – Sharepoint. \r\n\r\nEn aquest muntatge es configura l’ADFS com a Service Provider del Identity Provider de GICAR. D’aquesta manera, el ADFS és com si fos una aplicació integrada amb GICAR, la qual a la seva hora pot donar accés a múltiples SharePoint i aplicacions del món Microsoft.\r\n\r\n* De cara al Sharepoint:\r\n\t* El ADFS és el seu identity provider.\r\n\r\n* De cara al ADFS:\r\n* \tEl Sharepoint és un dels seus service provider o relying party.\r\n\t* GICAR és el seu identity provider.\r\n\r\n![Integració amb GICAR](/related/gicar/saml-ShibAdfsShp.png)\r\n\r\nEl funcionament en aquests casos seria el següent:\r\n\r\n1.\tEl client amb el seu navegador intenta accedir a una aplicació web desplegada sobre Sharepoint.\r\n\r\n2.\tSharepoint detecta que el recurs està protegit i redirigeix l’usuari cap a AD FS.\r\n\r\n3.\tEl servei AD FS presenta a l’usuari la pàgina WAYF (Where Are you From) per a que l’usuari indiqui on es vol autenticar (actualment aquesta pàgina no es presenta ja que només es pot autenticar amb GICAR).\r\n\r\n4.\tEl navegador del client es redirigeix cap a l’Identity Provider de GICAR (Shibboleth) e inicia una transacció d’autenticació sota el protocol SAML 2.0.\r\n\r\n5.\tSe li presenta al client el formulari de captura de credencials de GICAR.\r\n\r\n6.\tEs validen les credencials.\r\n\r\n7.\tL’Identity Provider genera un token en format SAML 2.0 amb la informació de l’usuari autentica i redirigeix l’usuari cap a l’ADFS.\r\n\r\n8.\tL’ADFS verifica el token rebut i modifica la informació per adaptar-la a la que necessita Sharepoint i finalment deixa passar l’usuari cap a Sharepoint amb aquesta informació. Sharepoint presentarà l’aplicació web sol·licitada en el punt 1.\r\n\r\nPer a més detall tècnic per a veure com integrar el Sharepoint-ADFS-GICAR consultar el document “Integració GICAR amb Sharepoint”.\r\n\r\n## Aplicació .NET 4.x\r\n\r\nNativament les aplicacions .NET 4.x suporten delegar l’autenticació a un ADFS, per tant el mecanisme per a integrar una aplicació .NET amb GICAR pot ser de forma nativa via ADFS. Bàsicament el que aquí es farà serà incloure l’aplicació .NET com a nou Relying Party dins del ADFS que té com a únic Identity Provider “GICAR”.\r\n\r\nEl procediment doncs es basarà en l’exposat en l’apartat “Configurar Sharepoint com a Relying Party” i “Configurar Claim Rules per a Sharepoint” del document “Integració GICAR amb Sharepoint\".","objectID":"L2dpY2FyLWludGVncmFjaW8vYXV0aC1zYW1sMg=="},"L2dpY2FyLWludGVncmFjaW8vaW50ZWdyYWNpbw==":{"date":1465402302000,"title":"Tasques per a integrar una aplicació amb SiteMinder","description":"","sections":"GICAR","taxonomies":[],"weight":2,"path":"/gicar-integracio/integracio","content":"Per tal de realitzar la integració d’una aplicació amb SiteMinder (instal·lació de l’agent al frontal web propi de l’aplicació) s’haurà de seguir el següent procediment:\r\n\r\n1. Obertura dels ports dels firewalls per connectar l’Agent de SiteMinder amb el SiteMinder Policy Server. El responsable de l’aplicació sol·licitarà l’obertura dels ports següents:\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/taula-ports-sm.png)\r\n\r\n1. L’interlocutor de CPD interessat en dur a terme la integració, haurà d’omplir el formulari “Petició d’integració d’una aplicació v3.xls” i enviar-les al sau.tic@gencat.cat, amb la capçalera _PET_ORD_9.34 GICAR_ENTORN_Integració XXXX \r\n\r\n1.\tL’Administrador de GICAR, aplicarà les configuracions pertinents, i omplirà el formulari i el retornarà al sol·licitant.\r\n \r\n1.\tEl tècnic de sistemes instal·larà  l’Agent de SiteMinder en el Servidor Web on resideix el frontal a protegir per SiteMinder, fent ús de la informació lliurada en l’apartat 3 .\r\n\r\n1.\tL’administrador de GICAR, consensuadament amb els responsables de l’aplicació, aplica les polítiques de seguretat en SiteMinder.\r\n\r\n1.\tL’integrador de l’aplicació haurà de modificar l’aplicació per poder capturar i tractar les capçaleres HTTP que li envia SiteMinder un cop l’usuari ha estat validat al Directori Corporatiu .\r\n\r\n**Si l’usuari s’ha autenticat amb usuari i contrasenya contra el  obtindrà les següents capçaleres:**\r\n\r\n* **HTTP_GICAR (conté les dades de l’usuari al DC)** = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n* **HTTP_GICAR_ID (conté el NIF de l’usuari al DC)** --> 11112222W\r\n\r\nEls detalls d’aquests camps es poden veure en la següent taula:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/taula-capçalera-gicar.png)\r\n\r\nSi l’usuari s’ha autenticat amb certificat:\r\n\r\n* **HTTP_GICAR (conté dades si l’usuari està al DC, sino ve buida)** = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n* **HTTP_GICAR_ID (conté el NIF de l’usuari)** --> 11112222W\r\n\r\nSota petició podran obtenir-se també les següents capçaleres:\r\n\r\n* **HTTP_GICAR_CERT** (conté el classification level, el issuer, el subject, i el OID del certificat)  --> CLASIFICATIONLEVEL=4;CERTISSUER=C=ES, O=Agencia Catalana de Certificacio (NIF Q-0801176-I), L=Passatge de la Concepcio 11 08008 Barcelona, OU=Serveis Publics de Certificacio ECV-2, OU=Vegeu https://www.catcert.net/verCIC-2 (c)03, OU=Secretaria d'Administracio i Funcio Publica, CN=EC-SAFP;CERTSUBJECT=C=ES, O=Centre Telecomunicacions i Tecnologies de la Informació, OU=Serveis Públics de Certificació CPISR-1, OU=Vegeu https://www.catcert.cat/verCPISR-1 (c)03, SN=GARCIA GARCIA, G=ALBERT, SERIALNUMBER=46587898A, CN=CPISR-1 ALBERT GARCIA GARCIA;CERTIFICATEPOLICY=1.3.6.1.4.1.15096.1.3.1.81\r\n\r\n* **HTTP_GICAR_PSIS**: que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’annex D.\r\n\r\nA partir d’aquest moment, l’aplicació determinarà els privilegis que té l’usuari que hi accedeix.\r\n\r\n\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vaW50ZWdyYWNpbw=="},"L2dpY2FyLWludGVncmFjaW8vbWlncmFjaW8tc2FjZQ==":{"date":1465402302000,"title":"Migració de SACE a GICAR","description":"","sections":"GICAR","taxonomies":[],"weight":7,"path":"/gicar-integracio/migracio-sace","content":"Per motius històrics diverses aplicacions de la Generalitat fan encara l’ús del Servei d’Autenticació Centralitzat (més conegut com a SACE). Aquest és un servei obsolescent que està en fase d’extinció, i es recomana a totes les aplicacions que encara facin ús d’aquest servei, la migració de l’autenticació cap a GICAR.\r\n\r\nAquest apartat pretén donar unes directrius bàsiques sobre com abordar la migració d’una aplicació web integrada amb SACE vers GICAR. Es començarà explicant com s’integren actualment les aplicacions amb el SACE, i a continuació s’exposarà quin és el mecanisme que es proposa per a migrar l’autenticació a GICAR.\r\n\r\n## Funcionament actual de l’autenticació de les aplicacions amb el SACE\r\n\r\nLa manera d’integrar-se amb el SACE, consistia en fer una crida HTTPS a una adreça, passant com a informació un fitxer XML, que de sortida contindrà les dades requerides.\r\n\r\nhttps://sace.xxx.gencat.intranet/SACE/SACE_Logon.aspx\r\n\r\nOn xxx es dc, prepdc i desenvdc per als entorns de Producció, pre-producció i desenvolupament, respectivament. \r\n\t\r\nL’estructura del fitxer XML d’entrada i sortida de dades així com la informació que conté i el seu significat, s’especifica a continuació:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/xmlsace.png)\r\n\r\nEl codi d’operació pot estar informat amb els següents valors:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/saceoperacions.png)\r\n\r\nEls paràmetres d’entrada seran recollits via POST per un camp que es diu XMLIn. Anàlogament, els paràmetres de sortida seran enviats via POST a la pàgina que s’indica en el tag <URL_RETORN> dins del contingut d’un camp que es diu  XMLOut.\r\n\r\nAquest funcionament feia necessari que les aplicacions haguessin de construir-se i presentar un formulari de login, i que aquest formulari de login, o un element dinàmic relacionat, hagués de gestionar els següents punts:\r\n\r\n1.\tTenir tota la lògica de crida a SACE i d’enviament de paràmetres.\r\n2.\tEnviament de paràmetres de SACE cap a l’aplicació.\r\n3.\tParsejat dels paràmetres retornats per SACE.\r\n4.\tGeneració de la sessió de l’usuari en base a aquests paràmetres obtinguts\r\n\r\nEsquemàticament l’aplicació està funcionant ara mateix de la següent manera:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/sacejsp.png)\r\n\r\n## Proposta de canvi de migració de SACE cap a GICAR\r\n\r\nA continuació es descriu una estratègia orientada a la substitució del SACE per GICAR per a les aplicacions que utilitzen SACE. Comentar que l’estratègia que es descriu a continuació és la recomanada per a fer aquest tipus de migracions de SACE a GICAR, però no és la forma recomanada per a realitzar les intragracions amb GICAR per una aplicació que es construeixi des de 0.\r\n\r\nEn primer lloc el canvi suposa que a nivell de CPD, calgui instal·lar l’agent de SiteMinder sobre el servidor web on resideixi l’aplicació.\r\n\r\nA nivell d’aplicacions el canvi proposat es basa en substituir el formulari de login propietari de l’aplicació anterior, per un JSP, ASP, PHP (element dinàmic de servidor), que estarà protegit a nivell de SiteMinder, que es limiti a fer el següent:\r\n\r\n1.\tCapturar les següents capçaleres HTTP:\r\n\r\n- HTTP_GICAR_ID (conté el NIF de l’usuari) --> 11112222W\r\nCaptura obligatòria, a partir del qual s’obtindria el DNI de l’usuari autenticat.\r\n\r\n- HTTP_GICAR (conté les dades de l’usuari al DC) = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\nCaptura addicional, a partir del qual s’obtindrien altres dades de l’usuari autenticat.\r\n\r\n2.\tGenerar la sessió de l’aplicació en base a aquests paràmetres obtinguts en anterioritat.\r\n\r\nAquest element JSP, ASP, PHP seria l’únic punt de l’aplicació que estaria protegit per SiteMinder, d’aquesta forma aquest JSP, quan fos accedit pel navegador de l’usuari, faria saltar el formulari de login de GICAR, i demanaria les credencials a l’usuari.\r\n\r\nPer tant, un cop fet això la traça de navegació de l’usuari seria la següent:\r\n\r\n1. L’usuari accedirà a la url l’aplicació web, a la zona on habitualment li demana fer login. Aquesta zona farà un HTTP-REDIRECT al component dinàmic desenvolupat. \r\n\r\n1. Saltaria la protecció de GICAR (SiteMinder) al intentar accedir al element dinàmic.\r\n\r\n1. L’usuari introdueix la seva credencial (usuari o contrasenya /certificat). \r\n\r\n1. L’agent de SiteMinder genera les capçaleres HTTP corresponents, que indiquen que l’usuari està loguinat a GICAR.\r\n\r\n1. L’element dinàmic desenvolupat captura les capçaleres de GICAR, i genera la sessió a l’usuari en l’aplicació.\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/funcionament-migracio-sace-gicar.png)\r\n\r\nD’aquesta manera, es substitueix el formulari i les llibreries que fan les crides cap a SACE per una URL protegida per GICAR i una llibreria que recull les capçaleres HTTP i generen la sessió de l’aplicació.\r\n\r\nAddicionalment al mètode proposat anteriorment (on només es proposa la protecció amb GICAR d’un únic element dinàmic que és el que recull les capçaleres de GICAR i el que genera la sessió de l’aplicació), també és possible tècnicament que totes les URLs de l’aplicació puguin ser protegides amb GICAR (de fet és el recomanable a nivell de seguretat). El fet de fer-ho d’una forma o d’una altra, depèn del grau d’interacció que tingui aquesta aplicació amb altres elements externs, que impossibilitin la protecció total de l’aplicació amb SiteMinder.\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vbWlncmFjaW8tc2FjZQ=="},"L2dpY2FyLWludGVncmFjaW8vc2FuZGJveA==":{"date":1465402302000,"title":"Entorn de desenvolupament GICAR","description":"Entorn Sandbox per a simular el funcionament de GICAR","sections":"GICAR","taxonomies":[],"draft":false,"weight":8,"path":"/gicar-integracio/sandbox","content":"A continuació s'exposa com simular GICAR en entorns de desenvolupament, amb l'objectiu de que els proveïdors de desenvolupament tinguin una forma senzilla de simular GICAR i testejar-lo sense necessitat de disposar, per exemple, de connexió a la Xarxa de la Generalitat, ni de demanar configuracions a l'Oficina Tècnica de GICAR.\n\nEs presenten dues estratègies per a fer-ho:\n\n## Apache amb capçaleres estàtiques\n\nConfigurant el frontal web apache de cara a que generi de forma automàtica les capçaleres de GICAR. S’ha d’afegir a l’arxiu httpd.conf, el següent:\n\n- Habilitar el mod_header en el apache.\n\n- Generar les següents capçaleres a nivell d'apache utilitzant les següents directives:\n\n\t- RequestHeader set GICAR_ID “00000000T”\n\t- RequestHeader set GICAR “CODIINTERN=NRDRJN0001;NIF=00000000T;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\n\nAquesta configuració fa que l’Apache afegeixi la capçalera GICAR i GICAR_ID, amb valor fix, dins de totes les peticions HTTP rebudes.\n\n## Docker\n\n<span style=\"color:red\">\nTemporalment aquesta funcionalitat està indisponible.\n</style>\n\nHem creat un contenidor Docker exacte als Apache-GICAR que es poden trobar als CPDs de la Generalitat. Aixecant a l'entorn del desenvolupador aquest  contenidor, amb connexió a un Policy Server de desenvolupament que és visible des dels entorns dels proveïdors, es pot simular el funcionament real d'una aplicació integrada amb GICAR d'una manera molt senzilla (només permet simular proves amb usuari i contrasenya, no amb certificat digital).\n\nPer a fer això cal seguir el següent procediment:\n\n1. El proveïdor de desenvolupament s'ha d'instal·lar el docker engine que permet gestionar imatges i contenidors (https://www.docker.com/products/docker-engine), o bé utilitzar l'entorn de desenvolupament de Canigó (http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/).\n\n1. Dockerfile GICAR (https://hub.docker.com/r/gencatcloud/gicar/) :\n\n\t\tFROM  centos:6.6\n\n\t\tRUN yum install httpd glibc libstdc++ ncurses perl unzip tar xz -y\n\n\t\tENV httpd /etc/httpd\n\n\t\tRUN mkdir -p ${httpd}/CA/webagent\n\n\t\tRUN curl -o ${httpd}/CA/webagent.tar.xz http://canigo.ctti.gencat.cat/related/cloud/fitxers-suport/webagent.tar.xz\n\t\tRUN tar xfvJ ${httpd}/CA/webagent.tar.xz -C ${httpd}/CA/\n\t\tRUN rm ${httpd}/CA/webagent.tar.xz\n\n\t\tRUN curl -o ${httpd}/conf/config.zip http://canigo.ctti.gencat.cat/related/cloud/fitxers-suport/config.zip\n\t\tRUN unzip  -o ${httpd}/conf/config.zip -d  ${httpd}/conf/\n\t\tRUN rm ${httpd}/conf/config.zip\n\n\t\tENV NETE_WA_ROOT ${httpd}/CA/webagent\n\t\tENV NETE_WA_PATH ${NETE_WA_ROOT}/bin\n\t\tENV CAPKIHOME ${httpd}/CA/webagent/CAPKI\n\t\tENV LD_LIBRARY_PATH ${NETE_WA_ROOT}/bin:${NETE_WA_ROOT}/bin/thirdparty:${LD_LIBRARY_PATH}\n\t\tENV PATH ${NETE_WA_PATH}:${PATH}\n\n\t\tRUN mv ${httpd}/conf/headers.cgi /var/www/cgi-bin/\n\t\tRUN mv ${httpd}/conf/index.html /var/www/html/\n\t\tRUN chmod 755 -R /var/www/cgi-bin/\n\t\tRUN chmod 755 -R /var/www/html/\n\n\t\tRUN echo \"#!/bin/bash\" > /entrypoint.sh\n\t\tRUN echo \"set -m\" >> /entrypoint.sh\n\t\tRUN echo \"/usr/sbin/apachectl -D FOREGROUND &\" >> /entrypoint.sh\n\t\t#RUN echo \"sleep 30\" >> /entrypoint.sh\n\t\tRUN echo \"/etc/httpd/CA/webagent/bin/smreghost -i \\$PS_IP -u \\$GICARUSER -p \\$GICARPWD -hn \\$ContainerHostName -hc \\$HCOGICAR -f /etc/httpd/conf/Smhost.conf -o\" >> /entrypoint.sh\n\t\tRUN echo \"sed -i -- 's/\\\\\\$AgentConfigDocker/'\\\"\\$AgentConfigDocker\\\"'/g' /etc/httpd/conf/WebAgent.conf\" >>  /entrypoint.sh\n\t\tRUN echo \"sed -i -- 's/\\\\\\$AGENTNAME/'\\\"\\$AGENTNAME\\\"'/g' /etc/httpd/conf/LocalConfigGicar.conf\" >> /entrypoint.sh\n\t\tRUN echo \"chown apache:apache /etc/httpd/conf/Smhost.conf\" >> /entrypoint.sh\n\t\tRUN echo \"fg\" >> /entrypoint.sh\n\n\t\tRUN chmod 755 /entrypoint.sh\n\n\t\t#Copiem el fitxer wait-for-it\n\t\tCOPY wait-for-it.sh /\n\t\tRUN chmod 755 /wait-for-it.sh\n\n\t\tCMD [\"/entrypoint.sh\"]\n\n1. Executar la següent comanda per a generar la imatge de l'apache GICAR:\n\n\t\t$ docker build -t gicar_dev .\n\n1. Per a demanar la configuració per a arrencar el Docker d'apache GICAR, cal omplir el següent formulari:\n\n\t<div class=\"form col-xs-12 col-md-12\" id=\"form-sandbox\">\n\t<form action='http://formularis.gencat.cat/gencat_forms/AppJava/submitFormulari.do' method='post'>\n\n\t<div class=\"col-xs-12 col-md-4 \">\n\t<label>Peticionari<span class=\"red\">*</span></label><input name='peticionari' type='text' class=\"form-control\" />\n\t</div>\n\t<div class=\"col-xs-12 col-md-4 \">\n\t<label>NIF<span class=\"red\">*</span></label><input name='NIF' type='text' class=\"form-control\" />\n\t</div>\n\t<div class=\"col-xs-12 col-md-4 \">\n\t<label>Correu<span class=\"red\">*</span></label><input name='correu' type='text' class=\"form-control\" />\n\t</div>\n\n\t<div class=\"col-xs-12 col-md-6 \">\n\t<label>Lot d'aplicacions<span class=\"red\">*</span></label><br />\n\t<select name='lot_aplicacions' class=\"form-control custom_select hasCustomSelect\" >\n\t\t<option value='A1'>A1</option>\n\t\t<option value='A2'>A2</option>\n\t\t<option value='A3'>A3</option>\n\t\t<option value='A4'>A4</option>\n\t\t<option value='A5'>A5</option>\n\t\t<option value='A6'>A6</option>\n\t\t<option value='A7'>A7</option>\n\t\t<option value='A8'>A8</option>\n\t\t<option value='A9'>A9</option>\n\t\t<option value='A10'>A10</option>\n\t\t<option value='A11'>A11</option>\n\t</select>\n\t</div>\n\n\t<div class=\"col-xs-12 col-md-12\">\n\t<label>Observacions (informeu els patrons d'url a protegir, així com qualsevol altra qüestió relacionada)<span class=\"red\">*</span></label><textarea name='observacions' class=\"form-control\"> </textarea>\n\t</div>\n\n\t<div class=\"col-xs-12 col-md-3\">\n\t<input id=\"codeCaptcha\" type=\"hidden\" value=\"433905973\" name=\"captchaCode\"/>\n\t<script type=\"text/javascript\">\n\t\t$(function(){\n\t\t\t$(\"#refreshKaptchaImage\").click(function () {\n\t\t\t\tvar valor =  Math.floor(Math.random()*1000000000);\n\t\t\t\t$(\"#codeCaptcha\").attr(\"value\", valor)\n\t\t\t\t$(\"#kaptchaImage\").hide().attr(\"src\", \"http://formularis.gencat.cat/gencat_forms/AppJava/generarKaptcha?kaptchaCode=\"+valor).fadeIn();\n\t\t\t\t$(\"#captchaAnswer\").attr(\"value\", \"\");\n\t\t\t});\n\t\t});\n\t</script>\n\n\t<br />\n\t<img id=\"kaptchaImage\" src=\"http://formularis.gencat.cat/gencat_forms/AppJava/generarKaptcha?kaptchaCode=433905973\" width=\"200\"/>\n\t<img id=\"refreshKaptchaImage\" src=\"http://formularis.gencat.cat/gencat_forms/images/refrescar.png\" style=\"vertical-align: top; cursor:pointer;\"/>\n\n\t<br />\n\t<input type=\"text\" id=\"captchaAnswer\" name=\"captchaAnswer\" class=\"form-control\"/>\n\t<br />\n\t</div>\n\n\t<div class=\"col-xs-12 col-md-12\">\n\t<input type='submit' class=\"btn bgRed white margin_top_xs\" />\n\t</div>\n\t<textarea name='meta_inf' style='display:none;'>\n\t\t<meta-informacio>\n\t\t\t<idFormulari>52697</idFormulari>\n\t\t\t<idioma>ca_ES</idioma>\n\t\t</meta-informacio>\n\t</textarea>\n\n\t</form>\n\t</div>\n\t<div  class=\"clearfix\">&nbsp;</div>\n\n1. Amb les dades que se us proporcionin, podreu arrencar el contenidor amb la següent comanda:\n\n\t\t$ docker run -d -p 80:80 -e \"PS_IP=[ip]\" -e \"AgentConfigDocker=[aco]\" -e \"ContainerHostName=[nom del contenidor]\" -e \"AGENTNAME=[agent_name],[nom de domini]\" -e \"HCOGICAR=[hco]\" -e \"GICARUSER=[user]\" -e \"GICARPWD=[pwd]\" -e \"APPSERVER_PORT_8080_TCP_ADDR=localhost\" -e \"APPSERVER_PORT_8080_TCP_PORT=8080\" --name gicar_dev gicar_dev\n\n\n1. Si necessiteu configuracions específiques per a connectar al vostre servidor d'aplicacions, podeu per fer el següent:\n\n\t- Descarregueu el httpd.conf que s'inclou config.zip del Dockerfile\n\n\t- Creeu la imatge de base de gicar_dev\n\n\t- Creeu la vostra imatge personalitzada de gicar\n\n\t\t\tFROM  gicar_dev\n\n\t\t\t# instal·la els mòduls necessaris, ajp, mod_wl, ...\t\n\n\t\t\tRUN ...\t\n\n\t\t\t# copia el fitxer personalitzat httpd.conf a la ruta correcta\n\t\t\t\n\t\t\tCOPY myhttpd.conf /etc/httpd/conf/httpd.conf\n","objectID":"L2dpY2FyLWludGVncmFjaW8vc2FuZGJveA=="},"L2dpY2FyLWludGVncmFjaW8vc2l0ZW1pbmRlcg==":{"date":1465402302000,"title":"Siteminder","description":"Característiques i arquitectura","sections":"GICAR","taxonomies":[],"weight":1,"path":"/gicar-integracio/siteminder","content":"GICAR disposa d’una eina, el SiteMinder, per facilitar l’autenticació d’aplicacions web. A continuació es veurà que és Siteminder, quines són les seves característiques principals, els elements dels quals es composa (Servidor de Polítiques, Agents, Servidor Web i els diferents directoris) i les tasques que s’han de realitzar per tal d’integrar-ne una aplicació. \n\nA part de tots el punts anteriors que enfoquen l’autenticació de l’usuari contra el Directori Corporatiu de la Generalitat (empleat públic de la Generalitat), s’exposaran quins són els passos a seguir per tal de que GICAR pugui proporcionar a una aplicació el servei d’autenticació anònima mitjançant l’ús d’un certificat digital. \n\nEn cas que l’aplicació a integrar tingui la necessitat de que sigui accedida per usuaris de la Generalitat, i per usuaris de les administracions locals catalanes (AAL), GICAR permet també autenticar aquests usuaris gràcies al servei de validació que proporciona GICAR contra el Directori del Consorci AOC (EACAT). \n\nAixí doncs i a mode de resum, GICAR permet l’autenticació als següents col·lectius i amb les següents modalitats:\n\n![Integració Aplicacions GICAR](/related/gicar/taula-modalitats-autenticacio.png)\n\nPer últim en l’apartat 3.8 s’exposa com fer la integració d’una aplicació amb GICAR utilitzant com a protocol d’integració SAML2, indicat per a aplicacions que només puguin delegar l’autenticació a GICAR a través de SAML2.\n\n\n## Característiques de SiteMinder\n\nSiteMinder és l’eina de la plataforma GICAR que, de forma centralitzada i en alta disponibilitat, s’utilitza per gestionar les polítiques d’accés dels usuaris a les aplicacions web. Per tant, les aplicacions deleguen completament el procés d’autenticació en SiteMinder.\n\nQuan una aplicació està protegida, quan l’usuari intenta accedir-hi,  SiteMinder li demana a l’usuari les credencials (usuari i contrasenya, o certificat digital) i posteriorment es fa una validació d’aquestes al Directori Corporatiu de la Generalitat de Catalunya. En el cas que el resultat sigui positiu, SiteMinder li lliura a l’aplicació final unes capçaleres HTTP amb informació de l’usuari validat. A partir d’aquest moment, l’aplicació és la que determina quins permisos d’accés o privilegis té l’usuari dins l’aplicació (Autorització).\n\nEn resum, les característiques més rellevants de SiteMinder són:\n\n- Seguretat Centralitzada, amb la capacitat d’aplicar polítiques diferents en funció del tipus d’usuari, del col·lectiu al que pertany, del departament, etc.\n- Permet disposar d’un entorn de Single Sign On, amb contrasenya única del Directori (autenticació única)\n- Alta Disponibilitat dels Servidors de Polítiques\n- Disposa d’un registre d’accessos (log) molt complert per processos d’auditoria.\n- Servei d’administració per tal de realitzar, per exemple, el manteniment del Servidor de Polítiques.\n\n\n## Arquitectura i elements de SiteMinder\n\nEl següent gràfic mostra l’arquitectura dels elements de GICAR responsables del procés d’autenticació:\n\n![Integració Aplicacions GICAR](/related/gicar/arquitectura-siteminder.png)\n\nTal i com s’observa en el gràfic, l’arquitectura de SiteMinder la integren els elements que es descriuen a continuació:\n\n- SiteMinder Policy Server proporciona i centralitza la gestió de polítiques, autenticació i auditoria per a aplicacions web. El Policy Server és el responsable de:\n\t- Aplicar una política de control d’accés sobre les aplicacions integrades.\n\t- Realitzar, quan sigui necessari, l’autenticació d’usuari.\n\t- Permetre l’accés a determinats recursos d’aquells únicament dels usuaris autoritzats.\n\t- Facilitar a les aplicacions les dades necessàries per a la identificació de l’usuari que accedeix al recurs.\n\t- Oferir SSO (Single Sign-On) entre totes les aplicacions integrades.\n\t- Separar la lògica d’autenticació de la lògica d’aplicació. Això permet modificar el procediment d’autenticació sense afectar a l’aplicació així com aplicar polítiques centralitzades de contrasenyes.\n\t\n- Agent de SiteMinder: Es tracta d’una extensió del servidor web (un filtre ISAPI en el cas de l’IIS, un mòdul mod en el cas d’Apache) que intercepta les peticions abans de ser processades, tot aplicant la política definida al servidor central. S’instal·la en el Servidor Web on resideix el frontal de l’aplicació i s’ocupen d’interceptar les peticions d’accés a les pàgines web d’aquest servidor. Aquestes peticions són enviades al Servidor de Polítiques de SiteMinder per determinar si l’aplicació està protegida i requereix d’autenticació.\nEn línies generals, SiteMinder intercepta totes les peticions rebudes pel servidor web i, abans de passar-la a l’aplicació, verifica que l’usuari estigui autenticat.\n\n![Integració Aplicacions GICAR](/related/gicar/arquitectura-siteminder2.png)\n\n- Directori Corporatiu: és el repositori central d’identitats utilitzat per SiteMinder per comprovar la validesa o no d’una identitat que intenta accedir a una aplicació web protegida. En el Directori Corporatiu és on resideix la contrasenya única utilitzada per validar totes les aplicacions integrades amb SiteMinder.\n\n- Servidor Web: es on resideix el frontal de l’aplicació web a protegir i on cal instal.lar l’agent de SiteMinder.\n","objectID":"L2dpY2FyLWludGVncmFjaW8vc2l0ZW1pbmRlcg=="},"L2dpY2FyLWludGVncmFjaW8vd29ya2Zsb3c=":{"date":1465402302000,"title":"Procés d'autenticació amb Siteminder","description":"Descripció del procés i finalització de la sessió activa","sections":"GICAR","taxonomies":[],"weight":3,"path":"/gicar-integracio/workflow","content":"A continuació es descriuen els passos que SiteMinder segueix per portar a terme l’autenticació d’un usuari, i disposar d’un entorn de Single Sign On Web:\r\n\r\n1.\tL’usuari intenta accedir al recurs protegit. Si l’usuari no ha iniciat cap sessió o aquesta ha caducat, l’agent de SiteMinder instal·lat interceptarà la petició per tal de que es produeixi un desafiament d’autenticació (Punt 2). Altrament, si l’usuari té una sessió activa, aquest accedirà directament a l’aplicació.\r\n\r\n1.\tL’Agent de SiteMinder instal·lat en el Servidor Web on resideix el frontal de l’aplicació en qüestió intercepta la petició (primer filtre de virtual hosts) podent:\r\n\r\n\t- Ignorar-la: en el cas que sigui un domini que s’hagi decidit ignorar de la protecció de SiteMinder\r\n\t- Enviar la petició al SiteMinder Policy Server que analitzarà el tipus de protecció, si hi ha una sessió activa, etc.\r\n\r\n1.\tSiteMinder avalua si es tracta d’un recurs protegit\r\n\r\n\t- Si està protegit, SiteMinder avalua si l’usuari té una sessió activa.\r\n\t- Si no té sessió activa, se li  demanen a l’usuari les seves credencials o el Certificat Digital. SiteMinder farà una validació de les credencials al Directori Corporatiu i s’assegurarà de la validesa del certificat. Si tot és correcte, s’obrirà una nova sessió per a l’usuari validat.\r\n\r\n1.\tFeta la validació, SiteMinder (via l’agent) envia a l’aplicació les capçaleres HTTP (indicades en el punt anterior) per a que l’aplicació conegui la identitat de l’usuari validat.\r\n\r\n\tEsmentar que és el browser (client web) de l’usuari el que genera en local la cookie de sessió, mitjançant el qual SiteMinder determina si una sessió està activa o no, així com el temps d’expiració de la mateixa.\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/esquema-acces.png)\r\n\r\n1.\tA partir d’aquest moment, és la pròpia aplicació (amb les capçaleres rebudes que identifiquen a la persona autenticada) qui determina si l’usuari està autoritzat, amb quins permisos, etc..\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/esquema-acces2.png)\r\n\r\n## Finalització de la sessió activa\r\n\r\nHi ha dues maneres de terminar una sessió amb GICAR: o bé a través del formulari de logoff específic de GICAR, o bé a partir d’un timeout.\r\n\r\nEl timeout es un paràmetre definit en els Policy Servers que provoca la terminació de la sessió en el cas que s’hagi superat un cert temps sense activitat. Aquest temps màxim d’inactivitat pot ser diferent per cada aplicació. En el cas d’accedir a una aplicació amb GICAR i fer ús del Single Sign On per a accedir a una altra, cal tenir en compte que el temps de timeout no es veurà modificat i seguirà mantenint el valor que estigués indicat per a la primera aplicació.\r\n\r\nUna altra manera per a terminar la sessió, es que l’aplicació invoqui el formulari de logoff que posa a disposició GICAR. Aquest formulari realitza l’esborrat de les cookies associades a la sessió, cosa que provoca la seva finalització. Així doncs, només cal que l’aplicació invoqui una de les URL següents segons l’entorn en que es trobi:\r\n\r\nSi l’aplicació té domini xxx.gencat.cat:\r\n \r\n- A PRE: en funció del que indiquin els administradors de GICAR es farà servir un link o un altre:\r\n\r\n\t- https://preproduccio.idp1-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\t- https://preproduccio.idp4-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\r\n- A PRO: en funció del que indiquin els administradors de GICAR es farà servir un link o un altre:\r\n\r\n\t- https://idp1-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\t- https://idp4-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\r\nSi l’aplicació té un domini aliè a xxx.gencat.cat, caldrà consultar el tema als responsables de GICAR.\r\n\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vd29ya2Zsb3c="},"L2hvd3Rvcy8yMDE2LTEwLUhvd3RvLUNhbmlnby1HZXN0aW8tRXJyb3JzLUdsb2JhbHM=":{"date":1477785600000,"title":"Gestió global d'errors a una aplicació Canigó","description":"How To de com gestionar els errors de forma global a una aplicació Canigó Rest.","sections":["Canigo","howtos"],"categories":["canigo"],"key":"NOVEMBRE2016","path":"/howtos/2016-10-Howto-Canigo-Gestio-Errors-Globals","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació REST amb Canigó 3.1 i vulguin gestionar els errors de forma global.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.1.x del Framework Canigó.\r\n\r\n### Introducció\r\n\r\nEn aquest HowTo s’explica com gestionar els errors utilitzant @ControllerAdvice a una aplicació Canigó Canigó 3.1 REST. Per a fer-ho desplegarem l’aplicació demo que genera el plugin de Canigó i i afegirem la gestió d'errors.\r\n\r\nPer a mostrar el funcionament de @ControllerAdvice crearem un MockController que llençi els errors, que seran capturats pel nostre ControllerAdvice i aquest retornarà un ResponseError amb el codi i missatge de l'error en qüestió. \r\n\r\n### Afegir Llibreries\r\n\r\nEn aquest how to es genera un handler per a excepcions del tipus AuthenticationException i AccessDeniedException del mòdul de seguretat de Spring, així que l'afegim al pom.xml de l'aplicació. \r\n\r\nSi la vostra aplicació ja utilitza el mòdul de seguretat de Canigó, aquesta dependència ja es trobarà a la vostra aplicació.\r\n\r\n    <!-- SPRING SECURITY -->\r\n\t<dependency>\r\n\t\t<groupId>org.springframework.security</groupId>\r\n\t\t<artifactId>spring-security-core</artifactId>\r\n\t\t<version>${spring.security.version}</version>\r\n\t</dependency>\r\n\t\r\n### Response Error\r\n\r\nPrimer de tot es crea l'objecte ResponseError, per a utilitzar-lo com a resposta d'error genèrica\r\n\r\nEn aquest howto s'ha creat al path cat.gencat.canigorest311.model.response:\r\n\r\n\tpackage cat.gencat.canigorest311.model.response;\r\n\r\n\timport java.io.Serializable;\r\n\r\n\tpublic class ResponseError implements Serializable {\r\n\r\n\t\tprivate static final long serialVersionUID = 3626211819197624092L;\r\n\t\tprivate int code;\r\n\t\tprivate String message;\r\n\r\n\t\tpublic ResponseError() {\r\n\t\t\tsuper();\r\n\t\t}\r\n\r\n\t\tpublic ResponseError(final int code, final String message) {\r\n\t\t\tsuper();\r\n\t\t\tthis.code = code;\r\n\t\t\tthis.message = message;\r\n\t\t}\r\n\r\n\t\tpublic int getCode() {\r\n\t\t\treturn code;\r\n\t\t}\r\n\r\n\t\tpublic void setCode(int code) {\r\n\t\t\tthis.code = code;\r\n\t\t}\r\n\r\n\t\tpublic String getMessage() {\r\n\t\t\treturn message;\r\n\t\t}\r\n\r\n\t\tpublic void setMessage(String message) {\r\n\t\t\tthis.message = message;\r\n\t\t}\r\n\r\n\t}\r\n\r\n### Excepcions específiques\r\n\r\nCada aplicació pot tenir les seves exceptions específiques per tractar errors controlats a la seva lògica. Com a exemple en aquest howto es crea l'objecte ResourceNotFoundException, que s'utilitzaria en cas d'intentar accedir a un Resource de l'aplicació i no trobar-lo.\r\n\r\nEn aquest howto s'ha creat al path cat.gencat.canigorest311.model.exception:\r\n\r\n\tpackage cat.gencat.canigorest311.model.exception;\r\n\r\n\tpublic class ResourceNotFoundException extends RuntimeException {\r\n\r\n\t\tprivate static final long serialVersionUID = 354698655002619627L;\r\n\r\n\t\tprivate long resourceId;\r\n\r\n\t\tpublic ResourceNotFoundException(long resourceId) {\r\n\t\t\tthis.setResourceId(resourceId);\r\n\t\t}\r\n\r\n\t\tpublic long getResourceId() {\r\n\t\t\treturn resourceId;\r\n\t\t}\r\n\r\n\t\tpublic void setResourceId(long resourceId) {\r\n\t\t\tthis.resourceId = resourceId;\r\n\t\t}\r\n\t}\r\n\r\n### Handler per a les excepcions\r\n\r\nEs crea l'objecte GlobalDefaultExceptionHandler per a gestionar totes les excepcions.\r\n\r\nEn aquest objecte es pot crear un Handler per a totes les excepcions que es dessitgin controlar, en aques howto es controlen les següents:\r\n\t- MultipartException\r\n\t- AuthenticationException\r\n\t- AccesDeniedException\r\n\t- ResourceNotFoundException (Aquesta és la que s'ha creat al punt anterior)\r\n\t- Exception (Per a controlar tots els errors no controlats)\r\n\t\r\nAquest objecte ha de tenir l'annotació @ControllerAdvice a nivell de classe.\r\n\r\n\t@ControllerAdvice\r\n\tpublic class GlobalDefaultExceptionHandler\r\n\r\nEls mètodes que actuen com Handlers de les exceptions han de tenir el tag @ExceptionHandler amb la classe d'excepció que controlen.\r\n\r\n\t@ExceptionHandler(MultipartException.class)\r\n\t@ResponseStatus(value = HttpStatus.BAD_REQUEST)\r\n\t@ResponseBody\r\n\tpublic ResponseError defaultErrorHandlerMultipartException(final HttpServletRequest request, final HttpServletResponse response, final MultipartException e)\r\n\t\r\nEl fitxer resultant s'ha creat al path cat.gencat.canigorest311.service.exception.handler:\r\n\r\n\tpackage cat.gencat.canigorest311.service.exception.handler;\r\n\r\n\timport javax.servlet.http.HttpServletRequest;\r\n\timport javax.servlet.http.HttpServletResponse;\r\n\r\n\timport org.apache.commons.logging.Log;\r\n\timport org.apache.commons.logging.LogFactory;\r\n\timport org.springframework.http.HttpStatus;\r\n\timport org.springframework.security.access.AccessDeniedException;\r\n\timport org.springframework.security.core.AuthenticationException;\r\n\timport org.springframework.web.bind.annotation.ControllerAdvice;\r\n\timport org.springframework.web.bind.annotation.ExceptionHandler;\r\n\timport org.springframework.web.bind.annotation.ResponseBody;\r\n\timport org.springframework.web.bind.annotation.ResponseStatus;\r\n\timport org.springframework.web.multipart.MultipartException;\r\n\r\n\timport cat.gencat.canigorest311.model.exception.ResourceNotFoundException;\r\n\timport cat.gencat.canigorest311.model.response.ResponseError;\r\n\r\n\t@ControllerAdvice\r\n\tpublic class GlobalDefaultExceptionHandler {\r\n\r\n\t\tprivate static final Log LOGGER = LogFactory.getLog(GlobalDefaultExceptionHandler.class);\r\n\r\n\t\tprivate static final String RESOURCE_NOT_FOUND_MSG = \"Resource no trobat\";\r\n\r\n\t\tprivate static final String UNAUTHORIZED_MSG = \"No es troba autoritzat per accedir a aquest recurs\";\r\n\r\n\t\tprivate static final String MULTIPART_BAD_REQUEST_MSG = \"Petició incorrecta\";\r\n\r\n\t\t@ExceptionHandler(MultipartException.class)\r\n\t\t@ResponseStatus(value = HttpStatus.BAD_REQUEST)\r\n\t\t@ResponseBody\r\n\t\tpublic ResponseError defaultErrorHandlerMultipartException(final HttpServletRequest request, final HttpServletResponse response,\r\n\t\t\t\tfinal MultipartException e) {\r\n\t\t\tLOGGER.error(e.getMessage(), e);\r\n\t\t\treturn new ResponseError(HttpStatus.BAD_REQUEST.value(), MULTIPART_BAD_REQUEST_MSG);\r\n\t\t}\r\n\r\n\t\t@ExceptionHandler(Exception.class)\r\n\t\t@ResponseStatus(value = HttpStatus.INTERNAL_SERVER_ERROR)\r\n\t\t@ResponseBody\r\n\t\tpublic ResponseError defaultErrorHandlerException(final HttpServletRequest request, final HttpServletResponse response, final Exception e) {\r\n\t\t\tLOGGER.error(e.getMessage(), e);\r\n\t\t\treturn new ResponseError(HttpStatus.INTERNAL_SERVER_ERROR.value(), e.getLocalizedMessage());\r\n\r\n\t\t}\r\n\r\n\t\t@ExceptionHandler(value = { AuthenticationException.class, AccessDeniedException.class })\r\n\t\t@ResponseStatus(value = HttpStatus.UNAUTHORIZED)\r\n\t\t@ResponseBody\r\n\t\tpublic ResponseError defaultErrorHandlerAuthenticationException(final Exception e) {\r\n\t\t\tLOGGER.error(e.getMessage(), e);\r\n\t\t\treturn new ResponseError(HttpStatus.UNAUTHORIZED.value(), UNAUTHORIZED_MSG);\r\n\r\n\t\t}\r\n\r\n\t\t@ExceptionHandler(ResourceNotFoundException.class)\r\n\t\t@ResponseStatus(HttpStatus.NOT_FOUND)\r\n\t\t@ResponseBody\r\n\t\tpublic ResponseError resourceNotFound(final ResourceNotFoundException e) {\r\n\t\t\tfinal long resourceId = e.getResourceId();\r\n\t\t\tLOGGER.info(\"Resource Not Found idResource: \" + resourceId);\r\n\r\n\t\t\treturn new ResponseError(HttpStatus.NOT_FOUND.value(), RESOURCE_NOT_FOUND_MSG);\r\n\t\t}\r\n\t}\r\n\r\n\r\n### Proves\r\n\r\nPer a comprovar el funcionament es crea un MockController, el qual cridarem des de el navegador i llençarà una excepció que serà capturada pel nostre handler, GlobalDefaultExceptionHandler.\r\n\r\nEa crea al path cat.gencat.canigorest311.endpoints:\r\n\r\n\tpackage cat.gencat.canigorest311.endpoints;\r\n\r\n\timport org.springframework.http.MediaType;\r\n\timport org.springframework.web.bind.annotation.PathVariable;\r\n\timport org.springframework.web.bind.annotation.RequestMapping;\r\n\timport org.springframework.web.bind.annotation.RequestMethod;\r\n\timport org.springframework.web.bind.annotation.RestController;\r\n\timport cat.gencat.canigorest311.model.exception.ResourceNotFoundException;\r\n\r\n\t@RestController\r\n\tpublic class MockController {\r\n\r\n\t\t@RequestMapping(method = RequestMethod.GET, value = \"/resource/{id}\", produces = MediaType.APPLICATION_JSON_VALUE)\r\n\t\tpublic void mockResourceNotFoundException(@PathVariable final long id) {\r\n\t\t\tthrow new ResourceNotFoundException(id);\r\n\t\t}\r\n\t}\r\n\r\n### Resultat\r\n\r\nUna vegada desplegada l'aplicació, si fem la crida a \"localhost:8081/CanigoRest311/api/resource/2\" per pantalla es mostra l'objecte ResponseError:\r\n\r\n{\r\ncode: 404,\r\nmessage: \"Resource no trobat\"\r\n} \r\n\t","objectID":"L2hvd3Rvcy8yMDE2LTEwLUhvd3RvLUNhbmlnby1HZXN0aW8tRXJyb3JzLUdsb2JhbHM="},"L2hvd3Rvcy8yMDE2LTEwLUhvd3RvLUNhbmlnby1TcHJpbmctQmF0Y2g=":{"date":1475193600000,"title":"Spring Batch a una aplicació Canigó","description":"How To per afegir Spring Batch a una aplicació Canigó.","section":"howtos","categories":["canigo"],"key":"OCTUBRE2016","path":"/howtos/2016-10-Howto-Canigo-Spring-Batch","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que vulguin afegir Spring Batch a una aplicació Canigó 3.1 Rest.\n\n### Versió de Canigó\n\nEls passos descrits en aquest document apliquen a la versió 3.1.x del Framework Canigó.\n\n### Introducció\n\nEn aquest HowTo s’explica com afegir Spring Batch a una aplicació Canigó 3.1 REST. Per a fer-ho desplegarem l’aplicació demo que genera el plugin de Canigó (amb una base de dades MySql) amb un procés batch que llegeixi d'un fitxer CSV cada cert temps i inserti les dades a BBDD.\nAquest procés ho implementarem amb Spring Batch.\n\nPer a mostrar el funcionament de Spring Batch amb diferents nodes, farem un altre exemple que realitzi la mateixa tasca que l'anterior però particionada de forma que diferents threads s'ocupin paral·lelament del processament del fitxer. \nEn un entorn real s'hauria d'utilitzar un framework de missatgeria(JMS) per a poder realitzar aquesta separació entre diferents nodes.\n\n## Exemple Configuració Spring Batch\n\n### Afegir Llibreries\n\nS'ha d'afegir al pom.xml la dependència a Spring Batch Core\n\n    <!-- SPRING BATCH -->\n    <dependency>\n        <groupId>org.springframework.batch</groupId>\n        <artifactId>spring-batch-core</artifactId>\n        <version>3.0.7.RELEASE</version>\n    </dependency>\n\t\n### Configuració Base de Dades de Spring Batch (Job Repository)\n\nPrimer s'han d'afegir a la base dades les taules de Spring Batch: S'ha d'executar a la Base de Dades el següent script https://github.com/spring-projects/spring-batch/blob/master/spring-batch-core/src/main/resources/org/springframework/batch/core/schema-mysql.sql\n\nEn cas de tenir una Base de Dades diferent a MySQL seleccionar el script adient : https://github.com/spring-projects/spring-batch/tree/master/spring-batch-core/src/main/resources/org/springframework/batch/core\n\nDesprés hem de definir el job repository. Al fitxer app-custom-persistence-jpa.xml afegirem els següents beans:\n\n\t<!-- Spring Batch -->\n\t<!-- stored job-meta in database -->\n\t<bean id=\"jobRepository\"\n\t\tclass=\"org.springframework.batch.core.repository.support.JobRepositoryFactoryBean\">\n\t\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t\t<property name=\"transactionManager\" ref=\"transactionManager\" />\n\t\t<property name=\"databaseType\" value=\"mysql\" />\n\t</bean>\n\t\n\t<bean id=\"transactionManager\"\n\t\tclass=\"org.springframework.batch.support.transaction.ResourcelessTransactionManager\" />\n\n### Input (Fitxer CSV)\n\nEn aquest howto l'input del procés Batch és un fitxer CSV que hem desat a **resources/cvs/input/input.csv**\n\n\t'estacio autobusos', 'Balaguer'\n\t'Jutjat de Pau', 'Santa Coloma Gramenet'\n\t'centre obert Alba', 'Vilafranca'\n\t'La Salle Manlleu', 'Manlleu'\n\t'estacio metro', 'Barcelona'\n\t'Jutjat Social', 'Manresa'\n\t'centre obert Ocaso', 'Vic'\n\t'La Salle Salou', 'Salou'\n\t'estacio tren', 'Sant Celoni'\n\t'Jutjat Penal', 'Vielha'\n\t'centre obert Nit', 'Sabadell'\n\t'La Salle Lleida', 'Lleida'\n\n### Configuració del Job\n\nHem de crear el fitxer app-custom-spring-batch.xml a la carpeta spring.\n\nA la definició del xml afegim els esquemes de batch y task (per a crida al job de forma asíncrona)\n\n\t<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n\t<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n\txmlns:batch=\"http://www.springframework.org/schema/batch\"\n    xmlns:task=\"http://www.springframework.org/schema/task\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \n           http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\n           http://www.springframework.org/schema/task\n           http://www.springframework.org/schema/task/spring-task-4.1.xsd\n           http://www.springframework.org/schema/batch\n\t\t   http://www.springframework.org/schema/batch/spring-batch-3.0.xsd\">\n\nDefinim el nostre job, que tindrà un step. Aquest step s'encarrega de llegir del fitxer csv, processar la informació i escriure-la en base de dades:\n\n\t<batch:job id=\"howtoJob\">\n\t  <batch:step id=\"step1\">\n\t\t<batch:tasklet>\n\t\t\t<batch:chunk reader=\"cvsFileItemReader\" writer=\"jdbcItemWriter\" processor=\"itemProcessor\" commit-interval=\"2\"></batch:chunk>\n\t\t</batch:tasklet>\n\t  </batch:step>\n\t</batch:job>\n\t\n\t<bean id=\"cvsFileItemReader\" class=\"org.springframework.batch.item.file.FlatFileItemReader\">\n\t\t<property name=\"resource\" value=\"classpath:cvs/input/input.csv\" />\n\n\t\t<property name=\"lineMapper\">\n\t\t    <bean class=\"org.springframework.batch.item.file.mapping.DefaultLineMapper\">\n\t\t\t<property name=\"lineTokenizer\">\n\t\t\t\t<bean\n\t\t\t\t\tclass=\"org.springframework.batch.item.file.transform.DelimitedLineTokenizer\">\n\t\t\t\t\t<property name=\"names\" value=\"nom,municipi\" />\n\t\t\t\t</bean>\n\t\t\t</property>\n\t\t\t<property name=\"fieldSetMapper\">\n\t\t\t\t<bean class=\"cat.gencat.howtobatch.batch.EquipamentFieldSetMapper\" />\n\t\t\t</property>\n\t\t    </bean>\n\t\t</property>\n\t</bean>\n\t\n\t<bean id=\"itemProcessor\" class=\"cat.gencat.howtobatch.batch.CustomItemProcessor\" />\n\t\n\t<bean id=\"jdbcItemWriter\" class=\"org.springframework.batch.item.database.JdbcBatchItemWriter\">\n\t\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t\t<property name=\"sql\">\n\t\t  <value>\n\t            <![CDATA[\n\t            \tinsert into equipaments (nom, municipi)\n\t\t\t\t\tvalues (:nom, :municipi)\n\t            ]]>\n\t\t  </value>\n\t\t</property>\n\t\t<!-- It will take care matching between object property and sql name parameter -->\n\t\t<property name=\"itemSqlParameterSourceProvider\">\n\t\t\t<bean class=\"org.springframework.batch.item.database.BeanPropertyItemSqlParameterSourceProvider\" />\n\t\t</property>\n\t</bean>\n\t\t\nDefinim també el jobLauncher, que s'encarrega de iniciar la execució dels diferents jobs que tinguem a l'aplicació\n\n\t<bean id=\"jobLauncher\"\n\t\tclass=\"org.springframework.batch.core.launch.support.SimpleJobLauncher\">\n\t\t<property name=\"jobRepository\" ref=\"jobRepository\" />\n\t</bean>\n\t\t\nI com en aquest howto volem iniciar de forma asíncrona el nostre procés batch definim un scheduler que s'executi cada 15 segons.\n\n\t <bean id=\"runScheduler\" class=\"cat.gencat.howtobatch.batch.RunScheduler\" />\n\n\t<!-- Run every 15 seconds -->\n\t<task:scheduled-tasks>\n\t\t<task:scheduled ref=\"runScheduler\" method=\"run\" cron=\"*/15 * * * * *\" />\n\t</task:scheduled-tasks>\n\nAra s'ha de crear les classes que hem definit: \n\n - EquipamentFieldSetMapper: S'encarrega de convertir cada línea del CSV en un objecte Equipaments\n - CustomItemProcessor: S'encarrega de processar les dades obtingudas de la lectura (En aquest howto no fem res, però per a facilitar futures implementacions es mostra un exemple)\n - RunScheduler: És la tasca que s'executarà cada 15 segons. Aquí s'inicia el job de Spring Batch\n \n#### EquipamentFieldSetMapper\n\n\tpackage cat.gencat.howtobatch.batch;\n\n\timport org.springframework.batch.item.file.mapping.FieldSetMapper;\n\timport org.springframework.batch.item.file.transform.FieldSet;\n\timport org.springframework.validation.BindException;\n\n\timport cat.gencat.howtobatch.model.Equipament;\n\n\tpublic class EquipamentFieldSetMapper implements FieldSetMapper<Equipament>{\n\n\t\t@Override\n\t\tpublic Equipament mapFieldSet(FieldSet fieldset) throws BindException {\n\t\t\t\n\t\t\tEquipament equipament = new Equipament();\n\t\t\tequipament.setNom(fieldset.readString(0));\n\t\t\tequipament.setMunicipi(fieldset.readString(1));\n\t\t\treturn equipament;\n\t\t}\n\t}\n\n#### CustomItemProcessor\n\n\tpackage cat.gencat.howtobatch.batch;\n\n\timport org.springframework.batch.item.ItemProcessor;\n\timport cat.gencat.howtobatch.model.Equipament;\n\n\tpublic class CustomItemProcessor implements ItemProcessor<Equipament, Equipament> {\n\n\t\t@Override\n\t\tpublic Equipament process(Equipament item) throws Exception {\n\t\t\tSystem.out.println(\"Tractant...\" + item);\n\t\t\treturn item;\n\t\t}\n\t}\n\n#### RunScheduler\n\n\tpackage cat.gencat.howtobatch.batch;\n\n\timport java.util.Date;\n\n\timport org.springframework.batch.core.Job;\n\timport org.springframework.batch.core.JobExecution;\n\timport org.springframework.batch.core.JobParameters;\n\timport org.springframework.batch.core.JobParametersBuilder;\n\timport org.springframework.batch.core.launch.JobLauncher;\n\timport org.springframework.beans.factory.annotation.Autowired;\n\timport org.springframework.stereotype.Component;\n\n\t@Component\n\tpublic class RunScheduler {\n\n\t\t@Autowired\n\t\tJobLauncher jobLauncher;\n\t\t\n\t\t@Autowired\n\t\tJob howtoJob;\n\n\t  public void run() {\n\n\t\ttry {\n\n\t\tString dateParam = new Date().toString();\n\t\tJobParameters param =\n\t\t  new JobParametersBuilder().addString(\"date\", dateParam).toJobParameters();\n\n\t\tSystem.out.println(dateParam);\n\n\t\tJobExecution execution = jobLauncher.run(howtoJob, param);\n\t\tSystem.out.println(\"Sortida: \" + execution.getStatus());\n\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\n\t  }\n\t}\n\nUn job només es pot executar 1 vegada (si s'ha completat amb èxit). Com en aquest cas volem que el mateix job s'executi continuament li hem de passar un paràmetre que el faci únic. En aquest cas li pasem la data.\n\n### Resultat\n\nSi arranquem l'aplicació, cada 15 segons veurem a la consola els logs que hem posat al procés batch:\n\n\tThu Sep 22 17:17:00 CEST 2016\n\tTractant...Equipament [nom='estacio autobusos']\n\tTractant...Equipament [nom='Jutjat de Pau']\n\tTractant...Equipament [nom='centre obert Alba']\n\tTractant...Equipament [nom='La Salle Manlleu']\n\tTractant...Equipament [nom='estacio metro']\n\tTractant...Equipament [nom='Jutjat Social']\n\tTractant...Equipament [nom='centre obert Ocaso']\n\tTractant...Equipament [nom='La Salle Salou']\n\tTractant...Equipament [nom='estacio tren']\n\tTractant...Equipament [nom='Jutjat Penal']\n\tTractant...Equipament [nom='centre obert Nit']\n\tTractant...Equipament [nom='La Salle Lleida']\n\tSortida: COMPLETED\n\tThu Sep 22 17:17:15 CEST 2016\n\tTractant...Equipament [nom='estacio autobusos']\n\tTractant...Equipament [nom='Jutjat de Pau']\n\tTractant...Equipament [nom='centre obert Alba']\n\tTractant...Equipament [nom='La Salle Manlleu']\n\tTractant...Equipament [nom='estacio metro']\n\tTractant...Equipament [nom='Jutjat Social']\n\tTractant...Equipament [nom='centre obert Ocaso']\n\tTractant...Equipament [nom='La Salle Salou']\n\tTractant...Equipament [nom='estacio tren']\n\tTractant...Equipament [nom='Jutjat Penal']\n\tTractant...Equipament [nom='centre obert Nit']\n\tTractant...Equipament [nom='La Salle Lleida']\n\tSortida: COMPLETED\n\tThu Sep 22 17:17:30 CEST 2016\n\tTractant...Equipament [nom='estacio autobusos']\n\tTractant...Equipament [nom='Jutjat de Pau']\n\tTractant...Equipament [nom='centre obert Alba']\n\tTractant...Equipament [nom='La Salle Manlleu']\n\tTractant...Equipament [nom='estacio metro']\n\tTractant...Equipament [nom='Jutjat Social']\n\tTractant...Equipament [nom='centre obert Ocaso']\n\tTractant...Equipament [nom='La Salle Salou']\n\tTractant...Equipament [nom='estacio tren']\n\tTractant...Equipament [nom='Jutjat Penal']\n\tTractant...Equipament [nom='centre obert Nit']\n\tTractant...Equipament [nom='La Salle Lleida']\n\tSortida: COMPLETED\n\n## Exemple Partitioning of Step\n\nEn aquest howto es mostra com configurar el processament de jobs de forma paral·lela. Per a mostrar el funcionament partirem els steps d'un job en N sub-steps i cadascún l'executarà un thread diferent.\n\nPer a utilitzar aquest sistema en una aplicació amb diferents nodes de forma remota s'hauria d'utilitzar un framework de missatgeria(JMS) per a la comunicació entre els nodes.\n\nCanvis a partir de l'exemple anterior:\n\n### app-custom-spring-batch-config\n\nEs modifica el fitxer de configuració per a partir el job. S'ha de implementar una classe que realitzi la partició\n\n\t...\n\n    <job id=\"partitionJob\" xmlns=\"http://www.springframework.org/schema/batch\">\n\t\t<step id=\"howtoJob\">\n\t\t\t<partition step=\"slave\" partitioner=\"rangePartitioner\">\n\t\t\t\t<handler grid-size=\"4\" task-executor=\"taskExecutor\" />\n\t\t\t</partition>\n\t\t</step>\n\t</job>\n\t\n\t<bean id=\"taskExecutor\" class=\"org.springframework.core.task.SimpleAsyncTaskExecutor\" />\n\n\t <!-- each thread will run this job, with different stepExecutionContext values. -->\n\t  <step id=\"slave\" xmlns=\"http://www.springframework.org/schema/batch\">\n\t  \t<tasklet>\n\t\t\t<chunk reader=\"cvsFileItemReader\" writer=\"jdbcItemWriter\" processor=\"itemProcessor\" commit-interval=\"2\">\n\t\t\t</chunk>\n\t\t</tasklet>\n\t  </step>\n\t  \n\t<bean id=\"rangePartitioner\" class=\"cat.gencat.howtobatch.batch.RangePartitioner\" />\n\t\n\t\t\n\t<bean id=\"itemProcessor\" class=\"cat.gencat.howtobatch.batch.CustomItemProcessor\" scope=\"step\">\n\t\t<property name=\"threadName\" value=\"#{stepExecutionContext[name]}\" />\n\t</bean>\n\t...\n\t\nEls beans cvsFileItemReader, jdbcItemWriterm, jobLauncher i runScheduler són los mateixos que a l'exemple anterior.\n\t\nAra s'ha de crear els fitxers que hem definit: \n\n - rangePartitioner: S'encarrega de dividir els steps en el nombre de sub-steps que s'ha definit (grid-size)\n\n#### RangePartitioner\n\n\tpackage cat.gencat.howtobatch.batch;\n\n\timport java.util.HashMap;\n\timport java.util.Map;\n\n\timport org.springframework.batch.core.partition.support.Partitioner;\n\timport org.springframework.batch.item.ExecutionContext;\n\n\tpublic class RangePartitioner implements Partitioner {\n\n\t\t@Override\n\t\tpublic Map<String, ExecutionContext> partition(int gridSize) {\n\n\t\t\tMap<String, ExecutionContext> result\n\t\t\t\t\t\t   = new HashMap<String, ExecutionContext>();\n\n\t\t\tfor (int i = 1; i <= gridSize; i++) {\n\t\t\t\tExecutionContext value = new ExecutionContext();\n\n\t\t\t\tvalue.putString(\"name\", \"Thread\" + i);\n\t\t\t\tresult.put(\"partition\" + i, value);\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t}\n \nCada cop que es crea un ExecutionContext es crea un Thread, cada thread processarà 4 línies del fitxer CSV.\n\nAl dividir el step en N sub steps, hi haurà N sortides (en aquest cas és indiferent ja que la sortida és escriure a base de dades, però si la sortida fós escriure en un fitxer es crearien N fitxers de sortida, un per cada sub-step)\n\n#### CustomItemProcessor\n\nHem modificat aquest fitxer per a incloure el nom del thread que està processant el step:\n\n\tpackage cat.gencat.howtobatch.batch;\n\n\timport org.springframework.batch.item.ItemProcessor;\n\n\timport cat.gencat.howtobatch.model.Equipament;\n\n\tpublic class CustomItemProcessor implements ItemProcessor<Equipament, Equipament> {\n\n\t\tprivate String threadName;\n\t\t\n\t\t@Override\n\t\tpublic Equipament process(Equipament item) throws Exception {\n\t\t\tSystem.out.println(threadName  + \" Tractant... \" + item);\n\t\t\treturn item;\n\t\t}\n\n\t\tpublic String getThreadName() {\n\t\t\treturn threadName;\n\t\t}\n\n\t\tpublic void setThreadName(String threadName) {\n\t\t\tthis.threadName = threadName;\n\t\t}\n\t\t\n\t}\n \n### Resultat\n \n\tFri Sep 23 09:49:00 CEST 2016\n\tThread4 Tractant... Equipament [nom='estacio autobusos']\n\tThread4 Tractant... Equipament [nom='Jutjat de Pau']\n\tThread3 Tractant... Equipament [nom='centre obert Alba']\n\tThread3 Tractant... Equipament [nom='La Salle Manlleu']\n\tThread2 Tractant... Equipament [nom='estacio metro']\n\tThread2 Tractant... Equipament [nom='Jutjat Social']\n\tThread1 Tractant... Equipament [nom='centre obert Ocaso']\n\tThread1 Tractant... Equipament [nom='La Salle Salou']\n\tThread3 Tractant... Equipament [nom='Jutjat Penal']\n\tThread3 Tractant... Equipament [nom='centre obert Nit']\n\tThread4 Tractant... Equipament [nom='estacio tren']\n\tThread4 Tractant... Equipament [nom='La Salle Lleida']\n\tSortida: COMPLETED\n\tFri Sep 23 09:49:15 CEST 2016\n\tThread3 Tractant... Equipament [nom='estacio autobusos']\n\tThread4 Tractant... Equipament [nom='centre obert Alba']\n\tThread4 Tractant... Equipament [nom='La Salle Manlleu']\n\tThread3 Tractant... Equipament [nom='Jutjat de Pau']\n\tThread1 Tractant... Equipament [nom='estacio metro']\n\tThread1 Tractant... Equipament [nom='Jutjat Social']\n\tThread2 Tractant... Equipament [nom='centre obert Ocaso']\n\tThread2 Tractant... Equipament [nom='La Salle Salou']\n\tThread3 Tractant... Equipament [nom='estacio tren']\n\tThread3 Tractant... Equipament [nom='Jutjat Penal']\n\tThread2 Tractant... Equipament [nom='centre obert Nit']\n\tThread4 Tractant... Equipament [nom='La Salle Lleida']\n\tSortida: COMPLETED","objectID":"L2hvd3Rvcy8yMDE2LTEwLUhvd3RvLUNhbmlnby1TcHJpbmctQmF0Y2g="},"L2hvd3Rvcy8yMDE2LTExLUhvd3RvLUNhbmlnby1KV1Q=":{"date":1480464000000,"title":"Autenticació amb JWT a una aplicació Canigó 3.1","description":"Autenticació amb JWT (JSON Web Tokens) a una aplicació Canigó 3.1.x (REST/HTML5+JS)","section":"howtos","categories":["canigo"],"key":"DESEMBRE2016","path":"/howtos/2016-11-Howto-Canigo-JWT","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que vulguin autenticar amb JWT a una aplicació Canigó 3.1 (REST+HTML5/JS).\n\n### Versió de Canigó\n\nEls pasos descrits en aquest document apliquen a la versió 3.1.x del Framework Canigó.\n\n### Introducció\n\nEn aquest HowTo s’explica com autenticar amb  JWT a una aplicació Canigó 3.1 REST. Per a fer-ho desplegarem l’aplicació demo que genera el plugin de Canigó amb seguretat per BBDD (amb una base de dades HSQLDB en memòria).\n\n\n## Configuració\n\n### Afegir Llibreries\n\nS'ha d'afegir al pom.xml la dependència amb Java JWT:\n\n   \t<!-- JJWT -->\n\t<dependency>\n\t\t<groupId>io.jsonwebtoken</groupId>\n\t\t<artifactId>jjwt</artifactId>\n\t\t<version>0.7.0</version>\n\t</dependency>\n\t\n### Configuració Petició/Resposta\n\nPer configurar JWT primer de tot creem les classes de petició, resposta, i el handler d'aquesta resposta:\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/dto* generem les següents classes:\n\n**AuthenticationRequestDto.java**, per a la petició:\n\n\tpackage cat.gencat.canigorest311.security.authentication.dto;\n\n\timport java.io.Serializable;\n\n\tpublic class AuthenticationRequestDto implements Serializable {\n\n\t\tprivate static final long serialVersionUID = 3237170924587387745L;\n\n\t\tprivate String username;\n\t\tprivate String password;\n\n\t\tpublic AuthenticationRequestDto() {\n\t\t\tsuper();\n\t\t}\n\n\t\tpublic AuthenticationRequestDto(final String username, final String password) {\n\t\t\tthis.setUsername(username);\n\t\t\tthis.setPassword(password);\n\t\t}\n\n\t\tpublic String getUsername() {\n\t\t\treturn username;\n\t\t}\n\n\t\tpublic void setUsername(final String username) {\n\t\t\tthis.username = username;\n\t\t}\n\n\t\tpublic String getPassword() {\n\t\t\treturn password;\n\t\t}\n\n\t\tpublic void setPassword(final String password) {\n\t\t\tthis.password = password;\n\t\t}\n\t}\n\n**AuthenticationResponseDto.java**, per a la respsota\n\n\tpackage cat.gencat.canigorest311.security.authentication.dto;\n\n\timport java.io.Serializable;\n\n\tpublic class AuthenticationResponseDto implements Serializable {\n\n\t\tprivate static final long serialVersionUID = -576643360234236041L;\n\n\t\tprivate final int code;\n\n\t\tpublic AuthenticationResponseDto(final int code) {\n\t\t\tthis.code = code;\n\t\t}\n\n\t\tpublic int getCode() {\n\t\t\treturn code;\n\t\t}\n\t}\n\n**JwtAuthenticationResponseDto.java**, per al token\n\n\tpackage cat.gencat.canigorest311.security.authentication.dto;\n\n\timport java.io.Serializable;\n\n\tpublic class JwtAuthenticationResponseDto implements Serializable {\n\n\t\tprivate static final long serialVersionUID = -5766433606831683041L;\n\t\tprivate final String token;\n\n\t\tpublic JwtAuthenticationResponseDto(final String token) {\n\t\t\tthis.token = token;\n\t\t}\n\n\t\tpublic String getToken() {\n\t\t\treturn token;\n\t\t}\n\t}\n\t\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/response* generem les classes utilitzades a la resposta:\n\n**ResponseRest.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.response;\n\n\timport java.io.Serializable;\n\n\tpublic class ResponseRest implements Serializable {\n\t\t/**\n\t\t *\n\t\t */\n\t\tprivate static final long serialVersionUID = -89237367748293773L;\n\t\tprivate int code;\n\t\tprivate String message;\n\n\t\tpublic ResponseRest() {\n\t\t\tsuper();\n\n\t\t}\n\n\t\tpublic ResponseRest(final int code, final String message) {\n\t\t\tsuper();\n\t\t\tthis.code = code;\n\t\t\tthis.message = message;\n\t\t}\n\n\t\tpublic int getCode() {\n\t\t\treturn code;\n\t\t}\n\n\t\tpublic void setCode(final int code) {\n\t\t\tthis.code = code;\n\t\t}\n\n\t\tpublic String getMessage() {\n\t\t\treturn message;\n\t\t}\n\n\t\tpublic void setMessage(final String message) {\n\t\t\tthis.message = message;\n\t\t}\n\t}\n\n**ResponseRestOk.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.response;\n\n\tpublic class ResponseRestOK extends ResponseRest {\n\n\t\tprivate static final long serialVersionUID = -234121341241231L;\n\n\t\tpublic ResponseRestOK() {\n\t\t\tsuper();\n\t\t}\n\n\t\tpublic ResponseRestOK(final int code, final String message) {\n\t\t\tsuper(code, message);\n\n\t\t}\n\n\t}\n\n**ResponseRestError.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.response;\n\n\tpublic class ResponseRestError extends ResponseRest {\n\n\t\tprivate static final long serialVersionUID = -12141241223455L;\n\n\t\tpublic ResponseRestError() {\n\t\t\tsuper();\n\t\t}\n\n\t\tpublic ResponseRestError(final int code, final String message) {\n\t\t\tsuper(code, message);\n\n\t\t}\n\n\t}\n\t\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/handler* generem les classes utilitzades per a construïr la resposta:\n\n**RestAuthenticationFailureHandler.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.handler;\n\n\timport java.io.IOException;\n\timport java.io.PrintWriter;\n\n\timport javax.servlet.ServletException;\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.springframework.http.MediaType;\n\timport org.springframework.security.core.AuthenticationException;\n\timport org.springframework.security.web.authentication.AuthenticationFailureHandler;\n\timport org.springframework.stereotype.Component;\n\n\timport com.fasterxml.jackson.databind.ObjectMapper;\n\n\timport cat.gencat.canigorest311.security.authentication.response.ResponseRestError;\n\n\t@Component(\"restAuthenticationFailureHandler\")\n\tpublic class RestAuthenticationFailureHandler implements AuthenticationFailureHandler {\n\n\t\t@Override\n\t\tpublic void onAuthenticationFailure(final HttpServletRequest request, final HttpServletResponse response, final AuthenticationException exception)\n\t\t\t\tthrows IOException, ServletException {\n\t\t\tbuilJsonResponse(response);\n\n\t\t}\n\n\t\tprivate void builJsonResponse(final HttpServletResponse response) throws IOException {\n\t\t\tresponse.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n\t\t\tresponse.setContentType(MediaType.APPLICATION_JSON.toString());\n\n\t\t\tfinal ObjectMapper mapper = new ObjectMapper();\n\t\t\tfinal ResponseRestError error = new ResponseRestError(HttpServletResponse.SC_UNAUTHORIZED, \"401. Unauthorized\");\n\t\t\tfinal String json = mapper.writeValueAsString(error);\n\t\t\tfinal PrintWriter writer = response.getWriter();\n\t\t\twriter.write(json);\n\t\t\twriter.flush();\n\t\t\twriter.close();\n\t\t}\n\t}\n\t\n**RestAuthenticationSuccessHandler.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.handler;\n\n\timport java.io.IOException;\n\timport java.io.PrintWriter;\n\n\timport javax.servlet.ServletException;\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.springframework.http.MediaType;\n\timport org.springframework.security.core.Authentication;\n\timport org.springframework.security.web.authentication.AuthenticationSuccessHandler;\n\timport org.springframework.stereotype.Component;\n\n\timport com.fasterxml.jackson.databind.ObjectMapper;\n\n\timport cat.gencat.canigorest311.security.authentication.response.ResponseRestOK;\n\n\t@Component(\"restAuthenticationSuccessHandler\")\n\tpublic class RestAuthenticationSuccessHandler implements AuthenticationSuccessHandler {\n\n\t\t@Override\n\t\tpublic void onAuthenticationSuccess(final HttpServletRequest request, final HttpServletResponse response, final Authentication authentication)\n\t\t\t\tthrows IOException, ServletException {\n\t\t\t// We do not need to do anything extra on REST login success, because there is no page to redirect to\n\t\t\tbuilJsonResponse(response);\n\t\t}\n\n\t\tprivate void builJsonResponse(final HttpServletResponse response) throws IOException {\n\t\t\tresponse.setStatus(HttpServletResponse.SC_OK);\n\t\t\tresponse.setContentType(MediaType.APPLICATION_JSON.toString());\n\n\t\t\tfinal ObjectMapper mapper = new ObjectMapper();\n\t\t\tfinal ResponseRestOK error = new ResponseRestOK(HttpServletResponse.SC_OK, \"200. Login Sucess\");\n\t\t\tfinal String json = mapper.writeValueAsString(error);\n\t\t\tfinal PrintWriter writer = response.getWriter();\n\t\t\twriter.write(json);\n\t\t\twriter.flush();\n\t\t\twriter.close();\n\t\t}\n\n\t}\n\n### Configuració JWT\n\n#### Handler del token\n\nClasse que s'utilitza per a obtenir la informació del token (username, authorities):\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/jwt*\n\n**JwtTokenHandler.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.jwt;\n\n\timport java.util.Date;\n\timport java.util.HashMap;\n\timport java.util.Map;\n\n\timport javax.annotation.PostConstruct;\n\n\timport org.apache.commons.lang3.StringUtils;\n\timport org.apache.commons.logging.Log;\n\timport org.apache.commons.logging.LogFactory;\n\timport org.springframework.security.core.authority.AuthorityUtils;\n\timport org.springframework.security.core.userdetails.User;\n\timport org.springframework.security.core.userdetails.UserDetails;\n\timport org.springframework.util.Assert;\n\n\timport io.jsonwebtoken.Claims;\n\timport io.jsonwebtoken.Jwts;\n\timport io.jsonwebtoken.SignatureAlgorithm;\n\n\tpublic class JwtTokenHandler {\n\n\t\tprivate static final Log logger = LogFactory.getLog(JwtAuthenticationFilter.class);\n\n\t\tpublic static final String SECRET_PASSWORD = \"***\";\n\t\tpublic static final String CLAIM_KEY_USERNAME = \"sub\";\n\t\tpublic static final String CLAIM_KEY_AUTHORITIES = \"authorities\";\n\n\t\tprivate String secret;\n\n\t\tprivate Long expiration;\n\n\t\tpublic UserDetails getUserFromToken(final String token) {\n\t\t\tUserDetails user;\n\t\t\ttry {\n\t\t\t\tfinal Claims claims = getClaimsFromToken(token);\n\t\t\t\tfinal String userName = claims.get(CLAIM_KEY_USERNAME, String.class);\n\t\t\t\tfinal String authorityes = claims.get(CLAIM_KEY_AUTHORITIES, String.class);\n\n\t\t\t\tuser = buildUserDetails(userName, authorityes);\n\t\t\t} catch (final Exception e) {\n\t\t\t\tlogger.error(\"Error getting user from token. Token is invalid?\", e);\n\t\t\t\tuser = null;\n\t\t\t}\n\t\t\treturn user;\n\t\t}\n\n\t\tpublic String getUsernameFromToken(final String token) {\n\t\t\tString username;\n\t\t\ttry {\n\t\t\t\tfinal Claims claims = getClaimsFromToken(token);\n\t\t\t\tusername = claims.getSubject();\n\t\t\t} catch (final Exception e) {\n\t\t\t\tlogger.error(\"Error getting userName from token. Token is invalid?\", e);\n\t\t\t\tusername = null;\n\t\t\t}\n\t\t\treturn username;\n\t\t}\n\n\t\tpublic Date getExpirationDateFromToken(final String token) {\n\t\t\tDate expiration;\n\t\t\ttry {\n\t\t\t\tfinal Claims claims = getClaimsFromToken(token);\n\t\t\t\texpiration = claims.getExpiration();\n\t\t\t} catch (final Exception e) {\n\t\t\t\tlogger.error(\"Error getting expiration date from token. Token is invalid?\", e);\n\t\t\t\texpiration = null;\n\t\t\t}\n\t\t\treturn expiration;\n\t\t}\n\n\t\tpublic String generateToken(final UserDetails userDetails) {\n\t\t\tfinal Map<String, Object> claims = new HashMap<>();\n\t\t\tclaims.put(CLAIM_KEY_USERNAME, userDetails.getUsername());\n\t\t\tclaims.put(CLAIM_KEY_AUTHORITIES, StringUtils.join(userDetails.getAuthorities(), ','));\n\t\t\treturn generateToken(claims);\n\t\t}\n\n\t\tpublic String generateToken(final Map<String, Object> claims) {\n\t\t\treturn Jwts.builder().setClaims(claims).setExpiration(generateExpirationDate()).signWith(SignatureAlgorithm.HS512, secret).compact();\n\t\t}\n\n\t\tpublic Boolean canTokenBeRefreshed(final String token) {\n\t\t\treturn !isTokenExpired(token) || ignoreTokenExpiration();\n\t\t}\n\n\t\tpublic String refreshToken(final String token) {\n\t\t\tString refreshedToken;\n\t\t\ttry {\n\t\t\t\tfinal Claims claims = getClaimsFromToken(token);\n\t\t\t\trefreshedToken = generateToken(claims);\n\t\t\t} catch (final Exception e) {\n\t\t\t\tlogger.error(\"Error refreshing token. Token is invalid?\", e);\n\t\t\t\trefreshedToken = null;\n\t\t\t}\n\t\t\treturn refreshedToken;\n\t\t}\n\n\t\tpublic Boolean validateToken(final String token) {\n\t\t\treturn !isTokenExpired(token);\n\t\t}\n\n\t\tprotected Boolean ignoreTokenExpiration() {\n\t\t\treturn false;\n\t\t}\n\n\t\tprivate Claims getClaimsFromToken(final String token) {\n\t\t\tClaims claims;\n\t\t\ttry {\n\t\t\t\tclaims = Jwts.parser().setSigningKey(secret).parseClaimsJws(token).getBody();\n\t\t\t} catch (final Exception e) {\n\t\t\t\tlogger.error(\"Error getting claimsfrom token. Token is invalid?\", e);\n\t\t\t\tclaims = null;\n\t\t\t}\n\t\t\treturn claims;\n\t\t}\n\n\t\tprivate Date generateExpirationDate() {\n\t\t\treturn new Date(System.currentTimeMillis() + expiration * 1000);\n\t\t}\n\n\t\tprivate Boolean isTokenExpired(final String token) {\n\t\t\tfinal Date expiration = getExpirationDateFromToken(token);\n\t\t\treturn expiration.before(new Date());\n\t\t}\n\n\t\tprivate UserDetails buildUserDetails(final String userName, final String authorityes) {\n\t\t\treturn new User(userName, SECRET_PASSWORD,\n\t\t\t\t\tStringUtils.isEmpty(authorityes) ? AuthorityUtils.NO_AUTHORITIES : AuthorityUtils.commaSeparatedStringToAuthorityList(authorityes));\n\t\t}\n\n\t\t@PostConstruct\n\t\tprivate void assertAfterPropertySet() {\n\t\t\tAssert.hasLength(secret, \"Secret (jwt.secret property) for JWT must not be null or empty!\");\n\t\t\tAssert.notNull(expiration, \"expiration (jwt.expiration property) for JWT must not be null!\");\n\t\t\tAssert.state(expiration > 0, \"expiration (jwt.expiration property) for JWT must not be less than 0!\");\n\n\t\t}\n\n\t\tpublic String getSecret() {\n\t\t\treturn secret;\n\t\t}\n\n\t\tpublic void setSecret(final String secret) {\n\t\t\tthis.secret = secret;\n\t\t}\n\n\t\tpublic Long getExpiration() {\n\t\t\treturn expiration;\n\t\t}\n\n\t\tpublic void setExpiration(final Long expiration) {\n\t\t\tthis.expiration = expiration;\n\t\t}\n\n\t}\n\n#### Entrypoint\n\nHem de generar la classe que indicarem a la configuració com a punt d'entrada de l'autenticació:\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/entrypoint* generem la classe **RestAuthenticationEntrypoint.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.entrypoint;\n\n\timport java.io.IOException;\n\timport java.io.PrintWriter;\n\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.springframework.http.MediaType;\n\timport org.springframework.security.core.AuthenticationException;\n\timport org.springframework.security.web.AuthenticationEntryPoint;\n\timport org.springframework.stereotype.Component;\n\n\timport com.fasterxml.jackson.core.JsonProcessingException;\n\timport com.fasterxml.jackson.databind.ObjectMapper;\n\n\timport cat.gencat.canigorest311.security.authentication.response.ResponseRestError;\n\n\t@Component(\"restAuthenticationEntryPoint\")\n\tpublic class RestAuthenticationEntryPoint implements AuthenticationEntryPoint {\n\n\t\t@Override\n\t\tpublic void commence(final HttpServletRequest request, final HttpServletResponse response, final AuthenticationException authException) throws IOException {\n\t\t\t// This is invoked when user tries to access a secured REST resource without supplying any credentials\n\t\t\t// We should just send a 401 Unauthorized response because there is no 'login page' to redirect to\n\t\t\tfinal ResponseRestError error = new ResponseRestError(HttpServletResponse.SC_UNAUTHORIZED, \"401. Unauthorized\");\n\t\t\tbuilJsonResponse(response, error);\n\t\t}\n\n\t\tprivate void builJsonResponse(final HttpServletResponse response, final ResponseRestError error) throws JsonProcessingException, IOException {\n\t\t\tresponse.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n\t\t\tresponse.setContentType(MediaType.APPLICATION_JSON.toString());\n\n\t\t\tfinal ObjectMapper mapper = new ObjectMapper();\n\t\t\tfinal String json = mapper.writeValueAsString(error);\n\t\t\tfinal PrintWriter writer = response.getWriter();\n\t\t\twriter.write(json);\n\t\t\twriter.flush();\n\t\t\twriter.close();\n\t\t}\n\t}\n\t\n#### Controlador de l'autenticació\n\nA l'exemple hem generat un controlador REST (/auth) com a servei que hauria de cridar el login.\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/controller* generem la classe **AuthController.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.controller;\n\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.springframework.beans.factory.annotation.Autowired;\n\timport org.springframework.beans.factory.annotation.Qualifier;\n\timport org.springframework.http.MediaType;\n\timport org.springframework.security.core.Authentication;\n\timport org.springframework.security.core.userdetails.User;\n\timport org.springframework.web.bind.annotation.RequestBody;\n\timport org.springframework.web.bind.annotation.RequestMapping;\n\timport org.springframework.web.bind.annotation.RequestMethod;\n\timport org.springframework.web.bind.annotation.RestController;\n\n\timport cat.gencat.canigorest311.security.authentication.dto.AuthenticationRequestDto;\n\timport cat.gencat.canigorest311.security.authentication.dto.JwtAuthenticationResponseDto;\n\timport cat.gencat.canigorest311.security.authentication.jwt.JwtTokenHandler;\n\timport cat.gencat.canigorest311.security.authentication.service.AuthenticationService;\n\timport cat.gencat.canigorest311.security.authentication.service.impl.DefaultAuthenticationService;\n\n\t@RestController\n\tpublic class AuthController {\n\n\t\t@Autowired(required = false)\n\t\t@Qualifier(\"jwtAuthenticationService\")\n\t\tprivate AuthenticationService jwtAuthenticationService;\n\n\t\t@Autowired(required = false)\n\t\tprivate JwtTokenHandler jwtTokenHandler;\n\n\t\t@RequestMapping(value = \"/auth\", produces = MediaType.APPLICATION_JSON_VALUE, method = RequestMethod.POST)\n\t\tpublic JwtAuthenticationResponseDto getAuthToken(final HttpServletRequest request, final HttpServletResponse response,\n\t\t\t\t@RequestBody(required = false) final AuthenticationRequestDto jwtAuthenticationRequestDto) {\n\n\t\t\tif (jwtAuthenticationRequestDto != null) {\n\t\t\t\trequest.setAttribute(DefaultAuthenticationService.SPRING_SECURITY_FORM_USERNAME_KEY, jwtAuthenticationRequestDto.getUsername());\n\t\t\t\trequest.setAttribute(DefaultAuthenticationService.SPRING_SECURITY_FORM_PASSWORD_KEY, jwtAuthenticationRequestDto.getPassword());\n\n\t\t\t}\n\t\t\tfinal Authentication authentication = jwtAuthenticationService.authenticate(request, response);\n\t\t\tfinal String token = jwtTokenHandler.generateToken((User) authentication.getPrincipal());\n\n\t\t\treturn new JwtAuthenticationResponseDto(token);\n\n\t\t}\n\n\t}\n\t\n#### Autenticació\n\nEn aquest exemple només hem implementat el provider de l'autenticació per defecte (DefaultAuthenticationService). Si l'aplicació estiguès protegida per un altre provider, com per exemple GICAR, s'hauria d'implementar un GicarAuthenticationService per a realitzar l'autenticació per GICAR.\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/service*\n\n**AuthenticationService.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.service;\n\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.springframework.security.core.Authentication;\n\n\tpublic interface AuthenticationService {\n\t\tAuthentication authenticate(final HttpServletRequest request, final HttpServletResponse response);\n\n\t\tboolean isAuthRequest(HttpServletRequest request);\n}\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/service/impl*\n\n**DefaultAuthenticationService.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.service.impl;\n\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.apache.commons.lang3.StringUtils;\n\timport org.springframework.beans.factory.annotation.Autowired;\n\timport org.springframework.context.annotation.Lazy;\n\timport org.springframework.security.authentication.AuthenticationManager;\n\timport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\n\timport org.springframework.security.core.Authentication;\n\timport org.springframework.stereotype.Component;\n\n\timport cat.gencat.canigorest311.security.authentication.service.AuthenticationService;\n\n\t@Component(\"defaultAuthenticationService\")\n\tpublic class DefaultAuthenticationService implements AuthenticationService {\n\n\t\tpublic static final String SPRING_SECURITY_FORM_USERNAME_KEY = \"username\";\n\t\tpublic static final String SPRING_SECURITY_FORM_PASSWORD_KEY = \"password\";\n\n\t\tprivate String usernameParameter = SPRING_SECURITY_FORM_USERNAME_KEY;\n\t\tprivate String passwordParameter = SPRING_SECURITY_FORM_PASSWORD_KEY;\n\n\t\t@Autowired\n\t\t@Lazy\n\t\tprivate AuthenticationManager authenticationManager;\n\n\t\t@Override\n\t\tpublic Authentication authenticate(final HttpServletRequest request, final HttpServletResponse response) {\n\t\t\tfinal String username = obtainUsername(request);\n\t\t\tfinal String password = obtainPassword(request);\n\n\t\t\tfinal UsernamePasswordAuthenticationToken authRequest = new UsernamePasswordAuthenticationToken(username, password);\n\n\t\t\treturn authenticationManager.authenticate(authRequest);\n\t\t}\n\n\t\tprotected String obtainUsername(final HttpServletRequest request) {\n\t\t\tfinal String username = request.getParameter(usernameParameter);\n\t\t\treturn StringUtils.isEmpty(username) ? \"\" : username.trim();\n\t\t}\n\n\t\tprotected String obtainPassword(final HttpServletRequest request) {\n\t\t\tfinal String password = request.getParameter(passwordParameter);\n\t\t\treturn StringUtils.isEmpty(password) ? \"\" : password;\n\t\t}\n\n\t\t@Override\n\t\tpublic boolean isAuthRequest(final HttpServletRequest request) {\n\t\t\treturn !StringUtils.isEmpty(obtainUsername(request)) && !StringUtils.isEmpty(obtainPassword(request));\n\t\t}\n\n\t}\n\n**JwtAuthenticationService.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.service.impl;\n\n\timport javax.annotation.PostConstruct;\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.apache.commons.lang3.StringUtils;\n\timport org.apache.commons.logging.Log;\n\timport org.apache.commons.logging.LogFactory;\n\timport org.springframework.beans.factory.annotation.Autowired;\n\timport org.springframework.beans.factory.annotation.Qualifier;\n\timport org.springframework.context.annotation.Lazy;\n\timport org.springframework.security.authentication.AbstractAuthenticationToken;\n\timport org.springframework.security.core.Authentication;\n\timport org.springframework.security.core.context.SecurityContextHolder;\n\timport org.springframework.security.core.userdetails.User;\n\timport org.springframework.security.web.authentication.WebAuthenticationDetailsSource;\n\n\timport cat.gencat.canigorest311.security.authentication.jwt.JwtAuthenticationFilter;\n\timport cat.gencat.canigorest311.security.authentication.jwt.JwtTokenHandler;\n\timport cat.gencat.canigorest311.security.authentication.service.AuthenticationService;\n\timport io.jsonwebtoken.lang.Assert;\n\n\tpublic class JwtAuthenticationService implements AuthenticationService {\n\n\t\tprivate static final Log logger = LogFactory.getLog(JwtAuthenticationFilter.class);\n\n\t\tprivate String headerAuthName;\n\n\t\tprivate String tokenResponseHeaderName;\n\n\t\t@Autowired\n\t\t@Lazy\n\t\tprivate JwtTokenHandler jwtTokenHandler;\n\n\t\t@Autowired\n\t\t@Qualifier(\"defaultAuthenticationService\")\n\t\t@Lazy\n\t\tprivate AuthenticationService defaultAuthenticationService;\n\n\t\t@Override\n\t\tpublic Authentication authenticate(final HttpServletRequest request, final HttpServletResponse response) {\n\t\t\tlogger.info(\"try Authenticate whith credentials.\");\n\t\t\tfinal Authentication authentication = defaultAuthenticationService.authenticate(request, response);\n\t\t\t((AbstractAuthenticationToken) authentication).setDetails(new WebAuthenticationDetailsSource().buildDetails(request));\n\t\t\tSecurityContextHolder.getContext().setAuthentication(authentication);\n\t\t\tresponse.setHeader(tokenResponseHeaderName, jwtTokenHandler.generateToken((User) authentication.getPrincipal()));\n\t\t\tlogger.info(\"setting JWT token to response header. Authenticate user in Spring context.\");\n\t\t\treturn authentication;\n\t\t}\n\n\t\t@Override\n\t\tpublic boolean isAuthRequest(final HttpServletRequest request) {\n\t\t\treturn (defaultAuthenticationService.isAuthRequest(request))\n\t\t\t\t\t|| !StringUtils.isEmpty(request.getHeader(headerAuthName));\n\t\t}\n\n\t\tpublic String getHeaderAuthName() {\n\t\t\treturn headerAuthName;\n\t\t}\n\n\t\tpublic void setHeaderAuthName(final String headerAuthName) {\n\t\t\tthis.headerAuthName = headerAuthName;\n\t\t}\n\n\t\tpublic String getTokenResponseHeaderName() {\n\t\t\treturn tokenResponseHeaderName;\n\t\t}\n\n\t\tpublic void setTokenResponseHeaderName(final String tokenResponseHeaderName) {\n\t\t\tthis.tokenResponseHeaderName = tokenResponseHeaderName;\n\t\t}\n\n\t\tpublic JwtTokenHandler getJwtTokenHandler() {\n\t\t\treturn jwtTokenHandler;\n\t\t}\n\n\t\tpublic void setJwtTokenHandler(final JwtTokenHandler jwtTokenHandler) {\n\t\t\tthis.jwtTokenHandler = jwtTokenHandler;\n\t\t}\n\n\t\tpublic AuthenticationService getDefaultAuthenticationService() {\n\t\t\treturn defaultAuthenticationService;\n\t\t}\n\n\t\tpublic void setDefaultAuthenticationService(final AuthenticationService defaultAuthenticationService) {\n\t\t\tthis.defaultAuthenticationService = defaultAuthenticationService;\n\t\t}\n\n\t\t@PostConstruct\n\t\tpublic void checkProperties() {\n\t\t\tAssert.hasLength(headerAuthName, \"headerAuthName can't be null or empty!\");\n\t\t\tAssert.hasLength(tokenResponseHeaderName, \"tokenResponseHeaderName can't be null or empty!\");\n\t\t}\n\n\t}\n\n#### Filtre Autenticació\n\nS'ha de crear un nou filtre per a comprovar a les url protegides si l'usuari es troba autenticat, o en cas contrari intentar l'autenticació.\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/jwt* generem la classe **JwtAuthenticationFilter.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.jwt;\n\n\timport java.io.IOException;\n\n\timport javax.annotation.PostConstruct;\n\timport javax.servlet.FilterChain;\n\timport javax.servlet.ServletException;\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.apache.commons.logging.Log;\n\timport org.apache.commons.logging.LogFactory;\n\timport org.springframework.beans.factory.annotation.Autowired;\n\timport org.springframework.beans.factory.annotation.Qualifier;\n\timport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\n\timport org.springframework.security.core.Authentication;\n\timport org.springframework.security.core.context.SecurityContextHolder;\n\timport org.springframework.security.core.userdetails.User;\n\timport org.springframework.security.web.authentication.WebAuthenticationDetailsSource;\n\timport org.springframework.web.filter.OncePerRequestFilter;\n\n\timport cat.gencat.canigorest311.security.authentication.service.AuthenticationService;\n\timport io.jsonwebtoken.lang.Assert;\n\n\tpublic class JwtAuthenticationFilter extends OncePerRequestFilter {\n\n\t\tprivate static final Log logger = LogFactory.getLog(JwtAuthenticationFilter.class);\n\n\t\tprivate String headerAuthName;\n\n\t\tprivate String startToken;\n\n\t\tprivate String tokenResponseHeaderName;\n\n\t\t@Autowired\n\t\tprivate JwtTokenHandler jwtTokenHandler;\n\n\t\t@Autowired\n\t\t@Qualifier(\"jwtAuthenticationService\")\n\t\tprivate AuthenticationService jwtAuthenticationService;\n\n\t\t@Override\n\t\tprotected void doFilterInternal(final HttpServletRequest request, final HttpServletResponse response, final FilterChain chain)\n\t\t\t\tthrows ServletException, IOException {\n\n\t\t\tif (requireDoFilter(request)) {\n\n\t\t\t\tfinal String header = request.getHeader(headerAuthName);\n\n\t\t\t\tif (header != null && header.startsWith(startToken)) {\n\n\t\t\t\t\tfinal String authToken = header.substring(7);\n\t\t\t\t\tfinal User user = (User) jwtTokenHandler.getUserFromToken(authToken);\n\n\t\t\t\t\tfinal Authentication authenticationSecurity = SecurityContextHolder.getContext().getAuthentication();\n\t\t\t\t\tif (authenticationSecurity == null) {\n\t\t\t\t\t\tif (user != null && jwtTokenHandler.validateToken(authToken)) {\n\t\t\t\t\t\t\tlogger.info(\"token is valid, the user is autheticate correctly! setter response jwtToken\");\n\t\t\t\t\t\t\tfinal UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(user, null, user.getAuthorities());\n\t\t\t\t\t\t\tauthentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));\n\t\t\t\t\t\t\tSecurityContextHolder.getContext().setAuthentication(authentication);\n\t\t\t\t\t\t\tresponse.setHeader(tokenResponseHeaderName,\n\t\t\t\t\t\t\t\t\tjwtTokenHandler.canTokenBeRefreshed(authToken) ? jwtTokenHandler.refreshToken(authToken) : authToken);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlogger.info(\"token is invalid or missing!\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlogger.info(\"The user was previous authenticate!\");\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tlogger.info(\"attemp to default authentication: call --> wtAuthenticationService.authenticate\");\n\t\t\t\t\tjwtAuthenticationService.authenticate(request, response);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlogger.info(\"The request:\" + request.getPathInfo() + \" has not info for authentication.\");\n\t\t\t}\n\n\t\t\tchain.doFilter(request, response);\n\n\t\t}\n\n\t\tpublic String getHeaderAuthName() {\n\t\t\treturn headerAuthName;\n\t\t}\n\n\t\tpublic void setHeaderAuthName(final String headerAuthName) {\n\t\t\tthis.headerAuthName = headerAuthName;\n\t\t}\n\n\t\tpublic String getStartToken() {\n\t\t\treturn startToken;\n\t\t}\n\n\t\tpublic void setStartToken(final String startToken) {\n\t\t\tthis.startToken = startToken;\n\t\t}\n\n\t\tpublic String getTokenResponseHeaderName() {\n\t\t\treturn tokenResponseHeaderName;\n\t\t}\n\n\t\tpublic void setTokenResponseHeaderName(final String tokenResponseHeaderName) {\n\t\t\tthis.tokenResponseHeaderName = tokenResponseHeaderName;\n\t\t}\n\n\t\tpublic JwtTokenHandler getJwtTokenHandler() {\n\t\t\treturn jwtTokenHandler;\n\t\t}\n\n\t\tpublic void setJwtTokenHandler(final JwtTokenHandler jwtTokenHandler) {\n\t\t\tthis.jwtTokenHandler = jwtTokenHandler;\n\t\t}\n\n\t\tpublic AuthenticationService getJwtAuthenticationService() {\n\t\t\treturn jwtAuthenticationService;\n\t\t}\n\n\t\tpublic void setJwtAuthenticationService(final AuthenticationService jwtAuthenticationService) {\n\t\t\tthis.jwtAuthenticationService = jwtAuthenticationService;\n\t\t}\n\n\t\t@PostConstruct\n\t\tpublic void checkProperties() {\n\t\t\tAssert.hasLength(startToken, \"startToken can't be null!\");\n\t\t\tAssert.hasLength(headerAuthName, \"headerAuthName can't be null or empty!\");\n\t\t\tAssert.hasLength(tokenResponseHeaderName, \"tokenResponseHeaderName can't be null or empty!\");\n\t\t}\n\n\t\tprivate boolean requireDoFilter(final HttpServletRequest request) {\n\t\t\treturn !isLoginRequest(request) && jwtAuthenticationService.isAuthRequest(request);\n\n\t\t}\n\n\t\tprivate boolean isLoginRequest(final HttpServletRequest request) {\n\t\t\treturn request.getPathInfo() != null && request.getPathInfo().endsWith(\"/auth\");\n\t\t}\n\n\t}\n\t\n### Configuració Seguretat a Spring\n\nPer a utilitzar les classes que hem creat als punts anteriors, hem de realitzar la configuració de Spring Security al fitxer **app-custom-security.xml**\n\nEn aquest fitxer hem de fer que Spring tingui en compte el controlador creat:\n\n\t<context:component-scan base-package=\"cat.gencat.canigorest311.security\" />\n\t\nDeclarar els beans de les noves classes creades:\n\n\t<bean name=\"jwtAuthenticationService\" id=\"jwtAuthenticationService\" class=\"cat.gencat.canigorest311.security.authentication.service.impl.JwtAuthenticationService\">\n\t\t<property name=\"tokenResponseHeaderName\" value=\"${jwt.tokenResponseHeaderName:jwtToken}\" />\n\t\t<property name=\"headerAuthName\" value=\"${jwt.header:Authentication}\" />\n\t</bean>\n\t\n\t<bean name=\"jwtAuthenticationFilter\" id=\"jwtAuthenticationFilter\" class=\"cat.gencat.canigorest311.security.authentication.jwt.JwtAuthenticationFilter\">\n\t\t<property name=\"startToken\" value=\"${jwt.header.startToken:Bearer}\" />\n\t\t<property name=\"tokenResponseHeaderName\" value=\"${jwt.tokenResponseHeaderName:jwtToken}\" />\n\t\t<property name=\"headerAuthName\" value=\"${jwt.header:Authentication}\" />\n\t</bean>\n\t\n\t<bean name=\"jwtTokenHandler\" id=\"jwtTokenHandler\" class=\"cat.gencat.canigorest311.security.authentication.jwt.JwtTokenHandler\">\n\t\t<property name=\"expiration\"\tvalue=\"${jwt.expiration:3600L}\" />\n\t\t<property name=\"secret\"\tvalue=\"${jwt.secret:canigo}\" />\n\t</bean>\n\t\nDeclarar el punt d'entrada de la seguretat:\n\n\t<security:http use-expressions=\"true\" create-session=\"stateless\" entry-point-ref=\"restAuthenticationEntryPoint\">\n\t\nDeclarar el filtre JWT:\n\n\t<security:custom-filter ref=\"jwtAuthenticationFilter\" before=\"PRE_AUTH_FILTER\" />\n\t\nAmb aquests canvis el fitxer quedaria de la següent manera:\n\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\t<beans  xmlns=\"http://www.springframework.org/schema/beans\"\n\t\t\txmlns:security=\"http://www.springframework.org/schema/security\"\n\t\t\txmlns:context=\"http://www.springframework.org/schema/context\"\n\t\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:jdbc=\"http://www.springframework.org/schema/jdbc\"\n\t\t\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \thttp://www.springframework.org/schema/beans/spring-beans-4.1.xsd\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/context \thttp://www.springframework.org/schema/context/spring-context-4.1.xsd\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/security \thttp://www.springframework.org/schema/security/spring-security-3.2.xsd\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/jdbc \t\thttp://www.springframework.org/schema/jdbc/spring-jdbc-4.1.xs\">\n\n\t\t<context:component-scan base-package=\"cat.gencat.canigorest311.security\" />\n\n\t\t<bean name=\"jwtAuthenticationService\" id=\"jwtAuthenticationService\" class=\"cat.gencat.canigorest311.security.authentication.service.impl.JwtAuthenticationService\">\n\t\t\t<property name=\"tokenResponseHeaderName\" value=\"${jwt.tokenResponseHeaderName:jwtToken}\" />\n\t\t\t<property name=\"headerAuthName\" value=\"${jwt.header:Authentication}\" />\n\t\t</bean>\n\t\t\n\t\t<bean name=\"jwtAuthenticationFilter\" id=\"jwtAuthenticationFilter\" class=\"cat.gencat.canigorest311.security.authentication.jwt.JwtAuthenticationFilter\">\n\t\t\t<property name=\"startToken\" value=\"${jwt.header.startToken:Bearer}\" />\n\t\t\t<property name=\"tokenResponseHeaderName\" value=\"${jwt.tokenResponseHeaderName:jwtToken}\" />\n\t\t\t<property name=\"headerAuthName\" value=\"${jwt.header:Authentication}\" />\n\t\t</bean>\n\t\t\n\t\t<bean name=\"jwtTokenHandler\" id=\"jwtTokenHandler\" class=\"cat.gencat.canigorest311.security.authentication.jwt.JwtTokenHandler\">\n\t\t\t<property name=\"expiration\"\tvalue=\"${jwt.expiration:3600L}\" />\n\t\t\t<property name=\"secret\"\tvalue=\"${jwt.secret:canigo}\" />\n\t\t</bean>\n\n\t\t<security:http pattern=\"/css/**\" security=\"none\" />\n\t\t<security:http pattern=\"/images/**\" security=\"none\" />\n\t\t<security:http pattern=\"/js/**\" security=\"none\" />\n\n\t\t<!-- Secure patterns -->\n\t\t<security:http use-expressions=\"true\" create-session=\"stateless\" entry-point-ref=\"restAuthenticationEntryPoint\">\n\t\t\t<security:intercept-url pattern=\"/**\" access=\"permitAll\" method=\"OPTIONS\" />\n\t\t\t<security:intercept-url pattern=\"/api/equipaments/**\" access=\"hasRole('ROLE_ADMIN')\" method=\"DELETE\" />\n\t\t\t<security:intercept-url pattern=\"/api/equipaments/**\" access=\"hasRole('ROLE_ADMIN')\" method=\"GET\" />\n\t\t\t<security:intercept-url pattern=\"/api/equipaments/**\" access=\"hasRole('ROLE_ADMIN')\" method=\"PUT\" />\n\t\t\t<security:intercept-url pattern=\"/api/equipaments/**\" access=\"hasRole('ROLE_ADMIN')\" method=\"POST\" />\n\t\t\t<security:intercept-url pattern=\"/api/logs/**\" access=\"hasRole('ROLE_ADMIN')\" />\n\n\t\t\t<security:form-login login-processing-url=\"/j_spring_security_check\" login-page=\"/j_spring_security_check\" />\n\t\t\t<security:custom-filter ref=\"jwtAuthenticationFilter\" before=\"PRE_AUTH_FILTER\" />\n\t\t</security:http>\n\n\t\t<security:authentication-manager alias=\"authenticationManager\">\t\n\t\t\t<!-- BBDD -->\n\t\t\t<security:authentication-provider>\n\t\t\t\t<security:jdbc-user-service data-source-ref=\"dataSource\"/>\n\t\t\t</security:authentication-provider>\n\t\t\t\n\t\t</security:authentication-manager>\n\n\t</beans>\n\t\n### Resultat\n\nAmb aquesta configuració, la primera vegada que un usuari vol accedir a l'aplicació haurà de proporcionar l'usuari i password, i l'aplicació a la response retornarà un token:\n\n\tjwtToken:eyJhbGciOiJIUzUxMiJ9.eyJleHAiOjE0ODA2ODc0OTcsInN1YiI6ImFkbWluIiwiYXV0aG9yaXRpZXMiOiJST0xFX0FETUlOLFJPTEVfVVNFUiJ9.kmupP8B269D-SZemxkTdfdqYQ-vRMF3-nNtsWoi-bbDo5Wk38LbRYYf-sO3ceqZaYursfFIYyI0BR6keuko-4A\n\t\nA partir d'aquí, l'aplicació ha d'enviar aquest token a la capçalera de les següents peticions:\n\n\tNom: Authentication\n\tValor: Bearer + token\n\t\nExemple\n\n\tAuthentication: Bearer eyJhbGciOiJIUzUxMiJ9.eyJleHAiOjE0ODA2ODc0OTcsInN1YiI6ImFkbWluIiwiYXV0aG9yaXRpZXMiOiJST0xFX0FETUlOLFJPTEVfVVNFUiJ9.kmupP8B269D-SZemxkTdfdqYQ-vRMF3-nNtsWoi-bbDo5Wk38LbRYYf-sO3ceqZaYursfFIYyI0BR6keuko-4A\n","objectID":"L2hvd3Rvcy8yMDE2LTExLUhvd3RvLUNhbmlnby1KV1Q="},"L2hvd3Rvcy8yMDE3LTAzLVNlY3VyaXR6YXJfRWxhc3RpY1NlYXJjaF9BcGFjaGU=":{"date":1488326400000,"title":"Securitzar accés a Elasticsearch des d'una pàgina web","description":"Securitzar accés a Elasticsearch des d'una pàgina web","section":"howtos","categories":["cloud"],"key":"MARÇ2017","path":"/howtos/2017-03-Securitzar_ElasticSearch_Apache","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells proveïdors d'aplicacions que utilitzin Elasticsearch (ES) i vulguin securitzar la connexió amb l'ES des de navegadors web.\r\n\r\n### Introducció\r\n\r\nEn cas que l'accés a un ES es realitzi directament des del navegador de l'usuari, cal que el client disposi de les credencials d'accés a aquest ES, amb les vulnerabilitats de seguretat que això pot implicar.\r\n\r\nPer evitar-ho es proposa aprovisionar un proxy intermig que sigui qui disposi d'aquestes credencials i així evitar-ne la potencial sostracció.\r\n\r\nEn aquest HowTo expliquem com configurar un Apache 2.2 / 2.4 per a que faci aquesta funció de proxy cap a l'ES.\r\n\r\n### Elasticsearch\r\n\r\nPer aquest howto hem instal·lat mitjançant Docker un [ES] (https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html)\r\n\r\nHem modificat el fitxer \"elasticsearch.yml\" per a configurar el CORS:\r\n\r\n\thttp.host: 0.0.0.0\r\n\r\n\thttp.cors.enabled : true\r\n\t \r\n\thttp.cors.allow-origin : \"*\"\r\n\thttp.cors.allow-methods : OPTIONS, HEAD, GET, POST, PUT, DELETE\r\n\thttp.cors.allow-headers : X-Requested-With,X-Auth-Token,Content-Type, Content-Length\r\n\r\nUna vegada desplegat al accedir a http://localhost:9200 el navegador ens ha de mostrar:\r\n\r\n\t{\r\n\t\tname: \"OOHe2gg\",\r\n\t\tcluster_name: \"docker-cluster\",\r\n\t\tcluster_uuid: \"pzOqu-XkRvGMKM08gcCUVw\",\r\n\t\tversion: {\r\n\t\tnumber: \"5.2.2\",\r\n\t\tbuild_hash: \"f9d9b74\",\r\n\t\tbuild_date: \"2017-02-24T17:26:45.835Z\",\r\n\t\tbuild_snapshot: false,\r\n\t\tlucene_version: \"6.4.1\"\r\n\t},\r\n\t\ttagline: \"You Know, for Search\"\r\n\t}\r\n\t\r\n### Exemple aplicació Angular\r\n\r\nHem utilitzat la [següent aplicació AngularJS] (https://github.com/spalger/elasticsearch-angular-example) per l'accés a l'ES.\r\n\r\nUna vegada seguits els passos pel seu desplegament, accedim amb el navegador al fitxer index.html i ens trobem amb el següent error:\r\n\r\n![](/related/canigo/howto/imatges/20170301.JPG)\r\n\r\nAquest error és degut al fet que tenim l'ES securitzat i no hem especificat les credencials al index.html. Com que precisament és això el que volem evitar, aprovisionem un Apache amb les credencials d'accés a l'ES.\r\n\r\n### Configuració Apache\r\n\r\nPer aquest Howto hem desplegat un Apache amb [Docker] (https://hub.docker.com/r/gencatcloud/httpd/) amb els següents canvis al fitxer httpd.conf:\r\n\r\nHem afegit els següents mòduls:\r\n\t\r\n\tLoadModule headers_module modules/mod_headers.so\r\n\tLoadModule proxy_http_module modules/mod_proxy_http.so\r\n\t\r\nI realitzat la següent configuració per la funcionalitat de proxy cap a l'ES:\r\n\r\n**Apache 2.4**\r\n\r\n\t<Location \"/\">\r\n\t\tRequestHeader set Authorization \"Basic ZWxhc3RpYzpjaGFuZ2VtZQ==\"\r\n\t\tRequire ip 192.168.99.1\r\n\t\tProxyPass        \"http://127.0.0.1:9200/\"\r\n\t\tProxyPassReverse \"http://127.0.0.1:9200/\"\r\n\t</Location>\r\n\t\r\non\r\n* http://127.0.0.1:9200/ és la URL d'accés a l'ES\r\n* 192.168.99.1 és la IP/Host de l'aplicació. En cas d'especificar un domini enlloc d'una IP s'haurà de fer de la següent manera \"Require host <domini>\"\r\n\r\n**Apache 2.2**\r\n\t\r\n\t<Location \"/\">\r\n\t\tRequestHeader set Authorization \"Basic ZWxhc3RpYzpjaGFuZ2VtZQ==\"\r\n\t\t\r\n\t\tOrder deny,allow\r\n\t\tDeny from all\r\n\t\tAllow from 192.168.99.1\r\n\t\t\r\n\t\tProxyPass        \"http://127.0.0.1:9200/\"\r\n\t\tProxyPassReverse \"http://127.0.0.1:9200/\"\r\n\t</Location>\r\n\t\r\n\r\nLes credencials d'accés del nostre ES són (usuari=elastic, password=changeme).\r\n\r\nAquestes credencials s'han d'especificar codificades en BASE64 en la sentència RequestHeader en format \"user:password\":\r\n\r\n\telastic:changeme ---> ZWxhc3RpYzpjaGFuZ2VtZQ==\r\n\t\r\nEn aquest exemple hem afegit per seguretat (whitelist) la sentència **Require ip**. Aquesta sentència permet indicar les IPs per les que el proxy accepta sol·licituds.\r\n\t\r\nModifiquem el index.html per a canviar la url d'accés per a que apunti al proxy:\r\n\r\n\t host: 'http://192.168.99.100:9200' (ES) -->  host: 'http://192.168.99.100' (proxy),\r\n\t \r\nAra al accedir a l'index.html el navegador ens mostrarà correctament l'estat de l'ES:\r\n\r\n![](/related/canigo/howto/imatges/20170302.JPG)\r\n\r\n### Elasticsearch per HTTPS i balancejat\r\n\r\nEn cas que el nostre Elasticsearch només es pugui accedir per HTTPS (Per exemple un Elasticsearch desplegat a Compose) i tingui més d'un node s'ha de modificar la configuració al Apache de la següent manera:\r\n\r\nPrimer de tot afegir el mòdul ssl:\r\n\r\n\tLoadModule ssl_module modules/mod_ssl.so\r\n\tLoadModule proxy_balancer_module modules/mod_proxy_balancer.so\r\n\t\r\n**Apache 2.2**\r\n\r\n\t<VirtualHost *:80>\r\n\r\n\t\tSSLProxyEngine On\r\n\t\t\r\n\t\t<Proxy balancer://mycluster>\r\n\t\t\tBalancerMember https://${ELASTIC_HOSTNAME1}:${ELASTIC_PORT1}/\r\n\t\t\tBalancerMember https://${ELASTIC_HOSTNAME2}:${ELASTIC_PORT2}/\r\n\t\t\t# Set counting algorithm to more evenly distribute work: \r\n\t\t\tProxySet lbmethod=byrequests\r\n\t\t</Proxy>\r\n\t\t\r\n\t\t<Location \"/\">\r\n\t\t\tRequestHeader set Authorization \"Basic ${ELASTIC_CREDENTIALS}\"\r\n\t\t\t\r\n\t\t\tOrder deny,allow\r\n\t\t\tDeny from all\r\n\t\t\tAllow from 192.168.99.1\r\n\t\t\t\r\n\t\t\tProxyPass balancer://mycluster/\r\n\t\t\tProxyPassReverse balancer://mycluster/\r\n\t\t</Location>\r\n\t</VirtualHost>\r\n\t\r\n**Apache 2.4**\r\n\r\n\t<VirtualHost *:80>\r\n\r\n\t\tSSLProxyEngine On\r\n\t\t\r\n\t\t<Proxy balancer://mycluster>\r\n\t\t\tBalancerMember https://${ELASTIC_HOSTNAME1}:${ELASTIC_PORT1}/\r\n\t\t\tBalancerMember https://${ELASTIC_HOSTNAME2}:${ELASTIC_PORT2}/\r\n\t\t\t# Set counting algorithm to more evenly distribute work: \r\n\t\t\tProxySet lbmethod=byrequests\r\n\t\t</Proxy>\r\n\t\t\r\n\t\t<Location \"/\">\r\n\t\t\tRequestHeader set Authorization \"Basic ${ELASTIC_CREDENTIALS}\"\r\n\t\t\t\r\n\t\t\tRequire ip 192.168.99.1\r\n\t\t\t\r\n\t\t\tProxyPass balancer://mycluster/\r\n\t\t\tProxyPassReverse balancer://mycluster/\r\n\t\t</Location>\r\n\t</VirtualHost>\r\n\t\r\nOn $ELASTIC_CREDENTIALS són les credentials en Base64 (De la mateixa manera que a l'exemple HTTP), i $ELASTIC_HOSTNAME1:${ELASTIC_PORT1} , $ELASTIC_HOSTNAME2:${ELASTIC_PORT2} són les dos url de connexió amb Elasticsearch.\r\n","objectID":"L2hvd3Rvcy8yMDE3LTAzLVNlY3VyaXR6YXJfRWxhc3RpY1NlYXJjaF9BcGFjaGU="},"L2hvd3Rvcy8yMDE3LTA0LUJhdGNoLWluc2VydHMtdXBkYXRlcy1jYW5pZ28zMg==":{"date":1491350400000,"title":"Batch inserts/updates a una aplicació Canigó 3.2","description":"Batch inserts/updates a una aplicació Canigó 3.2","section":"howtos","categories":["canigo"],"key":"ABRIL2017","path":"/howtos/2017-04-Batch-inserts-updates-canigo32","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que vulguin realitzar un gran volum d'inserts/updates a una aplicació Canigó 3.2.\n\n### Versió de Canigó\n\nEls pasos descrits en aquest document apliquen a la versió 3.2.x del Framework Canigó.\n\n### Introducció\n\nEn aquest HowTo s'explica com realitzar Batch Inserts amb una aplicació Canigó 3.2. \n\nCanigó 3.2 utilitza el framework Spring Data que proporciona un mètode *save(Iterable entities)* que es pot realitzar per a fer inserts/updates massius, però aquest mètode internament simplement crida al mètode simple *save(S entity)* amb lo qual no hi ha cap benefici de rendiment entre utilitzar aquest mètode o fer diverses crides al mètode *save(S entity)*\n\nPer aquesta raó el mòdul de persistència de Canigó 3.2 proporciona el mètode *bulkSave(Iterable entities)* que optimitza el rendiment quan es realitza un gran volum d'inserts/updates.\n\nAquest Howto es basa en l'aplicació que genera el [plugin de Canigó](/canigo-download-related/plugin-canigo)\n\n### EquipamentService\n\nA la classe EquipamentService creem dos mètodes, SaveIterable amb el qual realitzarem una inserció massiva utilitzant el mètode proporcionat per Spring Data, i un altre mètode saveBatch utilitzant el mètode proporcionat pel mòdul de persitència de Canigó 3.2\n\n**saveIterable**\n\n\tpublic void saveIterable (){\n\t\t\n\t\tList<Equipament> equipaments = new ArrayList<Equipament>();\n\t\t\n\t\tfor (int i = 0; i < 250000; i++){\n\n\t\t\tEquipament e = new Equipament();\n\t\t\te.setMunicipi(\"Municipi\" + System.currentTimeMillis());\n\t\t\te.setNom(\"Nom\" + System.currentTimeMillis());\n\t\t\t\n\t\t\tequipaments.add(e);\n\t\t\t\n\t\t\tif (i % BATCH_SIZE == 0) {\n\t\t\t\trepository.save(equipaments);\n\t\t\t\tequipaments.clear();\n\t\t\t}\n\t\t}\n\t\t\n\t\trepository.save(equipaments);\n\t}\n\t\n**saveBatch**\n\n\tpublic void saveBatch (){\n\t\t\n\t\tList<Equipament> equipaments = new ArrayList<Equipament>();\n\t\t\n\t\tfor (int i = 0; i < 250000; i++){\n\n\t\t\tEquipament e = new Equipament();\n\t\t\te.setMunicipi(\"Municipi\" + System.currentTimeMillis());\n\t\t\te.setNom(\"Nom\" + System.currentTimeMillis());\n\t\t\t\n\t\t\tequipaments.add(e);\n\t\t\t\n\t\t\tif (i % BATCH_SIZE == 0) {\n\t\t\t\trepository.bulkSave(equipaments);\n\t\t\t\tequipaments.clear();\n\t\t\t}\n\t\t}\n\t\t\n\t\trepository.save(equipaments);\n\t}\n\t\nTots dos mètodes el que fan és inserir a BBDD 250.000 registres en blocs de 50.\n\n\tprivate static final int BATCH_SIZE = 50;\n\n### ResultBatchDTO\n\nCreem un DTO per a mostrar el resultat de tots dos mètodes:\n\n\tpackage cat.gencat.plantillarest.model.dto;\n\n\timport java.io.Serializable;\n\n\tpublic class ResultBatchDTO implements Serializable{\n\n\t\tprivate static final long serialVersionUID = 1L;\n\n\t\tprivate Long tempsSaveIterable;\n\t\t\n\t\tprivate Long tempsBulkSave;\n\t\t\n\t\tpublic ResultBatchDTO() {\n\t\t\t\n\t\t}\n\n\t\tpublic Long getTempsSaveIterable() {\n\t\t\treturn tempsSaveIterable;\n\t\t}\n\n\t\tpublic void setTempsSaveIterable(Long tempsSaveIterable) {\n\t\t\tthis.tempsSaveIterable = tempsSaveIterable;\n\t\t}\n\n\t\tpublic Long getTempsBulkSave() {\n\t\t\treturn tempsBulkSave;\n\t\t}\n\n\t\tpublic void setTempsBulkSave(Long tempsBulkSave) {\n\t\t\tthis.tempsBulkSave = tempsBulkSave;\n\t\t}\n\t\t\n\t}\n\n### EquipamentServiceController\n\nAl nostre endpoint creem un mètode que fa la crida als mètodes que hem creat a la classe EquipamentService:\n\n\t @RequestMapping(value = \"/bulk\", method = RequestMethod.POST)\n\t public ResponseEntity<ResultBatchDTO> bulk()  {\n\t\t \n\t\t ResultBatchDTO result = new ResultBatchDTO();\n\t\t \n\t\t long inici = System.currentTimeMillis();\n\t\t equipamentService.saveIterable();\n\t\t long fi = System.currentTimeMillis();\n\t\t \n\t\t long temps = (fi-inici) / 1000;\n    \t\n\t\t result.setTempsSaveIterable(temps);\n\t\t \n\t\t inici = System.currentTimeMillis();\n\t\t equipamentService.saveBatch();\n\t\t fi = System.currentTimeMillis();\n\t\t \n\t\t temps = (fi-inici) / 1000;\n\t\t \n\t\t result.setTempsBulkSave(temps);\n\t\t \n\t\t return new ResponseEntity<ResultBatchDTO>(result, HttpStatus.OK);\n    }\n\t\nAquest mètode el que fa es fer la crida als dos mètodes i ens retorna el temps que ha trigat cada mètode en fer els 250.000 inserts.\n\n### Resultat\n\nDespleguem l'aplicació i utilitzant Swagger executem el mètode bulk amb el següent resultat\n\n![](/related/canigo/howto/imatges/20170401.jpg)\n\nCom es pot veure el temps amb el mètode de Spring Data és de 427 segons, mentres que el mètode optimitzat proporcionat per Canigó 3.2 ha trigat 19 segons","objectID":"L2hvd3Rvcy8yMDE3LTA0LUJhdGNoLWluc2VydHMtdXBkYXRlcy1jYW5pZ28zMg=="},"L2hvd3Rvcy8yMDE3LTA1LUhvd3RvLUNvbm5lY3Rhcl9ub2RlanNfYW1iX21vbmdvX3NzbA==":{"date":1493596800000,"title":"Connectar amb un cluster MongoDB per SSL en una aplicació NodeJS","description":"Connectar amb un cluster MongoDB per SSL en una aplicació NodeJS","section":"howtos","categories":["canigo"],"key":"MAIG2017","path":"/howtos/2017-05-Howto-Connectar_nodejs_amb_mongo_ssl","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells perfils tècnics que tinguin la necessitat de connectar-se amb un cluster MongoDB que requereixi SSL des d'una aplicació NodeJS.\r\n\r\n### Introducció\r\n\r\nLes connexions entre les aplicacions i les base de dades MongoDB haurien de realitzar-se amb connexió segura (SSL), sobretot en el cas que la base de dades estigui a cloud públic. En aquest how-to s'explica com fer-ho a una aplicació NodeJS.\r\n\r\n### Obtenir certificat\r\n\r\nEl primer pas és obtenir el certificat (ja sigui autosignat o emès per una entitat de confiança com Verisign) del proveïdor de la base de dades.\r\n\r\n### [MongoClient](https://www.mongoclient.com/)\r\n\r\nÉs el connector oficial al qual dóna suport [MongoDB](https://www.mongodb.com/), i correspon al paquet 'mongodb' de NodeJS.\r\n\r\nExemple:\r\n\r\n\tvar MongoClient = require('mongodb').MongoClient\r\n\t\t, format = require('util').format;\r\n\r\n\tvar fs = require('fs');\r\n\t\t\r\n\tvar caFile = fs.readFileSync(__dirname + '/mongodbcert.crt');\r\n\t\t\r\n\tMongoClient.connect('mongodb://user:password@host:port/db', \r\n\t\t{ \tmongos: {\r\n\t\t\t\tssl: true,\r\n\t\t\t\tsslValidate: true,\r\n\t\t\t\tsslCA: caFile,\r\n\t\t\t\tpoolSize: 1,\r\n\t\t\t\treconnectTries: 1\r\n\t\t\t}\r\n\t\t}\r\n\t\t,function (err, db) {\r\n\t\t\tif (err) {\r\n\t\t\t\tthrow err;\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"successfully connected to the database\");\r\n\t\t\t}\r\n\t\tdb.close();\r\n\t});\r\n\t\r\nA la variable caFile es carrega el certificat, i l'afegim com a paràmetre **sslCA** a Mongoclient.connect.\r\n\r\nPer a configurar l'accés SSL és necessari afegir també les propietats **ssl** i **sslValidate** amb valor \"true\".\r\n\t\r\n### [Mongoose](http://mongoosejs.com/)\r\n\r\nEl paquet 'mongoose', el qual permet treballar amb un model orientat a objectes, també és vàlid i suportat per la comunitat.\r\n\r\nExemple:\r\n\r\n\tconst mongoose = require('mongoose');\r\n\tconst fs = require('fs');\r\n\r\n\tconst mongoOpt = {\r\n\t\t\t  \"server\": {\r\n\t\t\t\t\"auto_reconnect\": true,\r\n\t\t\t\t\"reconnectTries\": 1,\r\n\t\t\t\t\"socketOptions\": {\r\n\t\t\t\t  \"keepAlive\": 1,\r\n\t\t\t\t  \"connectTimeoutMS\": 30000\r\n\t\t\t\t}\r\n\t\t\t  },\r\n\t\t\t  \"mongos\": {\r\n\t\t\t\t\"ssl\": true,\r\n\t\t\t\t\"sslValidate\": true,\r\n\t\t\t\t\"sslCA\": fs.readFileSync(__dirname + '/mongodbcert.crt')\r\n\t\t\t  }\r\n\t\t\t};\r\n\r\n\tmongoose.connect('mongodb://user:password@host:port/db', mongoOpt);\r\n\r\n\tvar db = mongoose.connection;\r\n\tdb.on('error', function(err) {\r\n\t\tconsole.error('Error in MongoDB connection: ' + err);\r\n\t\tmongoose.disconnect();\r\n\t});\r\n\r\n\tdb.on('connected', function() {\r\n\t\tconsole.log('Connexió amb el servidor de BBDD');\r\n\t\tmongoose.disconnect();\r\n\t});\r\n\r\nQuan es realitza la connexió, al paràmetre d'opcions (mongoOpt) s'han d'afegir les propietats **ssl** i **sslValidate** a \"true\" i **sslCA** amb el fitxer corresponent al certificat.\r\n","objectID":"L2hvd3Rvcy8yMDE3LTA1LUhvd3RvLUNvbm5lY3Rhcl9ub2RlanNfYW1iX21vbmdvX3NzbA=="},"L2hvd3Rvcy8yMDE3LTA3LUhvd3RvLUNvbmZpZ3VyYXItZW50b3JuLXRyZWJhbGw=":{"date":1498003200000,"title":"Configurar l'entorn de treball per a GIT al SIC 2.0","description":"Us donem unes guies bàsiques per configurar l'entorn de treball amb GIT per treballar amb el SIC 2.0","section":"howtos","categories":["sic"],"key":"JULIOL2017","path":"/howtos/2017-07-Howto-Configurar-entorn-treball","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors que comencin a treballar amb el SIC 2.0 i necessitin crear-se l'entorn de desenvolupament.\n\n### Introducció\n\nAmb el SIC 2.0 s'ha incorporat el nou sistema de gestió de codi font: GIT. Amb GIT \n\nCanigó 3.2 incorpora JPA 2.1 i Hibernate 5.0 com a proveïdor. IBM Wesphere 8.5.5 només dóna suport a JPA 2.0 incloent com a proveïdor OpenJPA 2.4. Degut a aquesta incompatibilitat, s'han de realitzar certes modificacions a les aplicacions Canigó per a poder ser desplegades a WebSphere 8.5.5.\n\nEn aquest HowTo es parteix de l'aplicació plantilla de Canigó que genera el [plugin d'Eclipse] (/canigo-download-related/plugin-canigo/).\n\n### Modificar el pom.xml\n\nS'ha de realitzar l'exclusió al mòdul de Spring Boot de **spring-boot-starter-tomcat**:\n\n\t<dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-web</artifactId>\n      <exclusions>\n        <exclusion>\n          <artifactId>spring-boot-starter-logging</artifactId>\n          <groupId>org.springframework.boot</groupId>\n        </exclusion>\n        <exclusion>\n          <artifactId>spring-boot-starter-tomcat</artifactId>\n          <groupId>org.springframework.boot</groupId>\n        </exclusion>\n      </exclusions>\n    </dependency>\n\nS'ha de realitzar l'exclusió de la llibreria **xml-apis** del mòdul spring-boot-starter-data-jpa:\n\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-data-jpa</artifactId>\n      <exclusions>\n        <exclusion>\n          <artifactId>spring-boot-starter-logging</artifactId>\n          <groupId>org.springframework.boot</groupId>\n        </exclusion>\n        <exclusion>\n          <artifactId>xml-apis</artifactId>\n          <groupId>xml-apis</groupId>\n        </exclusion>\n      </exclusions>\n    </dependency>\n\n### Implementació de PersistenceProviderResolver\n\nPer aconseguir que la nostra aplicació resolgui com a proveïdor de JPA HibernatePersistenceProvider, i no OpenJPA, hem d'implementar la nostra pròpia classe PersistenceProviderResolver. Un cop implementada, hem de fer que la nostra aplicació l'utilitzi registrant-la abans de realitzar la inicialització del mòdul de persistència.\n\nPer fer això hem creat el paquet \"cat.gencat.provawebsphere.websphere\" a l'aplicació i creat el fitxer HibernatePersistenceProviderResolver.java amb el següent codi:\n\n\tpackage cat.gencat.provawebsphere.websphere;\n\n\timport org.hibernate.jpa.HibernatePersistenceProvider;\n\timport org.slf4j.Logger;\n\timport org.slf4j.LoggerFactory;\n\n\timport javax.persistence.spi.PersistenceProvider;\n\timport javax.persistence.spi.PersistenceProviderResolver;\n\timport javax.persistence.spi.PersistenceProviderResolverHolder;\n\timport java.util.Collections;\n\timport java.util.List;\n\n\tpublic class HibernatePersistenceProviderResolver implements PersistenceProviderResolver {\n\t\t\n\t\t/** Logger  */  \n\t\tprivate static final Logger logger = LoggerFactory.getLogger(HibernatePersistenceProviderResolver.class);\n\t\t\n\t\tprivate volatile PersistenceProvider persistenceProvider = new HibernatePersistenceProvider();\n\n\t\t@Override\n\t\tpublic List<PersistenceProvider> getPersistenceProviders() {\n\t\t\treturn Collections.singletonList(persistenceProvider);\n\t\t}\n\n\t\t@Override\n\t\tpublic void clearCachedProviders() {\n\t\t\tpersistenceProvider = new HibernatePersistenceProvider();\n\t\t}\n\n\t\tpublic static void register() {\n\t\t\tlogger.debug(\"Registering HibernatePersistenceProviderResolver\");\n\t\t\tPersistenceProviderResolverHolder.setPersistenceProviderResolver(new HibernatePersistenceProviderResolver());\n\t\t}\n\t}\n\t\nPer assegurar que registrem el nostre proveïdor de JPA a l'inici de l'aplicació, abans de la creació de qualsevol altre bean de Spring, creem la classe PreInitializer amb el següent codi:\n\n\tpackage cat.gencat.provawebsphere.websphere;\n\n\timport org.springframework.beans.BeansException;\n\timport org.springframework.beans.factory.config.BeanFactoryPostProcessor;\n\timport org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\n\timport org.springframework.core.Ordered;\n\timport org.springframework.core.PriorityOrdered;\n\n\t \n\tpublic class PreInitializer implements BeanFactoryPostProcessor, PriorityOrdered {  \n\t\t @Override  \n\t\t public int getOrder() {  \n\t\t  return Ordered.HIGHEST_PRECEDENCE;  \n\t\t }  \n\t\t @Override  \n\t\t public void postProcessBeanFactory(  \n\t\t   ConfigurableListableBeanFactory beanFactory) throws BeansException {  \n\t\t\t HibernatePersistenceProviderResolver.register();\n\t\t }  \n\t} \n\nAl fitxer \"Application.java\" hem de crear el bean per la classe PreInitializer per a que es faci el registre:\n\n\t@Bean\n    public PreInitializer preInitializer() {\n\t\treturn new PreInitializer();\n    }\n\n### Definició entitats a \"persistence.xml\"\n\nAl fitxer de persistència hem de definir totes les entitats que tingui l'aplicació. En la plantilla que utilitza aquest HowTo només hi ha l'entitat Equipament:\n\n<persistence xmlns=\"http://java.sun.com/xml/ns/persistence\"\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd\"\n\tversion=\"1.0\">\n\n\t<persistence-unit name=\"canigo\" transaction-type=\"RESOURCE_LOCAL\">\n\t\t\t<class>cat.gencat.provawebsphere3.model.Equipament</class>  \n\t</persistence-unit>\n\n</persistence>\n\n### Configuració a WebSphere\n\nUna vegada configurada la nostra aplicació a la consola web d'administració de WebSphere, abans d'iniciar-la, seleccionar la nostra aplicació, anar a \"Cargador de clases\" i seleccionar els següents valors:\n\n**Clases cargadas con el cargador local primero (padre último)**\n\n**Cargador de clases único para la aplicación**\n\n![](/related/canigo/howto/imatges/20170501.jpg)\n\nSeguint aquestes instruccions l'aplicació plantilla de Canigó 3.2 haurà estat desplegada de forma satisfactòria a WebSphere 8.5.5.\n","objectID":"L2hvd3Rvcy8yMDE3LTA3LUhvd3RvLUNvbmZpZ3VyYXItZW50b3JuLXRyZWJhbGw="},"L2hvd3Rvcy8yMDE3LTA3LUhvd3RvLU1pZ3Jhci1yZXBvc2l0b3JpLVNWTi1hLXJlcG9zaXRvcmktR0lU":{"date":1498867200000,"title":"Migrar repositori SVN a repositori Git del SIC","description":"Migrar repositori SVN a repositori Git del SIC","section":"howtos","categories":["sic"],"key":"JULIOL2017","path":"/howtos/2017-07-Howto-Migrar-repositori-SVN-a-repositori-GIT","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells Release Manager que vulguin migrar el codi del repositori SVN del SIC al Git del SIC.\r\n\r\n### Introducció\r\n\r\nAquest HowTo té la finalitat de proporcionar una guía per a realitzar la migració de codi de SVN a Git. Aquest és el nou SCM que es possa a disposició dels proveïdors d'aplicacions des del [SIC 2.0] (/noticies/2017-06-07-SIC-SIC_2.0/).\r\n\r\n### Prerrequisits\r\n\r\n* Utilitzar un sistema operatiu Linux i tenir instal·lats els paquets git, git-svn i svn.\r\n* El **repositori a migrar no pot contenir binaris** (.jar, .war, .ear, .dll, .exe, carpeta \"node_modules\") **ni arxius de mida superior a 20 MB**.\r\n\r\n<p style=\"color: #CC0000;font-weight: bold\"> Advertència: Des del SIC recomanem no utilitzar els dos repositoris (l'original al SVN i el migrat al Git) alhora. Un cop s'hagi realitzat la migració i es comprovi que s'ha realitzat correctament, cal utilitzar el nou repositori del Git.</p>  \r\n\r\n#### Per a repositoris amb binaris\r\n\r\nEl Git del SIC té restriccions alhora de pujar fitxers binaris, fet que pot provocar errors en el procés de migració. Aquests repositoris que tinguin binaris no es podran migrar al Git, romandran en el SVN en mode lectura. Per aquests casos, per començar a treballar amb Git s'haurien de seguir els següents pasos:\r\n\r\n* Descarregar el darrer tag del SVN\r\n* Eliminar els binaris. Podem tenir dos casos:\r\n\t- binaris prescindibles: es poden generar a partir de codi font de l'aplicació, i per tant, no cal conservar-los\r\n\t-  binaris no prescindibles: s'han d'ubicar en el [repositori de binaris](https://bin.sic.intranet.gencat.cat/) o al [Nexus](https://hudson.intranet.gencat.cat/nexus/) del SIC. Per a més informació veure aquesta [notícia](http://canigo.ctti.gencat.cat/noticies/2017-07-05-SIC-Gestio-binaris/).\r\n* Inicialitzar el repositori Git local (git init)\r\n* Fer el commit, push i tag d'aquesta versió inicial al Git\r\n\r\nUn cop finalitzat aquest procés al Git es dispossarà del tag més recent. L'històric es mantindrà al SVN en mode lectura.\r\n\r\n### Obtenir els autors\r\n\r\nPrimer de tot, s'ha d'obtenir quí ha modificat els arxius del SVN. Per fer això s'ha preparat un [job de Jenkins] (https://hudson.intranet.gencat.cat/hudson/job/MIGRACIO_GENERAR_AUTORS/).\r\n\r\nS'ha d'executar aquest job informant els següents paràmetres:\r\n\r\n\tDEPARTAMENT -> acrònim del departament (En una ruta com http://svn.intranet.gencat.cat/ctt/0192/) seria ctt )\r\n\tCODI_DIALEG -> codi de diàleg (Per exemple 0192)\r\n\r\nUna vegada executat el job envia per email el fitxer author.txt a l'usuari que ha executat el job.\r\n\r\nS'ha de descarregar i desar el fitxer a la carpeta desitjada, en aquest howto /migracio.\r\n\r\nA més d'obtenir el fitxer author.txt, s'ha de descarregar el següent [fitxer] (/related/sic/howto/unknown_author.zip) i descomprimir-lo en la mateixa carpeta (/migracio). Aquest zip conté un procès per a evitar errors en el següent pas.\r\n\r\n### Obtenir les dades del SVN\r\n\r\nPer a obtenir les dades del SVN que s'han de migrar, dintre de la carpeta /migracio (on es troba el fitxer author.txt) executar:\r\n\r\n\tgit svn clone --authors-file=author.txt --authors-prog=unknown_author.sh http://svn.intranet.gencat.cat/$1/$2/$3 --no-metadata -s $4\r\n\r\nOn s'ha de substituir les variables segons:\r\n\r\n\t$1 -> acrònim del departament (En una ruta com http://svn.intranet.gencat.cat/ctt/0192/) seria ctt )\r\n\t$2 -> codi de diàleg (Per exemple 0192)\r\n\t$3 -> path de la carpeta que conté les carpetes tags, trunk i branches. En cas que estiguin a l'arrel no posar res.\r\n\t$4 -> nom de la carpeta que es crea al sistema de fitxers locals on es deixa el codi\r\n\r\n### Tractament del codi SVN\r\n\r\nAccedir a la carpeta que s'ha creat en el punt anterior ($4) i abans de pujar el codi a Git executar les següents comandes:\r\n\r\n\tcp -Rf .git/refs/remotes/origin/tags/* .git/refs/tags/\r\n\trm -Rf .git/refs/remotes/origin/tags\r\n\tcp -Rf .git/refs/remotes/* .git/refs/heads/\r\n\trm -Rf .git/refs/remotes\r\n\tfor i in $(ls .git/refs/tags/ -1 | grep '@'); do rm \".git/refs/tags/$i\"; done\r\n\t\r\n\r\n### Crear projecte en Git\r\n\r\nPer a crear el projecte en Git heu d'accedir a https://git.intranet.gencat.cat/ anar al grup del vostre codi de diàleg i prémer **New Project**\r\n\r\n### Pujar el codi a Git\r\n\r\nA la carpeta on s'ha desat el codi del SVN executar:\r\n\r\n\tgit remote add origin https://$1@git.intranet.gencat.cat/$2/$3.git\r\n\r\nOn s'ha de substituir les variables segons:\r\n\r\n\t$1 -> usuari GitLab\r\n\t$2 -> codi de diàleg (Per exemple 0192)\r\n\t$3 -> Nom del projecte de GitLab\r\n\r\nPer finalitzar es puja el codi a Git\r\n\r\n\tgit push origin --all\r\n\tgit push --tags\r\n\t\r\nÉs molt important analitzar el log que mostra Git per pantalla per assegurar que no hi ha errors i s'han migrat tant el trunk com tots els tags.\r\n\r\n### Establir mode lectura en el repositori SVN\r\n\r\nUn cop finalitzat el procés de migració és necessari demanar a l'equip del SIC, via petició a SAU Remedy al servei \"FRAMEWORK SIC\" o mail a la [Bústia de la Oficina Tècnica](mailto:oficina-tecnica.canigo.ctti@gencat.cat), que estableixi permisos només de lectura pel repositori. D'aquesta manera ens assegurem que només es faran modificacions en el Git.\r\n\r\nUs recordem que el 6 de novembre de 2017 el SVN del SIC passarà a mode de només lectura. Us animem a realitzar aquesta migració quant abans millor. Per a més informació sobre aquest i altres esdeveniments, podeu consultar el [RoadMap de l'Oficina Tècnica Canigó](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).\r\n","objectID":"L2hvd3Rvcy8yMDE3LTA3LUhvd3RvLU1pZ3Jhci1yZXBvc2l0b3JpLVNWTi1hLXJlcG9zaXRvcmktR0lU"},"L2hvd3Rvcy8yMDE3LTA4LUhvd3RvLUFjdHVhbGl0emFjaW9fQ2FuaWdvM18xX0NhbmlnbzNfMg==":{"date":1501804800000,"title":"Actualització Canigó 3.1 a Canigó 3.2","description":"Com realitzar l'actualització d'una aplicació de Canigó 3.1 a Canigó 3.2","section":"howtos","categories":["canigo"],"key":"JULIOL2017","path":"/howtos/2017-08-Howto-Actualitzacio_Canigo3_1_Canigo3_2","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells usuaris que vulguin fer l'actualització a Canigó 3.2 de la seva aplicació Canigó 3.1\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.1 del Framework Canigó\r\n\r\n### Introducció\r\n\r\nEl passat mes de Març s'ha publicat la versió 3.2 del Framework Canigó. Aquesta versió és una [versió LTS](/noticies/2017-07-05-Canigo-LTS/), i es recomana actualitzar les aplicacions Canigó a aquesta versió per tal de tenir un suport continuat així com la màxima estabilitat que proporciona una versió LTS.\r\n\r\nL'objectiu d'aquest Howto és mostrar els procediments necessaris per a realitzar l'actualització d'una aplicació realitzada amb Canigó 3.1. El punt de partida d'aquest Howto és una aplicació creada amb el plugin de Canigó per Eclipse.\r\n\r\n## Aplicació REST\r\n\r\n### Configuració de dependències\r\n\r\nA la [matriu de compatibilitats] (/canigo-download-related/matrius-compatibilitats) es poden veure les versions dels mòduls i components de Canigó de les versions 3.1.x i 3.2.x. S'han d'actualitzar els intervals dels mòduls utilitzats per a migrar a Canigó 3.2.\r\n\r\nEn cas de tenir alguna dependència de Spring al POM de l'aplicació s'ha d'actualitzar a la versió \"4.3.4.RELEASE\"\r\n\r\nEn cas de tenir la llibreria Xerces com a dependència s'ha d'actualitzar a la versió 2.11.0:\r\n\r\n\t\t<dependency>\r\n\t\t    <groupId>xerces</groupId>\r\n\t\t    <artifactId>xercesImpl</artifactId>\r\n\t\t    <version>2.11.0</version>\r\n\t\t</dependency>\r\n\t\t\r\nS'ha d'afegir la dependència al nou mòdul \"canigo.web.rs\":\r\n\t\r\n\t<canigo.web.rs.version>1.0.0</canigo.web.rs.version>\r\n\t...\r\n\t<dependency>\r\n\t\t<groupId>cat.gencat.ctti</groupId>\r\n\t\t<artifactId>canigo.web.rs</artifactId>\r\n\t\t<version>${canigo.web.rs.version}</version>\r\n\t</dependency>\r\n\t\r\nEls filtres *UrlRewriteFilter* i *LocalizationFilter* ja no es troben disponibles al mòdul \"canigo.web.core\". En cas de tenir la necessitat d'utilitzar-los s'ha d'afegir la dependència amb el mòdul \"canigo.web.jsf\":\r\n\r\n\t<dependency>\r\n\t\t<groupId>cat.gencat.ctti</groupId>\r\n\t\t<artifactId>canigo.web.jsf</artifactId>\r\n\t\t<version>${canigo.web.jsf.version}</version>\r\n\t\t<exclusions>\r\n\t\t\t<exclusion>\r\n\t\t\t\t<groupId>com.sun.faces</groupId>\r\n\t\t\t\t<artifactId>jsf-api</artifactId>\r\n\t\t\t</exclusion>\r\n\t\t\t<exclusion>\r\n\t\t\t\t<groupId>com.sun.faces</groupId>\r\n\t\t\t\t<artifactId>jsf-impl</artifactId>\r\n\t\t\t</exclusion>\r\n\t\t\t<exclusion>\r\n\t\t\t\t<groupId>javax.el</groupId>\r\n\t\t\t\t<artifactId>javax.el-api</artifactId>\r\n\t\t\t</exclusion>\r\n\t\t\t<exclusion>\r\n\t\t\t\t<groupId>com.sun.facelets</groupId>\r\n\t\t\t\t<artifactId>jsf-facelets</artifactId>\r\n\t\t\t</exclusion>\r\n\t\t</exclusions>\r\n\t</dependency>\r\n\t\r\nCom que l'aplicació no és JSF, es pot excloure les llibreries JSF del mòdul..\r\n\r\n### Servei de Logs\r\n\r\nEn Canigó 3.2 s'utilitza Log4j2 en comptes de Log4j. [S'han d'eliminar els fitxers log4j.xml de l'aplicació i substituir-los per log4j2.xml](https://logging.apache.org/log4j/2.x/manual/migration.html)\r\n\r\nPer exemple el següent fitxer log4j.xml\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n\t<!DOCTYPE log4j:configuration PUBLIC \"-//APACHE//DTD LOG4J//EN\" \"http://logging.apache.org/log4j/docs/api/org/apache/log4j/xml/log4j.dtd\">\r\n\r\n\t<log4j:configuration xmlns:log4j='http://jakarta.apache.org/log4j/'\r\n\t\tdebug=\"true\">\r\n\r\n\t\t<!-- Architecture appender -->\r\n\t\t<appender name=\"file\" class=\"org.apache.log4j.DailyRollingFileAppender\">\r\n\t\t\t<param name=\"DatePattern\" value=\"'.'yyyyMMdd\" />\r\n\t\t\t<param name=\"File\" value=\"/tmp/canigo.log\" />\r\n\t\t\t<param name=\"Append\" value=\"true\" />\r\n\t\t\t<layout class=\"org.apache.log4j.PatternLayout\">\r\n\t\t\t\t<param name=\"ConversionPattern\" value=\"canigo Message: %d{dd MMM yyyy HH:mm:ss,SSS} %-5p [%t] %c - %m%n - %X{APPID}\" />\r\n\t\t\t</layout>\r\n\t\t</appender>\r\n\t\t<appender name=\"console\" class=\"org.apache.log4j.ConsoleAppender\">\r\n\t\t\t<layout class=\"org.apache.log4j.PatternLayout\">\r\n\t\t\t\t<param name=\"ConversionPattern\" value=\"canigo Message: %d{dd MMM yyyy HH:mm:ss,SSS} %-5p [%t] %c - %m%n - %X{APPID}\" />\r\n\t\t\t</layout>\r\n\t\t</appender>\r\n\t\t<category name=\"cat.gencat.ctti\">\r\n\t\t\t<appender-ref ref=\"file\" />\r\n\t\t\t<appender-ref ref=\"console\" />\r\n\t\t</category>\r\n\t\t<root>\r\n\t\t\t<level value=\"debug\" />\r\n\t\t</root>\r\n\t</log4j:configuration>\r\n\t\r\nEs convertiria en el següent fitxer log4j2.xml\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t<Configuration>\r\n\t\t<Appenders>\r\n\t\t\t<RollingFile name=\"DAILY_LOG\" fileName=\"/tmp/canigo.log\" filePattern=\"tmp/%d{ddMMyyyy}_canigo.log\" append=\"true\">\r\n\t\t\t\t<PatternLayout pattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\"/>\r\n\t\t\t\t<Policies>\r\n\t\t\t\t\t<TimeBasedTriggeringPolicy interval=\"1\"/>\r\n\t\t\t\t</Policies>                               \r\n\t\t\t</RollingFile>\r\n\t\t\t<Console name=\"STDOUT\" target=\"SYSTEM_OUT\">\r\n\t\t\t\t<PatternLayout\r\n\t\t\t\t\tpattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\" />\r\n\t\t\t</Console>\r\n\t\t</Appenders>\r\n\t\t<Loggers>\r\n\t\t\t<Logger name=\"cat.gencat.ctti\" level=\"debug\" additivity=\"false\">\r\n\t\t\t\t<AppenderRef ref=\"DAILY_LOG\" />\r\n\t\t\t\t<AppenderRef ref=\"STDOUT\" />\r\n\t\t\t</Logger>\r\n\t\t\t<Root level=\"debug\">\r\n\t\t\t\t<AppenderRef ref=\"DAILY_LOG\" />\r\n\t\t\t\t<AppenderRef ref=\"STDOUT\" />\r\n\t\t\t</Root>\r\n\t\t</Loggers>\r\n\t</Configuration>\r\n\r\nTambé s'ha de substituïr la forma de realitzar el logging a les nostres classes de l'aplicació. A Canigó 3.1 el procediment era el següent:\r\n\r\n\t...\r\n\timport org.apache.commons.logging.Log;\r\n\timport org.apache.commons.logging.LogFactory;\r\n\t...\r\n\tprivate static final Log logger = LogFactory.getLog(MyClass.class);\r\n\t...\r\n\tlogger.debug(\"Això és un log\");\r\n\t...\r\n\t\r\nA Canigó 3.2 el procediment ha de ser el següent:\r\n\r\n\t...\r\n\timport org.slf4j.Logger;\r\n\timport org.slf4j.LoggerFactory;\r\n\t...\r\n\tprivate static final Logger logger = LoggerFactory.getLogger(MyClass.class);\r\n\t...\r\n\tlogger.debug(\"Això és un log\");\r\n\t\r\n### Esquemes de Spring\r\n\r\nA banda d'assegurar-se que totes les llibreries que Spring tinguin el mateix versionatge \"4.3.4.RELEASE\" (cal tenir en compte que hi ha llibreries de Spring amb el seu propi versionatge, en aquest cas ens hem d'assegurar que disposem de la versió compatible amb la 4.3.4.RELEASE del core de Spring) hem d'actualitzar els esquemes XSD dels fitxers de configuració a la versió 4.3.\r\n\r\nL'esquema XSD de Spring Security ha d'actualitzar-se a la versió 4.1.\r\n\r\nPer exemple, el fitxer app-custom-security.xml quedaria amb la següent capçalera:\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t<beans  xmlns=\"http://www.springframework.org/schema/beans\"\r\n\t\t\txmlns:security=\"http://www.springframework.org/schema/security\"\r\n\t\t\txmlns:context=\"http://www.springframework.org/schema/context\"\r\n\t\t\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \r\n\t\t\txmlns:jdbc=\"http://www.springframework.org/schema/jdbc\"\r\n\t\t\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \thttp://www.springframework.org/schema/beans/spring-beans-4.3.xsd\r\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/context \thttp://www.springframework.org/schema/context/spring-context-4.3.xsd\r\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/security \thttp://www.springframework.org/schema/security/spring-security-4.1.xsd\r\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/jdbc \t\thttp://www.springframework.org/schema/jdbc/spring-jdbc-4.3.xsd\">\r\n\r\n### Dispatcher-servlet\r\n\r\nA la versió 4.3.4 de Spring la propietat *mediaTypes* del bean ContentNegotiatingViewResolver ja no és modificable. En aquesta versió *ContentNegotiatingViewResolver* delega en l'objecte *ContentNegotiationManager* la gestió d'aquesta propietat:\r\n\r\nAl fitxer \"dispatcher-servlet.xml\" s'ha de substituir el bean actual:\r\n\r\n\t<bean class=\"org.springframework.web.servlet.view.ContentNegotiatingViewResolver\">\r\n\t\t<property name=\"order\" value=\"1\" />\r\n\t\t<property name=\"mediaTypes\">\r\n\t\t\t<map>\r\n\t\t\t\t<entry key=\"json\" value=\"application/json\" />\r\n\t\t\t</map>\r\n\t\t</property>\r\n\t\t<property name=\"defaultViews\">\r\n\t\t\t<list>\r\n\t\t\t\t<bean class=\"org.springframework.web.servlet.view.json.MappingJackson2JsonView\" />\r\n\t\t\t</list>\r\n\t\t</property>\r\n\t</bean>\r\n\t\r\nPer:\r\n\r\n\t<bean id=\"contentNegotiationManager\"  class=\"org.springframework.web.accept.ContentNegotiationManagerFactoryBean\">\r\n        \t<property name=\"favorPathExtension\" value=\"true\" />\r\n        \t<property name=\"ignoreAcceptHeader\" value=\"true\"/>\r\n\r\n\t\t<property name=\"mediaTypes\">\r\n\t\t    <map>\r\n\t\t\t<entry key=\"json\" value=\"application/json\"/>\r\n\t\t   </map>\r\n\t\t</property>\r\n   \t</bean>\r\n\t\r\n\t<bean class=\"org.springframework.web.servlet.view.ContentNegotiatingViewResolver\">\r\n\t\t<property name=\"order\" value=\"1\" />\r\n\t\t<property name=\"contentNegotiationManager\" ref=\"contentNegotiationManager\"/>\r\n\t\t<property name=\"defaultViews\">\r\n\t\t\t<list>\r\n\t\t\t\t<bean class=\"org.springframework.web.servlet.view.json.MappingJackson2JsonView\" />\r\n\t\t\t</list>\r\n\t\t</property>\r\n\t</bean>\r\n\t\r\n## Aplicació JSF\r\n\r\n### Configuració de dependències\r\n\r\nA la [matriu de compatibilitats] (/canigo-download-related/matrius-compatibilitats) es poden veure les versions dels mòduls i components de Canigó de les versions 3.1.x i 3.2.x. S'han d'actualitzar els intervals dels mòduls utilitzats per a migrar a Canigó 3.2.\r\n\r\nEn cas d'utilitzar el mòdul \"canigo.operation.instrumentation\", l'última versió d'aquest mòdul és només per a aplicacions REST. S'ha de treure la dependència a aquest mòdul i afegir la dependència al nou mòul \"canigo.operation.instrumentation.jsf\":\r\n\r\n\t<dependency>\r\n\t      <groupId>cat.gencat.ctti</groupId>\r\n\t      <artifactId>canigo.operation.instrumentation.jsf</artifactId>\r\n\t      <version>${canigo.operation.instrumentation.jsf}</version>\r\n    \t</dependency>\r\n\t\r\nEn cas de tenir alguna dependència amb Spring al POM de l'aplicació s'ha d'actualitzar a la versió 4.3.4.RELEASE.\r\n\r\nEn cas de tenir la llibreria Xerces com a dependència s'ha d'actualitzar a la versió 2.11:\r\n\r\n\t\t<dependency>\r\n\t\t    <groupId>xerces</groupId>\r\n\t\t    <artifactId>xercesImpl</artifactId>\r\n\t\t    <version>2.11.0</version>\r\n\t\t</dependency>\r\n\t\t\r\n### Servei de Logs\r\n\r\nIdem \"Aplicació REST\"\r\n\r\n### Esquemes de Spring\r\n\r\nIdem \"Aplicació REST\"\r\n","objectID":"L2hvd3Rvcy8yMDE3LTA4LUhvd3RvLUFjdHVhbGl0emFjaW9fQ2FuaWdvM18xX0NhbmlnbzNfMg=="},"L2hvd3Rvcy8yMDE3LTA4LUhvd3RvLVVzX2RlX21vbmdvX2NvbXBvc2VfYW1iX0phdmFCdWlsZHBhY2s=":{"date":1500854400000,"title":"Accés per SSL a cluster MongoDB (Compose) des de buildpack Java (Cloud Foundry)","description":"Accés per SSL a cluster MongoDB (Compose) des de buildpack Java (Cloud Foundry)","section":"howtos","categories":["cloud"],"key":"AGOST2017","path":"/howtos/2017-08-Howto-Us_de_mongo_compose_amb_JavaBuildpack","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells que vulguin desplegar una aplicació Java a [Bluemix|https://console.bluemix.net/] com a app utilitzant el buildpack Cloud Foundry de Java, i necessiti accés a una base de dades MongoDB creada a [Compose|https://compose.io].\r\n\r\nLes configuracions explicades en aquest Howto pot aplicar-se a aplicacions Java i bases de dades MongoDB desplegades a altres plataformes, però s'ha certificat a Bluemix i Compose, plataformes cloud d'IBM.\r\n\r\n### Introducció\r\n\r\nQuan es crea un cluster MongoDB a Compose, la url de connexió que es genera conté el paràmetre **ssl=true**. Això significa que l'accés ha de realitzar-se per SSL. En cas que no es realitzi cap configuració, l'accés des d'una aplicació Java produïra el següent error:\r\n\r\n\tCaused by: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification\r\n\t...\r\n\tCaused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\r\n\t...\r\n\tCaused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\r\n\t\r\nPer a solucionar-ho cal afegir el certificat que proporciona Compose al cacerts de Java. Aquest certificat s'haurà de sol·licitar a [suport.cloud@gencat.cat|mailto:suport.cloud@gencat.cat].\r\n\r\n### Afegir certificat a cacerts\r\n\r\nLa versió actual d'OpenJDK que utilitza el buildpack Java de Cloud Foundry, a Agost de 2017, és la versió 1.8.0_141, així que afegim el nostre certificat al cacerts inicial d'aquesta versió.\r\n\r\nPer descarregar [OpenJDK](https://github.com/ojdkbuild/ojdkbuild)\r\n\r\nS'ha d'anar a la ubicació on hem descomprimit la OpenJDK: <path_jdk>/jre/lib/security\r\n\r\nAmb el keytool importem el certificat generat al punt anterior (mongodbcert.crt):\r\n\r\n\tkeytool -importcert -keystore <path_cacerts> -file <path_mongodbcert.crt>\r\n\t\r\nEns demana el password, que és **changeit** i confirmació per importar el certificat, s'ha d'indicar **yes**\r\n\r\nAmb aquest procés disposem del nostre certificat afegit al cacerts, ara s'ha de substituir el cacerts original de java-buildpack amb el nostre\r\n\r\n### Extensió Java-Buildpack\r\n\r\nCrear al Git del SIC: https://git.intranet.gencat.cat/codidialeg/ un projecte buit, per exemple java-buildpack\r\n\r\nAleshores accedir al buildpack que es vol extendre, en aquest howto al github de [cloudfoundry] (https://github.com/cloudfoundry/java-buildpack) i fer un clone.\r\n\r\nAl clone realitzat, afegir el remote el nostre repositori creat i fer un push\r\n\r\nAquest pas ens crea una còpia del buildpack al Git del SIC: https://git.intranet.gencat.cat/mygroup/java-buildpack\r\n\r\nPer afegir el nostre cacerts ho hem de fer a **/resources/open_jdk_jre/lib/security/cacerts**. El path no existeix, l'hem d'afegir.\r\n\r\nUna vegada afegit el fitxer, realitzem el commit per a pujar els canvis al github i al manifest de la nostra aplicació en comptes de:\r\n\r\n\tbuildpack: https://github.com/cloudfoundry/java-buildpack.git\r\n\t\r\nHem de posar:\r\n\t\r\n\tbuildpack: https://git.intranet.gencat.cat/mygroup/java-buildpack.git\r\n\r\n","objectID":"L2hvd3Rvcy8yMDE3LTA4LUhvd3RvLVVzX2RlX21vbmdvX2NvbXBvc2VfYW1iX0phdmFCdWlsZHBhY2s="},"L2hvd3Rvcy8yMDE3LTEwLUhvd3RvLVVzX1NwcmluZ19DYWNoZV9DYW5pZ28=":{"date":1493596800000,"title":"Ús de Spring Cache (Caffeine) en Canigó 3.2.2","description":"Ús de Spring Cache (Caffeine) en Canigó 3.2.2","section":"howtos","categories":["canigo"],"key":"OCTUBRE2017","path":"/howtos/2017-10-Howto-Us_Spring_Cache_Canigo","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que vulguin afegir Spring Cache a una aplicació Canigó 3.2.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.2.x del Framework Canigó.\r\n\r\n### Introducció\r\n\r\nEn aquest HowTo s’explica com afegir Spring Cache a una aplicació Canigó 3.2. \r\nPer a fer-ho es desplega l’aplicació demo que genera el plugin de Canigó, per a mostrar el funcionament de Spring Cache primer es fa una prova sense utilitzar la cache i després una altre utilitzant la cache. \r\n\r\nEn aquest primer exemple no se li especifica cap proveïdor específic de caching (caffeine, ehcache, etc.) de tal manera que l'exemple utilitzarà simplement ConcurrentHashMap.\r\n\r\nA una aplicació real es pot triar la implementació de caching que es desitgi, però es important utilitzar l'abstracció que proporciona [Spring Cache] (https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-caching.html#boot-features-caching) (estàndard JSR-107) ja que a banda de complir els estàndards no fixa una aplicació a un proveïdor de caching en concret i facilita en un futur qualsevol modificació.\r\n\r\nEn un segon exemple es mostra com utilitzar un proveïdor de caching, en aquest exemple [Caffeine] (https://github.com/ben-manes/caffeine) com llibreria de caching\r\n\r\n## Exemple Configuració Spring Cache\r\n\r\n### Afegir Llibreries\r\n\r\nS'ha d'afegir al pom.xml la dependència a Spring Cache\r\n\r\n    <!-- SPRING BATCH -->\r\n     <dependency>\r\n\t    <groupId>org.springframework.boot</groupId>\r\n\t    <artifactId>spring-boot-starter-cache</artifactId>\r\n\t\t<exclusions>\r\n\t\t\t<exclusion>\r\n\t\t\t\t<groupId>org.springframework.boot</groupId>\r\n\t\t\t\t<artifactId>spring-boot-starter-logging</artifactId>\r\n\t\t\t</exclusion>\r\n\t\t</exclusions>\r\n\t</dependency>\r\n\t\r\n### Exemple d'accés sense Cache\r\n\r\nA la classe **EquipamentService** es crea els mètodes *getById* i *simularLentitud*, aquest segon mètode es crea per a veure millor els efectes de l'ús de cache respecte a no utilitzar cache.\r\n\r\n\t private void simularLentitud() {\r\n        try {\r\n            long time = 3000L;\r\n            Thread.sleep(time);\r\n        } catch (InterruptedException e) {\r\n            throw new IllegalStateException(e);\r\n        }\r\n    }\r\n\t\r\nAquest mètode el que fa, es aturar el thread durant 3 segons.\r\n\r\n\tpublic Equipament getById(Long id) {\r\n\t\tsimularLentitud();\r\n        return getEquipament(id);\r\n\t}\r\n\r\nAmb aquest mètode obtenint un equipament segons el seu ID, però fem que la crida s'aturi 3 segons.\r\n\r\nAl nostre endpoint (**EquipamentServiceController**) afegim un mètode que realitzi múltiples crides al mètode getById.\r\n\r\n\t@GetMapping(value = \"/howto\", produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic ResponsePage<String> howto() {\r\n\t\t\r\n\t\tlogger.info(\".... Obtenint equipaments\");\r\n        logger.info(\"Equipament-1 -->\" + equipamentService.getById(Long.valueOf(1)));\r\n        logger.info(\"Equipament-2 -->\" + equipamentService.getById(Long.valueOf(2)));\r\n        logger.info(\"Equipament-1 -->\" + equipamentService.getById(Long.valueOf(1)));\r\n        logger.info(\"Equipament-2 -->\" + equipamentService.getById(Long.valueOf(2)));\r\n        logger.info(\"Equipament-1 -->\" + equipamentService.getById(Long.valueOf(1)));\r\n        logger.info(\"Equipament-1 -->\" + equipamentService.getById(Long.valueOf(1)));\r\n\r\n\t\treturn null;\r\n\t}\r\n\t\r\nEl que fa aquest mètode és simplement cridar 6 vegades a getById, tres vegades demanant el ID 1, i 3 vegades demanant el ID 2.\r\n\r\nSi s'arrenca l'aplicació, es crida a /equipaments/howto i el resultat al log és:\r\n\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:11:59,720 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - .... Obtenint equipaments\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:07,184 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:10,185 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:13,186 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:16,186 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:19,186 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:22,186 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\r\nTot i que l'aplicació serveix els mateixos objectes múltiples vegades triga 3 segons a servir cadascún (La simulació de lentitud que hem fet).\r\n\r\n### Exemple d'accés amb Cache\r\n\r\nPer a activar la cache, hem de crear una Cache on s'enmmagatzemarà els Equipaments, per fer això utilitzem l'anotació @Cacheable de Spring (org.springframework.cache.annotation.Cacheable)\r\n\r\nAl mètode que s'ha creat al punt anterior (getById) afegim l'anotació\r\n\r\n\t@Cacheable(\"equipaments\")\r\n\tpublic Equipament getById(Long id) {\r\n\t\tsimularLentitud();\r\n        return getEquipament(id);\r\n\t}\r\n\t\r\nAmb aquesta anotació s'indica que es crea la Cache \"equipaments\" on es guardaran els objectes retornats pel mètode getById.\r\n\r\nPer a que l'aplicació processi les anotacions de Caching hem d'afegir l'anotació @EnableCaching a la nostra classe Application.java\r\n\r\n\t@SpringBootApplication\r\n\t@EnableCaching\r\n\tpublic class Application extends SpringBootServletInitializer implements WebApplicationInitializer {\r\n\r\n\t\tpublic static void main(final String[] args) throws Exception {\r\n\t\t\tif (System.getProperty(\"entorn\") == null) {\r\n\t\t\t\tSystem.setProperty(\"entorn\", \"loc\");\r\n\t\t\t}\r\n\r\n\t\t\tSpringApplication.run(Application.class, args);\r\n\t\t}\r\n\t\t\r\nSi ara s'arrenca l'aplicació i es crida a /equipaments/howto i el resultat al log és:\r\n\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:51:55,145 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - .... Obtenint equipaments\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:51:58,179 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:52:01,180 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:52:01,181 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:52:01,182 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:52:01,182 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:52:01,182 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t\r\nAra es pot veure que les dos primeres crides trigen 3 segons ja que l'aplicació obté per primera vegada aquests Equipaments. Però per als 4 següents, entrega els objectes de manera immediata (sense entrar al mètode i per tant sense aturar-se els 3 segons que hem simulat).\r\n\r\nEs recomana utilitzar un dels proveïdors compatibles amb [Spring Cache] (https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-caching.html#_supported_cache_providers) ja que la configuració per defecte té evidents problemes com que l'objecte desat a Cache es manté indefinidament, amb els inconvenients que això comporta.\r\n\r\n## Ús de Caffeine\r\n\r\n### Prerequisits\r\n\r\nCaffeine només funciona con Java 1.8 o superior, per això s'ha de compilar la nostra aplicació amb Java 1.8 i utilitzar Java 1.8 en el seu desplegament. Al pom.xml\r\n\r\n\t<plugin>\r\n\t\t<groupId>org.apache.maven.plugins</groupId>\r\n\t\t<artifactId>maven-compiler-plugin</artifactId>\r\n\t\t<configuration>\r\n\t\t\t<source>1.8</source>\r\n\t\t\t<target>1.8</target>\r\n\t\t</configuration>\r\n\t</plugin>\r\n\r\n### Exemple\r\n\r\nS'ha d'afegir la dependència de Caffeine al pom.xml\r\n\r\n\t<dependency>\r\n\t\t<groupId>com.github.ben-manes.caffeine</groupId>\r\n\t\t<artifactId>caffeine</artifactId>\r\n\t</dependency>\r\n\r\nA **resources** es crea el fitxer application.properties per afegir les propietats de configuració de Caffeine\r\n\r\n\tspring.cache.cache-names: equipaments\r\n\tspring.cache.caffeine.spec: maximumSize=500, expireAfterWrite=30s\r\n\t\r\nEn aquesta configuració hem indicat que crea el directori de cache \"equipaments\", que té una mida màxima de 500 elements i que cada element es guarda fins a 30 segons després d'escriure's a la cache.\r\n\r\nSi ara s'arrenca l'aplicació i es crida a /equipaments/howto i el resultat al log és:\r\n\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:52,706 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - .... Obtenint equipaments\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:55,709 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:58,710 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:58,710 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:58,710 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:58,710 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:58,710 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\r\nSi es torna a fer la crida abans que passin 30 segons:\r\n\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,510 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - .... Obtenint equipaments\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t\r\nEls objectes continuen entregant-se immediatament, però si es torna a fer la crida una vegada han passat 30 segons de la seva inserció:\r\n\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:52,326 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - .... Obtenint equipaments\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:55,329 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:58,331 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:58,331 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:58,331 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:58,331 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:58,331 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t\r\nLes dues primeres crides tornen a trigar 3 segons, ja que a la Cache ja no hi són els objectes.\r\n","objectID":"L2hvd3Rvcy8yMDE3LTEwLUhvd3RvLVVzX1NwcmluZ19DYWNoZV9DYW5pZ28="},"L2hvd3Rvcy8yMDE3LTA2LUhvd3RvLURlc3BsZWdhcl9hcGxpY2FjaW9fY2FuaWdvMzJfd2Vic3BoZXJl":{"date":1496275200000,"title":"Desplegar una aplicació Canigó 3.2 a Websphere 8.5.5","description":"Desplegar una aplicació Canigó 3.2 a Websphere 8.5.5","section":"howtos","categories":["canigo"],"key":"JUNY2017","path":"/howtos/2017-06-Howto-Desplegar_aplicacio_canigo32_websphere","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors que vulguin desplegar una aplicació Canigó 3.2 en un servidor d'aplicacions IBM Websphere 8.5.5\n\n### Introducció\n\nCanigó 3.2 incorpora JPA 2.1 i Hibernate 5.0 com a proveïdor. IBM Wesphere 8.5.5 només dóna suport a JPA 2.0 incloent com a proveïdor OpenJPA 2.4. Degut a aquesta incompatibilitat, s'han de realitzar certes modificacions a les aplicacions Canigó per a poder ser desplegades a WebSphere 8.5.5.\n\nEn aquest HowTo es parteix de l'aplicació plantilla de Canigó que genera el [plugin d'Eclipse] (/canigo-download-related/plugin-canigo/).\n\n### Modificar el pom.xml\n\nS'ha de realitzar l'exclusió al mòdul de Spring Boot de **spring-boot-starter-tomcat**:\n\n\t<dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-web</artifactId>\n      <exclusions>\n        <exclusion>\n          <artifactId>spring-boot-starter-logging</artifactId>\n          <groupId>org.springframework.boot</groupId>\n        </exclusion>\n        <exclusion>\n          <artifactId>spring-boot-starter-tomcat</artifactId>\n          <groupId>org.springframework.boot</groupId>\n        </exclusion>\n      </exclusions>\n    </dependency>\n\nS'ha de realitzar l'exclusió de la llibreria **xml-apis** del mòdul spring-boot-starter-data-jpa:\n\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-data-jpa</artifactId>\n      <exclusions>\n        <exclusion>\n          <artifactId>spring-boot-starter-logging</artifactId>\n          <groupId>org.springframework.boot</groupId>\n        </exclusion>\n        <exclusion>\n          <artifactId>xml-apis</artifactId>\n          <groupId>xml-apis</groupId>\n        </exclusion>\n      </exclusions>\n    </dependency>\n\n### Implementació de PersistenceProviderResolver\n\nPer aconseguir que la nostra aplicació resolgui com a proveïdor de JPA HibernatePersistenceProvider, i no OpenJPA, hem d'implementar la nostra pròpia classe PersistenceProviderResolver. Un cop implementada, hem de fer que la nostra aplicació l'utilitzi registrant-la abans de realitzar la inicialització del mòdul de persistència.\n\nPer fer això hem creat el paquet \"cat.gencat.provawebsphere.websphere\" a l'aplicació i creat el fitxer HibernatePersistenceProviderResolver.java amb el següent codi:\n\n\tpackage cat.gencat.provawebsphere.websphere;\n\n\timport org.hibernate.jpa.HibernatePersistenceProvider;\n\timport org.slf4j.Logger;\n\timport org.slf4j.LoggerFactory;\n\n\timport javax.persistence.spi.PersistenceProvider;\n\timport javax.persistence.spi.PersistenceProviderResolver;\n\timport javax.persistence.spi.PersistenceProviderResolverHolder;\n\timport java.util.Collections;\n\timport java.util.List;\n\n\tpublic class HibernatePersistenceProviderResolver implements PersistenceProviderResolver {\n\t\t\n\t\t/** Logger  */  \n\t\tprivate static final Logger logger = LoggerFactory.getLogger(HibernatePersistenceProviderResolver.class);\n\t\t\n\t\tprivate volatile PersistenceProvider persistenceProvider = new HibernatePersistenceProvider();\n\n\t\t@Override\n\t\tpublic List<PersistenceProvider> getPersistenceProviders() {\n\t\t\treturn Collections.singletonList(persistenceProvider);\n\t\t}\n\n\t\t@Override\n\t\tpublic void clearCachedProviders() {\n\t\t\tpersistenceProvider = new HibernatePersistenceProvider();\n\t\t}\n\n\t\tpublic static void register() {\n\t\t\tlogger.debug(\"Registering HibernatePersistenceProviderResolver\");\n\t\t\tPersistenceProviderResolverHolder.setPersistenceProviderResolver(new HibernatePersistenceProviderResolver());\n\t\t}\n\t}\n\t\nPer assegurar que registrem el nostre proveïdor de JPA a l'inici de l'aplicació, abans de la creació de qualsevol altre bean de Spring, creem la classe PreInitializer amb el següent codi:\n\n\tpackage cat.gencat.provawebsphere.websphere;\n\n\timport org.springframework.beans.BeansException;\n\timport org.springframework.beans.factory.config.BeanFactoryPostProcessor;\n\timport org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\n\timport org.springframework.core.Ordered;\n\timport org.springframework.core.PriorityOrdered;\n\n\t \n\tpublic class PreInitializer implements BeanFactoryPostProcessor, PriorityOrdered {  \n\t\t @Override  \n\t\t public int getOrder() {  \n\t\t  return Ordered.HIGHEST_PRECEDENCE;  \n\t\t }  \n\t\t @Override  \n\t\t public void postProcessBeanFactory(  \n\t\t   ConfigurableListableBeanFactory beanFactory) throws BeansException {  \n\t\t\t HibernatePersistenceProviderResolver.register();\n\t\t }  \n\t} \n\nAl fitxer \"Application.java\" hem de crear el bean per la classe PreInitializer per a que es faci el registre:\n\n\t@Bean\n    public PreInitializer preInitializer() {\n\t\treturn new PreInitializer();\n    }\n\n### Definició entitats a \"persistence.xml\"\n\nAl fitxer de persistència hem de definir totes les entitats que tingui l'aplicació. En la plantilla que utilitza aquest HowTo només hi ha l'entitat Equipament:\n\n<persistence xmlns=\"http://java.sun.com/xml/ns/persistence\"\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd\"\n\tversion=\"1.0\">\n\n\t<persistence-unit name=\"canigo\" transaction-type=\"RESOURCE_LOCAL\">\n\t\t\t<class>cat.gencat.provawebsphere3.model.Equipament</class>  \n\t</persistence-unit>\n\n</persistence>\n\n### Configuració a WebSphere\n\nUna vegada configurada la nostra aplicació a la consola web d'administració de WebSphere, abans d'iniciar-la, seleccionar la nostra aplicació, anar a \"Cargador de clases\" i seleccionar els següents valors:\n\n**Clases cargadas con el cargador local primero (padre último)**\n\n**Cargador de clases único para la aplicación**\n\n![](/related/canigo/howto/imatges/20170501.jpg)\n\nSeguint aquestes instruccions l'aplicació plantilla de Canigó 3.2 haurà estat desplegada de forma satisfactòria a WebSphere 8.5.5.\n","objectID":"L2hvd3Rvcy8yMDE3LTA2LUhvd3RvLURlc3BsZWdhcl9hcGxpY2FjaW9fY2FuaWdvMzJfd2Vic3BoZXJl"},"L2hvd3Rvcy8yMDE3LTExLUhvd3RvLVVzX1NlcnZlaV9QZXJzaXN0ZW5jZV9DYW5pZ28=":{"date":1510272000000,"title":"Ús del Servei de Persistencia en Canigó 3.2","description":"Ús del Servei de Persistencia en Canigó 3.2","section":"howtos","categories":["canigo"],"key":"NOVEMBRE2017","path":"/howtos/2017-11-Howto-Us_Servei_Persistence_Canigo","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.2.x del Framework Canigó.\r\n\r\n### Introducció\r\n\r\nEn aquest HowTo s'explica l'estructura del servei de persistència i com definir consultes utilitzant Spring Data y Query DSL.\r\n\r\nPer a fer-ho es desplega l'aplicació demo que genera el plugin de Canigó que per defecte ja incorpora el servei de persistència.\r\n\r\n### Estructura del Servei\r\n\r\nEl servei de persistència ofereix la classe GenericRepository que hereta de la classe de SpringData JpaRepository.\r\n\r\nAquest repository proporciona els mètodes bàsics per a la gestió d'una entitat:\r\n\r\n\tS save(S entity);\r\n\tOptional findById(ID primaryKey);\r\n\tIterable findAll();\r\n\tlong count();\r\n\tvoid delete(T entity);\r\n\tboolean existsById(ID primaryKey);\r\n\t...\r\n\r\nTambé proporciona mètodes per a realitzar la paginació i l'ordenació:\r\n\r\n\tIterable findAll(Sort sort);\r\n\tPage findAll(Pageable pageable);\r\n\r\nEl servei de persistència així mateix ofereix dos mètodes més:\r\n\r\n\tPage findAll(FactoryExpression factoryExpression, Predicate predicate, Pageable pageable);\r\n\tList bulkSave(Iterable entities);\r\n\r\nEl mètode **findAll** que es proporciona retorna tots els elements de l'entitat cercada, però mostrant el valor només dels camps desitjats.\r\n\r\nEl mètode **bulkSave** proporciona un mètode per a [realitzar inserts i updates de forma massiva.](/howtos/2017-04-Batch-inserts-updates-canigo32/)\r\n\r\nPer a utilitzar aquest Repository l'aplicació demo de Canigó proporciona la següent estructura per a l'entitat Equipament. És l'estructura que es recomana utilitzar per a les entitats pròpies de cada aplicació.\r\n\r\n#### EquipamentRepositoryCustom\r\n\r\nAquesta interfície és on definirem mètodes específics per a la nostra entitat que tinguem la necessitat d'implementar.\r\n\r\n#### EquipamentRepositoryImpl\r\n\r\nClasse que implementa els mètodes que hem declarat a EquipamentRepositoryCustom\r\n\r\n#### EquipamentRepository\r\n\r\nInterfície que hereta de GenericRepository (proporcionat pel servei de Persistència) i del nostre EquipamentRepositoryCustom. És l'objecte a què accedirà el nostre Servei (EquipamentService en aquest cas) per a realitzar les operacions desitjades.\r\n\r\n### Spring Data\r\n\r\nA banda de les operacions genèriques (count, delete, find, get) Spring Data proporciona la possibilitat de construir quèries de forma automàtica utilitzant el prefix **By** seguit del camp desitjat.\r\n\r\nAquestes quèries s'ha de definir com a mètode a la classe EquipamentRepository, ja que no hem de realitzar cap implementació a la nostra aplicació.\r\n\r\nPer exemple:\r\n\r\n\tpublic interface EquipamentRepository extends GenericRepository<Equipament, Long>, EquipamentRepositoryCustom {\r\n\r\n\t\tList findByNom(String nom);\r\n\t\tlong countByMunicipi(String municipi);\r\n\t\tlong deleteByMunicipi(String municipi);\r\n\t}\r\n\r\n\tfindByNom retorna la llista d'equipaments que tinguin el nom proporcionat.\r\n\tcountByMunicipi retorna el nombre d'equipaments amb el municipi proporcionat.\r\n\tdeleteByMunicipi retorna el nombre d'equipaments eliminats amb el municipi proporcionat.\r\n\r\nSpring Data també permet la utilització d'expressions com DISTINCT, permet la concatenació de camps al criteri de la query amb AND i OR , la ordenació dels resultats amb ASC o DESC i més funcionalitats.\r\n\r\nPer a més informació de la creació de quèries es pot consultar la documentació de [Spring Data] (https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-creation)\r\n\r\n### Query DSL\r\n\r\nEl servei de persistència ofereix la integració de Query DSL amb Spring Data i proporciona els mètodes:\r\n\r\n\tT findOne(Predicate predicate); -> Retorna un element que compleixi el Predicate\r\n\tIterable findAll(Predicate predicate); -> Retorna tots els elements que compleixin el Predicate\r\n\tlong count(Predicate predicate); -> Retorna el nombre d'elements que compleixin el Predicate\r\n\tboolean exists(Predicate predicate); -> Retorna si hi ha algun element que compleixi el Predicate\r\n\r\nPer a facilitar la creació del Predicate el servei de persistència ofereix la classe **GenericPredicateBuilder**.\r\n\r\nAquesta classe suporta els següents operadors:\r\n\r\nOperador | Descripció\r\n--------- | --------\r\n> | major que\r\n>: | major o igual que\r\n< | menor que\r\n<> | diferent de\r\n: | igual que\r\n\r\nI permet afegir paràmetres de forma individual:\r\n\r\n\tpublic void addParam (String key, String operation, Object value)\r\n\r\nOn key és el nom del camp, operation és l'operador i value el valor a comparar.\r\n\r\nO de forma conjunta:\r\n\r\n\tpublic void populateSearchCriteria(String search)\r\n\r\nOn el valor de search ha de complir el patró **field1Operador1Valor1,field2Operador2Valor2,fieldNOperadorNValorN**\r\n\r\nUn exemple d'aquest ús es pot trobar al mètode findPaginated d'EquipamentService a la aplicació demo de Canigó:\r\n\r\n\tpublic Page findPaginated(final Integer page, final Integer rpp, final String sort, final String filter) {\r\n\r\n\t\tfinal GenericPredicateBuilder builder = new GenericPredicateBuilder(Equipament.class, \"equipament\");\r\n\r\n\t\tbuilder.populateSearchCriteria(filter);\r\n\r\n\t\tfinal Pageable pageable = new PageRequest(page - 1, rpp, getOrdenacio(sort));\r\n\r\n\t\treturn repository.findAll(builder.build(), pageable);\r\n\t}\r\n\r\nNo és obligatori utilitzar el GenericPredicateBuilder per a construir els predicates. El servei de persistència suporta qualsevol Predicate vàlid.\r\n\r\nPodeu trobar més informació a la documentació de [Spring Data] (https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.extensions.querydsl) o de [QueryDSL] (http://www.querydsl.com/static/querydsl/latest/reference/html/)\r\n","objectID":"L2hvd3Rvcy8yMDE3LTExLUhvd3RvLVVzX1NlcnZlaV9QZXJzaXN0ZW5jZV9DYW5pZ28="},"L2hvd3Rvcy8yMDE3LTEyLWhvd3RvLWludGVncmFjaW9fY2FuaWdvX3NpYw==":{"date":1513036800000,"title":"Integració d'una aplicació Canigó a SIC 2.0","description":"Integració d'una aplicació Canigó a SIC 2.0","section":"howtos","categories":["canigo"],"key":"DESEMBRE2017","path":"/howtos/2017-12-howto-integracio_canigo_sic","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2 i s'hagin d'integrar al SIC.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.2.x del Framework Canigó.\r\n\r\n### Introducció\r\n\r\nEn aquest HowTo s'explica els passos a realitzar per a realitzar la [integració d'una aplicació Canigó al SIC](noticies/2017-12-11-Canigo-Integracio-pipelines-SIC/).\r\n\r\nEl punt de partida és una aplicació Canigó generada pel [plugin de Canigó per a Eclipse](/canigo-download-related/plugin-canigo/), un projecte creat al [Gitlab de SIC] (http://canigo.ctti.gencat.cat/noticies/2017-07-18-SIC-Autoservei-usuaris-SIC2.0/) i un usuari amb permisos per treballar-hi.\r\n\r\n### Connectar amb Git\r\n\r\nPrimer de tot cal que es configurin els binaris per estar fora del control del Git, ja que no corresponen a codi font. Per això cal crear un fitxer [.gitignore](https://git-scm.com/docs/gitignore) a l'arrel de l'aplicació perquè ignori les parts que no s'han de sincronitzar amb el Git. Per exemple:\r\n\r\n\ttarget/\r\n\t\r\nTípicament, a més de la carpeta de sortida de la compilació, també s'ignoren recursos propis de l'IDE de desenvolupament (Eclipse, NetBeans, IntelliJ, ...).\r\n\r\nInicialitzem l'aplicació com a repositori Git i pugem el codi:\r\n\r\n\tAnar a l'arrel de l'aplicació\r\n\tgit init\r\n\tgit remote add origin *path_projecte_git*\r\n\tgit add .\r\n\tgit commit -m \"descripció commit\"\r\n\tgit push -u origin master\r\n\t\r\n### Automatitzar el descriptor sic.yml\r\n\r\nPer a la construcció i desplegament d'una aplicació mitjançant una pipeline al Jenkins, l'aplicació ha de disposar del fitxer \"sic.yml\" amb la versió de l'aplicació. Més informació al punt 3.3.3 del [Manual d'Usuari del SIC](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-usuari.pdf). Aquesta serà la versió amb què s'etiquetarà el codi pujat al master un cop hagi superat les diferents fases prèvies de la pipeline (construcció, tests, ...).\r\n\r\nPer a que el camp \"version\" d'aquest fitxer \"sic.yml\" no hagi de ser actualitzat manualment, es recomana automatitzar el procés a partir de la versió del projecte Maven:\r\n\r\nA *src/main/resources* crear el fitxer \"sic.yml\" amb el següent contingut:\r\n\r\n\tversion: ${project.version}\r\n\t\r\nAl pom.xml de l'aplicació s'ha d'afegir el plugin **maven-resources-plugin** amb la següent configuració:\r\n\r\n\t<plugin>\r\n\t\t<groupId>org.apache.maven.plugins</groupId>\r\n\t\t<artifactId>maven-resources-plugin</artifactId>\r\n\t\t<version>3.0.2</version>\r\n\t\t<executions>\r\n\t\t\t<execution>\r\n\t\t\t\t<id>set-version</id>\r\n\t\t\t\t<phase>process-resources</phase>\r\n\t\t\t\t<goals>\r\n\t\t\t\t\t<goal>copy-resources</goal>\r\n\t\t\t\t</goals>\r\n\t\t\t\t<configuration>\r\n\t\t\t\t\t<useDefaultDelimiters>true</useDefaultDelimiters>\r\n\t\t\t\t\t<outputDirectory>sic</outputDirectory>\r\n\t\t\t\t\t<resources>          \r\n\t\t\t\t\t\t<resource>\r\n\t\t\t\t\t\t\t<directory>src/main/resources</directory>\r\n\t\t\t\t\t\t\t<filtering>true</filtering>\r\n\t\t\t\t\t\t\t<includes>\r\n\t\t\t\t\t\t\t\t<include>sic.yml</include>\r\n\t\t\t\t\t\t\t</includes>\r\n\t\t\t\t\t\t</resource>\r\n\t\t\t\t\t</resources>\r\n\t\t\t\t</configuration>            \r\n\t\t\t</execution>\r\n\t\t</executions>\r\n\t</plugin>\r\n\r\nD'aquesta manera, quan es construeixi l'aplicació, automàticament s'establirà la versió al fitxer \"/sic/sic.yml\", a partir del qual la pipeline del SIC generarà el tag de l'aplicació al Git. \r\n\r\n*A partir de la versió 3.2.3 de Canigó, aquesta configuració ja estarà incorporada a la plantilla que genera el plugin d'Eclipse*\r\n\t\r\n\r\n\t\r\n\r\n","objectID":"L2hvd3Rvcy8yMDE3LTEyLWhvd3RvLWludGVncmFjaW9fY2FuaWdvX3NpYw=="},"L2hvd3Rvcy8yMDE4LTAxLWhvd3RvLW9icmlyLXBldGljaW9ucy1TSUMtYS1hdXRvc2VydmVpLVJlbWVkeQ==":{"date":1516147200000,"title":"Obrir peticions SIC a autoservei Remedy","description":"Com obrir peticions a l'autoservei Remedy per a SIC","section":"howtos","categories":["sic"],"path":"/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy","content":"### A qui va dirigit\r\n\r\nAquesta guia va dirigida a tots aquells usuaris que hagin d’obrir alguna petició a SAU-Remedy sobre serveis del SIC.\r\n\r\n### Context de necessitat\r\n\r\nS’ha preparat aquesta guia per a aquells usuaris que no estiguin massa familiaritzats amb els procediments de Remedy a l’hora d’obrir peticions o que pateixin dificultats a l’hora d’identificar el tipus de petició a obrir al servei de SIC a Remedy segons la seva necessitat.\r\n\r\nLa guia s’ha elaborat a partir de la “Guia d'usuari del Portal d'Autoservei” oficial de Remedy.\r\n\r\n### Introducció\r\n\r\nA Remedy no hi ha tipus de peticions específiques per als serveis SIC, totes les peticions s’han de demanar a partir de 3 tipus de peticions genèriques.\r\n\r\nDe cara a facilitar la feina d'identificar la tasca a realitzar als tècnics de SAU-Remedy, es demanarà que es respecti una determinada sintaxi a l'hora d'informar el camp de “descripció breu de la petició”.\r\n\r\nA les peticions s’hi poden afegir adjunts. S’agrairà que a l’hora d’obrir les peticions s’adjunti qualsevol document que pugui ser útil per a la resolució de la tasca (formularis, captures de pantalla per a les incidències...).\r\n\r\n### Accés a l'autoservei de Remedy\r\n\r\nCal entrar a l’eina Remedy mitjançant el seu portal: https://pautic.gencat.cat.\r\n\r\nA l'accedir, demanarà realitzar login a GICAR si no s'ha logat prèviament en aquest sistema. Una vegada dins, apareixerà la consola d'Autoservei. Aquesta presenta el següent aspecte:\r\n\r\n![](/related/sic/howto/imatges/Remedy1.png)\r\n\r\n**OBSERVACIÓ**: Segons el perfil de l'usuari, es trobaran habilitades més o menys tipus de peticions per obrir.\r\n\r\n### Operativa per obrir peticions\r\n\r\nA continuació s'expliquen les 3 categories de peticions que contemplem i l'operativa a realitzar amb cadascuna d'elles per obrir les diferents peticions al SIC.\r\n\r\n* [Obrir petició de suport funcional](/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#suport)\r\n* [Obrir consulta](/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta)\r\n* [Reportar incidències](/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#incidencia)\r\n\r\n______________________________________\r\n\r\n<div id=\"suport\"></div>\r\n#### Obrir petició de suport funcional\r\n\r\nCaldrà obrir aquest tipus de petició a Remedy per demanar:\r\n\r\n* Creació de jobs d'aplicació a Jenkins.\r\n* Afegir llibreria al Nexus del SIC (necessàries per a la construcció d'artefactes en jobs del SIC).\r\n\r\nDins de la consola d'Autoservei, aquest tipus de petició es pot trobar sota la categoria: `Necessito demanar → Suport funcional`:\r\n\r\n![](/related/sic/howto/imatges/Remedy2.png)\r\nEl formulari de petició de Suport funcional presenta el següent aspecte:\r\n\r\n![](/related/sic/howto/imatges/Remedy3.png)\r\nEs detalla la informació a omplir en cada camp:\r\n\r\n![](/related/sic/howto/imatges/Remedy4.png)\r\nLes peticions de suport funcional poden tenir adjunts. Es recomana adjuntar qualsevol arxiu que sigui útil per completar el suport.\r\n\r\n![](/related/sic/howto/imatges/Remedy5.png)\r\nEn aquesta petició Remedy no figura cap camp específic per identificar el tipus de petició a obrir a SIC. Per tal de facilitar la tasca d’identificació es recomana que s’indiqui el tipus de petició al camp `Descripció breu del suport`.\r\n\r\nPer a tal efecte, es recomana seguir la següent nomenclatura a l’hora d’obrir peticions:\r\n\r\n* **Altes/Modificacions dades Jobs d’aplicacions a Jenkins**: Per a peticions de creació de jobs d’aplicació a Jenkins:\r\n\t* Descripció breu del suport: “SIC – Alta Jobs aplicació \\[CODI DIÀLEG\\] \\[NOM PROJECTE\\]”\r\n\tO bé\r\n\t* Descripció breu del suport: “SIC – Modificació dades Job aplicació \\[CODI DIÀLEG\\] \\[NOM PROJECTE\\] :”+ breu descripció del canvi\r\n\r\n**Cal adjuntar del document del Disseny d’Arquitectura de l’aplicació**, de cara a que l’equip de SIC pugui extreure informació per a la configuració dels jobs.\r\n\r\n![](/related/sic/howto/imatges/Remedy6.png)\r\nAl desplegable de d’aplicació cal escollir la opció ‘FRAMEWORK SIC’.\r\n\r\n**NOTA IMPORTANT**: Aquest desplegable no s’omplirà d’opcions fins no haver començat a escriure al camp “Descripció breu de suport”.\r\n\r\n![](/related/sic/howto/imatges/Remedy7.png)\r\nEn aquest camp es pot detallar més informació sobre la petició.\r\n\r\n![](/related/sic/howto/imatges/Remedy8.png)\r\nIndicar un o d’altre valor segons la urgència de la petició (seguir les instruccions per informar-ho).\r\n\r\n______________________________________\r\n\r\n<div id=\"consulta\"></div>\r\n#### Obrir consulta\r\n\r\nCaldrà obrir aquest tipus de petició a Remedy per demanar qualsevol tipus d’informació relacionada amb els serveis de SIC.\r\n\r\nDins de la consola d'Autoservei, aquest tipus de petició es pot trobar sota la categoria: `Necessito saber → Consulta sobre aplicacions corporatives`:\r\n\r\n![](/related/sic/howto/imatges/Remedy9.png)\r\n\r\nEl formulari de consulta presenta el següent aspecte:\r\n\r\n![](/related/sic/howto/imatges/Remedy10.png)\r\n\r\nEs detalla la informació a omplir a cada camp:\r\n\r\n![](/related/sic/howto/imatges/Remedy11.png)\r\n\r\nAl primer camp de Nom de l’aplicació (desplegable), cal seleccionar `FRAMEWORK SIC`.\r\n\r\n![](/related/sic/howto/imatges/Remedy12.png)\r\n\r\nEl segon camp de Nom de l’aplicació (text), serveix per informar el nom de l’aplicació per als casos d’aplicacions que no figurin al sistema Remedy i no apareguin al desplegable. “FRAMEWORK SIC” ja es troba donada d’alta a Remedy i per tant es podrà escollir al desplegable. **S’ha de deixar en blanc**.\r\n\r\n![](/related/sic/howto/imatges/Remedy13.png)\r\n\r\nLa informació sobre el PC de l’usuari que obre la consulta no aportarà valor a l’hora de resoldre una consulta relacionada amb SIC.\r\nDonat que és un camp obligatori i cal informar-ho, s’aconsella informar-ho com si es tractés del camp de “breu descripció” i seguir la següent nomenclatura en omplir-lo:\r\n\r\nPer a consultes generals sobre serveis SIC:\r\n“SIC – Consulta:” + breu descripció de la consulta\r\n\r\nPer a consulta específiques sobre repositori Git de SIC:\r\n “SIC – Consulta Git:” + breu descripció de la consulta\r\n\r\nPer a consulta específiques sobre Jobs de Jenkins de SIC:\r\n “SIC – Consulta Jobs Jenkins:” + breu descripció de la consulta\r\n\r\n![](/related/sic/howto/imatges/Remedy14.png)\r\n\r\nInformar algun telèfon de contacte per tal que  en cas de necessitat l’equip de SIC pugui contactar amb el peticionari. També es pot afegir informació sobre l’horari de contacte o bústia.\r\n\r\n![](/related/sic/howto/imatges/Remedy15.png)\r\n\r\nDescripció detallada sobre la consulta a realitzar. Cas que fos necessari complementar la consulta amb algun/s document/s, caldria annexar-ho/los també.\r\n\r\n______________________________________\r\n\r\n<div id=\"incidencia\"></div>\r\n#### Reportar incidències\r\n\r\nCaldrà obrir aquest tipus de petició a Remedy per reportar qualsevol tipus d’incidència relacionada amb els serveis de SIC, com ara:\r\n\r\n* Problemes d’accés a repositoris Git/Jobs de Jenkins\r\n* Errors d’execució als jobs de Jenkins\r\n\r\nDins la consola d’Autoservei, aquest tipus de petició es pot trobar navegant per: `Avaria o mal funcionament → Incidència en aplicacions corporatives`:\r\n\r\n![](/related/sic/howto/imatges/Remedy16.png)\r\n\r\nEl formulari de reportar incidència presenta el següent aspecte:\r\n\r\n![](/related/sic/howto/imatges/Remedy17.png)\r\n\r\nEs detalla la informació a omplir a cada camp:\r\n\r\n![](/related/sic/howto/imatges/Remedy18.png)\r\n\r\nLa informació sobre el PC de l’usuari que obre la consulta no aportarà valor a l’hora de resoldre una consulta relacionada amb SIC.\r\nDonat que és un camp obligatori i cal informar-ho, s’aconsella informar-ho com si es tractés del camp de “breu descripció” i seguir la següent nomenclatura en omplir-lo:\r\n\r\nPer a incidències relacionades amb el repositori Git de SIC:\r\nDescripció breu del suport: “SIC – Incidència Git:” + breu descripció de la incidència\r\n\r\nPer a incidències relacionades amb el  Jobs Jenkins de SIC:\r\nDescripció breu del suport: “SIC – Incidència Job Jenkins :” + breu descripció de la incidència\r\n\r\n![](/related/sic/howto/imatges/Remedy19.png)\r\n\r\nInformar algun telèfon de contacte per tal que  en cas de necessitat l’equip de SIC pugui contactar amb el peticionari. També es pot afegir informació sobre l’horari de contacte o bústia.\r\n\r\n![](/related/sic/howto/imatges/Remedy20.png)\r\n\r\n\r\nAl desplegable de Problema, cal escollir la tipologia de incidència:\r\n\r\n* `No puc accedir`: Per a problemes relacionats amb l’accés a repositoris Git o Jobs a Jenkins.\r\n* `Va massa lent`: Per a problemes relacionats amb temps d’espera a l’hora d’accedir a repositori Git o execució de jobs a Jenkins.\r\n* `Funcionament incorrecte`: Per a qualsevol altre tipus de problema no relacionat amb els anteriors.\r\n\r\n![](/related/sic/howto/imatges/Remedy21.png)\r\n\r\nAl primer camp de Nom de l’aplicació (desplegable), cal seleccionar `FRAMEWORK SIC`.\r\n\r\n![](/related/sic/howto/imatges/Remedy22.png)\r\n\r\nEl segon camp de Nom de l’aplicació (text), serveix per informar el nom de l’aplicació per als casos d’aplicacions que no figurin al sistema Remedy i no apareguin al desplegable. “FRAMEWORK SIC” ja es troba donada d’alta a Remedy i per tant es podrà escollir al desplegable. S’ha de deixar en blanc.\r\n\r\n![](/related/sic/howto/imatges/Remedy23.png)\r\n\r\nAmb aquest desplegable es pot indicar si la incidència afecta a un sol repositori Git o job a Jenkins. \r\nEn cas de que l’afectació sigui per més d’un repositori Git o job a Jenkins, caldrà enumerar-los mitjançant el camp `Indiqui el nom de les aplicacions afectades`.\r\n\r\n![](/related/sic/howto/imatges/Remedy24.png)\r\n\r\nEl camp ubicació no aportarà valor a l’hora de tractar la incidència, però donat que és un camp obligatori, caldrà informar-ho.\r\n\r\n![](/related/sic/howto/imatges/Remedy25.png)\r\n\r\nEn aquest camp cal descriure la incidència. Es recomana adjuntar captures de pantalla o qualsevol altre document que pugui servir d’ajut per a entendre el problema.\r\n\r\n","objectID":"L2hvd3Rvcy8yMDE4LTAxLWhvd3RvLW9icmlyLXBldGljaW9ucy1TSUMtYS1hdXRvc2VydmVpLVJlbWVkeQ=="},"L2hvd3Rvcy8yMDE4LTAxLWhvd3RvLXRlc3RfamFyc19jYW5pZ28=":{"date":1513036800000,"title":"Proves Unitàries Mòduls de Canigó","description":"Realitzar proves unitàries de mòduls de Canigó","section":"howtos","categories":["canigo"],"key":"GENER2018","path":"/howtos/2018-01-howto-test_jars_canigo","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2.3.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.2.3 del Framework Canigó.\r\n\r\n### Introducció\r\n\r\nAmb la publicació de Canigó 3.2.3 els mòduls Core, Web-RS, Persistència i Seguretat proporcionen uns jars que inclouen els seus tests unitaris (tipus test-jar).\r\n\r\nAmb aquests jars des de l'aplicació creada es pot executar aquests tests per a comprovar que els mòduls funcionen correctament. Aquests tests es poden executar amb llibreries més actuals i d'aquesta manera comprovar que els mòduls continuen funcionant, o en cas contrari que les noves llibreries no són compatibles amb Canigó\r\n\r\n### Test Jars\r\n\r\nSi es crea una nova aplicació amb el [plugin de Canigó](/canigo-download-related/plugin-canigo/) aquestes llibreries ja vénen incorporades al pom.xml\r\n\r\n\t<dependency>\r\n\t   <groupId>cat.gencat.ctti</groupId>\r\n\t   <artifactId>canigo.core</artifactId>\r\n\t   <type>test-jar</type>\r\n\t   <version>${canigo.core.version}</version>\r\n\t   <scope>test</scope>\r\n\t   <classifier>tests</classifier>\r\n\t</dependency>\r\n\t<dependency>\r\n\t   <groupId>cat.gencat.ctti</groupId>\r\n\t   <artifactId>canigo.web.rs</artifactId>\r\n\t   <type>test-jar</type>\r\n\t   <version>${canigo.web.rs.version}</version>\r\n\t   <scope>test</scope>\r\n\t   <classifier>tests</classifier>\r\n\t</dependency>\r\n\t<dependency>\r\n\t   <groupId>cat.gencat.ctti</groupId>\r\n\t   <artifactId>canigo.persistence.jpa</artifactId>\r\n\t   <type>test-jar</type>\r\n\t   <version>${canigo.persistence.jpa}</version>\r\n\t   <scope>test</scope>\r\n\t   <classifier>tests</classifier>\r\n\t</dependency>\r\n\r\nI també el plugin de Maven que fa que s'executin els tests dels mòduls:\r\n\r\n\r\n\t<plugin>\r\n\t\t\t<groupId>org.apache.maven.plugins</groupId>\r\n\t\t\t<artifactId>maven-surefire-plugin</artifactId>\r\n\t\t\t<executions>\r\n\t\t\t\t<execution>\r\n\t\t\t\t\t<id>base-test</id>\r\n\t\t\t\t\t<phase>test</phase>\r\n\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t<goal>test</goal>\r\n\t\t\t\t\t</goals>\r\n\t\t\t\t\t<configuration>\r\n\t\t\t\t\t\t<dependenciesToScan>\r\n\t\t\t\t\t\t\t<dependency>cat.gencat.ctti:canigo.core</dependency>\r\n\t\t\t\t\t\t\t<dependency>cat.gencat.ctti:canigo.persistence.jpa</dependency>\r\n\t\t\t\t\t\t\t<dependency>cat.gencat.ctti:canigo.web.rs</dependency>\r\n\t\t\t\t\t\t</dependenciesToScan>\r\n\t\t\t\t\t\t<excludes>\r\n\t\t\t\t\t\t\t<exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t\t\t\t</excludes>\r\n\t\t\t\t\t</configuration>\r\n\t\t\t\t</execution>\r\n\t\t\t</executions>\r\n\t\t</plugin>\r\n\r\n### Executar els tests\r\n\r\nPer executar els tests només cal cridar al goal de maven **test**\r\n\r\n\tResults :\r\n\r\n\tTests run: 57, Failures: 0, Errors: 0, Skipped: 0\r\n\r\nSi per exemple es vol probar que una nova versió d'Hibernate és compatible amb els mòduls Canigó s'ha d'afegir la llibreria que es desitgi provar amb **scope test**\r\n\r\n\r\n\t<dependency>\r\n\t\t<groupId>org.hibernate</groupId>\r\n\t\t<artifactId>hibernate-core</artifactId>\r\n\t\t<version>5.2.10.Final</version>\r\n\t\t<scope>test</scope>\r\n\t</dependency>\r\n\t\t\t\r\n\t<dependency>\r\n\t\t<groupId>org.hibernate</groupId>\r\n\t\t<artifactId>hibernate-entitymanager</artifactId>\r\n\t\t<version>5.2.10.Final</version>\r\n\t\t<scope>test</scope>\r\n\t</dependency>\r\n\r\nI tornar a llençar el goal maven de test:\r\n\r\n\tTests run: 57, Failures: 0, Errors: 2, Skipped: 0\r\n\r\nAmb aquestes noves llibreries, el mòdul canigo-persistence no passa els tests, amb el qual significa que no es pot utilitzar amb Canigó.\r\n\r\nAmb aquest procediment es pot validar si es poden utilitzar llibreries més actuals que les proporcionades als mòduls de Canigó.\r\n\r\n","objectID":"L2hvd3Rvcy8yMDE4LTAxLWhvd3RvLXRlc3RfamFyc19jYW5pZ28="},"L2hvd3Rvcy8yMDE4LTAyLWhvd3RvLXN3YWdnZXJfc29hcHVp":{"date":1518566400000,"title":"Generació de joc de proves per a peticions REST a SOAP-UI amb Swagger","description":"En aquest HowTo s'explica com generar un joc de proves per a peticions REST a SOAP-UI amb Swagger","section":"howtos","categories":["canigo"],"key":"FEBRER2018","path":"/howtos/2018-02-howto-swagger_soapui","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.2 del Framework Canigó.\r\n\r\n### Prerequisits\r\n\r\nEs necessita la versió 5.2.1 o superior de [SOAP-UI] (https://www.soapui.org/downloads/soapui.html)\r\n\r\n### Introducció\r\n\r\nLes aplicacions Canigó amb versió 3.2.x incorporen Swagger a la seva plantilla que permet realitzar proves a les crides de l'aplicació de forma intuïtiva i senzilla, però que no permet realitzar un joc de proves automàtic, com executar totes les crides o realitzar més d'una a la vegada.\r\n\r\nAquestes proves es poden realitzar amb un programa com el SOAP-UI que permet la importació de les metadades generades per swagger. Amb aquestes dades es pot generar un projecte amb totes les crides i poder realitzar proves de forma més exhaustiva i còmode.\r\n\r\n### Obtenció swagger.json\r\n\r\nPer a importar les metadades del nostre projecte a SOAP-UI es necessita obtenir el fitxer json que genera Swagger:\r\n\r\n- Accedir directament al json que genera: http://localhost:8080/api/v2/api-docs\r\n\r\nUna altre forma d'obtenir el fitxer json és:\r\n\r\n- Accedir a la plana de Swagger de la nostra aplicació http://localhost:8080/canigo-api.html\r\n- Obrir les eines de desenvolupador que proporciona el navegador. A Chrome es pot accedir mitjançant F12 o \"Més eines - Eines per a desenvolupadors\"\r\n- Anar a la pestanya Network i fer F5 per refrescar la pàgina\r\n- Seleccionar el filtre XHR\r\n- Apareixerà una petició \"api-docs\" que conté el json. Aquest json s'ha de guardar en un fitxer, per exemple swagger.json\r\n\t\r\n![Obtenir swagger.json](/related/canigo/howto/imatges/201802_01.jpg)\r\n\r\n### Importar a SOAP-UI\r\n\r\nObrim l'aplicació SOAP-UI i es crea un nou projecte (File - Create Empty Project)\r\n\r\nBotó dret sobre el projecte creat, Import Swagger i seleccionar el fitxer que hem desat abans (swagger.json)\r\n\r\nEs crea una crida a cada endpoint publicat de l'aplicació:\r\n\r\n![Import swagger.json](/related/canigo/howto/imatges/201802_02.jpg)\r\n\r\n","objectID":"L2hvd3Rvcy8yMDE4LTAyLWhvd3RvLXN3YWdnZXJfc29hcHVp"},"L2hvd3Rvcy8yMDE4LTAzLVNJQy1JbnRlZ3JhY2lvbnMtYW1iLUNQRA==":{"date":1521590400000,"title":"SIC. Integracions amb CPD al SIC","description":"En aquest article es mostra els requeriments del SIC amb els CPDs en quant a la integració d'aplicacions.","sections":["drafts"],"categories":["sic"],"key":"ABRIL2018","path":"/howtos/2018-03-SIC-Integracions-amb-CPD","content":"<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML' async></script>\n\nQuan s'integra una aplicació al SIC, el SIC pot requerir una sèrie d'actuacions per part del CPD on aquesta es desplega. Habitualment es tracta de creacions d'usuaris al Middleware amb permisos per realitzar desplegaments, creacions d'espais SFTP per a la pujada d'artefactes, etc.\n\n## Models de desplegament\n\nAbans d'entrar amb els detalls de què es requereix, prèviament cal ser conscient del tipus de desplegament que es realitzarà a cada entorn. El sic pot realitzar dos tipus de desplegament:\n\n* **Desplegament manual**: Desplegament realitzat manualment pels tècnics de CPD en el que el SIC facilita els artefactes.\n* **Desplegament semiautomàtic**: Desplegament realitzat de forma automàtica per jobs específics de CPD. Aquests jobs són invocats pels tècnics de CPD.\n* **Desplegament automàtic**: Desplegament realitzat de forma automàtica per la pipeline de construcció i desplegament invocada al fer-se un push al repositori Git del projecte.\n\n### Desplegament manual\n\nConsisteix en:\n\n1. Pujar els artefactes a un espai SFTP del CPD on es desplega, d'aquesta manera els tècnics de CPD tenen accés de forma ràpida a aquests fitxers.\n2. En funció de si l'aplicació està integrada a Remedy o no, obrir un tiquet de canvi a Remedy o enviar un correu al SAU corresponent. Sigui quina sigui l'opció escollida, s'inclou la ubicació dels artefactes.\n3. Dins de la finestra de desplegament, el tècnic realitzarà manualment les tasques de desplegament obtenint els artefactes proporcionats pel SIC.\n\n#### Requeriments\n\nEls requeriments del SIC per a aquest tipus de desplegaments són:\n\n* Tenir un compte SFTP en el mateix entorn de desplegament on poder pujar els artefactes perquè CPD els reculli. La informació que s'ha de traspassar al SIC és:\n\t* Usuari\n\t* Paraula de pas\n\t* Host\n\t* Port\n\nL'espai varia en funció de la quantitat d'artefactes generats i de les seves mides. Per a garantir disposar de l'espai necessari, aquest hauria de ser el doble del sumatori de l'espai ocupat per tots els artefactes:\n\n<div>$$mida_{Total}=2\\sum_{i=0}^n mida(artefacte_{i})$$</div>\n\nEn cas de dubte sobre la mida que ha de tenir l'espai SFTP, consultar amb el SIC.\n\n### Desplegaments automàtic i semiautomàtic\n\nAquests tipus de desplegament realitzen de forma automàtica el desplegament de l'aplicació. La diferència entre el desplegament automàtic i el desplegament semiautomàtic radica en qui invoca i el desplegament. En el cas dels desplegaments automàtics, és la pipeline de construcció i desplegament la que directament fa els desplegaments a l'entorn indicat. En els desplegaments semiautomàtics, la pipeline de desplegament s'atura i s'espera a rebre confirmació de què el job de desplegament automàtic de CPD s'hagi executat. En qualsevol cas (sigui el job de CPD o la pipeline de construcció i desplegament), les tasques de desplegament seran automàtiques.\n\n#### Requeriments\n\nPer tal d'automatitzar els desplegaments, el SIC requereix una sèrie d'accions per part de CPD. Les detallem a continuació en funció de la plataforma/tecnologia utilitzada.\n\nDreceres:\n\n* Servidors web:\n\t* <a href=\"#ServidorWeb\">Servidors web</a>\n* Sevidors de fitxers:\n\t* <a href=\"#ServidorFitxers\">Servidors de fitxers</a>\n* Servidors d'aplicacions:\n\t* <a href=\"#IIS\">Servidors IIS</a>\n\t* <a href=\"#WL\">Servidors Weblogic</a>\n\t* <a href=\"#WAS\">Servidors Websphere</a>\n\t* <a href=\"#Tomcat\">Servidors Tomcat</a>\n\t* Servidors JBoss (properament)\n* Servidors de bases de dades:\n\t* <a href=\"#Oracle\">Bases de dades Oracle</a>\n\t* <a href=\"#MySQL\">Bases de dades MySQL</a>\n\t* <a href=\"#MongoDB\">Bases de dades MongoDB</a>\n\t* <a href=\"#SQLServer\">Bases de dades SQLServer</a>\n\t* <a href=\"#PostgreSQL\">Bases de dades PostgreSQL</a>\n\n<hr />\n\n<div id=\"ServidorWeb\" style=\"background-color: #f5f5f5; padding: 10px;\">\n<div  style=\"font-weight: bold;margin: 5px 0px;\">Servidors web</div>\n\nPer als servidors web, el SIC requereix un usuari amb un home propi (per poder pujar els artefactes) i accés al webroot del servidor web per esborrar el contingut estàtic del contexte de l'aplicació i descomprimir el del nou artefacte.\n\nPer tant, el SIC requerirà un __compte SFTP__ que ens ha de permetre **poder fer esborrats de fitxers i carpetes publicats en el webroot**. La mida de l'espai del _home_ pot variar, però generalment 100 MB són suficients. En concret, caldrà facilitar al SIC les següents dades:\n\n* Les dades del compte SSH:\n\t* Usuari\n\t* Paraula de pas\n\t* FQDN del host (nom complet amb el domini inclòs)\n\t* Port\n\n* El path d'on es troba el contexte de l'aplicació.\n\n<div style=\"text-align: right; padding: 0px; 5px;\"><a href=\"#requeriments-1\">Tornar amunt</a></div>\n</div>\n<hr />\n<div id=\"ServidorFitxers\" style=\"background-color: #f5f5f5; padding: 10px;\">\n<div style=\"font-weight: bold;margin: 5px 0px;\">Servidors de fitxers</div>\n\nPer als servidors de fitxers, ens caldrà un **compte SFTP** amb accés directe al directori de l'aplicació. L'usuari ha de tenir permisos per esborrar, modificar i crear carpetes i arxius. No es requereix cap espai propi, es treballarà directament amb l'espai de l'aplicació.\n\nCaldrà facilitar al SIC:\n\n* Les dades del compte SFTP:\n\t* Usuari\n\t* Paraula de pas\n\t* FQDN del host (nom complet amb el domini inclòs)\n\t* Port\n\n<div style=\"text-align: right; padding: 0px; 5px;\"><a href=\"#requeriments-1\">Tornar amunt</a></div>\n</div>\n<hr />\n<div id=\"IIS\" style=\"background-color: #f5f5f5; padding: 10px;\">\n<div style=\"font-weight: bold;margin: 5px 0px;\">Servidors IIS</div>\n\nPel que fa als servidors IIS, el SIC fa desplegaments en remot. Per poder-los realitzar ens cal la següent configuració:\n\n* Servei IIS:\n\t* Permetre l'administració remota del servei IIS\n* Compte d'usuari:\n\t* L'usuari ha de tenir els privilegis suficients per administrar aplicacions i per crear i esborrar carpetes a l'IIS.\n\nTan bon punt s'hagin realitzat les configuracions, cal informar el SIC amb la següent informació:\n\n* Compte d'usuari:\n\t* Usuari\n\t* Paraula de pas\n* Servidor:\n\t* FQDN del host (nom complet amb el domini inclòs)\n\t* Port\n* Dades de l'aplicació:\n\t* ComputerName\n\t* IISWebApplicationName\n\n<div style=\"text-align: right; padding: 0px; 5px;\"><a href=\"#requeriments-1\">Tornar amunt</a></div>\n</div>\n<hr />\n<div id=\"WL\" style=\"background-color: #f5f5f5; padding: 10px;\">\n<div style=\"font-weight: bold;margin: 5px 0px;\">Servidors Weblogic</div>\n\nPer als servidors Weblogic, el SIC fa redeploys de l'aplicació. Per tant cal pujar l'artefacte a la mateixa ubicació des d'on es va fer el desplegament previ.\n\nPer tant, perquè el SIC pugui fer desplegaments a plataformes Weblogic, cal configurar:\n\n* Un usuari amb rol deployer al Weblogic amb permisos per poder fer el desplegament.\n* Un compte sftp amb accés a la ubicació dels artefactes i permisos per poder sobreescriure'ls.\n\nUn cop s'ha realitzat la configuració, cal transmetre al SIC les següents dades:\n\n* Accessos al weblogic:\n\t* Usuari amb rol deployer\n\t* Paraula de pas\n\t* FQDN del host (nom complet amb el domini inclòs)\n\t* Port\n\t* Protocol (t3s, per exemple)\n\t* Name\n\t* ServerName\n\n* Accessos a l'espai dels artefactes:\n\t* Usuari\n\t* Paraula de pas\n\t* FQDN del host (nom complet amb el domini inclòs)\n\t* Port\n\n<div style=\"text-align: right; padding: 0px; 5px;\"><a href=\"#requeriments-1\">Tornar amunt</a></div>\n</div>\n<hr />\n<div id=\"WAS\" style=\"background-color: #f5f5f5; padding: 10px;\">\n<div style=\"font-weight: bold;margin: 5px 0px;\">Servidors Websphere</div>\n\nPel que respecta als servidors Websphere, el SIC fa desplegaments en remot de l'aplicació. Ens caldrà un usuari amb permisos per fer el redesplegament i la informació relativa a l'aplicació.\n\nEn concret, necessitarem:\n\n* Dades del WebSphere i de l'aplicació:\n\t* Usuari\n\t* Paraula de pas\n\t* FQDN del host (nom complet amb el domini inclòs)\n\t* Port\n\t* Nom del perfil\n\t* VirtualHost\n\t* Clúster\n\t* Nom de l'apliació\n\t* Tipus de connexió\n\t* Workspace\n\n<div style=\"text-align: right; padding: 0px; 5px;\"><a href=\"#requeriments-1\">Tornar amunt</a></div>\n</div>\n<hr />\n<div id=\"Tomcat\" style=\"background-color: #f5f5f5; padding: 10px;\">\n<div style=\"font-weight: bold;margin: 5px 0px;\">Tomcat</div>\n\nPel que fa als servidors Tomcat, el SIC realitza desplegaments remots de l'aplicació. Ens caldrà un usuari amb rol de manager-script i la informació relativa al desplegament.\n\nEn conret, necessitarem:\n\n* Dades de l'usuari:\n\t* Usuari\n\t* Paraula de pas\n* Dades del servidor:\n\t* Versió de Tomcat\n\t* FQDN del host (nom complet amb el domini inclòs)\n\t* Port\n\t* Protocol d'accés (HTTP/HTTPs)\n* Dades de l'aplicació:\n\t* Contexte\n\n<div style=\"text-align: right; padding: 0px; 5px;\"><a href=\"#requeriments-1\">Tornar amunt</a></div>\n</div>\n<hr />\n<div id=\"Oracle\" style=\"background-color: #f5f5f5; padding: 10px;\">\n<div style=\"font-weight: bold;margin: 5px 0px;\">BBDD Oracle</div>\n\nPer a les bases de dades Oracle, el SIC realitza els desplegaments connectant-se amb un usuari propi fent proxy authentication contra l'usuari ADM de l'aplicació.\n\nUn cop estigui creat, caldrà transmetre les següents dades al SIC:\n\n* O bé ens cal les dades per separat:\n\t* Credencials\n\t\t* Usuari SIC\n\t\t* Paraula de pas de l'usuari SIC\n\t\t* Usuari ADM de l'aplicació\n\t* Connexió\n\t\t* FQDN del host (nom complet amb el domini inclòs)\n\t\t* Port\n\t\t* Servei\n\t\t* Instància (si cal)\n* O bé la cadena de connexió TNS amb totes les dades anteriors.\n\n<div style=\"text-align: right; padding: 0px; 5px;\"><a href=\"#requeriments-1\">Tornar amunt</a></div>\n</div>\n<hr />\n<div id=\"MySQL\" style=\"background-color: #f5f5f5; padding: 10px;\">\n<div style=\"font-weight: bold;margin: 5px 0px;\">BBDD MySQL</div>\n\nPer a les bases de dades MySQL, el SIC realitza els desplegaments connectant-se amb un usuari propi. Caldrà que l'usuari tingui permisos d'administrador dins de la base de dades MySQL de l'aplicació.\n\nUn cop configurat el servidor, transmetre la següent informació al SIC:\n\n* O bé les dades per separat:\n\t* Usuari\n\t* Paraula de pas\n\t*  FQDN del host (nom complet amb el domini inclòs)\n\t* Port\n* O bé la cadena de connexió amb totes les dades anteriors.\n\n<div style=\"text-align: right; padding: 0px; 5px;\"><a href=\"#requeriments-1\">Tornar amunt</a></div>\n</div>\n<hr />\n<div id=\"MongoDB\" style=\"background-color: #f5f5f5; padding: 10px;\">\n<div style=\"font-weight: bold;margin: 5px 0px;\">BBDD MongoDB</div>\n\nPer a les bases de dades MongoDB, el SIC realitza els desplegaments connectant-se amb un usuari propi. Caldrà que l'usuari tingui el rol **readWrite**.\n\nUn cop configurat el servidor, transmetre la següent informació al SIC:\n\n* Usuari\n* Paraula de pas\n* FQDN del host (nom complet amb el domini inclòs)\n* Port\n* Certificat\n* ReplicaSet\n* AuthenticationDatabase\n\n<div style=\"text-align: right; padding: 0px; 5px;\"><a href=\"#requeriments-1\">Tornar amunt</a></div>\n</div>\n<hr />\n<div id=\"SQLServer\" style=\"background-color: #f5f5f5; padding: 10px;\">\n<div style=\"font-weight: bold;margin: 5px 0px;\">BBDD MS SQLServer</div>\n\nPer a les bases de dades SQLServer, el SIC realitza els desplegaments connectant-se amb un usuari propi. Caldrà que l'usuari tingui permisos per crear, modificar i esborrar objectes a la base de dades així com poder fer sentències INSERT, UPDATE, SELECT i DELETE.\n\nUn cop configurat el servidor, transmetre la següent informació al SIC:\n\n* Usuari\n* Paraula de pas\n* FQDN del host (nom complet amb el domini inclòs)\n* Port\n\n<div style=\"text-align: right; padding: 0px; 5px;\"><a href=\"#requeriments-1\">Tornar amunt</a></div>\n</div>\n<hr />\n<div id=\"PostgreSQL\" style=\"background-color: #f5f5f5; padding: 10px;\">\n<div style=\"font-weight: bold;margin: 5px 0px;\">BBDD PostgreSQL</div>\n\nPer a les bases de dades PostgreSQL, el SIC realitza els desplegaments connectant-se amb un usuari propi. Caldrà que l'usuari tingui permisos per crear, modificar i esborrar objectes a la base de dades així com poder fer sentències INSERT, UPDATE, SELECT i DELETE.\n\nUn cop configurat el servidor, transmetre la següent informació al SIC:\n\n* Usuari\n* Paraula de pas\n* FQDN del host (nom complet amb el domini inclòs)\n* Port\n* Nom de la base de dades\n\n<div style=\"text-align: right; padding: 0px; 5px;\"><a href=\"#requeriments-1\">Tornar amunt</a></div>\n</div>\n<hr />\n\nSi teniu cap dubte al respecte, podeu obrir una [consulta](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta) a SAU Remedy.\n\n","objectID":"L2hvd3Rvcy8yMDE4LTAzLVNJQy1JbnRlZ3JhY2lvbnMtYW1iLUNQRA=="},"L2hvd3Rvcy8yMDE4LTA0LWhvd3RvLWZyb250ZW5kLW11bHRpZW50b3Ju":{"date":1522800000000,"title":"Configuració multi-entorn a una SPA amb backend Canigó","description":"En aquest HowTo s'explica com aplicar una configuració multi-entorn per una SPA amb un backend Canigó","section":"howtos","categories":["canigo","sic"],"key":"ABRIL2018","path":"/howtos/2018-04-howto-frontend-multientorn","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2 amb una SPA per la part de frontend.\n\n### Versió de Canigó\n\nEls passos descrits en aquest document apliquen a la versió 3.2 del Framework Canigó.\n\n### Introducció\n\nLes aplicacions Canigó estan configurades per utilitzar propietats multi-entorn. Això vol dir que les propietats prenen un valor o un altre depenent de l'entorn on s'ha desplegat l'aplicació.\nAquesta funcionalitat de [configuració multi-entorn](/canigo-documentacio-versions-3x-core/modul-configuracio/) només aplica al backend de l'aplicació, el qual mitjançant la propietat de sistema \"entorn\" obté la informació específica de l'entorn on s'ha desplegat.\n\nEl frontend de l'aplicació (típicament SPAs) no disposa d'aquesta informació, i per tant, si no s'aplica alguna solució per configuració multi-entorn cal generar versions diferents per a cada entorn.\n\n### Solució de configuració multi-entorn \n\nCanigó ofereix l'endpoint **/api/info/properties** que retorna totes les propietats de l'aplicació per a l'entorn actual. \n\n<span style=\"color:red\">Aquest endpoint s'ha de protegir o bloquejar en entorns productius</style>\n\n\t@RestController\n\t@RequestMapping(\"/info/properties\")\n\tpublic class InfoPropertiesController {\n\n\t\t@Autowired\n\t\tprivate ICustomPropertyPlaceHolderConfigurer propertyConfigurer;\n\n\t\t@GetMapping(produces = MediaType.APPLICATION_JSON_VALUE)\n\t\tpublic Map<String, String> getInfoPropertiesLoaded() {\n\t\t\treturn propertyConfigurer.getResolvedProps();\n\t\t}\n\t}\n\nLa millor opció per a que el frontend pugui obtenir les propietats multi-entorn que siguin necessaries, seria que l'aplicació exposés un endpoint específic, també protegit, que retorni únicament les propietats necessàries pel frontend.\n\nLa primera vegada que la SPA es carregui, després d'obtenir el token JWT prèvia autenticació, hauria de fer una crida a aquest endpoint per a obtenir la configuració.\n\n\t@RestController\n\t@RequestMapping(\"/info/frontendProperties\")\n\tpublic class InfoFrontendPropertiesController {\n\n\t\t@Autowired\n\t\tprivate ICustomPropertyPlaceHolderConfigurer propertyConfigurer;\n\n\t\t@GetMapping(produces = MediaType.APPLICATION_JSON_VALUE)\n\t\tpublic Map<String, String> getInfoFrontendPropertiesLoaded() {\n\t\t\tMap<String, String> frontendProperties = propertyConfigurer.getResolvedProps();\n\n\t\t\t//FILTRAR frontendProperties i DEIXAR NOMÉS LES QUE NECESSITI EL FRONT-END\n\n\t\t\t return frontendProperties;\n\t\t}\n\t}\n\t\nPer exemple, si el frontend utilitzés la propietat: url.sgde i aquesta url és diferent a PRE i a PRO, al nostre fitxer de propietats hauríem de tenir:\n\n\tpre.url.sgde = http://preproduccio.sgde.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\n\tpro.url.sgde = http://sgde.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\n\t\nCom a informació addicional, per a configuracions amb informació sensible es recomana que s'injectin via variables d'entorn enlloc d'estar en fitxers de propietats dins el codi font.\n\n","objectID":"L2hvd3Rvcy8yMDE4LTA0LWhvd3RvLWZyb250ZW5kLW11bHRpZW50b3Ju"},"L25vdGljaWVzLzIwMTQtMTItMDktY29ubmVjdG9ycy1jYW5pZ28=":{"date":1418083200000,"title":"Canigó. Publicació serveis i connectors Canigó 3.1","description":"Al mes de Novembre s'han alliberat noves versions dels serveis i connectors que formen part de Canigó 3.1. Aquesta és la referència a la Matriu de compatibilitats de Canigó 3.1. En ella s'especifica el detall de totes les versions dels serveis de Canigó 3.1 i les compatibilitats/dependències entre cadascun d'ells. ","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2014-12-09-connectors-canigo","content":"En aquestes noves versions de serveis i connectors s'han eliminat dependències nnecessàries així com unificat les existents. Per exemple, tots els connectors que utilitzen Axis2 han estat unificats a la versió 1.5.3. Moltes altres com Aspectj, JAX-WS, Bouncy Castle Crypto API, etc. han estat actualitzades.\r\n\r\nTambé s'ha alliberat la versió 1.2.0 del Plugin d'Eclipse per donar suport al desenvolupament d'aplicacions Canigó 3.1. Aquest plugin permet la creació de dos tipus de plantilles d'aplicació:\r\n\r\n- Plantilla HTML/JS i REST: backend basat en serveis REST utilitzant Spring MVC. Presentació desacoblada. (Recomanació CS Canigó)\r\n- Plantilla JSF 2.2 (Primefaces): backend basat en la JSF 2.2 i Primefaces 5.0 com a llibreria de components al frontend.\r\n\r\nAl Portal de Frameworks i Solucions d'Arquitectura podeu trobar la Documentació de Referència de Canigó 3 actualitzada i els binaris de Canigó 3.1 disponibles a la secció de Descàrregues. Per aquest comunicat també s'ha redactat un HowTo destinat a totes aquelles aplicacions desenvolupades amb Canigó 3.0 que vulguin migrar a Canigó 3.1.","objectID":"L25vdGljaWVzLzIwMTQtMTItMDktY29ubmVjdG9ycy1jYW5pZ28="},"L25vdGljaWVzLzIwMTUtMDEtMDgtY2FuaWfDsy1SRVNU":{"date":1420848000000,"title":"Cas d'èxit d'aplicació Canigo 3 amb arquitectura HTML5 + REST","description":"L'arquitectura que des del CS Canigó s'està promovent per aplicacions web ja està sent adoptada per noves aplicacions, com és el cas de l'aplicació d'Ajuts i Subvencions (Transversal)","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-01-08-canigó-REST","content":"L'arquitectura que des del CS Canigó s'està promovent per aplicacions web ja està sent adoptada per noves aplicacions, com és el cas de l'aplicació d'Ajuts i Subvencions (Transversal). Aquesta aplicació Canigó 3 ha utilitzat una arquitectura híbrida, 90% HTML5+REST i un 10% JSP. Aquesta petita part basada en JSP (Java Server Pages) bàsicament s'ha fet per a generar l'estructura de la pàgina (template) en què es basa l'aplicació SPA (Single Page Application, aplicació de pàgina única) on les diferents parts de la pàgina es poden refrescar sense haver de recarregar tota la pàgina. La resta de codi de la capa de presentació és estàtic, no generat des del servidor, utilitzant javascript per a cridar serveis REST/JSON i formatar-los al navegador. Les conclusions per part de l'equip tècnic del projecte han estat molt positives pel que fa l'ús d'aquesta arquitectura respecte a la predecessora basada en JSF (Java Server Faces).\r\n\r\nEl següent diagrama il·lustra les diferents capes d'una aplicació Canigó 3 amb aquesta arquitectura HTML5+REST:\r\n\r\n![Arquitectura Canigó Restful](/images/news/arquitectura-canigo-restful.png)\r\n\r\nCom es pot observar la comunicació entre la capa de presentació i la capa de lògica de negoci es fa mitjançant el controlador REST. Aquest desacoblament entre client (Presentació) i servidor (Negoci-Dades) facilita la implementació de diferents clients (escriptori, mòbil, etc.) per accedir a uns mateixos recursos de servidor. En el comunicat de Novembre 2013 podeu trobar més informació respecte a aquest tipus d'arquitectura i el codi font d'una aplicació demo.\r\n\r\nPel que fa als frameworks a utilitzar a la capa de presentació destaquem els següents:\r\n\r\n- Bootstrap: framework HTML, CSS i Javascript per al desenvolupament d'aplicacions web responsives. Incorpora plugins Javascript que requereixen JQuery. \r\n- AngularJS: framework Javascript per desenvolupament d'aplicacions web. Facilita el desenvolupament a més de proposar patrons de disseny per dur-les a terme. Requereix JQuery. En cas de no estar present a l'aplicació utilitza una versió reduïda (jqLite) que inclou el necessari pel seu funcionament.\r\n- Bootstrap UI: llibreria de components Bootstrap basats en AngularJS.\r\n\r\nA més d'aquestes llibreries que hem destacat existeixen moltes altres (JQuery UI, Backbone.js, Ember.js, etc.). Des del CS Canigó es dóna llibertat pel que fa als frameworks a utilitzar a la capa de presentació sempre que es compleixi la normativa de desenvolupament web del CTTI i el PIV (Programa d'Identificació Visual). \r\n\r\nRecordar que la nova versió de l'entorn de treball de Canigó 3 permet la creació d'una plantilla d'aplicació Canigó 3.1 amb aquesta arquitectura HTML5+REST. En aquesta plantilla s'inclou un exemple de CRUD (Create-Read-Update-Delete) d'una entitat.  Per qualsevol dubte referent a aquest tipus d'arquitectura en aplicacions Canigó 3 us podeu posar en contacte amb l'equip del CS Canigó, preferiblement fent una petició de Suport al JIRA CSTD o enviant un correu a la bústia oficina-tecnica.canigo.ctti@gencat.cat.\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDEtMDgtY2FuaWfDsy1SRVNU"},"L25vdGljaWVzLzIwMTUtMDEtMDktU0lDLW5vdS1tb2RlbA==":{"date":1420675200000,"title":"SIC. Calendari de migració d'aplicacions al nou model","description":"Tal com es va notificar al comunicat de Novembre 2014 aviat començarà la migració d'aplicacions per adaptar-se al nou model TIC. Per organitzar aquest procés de migració s'ha elaborat un calendari i s'ha publicat a la plana principal del SVN del SIC, secció \"Calendari de migració d'aplicacions al SIC\"","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-01-09-SIC-nou-model","content":"Tal com es va notificar al comunicat de Novembre 2014 aviat començarà la migració d'aplicacions per adaptar-se al nou model TIC. Per organitzar aquest procés de migració s'ha elaborat un calendari i s'ha publicat a la plana principal del SVN del SIC, secció \"Calendari de migració d'aplicacions al SIC\". A continuació s'enumeren els principals aspectes en que consisteix aquesta migració:\n\n- La migració començarà a partir del 26-01-15 i durarà fins al 03-03-15\n- La migració es durà a terme en franges horàries de 14h a 18h minimitzant l'impacte en el servei durant les hores de més activitat\n- La migració implicarà un tall de servei però aquest només afectarà al bloc d'aplicacions a migrar en la franja horària corresponent \n- Les aplicacions a migrar s'han separat en blocs segons l'àmbit al qual pertanyen. Per a aquells àmbits amb major volum d'aplicacions a migrar ha calgut distribuir-les en diversos blocs, fet que provocarà que la migració d'aplicacions de tot l'àmbit s'allargui més d'un dia en la franja horària esmentada anteriorment. En aquests casos s'oferirà l'alternativa d'unificar els blocs i realitzar la migració en dies complets però tenint en compte que l'aturada del servei durarà tota la jornada, de 08h a 18h\n- El calendari es troba obert a modificacions. En cas de produir-se alguna, es publicarà i s'informarà d'aquest canvi\n\nAmb 2 setmanes d'antelació a les dates publicades al calendari s'emetrà el corresponent comunicat als Responsables d'Arquitectura, Responsables de Qualitat i als Release Managers de l'Àmbit afectat alertant de l'inici d'aquesta migració i aportant més informació relativa al procés.\n\nEs recorda la importància d'haver tramitat prèviament a aquesta migració la creació dels usuaris Release Manager de lot i àmbit de les aplicacions, donat que l'accés al nou repositori es troba restringit a aquests usuaris. Aquest és l'enllaç a la plana de Documentació del SIC on podeu trobar el Formulari de Gestió d'usuaris al SIC per sol·licitar aquestes altes.\nL'accés als repositoris SVN del nou model per les aplicacions que seran migrades no s'habilitarà fins que finalitzi la seva migració. Aquesta mesura s'ha pres per evitar conflictes de duplicitat de codis entre repositori antic i nou.\n\nPer qualsevol dubte referent a aquest procés de migració us podeu posar en contacte amb l'equip del SIC, preferiblement fent una petició de Suport al JIRA CSTD o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta) .","objectID":"L25vdGljaWVzLzIwMTUtMDEtMDktU0lDLW5vdS1tb2RlbA=="},"L25vdGljaWVzLzIwMTUtMDItMDItU0lDLXRyYW5zZm9ybWFjaW8tc2VydmVp":{"date":1417478400000,"title":"SIC. Transformació del servei","description":"El passat 13/11 es va efectuar la transformació del servei SIC al CPD1-HP. En el següent diagrama es mostren els components més rellevants de la capa d'aplicacions i com es realitza la redirecció dels dominis cap als servidors del SIC","sections":["Notícies","home"],"categories":["SIC"],"path":"/noticies/2015-02-02-SIC-transformacio-servei","content":"El passat 13-11-2014 es va efectuar la transformació del servei SIC al CPD1-HP. En el següent diagrama es mostren els components més rellevants de la capa d'aplicacions i com es realitza la redirecció dels dominis cap als servidors del SIC: \n\n![Nou SIC](/related/sic/SIC-CPD1.png)\n\nPer a tots els usuaris del SIC que accedeixen als serveis per domini, ja sigui \"hudson.intranet.gencat.cat\" (Jenkins) o \"svn.intranet.gencat.cat\" (Subversion), el canvi ha estat transparent donat que la connectivitat al nou servidor està oberta i la resolució dels noms per DNS es va canviar el 13/11 per a accedir als nous servidors. Destacar que degut a requeriments d'infraestructura des d'aquesta data és obligatori l'accés per domini, deixant de funcionar l'accés directe per IP (10.48.143.21).\n\nEls usuaris del SIC poden trobar tots els recursos als quals accedien a l'entorn antic en les mateixes URLs. No han canviat les referències a repositoris de Subversion ni a jobs de Jenkins. També es manté tota la informació històrica (tags, històric de modificacions, execucions de jobs, etc.).\n\nEn aquesta transformació s'han fet millores en l'arquitectura del SIC així com actualitzat diferents peces del software que formen part del servei. Els serveis de Jenkins i Nexus ara corren en diferents instàncies de servidors web Tomcat 7.0.50 (Java JRE 1.7.0_51), aïllant les possibles incidències i intervencions que es puguin realitzar en un respecte a l'altre. Les versions de Jenkins i Nexus actuals al SIC són 1.509.4 i 2.10.0 respectivament. Per aquest últim s'ha fet un upgrade de la versió 1.8.0.1 que hi havia instal·lada a l'antic servidor.\n\nEn aquest procés de transformació de CPD s'ha donat de baixa el servei Sonar (sonar.intranet.gencat.cat). Es segueix recomanant però l'ús d'aquest tipus d'eines en entorns de desenvolupament, prèviament a l'alliberament de noves versions de les aplicacions al SIC. L'eina corporativa per l'anàlisi de qualitat de codi és CAST. Més informació al Portal de Qualitat a la secció Eines - CAST.\n\nEn cas de tenir qualsevol dubte o detectar qualsevol afectació conseqüència d'aquesta transformació us podeu posar en contacte amb l'equip del SIC preferiblement via JIRA CSTD al servei SICQ o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).","objectID":"L25vdGljaWVzLzIwMTUtMDItMDItU0lDLXRyYW5zZm9ybWFjaW8tc2VydmVp"},"L25vdGljaWVzLzIwMTUtMDItMDUtU0dERS1vY3Itc3Rk":{"date":1423094400000,"title":"SGDE. OCR al STD","description":"En el procés de transformació de CPD de l'entorn PROductiu del STD (Sistema de Transformació de Documents), finalitzat el passat 28/1, ha estat publicada una nova versió del WebService de Serveis Invocació STD","sections":["Notícies","home"],"categories":["desenvolupament","sgde"],"path":"/noticies/2015-02-05-SGDE-ocr-std","content":"En el procés de transformació de CPD de l'entorn PROductiu del STD (Sistema de Transformació de Documents), finalitzat el passat 28/1, ha estat publicada una nova versió del WebService de Serveis Invocació STD:\r\n\r\n- [WS v1.0] (http://sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTD?wsdl)\r\n- [WS v2.0 (NOVA VERSIÓ)] (http://sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl)\r\n\r\nAquesta nova versió inclou mètodes d'OCR (Optical Character Recognition). A continuació es descriuen breument cadascuna de les funcionalitats proporcionades per aquests nous mètodes:\r\n\r\n- ferOCR: a partir del binari d'una imatge retorna el text resultat del OCR.\r\n- convertirPDFCercable: es passa l'OCR al document a convertir, prèvia conversió a imatge en cas que el document origen no sigui una imatge. El PDF resultat és un PDF \"cercable\".\r\n- convertirComposarPDFCercable: mateixa funcionalitat que l'operació existent \"convertirComposarPDF\" però el document PDF a composar és un PDF \"cercable\", ja que prèviament a la composició s'aplica la funcionalitat de \"convertirPDFCercable\". \r\n\r\nI un diagrama on s'il·lustra el seu funcionament dins el STD:\r\n\r\n<CENTER>![OCR](/images/news/OCR.png)</center>\r\n\r\nEn el Portal de Frameworks i Solucions d'Arquitectura, secció [SGDE] (/sgde/documentacio), podeu trobar tota la informació relacionada amb aquesta versió 2.0 del Webservice de Serveis Invocació STD. Properament es publicarà una nova versió del connector SGDE de Canigó 2 i Canigó 3 que faciliti el seu consum des d'aplicacions Canigó.","objectID":"L25vdGljaWVzLzIwMTUtMDItMDUtU0dERS1vY3Itc3Rk"},"L25vdGljaWVzLzIwMTUtMDMtMDUtU0lDLVBIUA==":{"date":1425513600000,"title":"SIC. PHP","description":"Durant el mes de Febrer s'ha dotat al SIC dels processos necessaris per poder fer desplegaments d'aplicacions PHP en entorns corporatius. A  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels documents de referència.","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-03-05-SIC-PHP","content":"Durant el mes de Febrer s'ha dotat al SIC dels processos necessaris per poder fer desplegaments d'aplicacions PHP en entorns corporatius. A  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels següents documents: \n\n- <i>Formulari d'alta d'aplicació per al Portal d'Integració Continua (Tasques al Jenkins):</i> en aquest formulari s'ha afegit una nova pestanya \"PHP-Desplegament\" amb els camps necessaris pel desplegament d'aplicacions PHP en entorns d'INT, PRE i PRO. \n- <i>Manual d'Integració:</i> afegit detall dels requeriments per la integració d'aplicacions PHP al SIC. \n- <i>Manual d'Usuari:</i> afegida informació per l'ús de Jenkins per tal de fer desplegaments d'aplicacions PHP amb el SIC.\nLa custòdia de codi d'aplicacions PHP ja era permesa i amb l'afegit dels desplegaments es proveeix al SIC de la possibilitat de gestionar el cicle de vida d'aplicacions desenvolupades amb aquesta tecnologia. Destacar que de la mateixa manera que amb aplicacions JEE, també es permet l'execució de scripts de bases de dades Oracle en els desplegaments automàtics a INT. Per PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD i enviament de correu de sol·licitud de desplegament a SAU CTTI.\n\nA continuació es mostra un diagrama amb el funcionament global del SIC per aplicacions PHP:\n\n<CENTER>![PHP](/images/news/SIC_PHP.png)</center>\n\nComentar que en el roadmap del SIC està l'execució de scripts SQL/PLSQL en MySQL donada la seva presencia en el stack LAMP (Linux - Apache HTTP Server - MySQL- PHP).\n\nPer qualsevol dubte referent a la integració d'aplicacions PHP al SIC podeu fer una petició de consulta al servei [SICQ] (https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) al JIRA CSTD o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).\n\n","objectID":"L25vdGljaWVzLzIwMTUtMDMtMDUtU0lDLVBIUA=="},"L25vdGljaWVzLzIwMTUtMDMtMDUtY2FuaWfDsy1jYXB0Y2hh":{"date":1425513600000,"title":"Canigó. Captcha en aplicacions Canigó 3","description":"Els Captcha són tests utilitzats per a diferenciar entre persones i robots que tracten d'evitar un mal ús de les aplicacions per part de robots/programes automàtics. En aplicacions Canigó els Captcha poden resultar molt útils per a validar que s'està fent un ús correcte de les accions destinades a l'usuari final de l'aplicació com per exemple omplir i enviar formularis","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-03-05-canigó-captcha","content":"Els Captcha són tests utilitzats per a diferenciar entre persones i robots que tracten d'evitar un mal ús de les aplicacions per part de robots/programes automàtics. En aplicacions Canigó els Captcha poden resultar molt útils per a validar que s'està fent un ús correcte de les accions destinades a l'usuari final de l'aplicació com per exemple omplir i enviar formularis.\r\n\r\nDes del CS Canigó recomanem l'ús de [Google ReCaptcha] (http://www.google.com/recaptcha/intro/index.html)  degut a la senzillesa de la seva implementació, la facilitat d'ús per a l'usuari final de l'aplicació i la seguretat que proporciona. Google ReCaptcha és una evolució dels Captcha originals que fa més difícil per als programes OCR el reconeixement de les paraules a introduir.\r\n\r\n<CENTER>![captcha](/images/news/captcha.png)</center>\r\n\r\nPer qualsevol dubte referent a la integració dels Captcha a les aplicacions Canigó podeu fer una petició de consulta al servei [CAN] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) al JIRA CSTD o adreçar-vos a la bústia <a href=\"mailto://oficina-tecnica.canigo.ctti@gencat.cat\">oficina-tecnica.canigo.ctti@gencat.cat</a>.","objectID":"L25vdGljaWVzLzIwMTUtMDMtMDUtY2FuaWfDsy1jYXB0Y2hh"},"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDIC1hdXRvcml0emFjaW8tcmVwb3NpdG9yaXM=":{"date":1428192000000,"title":"SIC. Nova política d'autorització d'accés a repositoris","description":"Els repositoris de Subversion de l'antic model existents al SIC només comptaven amb un control d'accessibilitat (autenticació). Els usuaris podien accedir a determinats repositoris en funció del grup al qual se'ls hi havia assignat amb control total (Read/Write). En els repositoris del nou model s'ha incorporat un control d'autorització que permet definir els permisos sobre el contingut accedit (Read o Read/Write)","sections":["Notícies","home"],"categories":["desenvolupament","sic"],"path":"/noticies/2015-04-05-SIC -autoritzacio-repositoris","content":"Els repositoris de Subversion de l'antic model existents al SIC només comptaven amb un control d'accessibilitat (autenticació). Els usuaris podien accedir a determinats repositoris en funció del grup al qual se'ls hi havia assignat amb control total (Read/Write). En els repositoris del nou model s'ha incorporat un control d'autorització que permet definir els permisos sobre el contingut accedit (Read o Read/Write)\n\nAquesta nova característica ha permès limitar els permisos del grup d'administradors de CPD als repositoris de les aplicacions per tal que només puguin descarregar contingut (Read), salvant el risc i responsabilitat que comportava l'accés total (Read/Write) als repositoris als quals tenien accés en l'antic model.\n\n<CENTER>![sic](/images/news/RML_vs_CPD_permissions.png)</center>\n\nEls nous repositoris de [Subversion] (http://svn.intranet.gencat.cat/) compten ara amb un total de 532 codis de diàleg donats d'alta. En el següent gràfic es mostren el total de codis de diàleg distribuïts per àmbits:\n\nPer qualsevol consulta referent a la política d'accés als repositoris de Subversion es pot fer arribar una petició de consulta al JIRA CSTD al servei [SICQ] (https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).\n\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDIC1hdXRvcml0emFjaW8tcmVwb3NpdG9yaXM="},"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDLW1pZ3JhY2nDsw==":{"date":1428192000000,"title":"SIC. Migració a nou model TIC finalitzada","description":"El passat mes de Març ha finalitzat la migració d'aplicacions al SIC de l'antic model, basat en departaments i acrònims d'aplicació, cap al nou, basat en àmbits i codis de diàleg","sections":["Notícies","home"],"categories":["desenvolupament","sic"],"path":"/noticies/2015-04-05-SIC-migració","content":"El passat mes de Març ha finalitzat la migració d'aplicacions al SIC de l'antic model, basat en departaments i acrònims d'aplicació, cap al nou, basat en àmbits i codis de diàleg.\n\nEls nous repositoris de [Subversion] (http://svn.intranet.gencat.cat/) compten ara amb un total de 532 codis de diàleg donats d'alta. En el següent gràfic es mostren el total de codis de diàleg distribuïts per àmbits:\n\n<CENTER>![sic](/images/news/codisdialeg_per_ambit.png)</center>\n\nEls repositoris de l'antic model es conserven com a backup però s'hi ha deshabilitat l'accés. Aquests es mantindran fins al 30 / 6, i passada aquesta data s'eliminaran. Destacar que totes aquelles persones que no hagin demanat permisos als nous repositoris no hi tindran accés donat que no s'han migrat usuaris i permisos. Aquest és l'enllaç a la [secció de documentació](/sic/documentacio) on es pot trobar el formulari de gestió d'usuaris del SIC. \n\nPer qualsevol consulta referent a la migració de repositoris es pot fer arribar una petició de consulta al JIRA CSTD al servei [SICQ] (https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDLW1pZ3JhY2nDsw=="},"L25vdGljaWVzLzIwMTUtMDQtMjQtU0lDIC1wdWJsaWNhY2lvLWFudGl2aXJ1cw==":{"date":1429833600000,"title":"Canigó. Nova versió del connector Antivirus","description":"S'han publicat noves versions del connector d'Antivirus de Canigó 3 i Canigó 2. El funcionament d'aquestes versions, 1.2.0 i 2.3.21-SNAPSHOT respectivament, ha estat certificat amb la versió 7.5 de l'API de Symantec corresponent a la versió instal·lada per el nou Antivirus corporatiu. Cal destacar els canvis de dominis realitzats en la transformació del servei d'Antivirus. Les aplicacions han de fer canvis a la seva configuració per accedir-hi.","sections":["Notícies","home"],"categories":["desenvolupament","canigo"],"path":"/noticies/2015-04-24-SIC -publicacio-antivirus","content":"Durant el mes d'Abril han estat publicades les versions [1.2.0](http://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.antivirus/1.2.0/) del [Connector d'Antivirus] (/canigo-documentacio-versions-3x-integracio/modul-antivirus/) per a Canigó 3 i [2.3.21-SNAPSHOT](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/connectors/canigo-connectors-antivirus/2.3.21-SNAPSHOT/) per a Canigó 2.\r\n\r\nAquestes noves versions utilitzen la versió 7.5 de l’API de Symantec. Per a poder utilitzar aquesta API s’ha de sol·licitar el jar “sym-7.5.jar” a la bústia de canigó <oficina-tecnica.canigo.ctti@gencat.cat> al no estar disponible a cap repositori públic Maven. Altrament l’aplicació no podrà compilar. La instal·lació haurà de fer-se en els repositoris locals dels desenvolupadors. Aquesta llibreria ja ha estat incorporada internament al SIC (Servei d’Integració Contínua) per a compilacions de releases d’aplicacions.\r\n\r\nPer a continuar utilitzant l'API de Symantec 4.3.1 s'ha de mantenir la versió 1.1.0 del connector (o anterior) en cas de Canigó 3 i 2.3.20 (o anterior) en cas de Canigó 2. No s'han detectat incompatibilitats en l'ús d'aquesta versió de l'API en l'accés al nou servei d'Antivirus.\r\n\r\nEls nous dominis d'accés al Servei d'Antivirus són:\r\n\r\nEntorn         | Domini \t\t\t\t\t\t\t\t\t\t| port\r\n-------------- | ----------------------------------------------\t| -----\r\npreproducció   | preproduccio.antivirus.intranet.gencat.cat     | 1344\r\nproducció      | antivirus.intranet.gencat.cat       \t\t\t| 1344\r\n\r\nEl port d'accés, ICAP (1344), no és un dels estàndars (80-http, 443-https). És per aquest motiu que s’han de gestionar les regles de firewall per habilitar la connectivitat cap al servei d’Antivirus des dels servidors d'aplicacions.\r\n\r\nPer a obtenir més informació del Mòdul d'Antivirus podeu consultar la documentació del [Connector d'Antivirus] (/canigo-documentacio-versions-3x-integracio/modul-antivirus/) al Portal de Frameworks i Solucions d’Arquitectura.\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMjQtU0lDIC1wdWJsaWNhY2lvLWFudGl2aXJ1cw=="},"L25vdGljaWVzLzIwMTUtMDQtMzAtU0lDLU1hc3Rlci1TbGF2ZS1DUEQ0":{"date":1430352000000,"title":"SIC. Multi-CPD - Desplegaments a CPD4-TSystems","description":"El SIC - Multi CPD basat en l'arquitectura Master/Slave de Jenkins ja s’ha començat a implantar. El primer CPD on s’ha posat en marxa el Slave de Jenkins per als desplegaments d’aplicacions ha estat a CPD4-TSystems. Aquest slave és controlat pel Jenkins Master (CPD1-HP), el qual li delegarà el desplegament de les aplicacions ubicades a CPD4-TSystems.","sections":["Notícies","home"],"categories":["sic"],"path":"/noticies/2015-04-30-SIC-Master-Slave-CPD4","content":"El SIC - Multi CPD basat en l'arquitectura Master/Slave de Jenkins ja s’ha com****ençat a implantar. El primer CPD on s’ha posat en marxa el Slave de Jenkins per als desplegaments d’aplicacions ha estat a CPD4-TSystems. Aquest slave és controlat pel Jenkins Master (CPD1-HP), el qual li delegarà el desplegament de les aplicacions ubicades a CPD4-TSystems.\n\nEls avantatges d’aquesta arquitectura Master/Slave són els següents:\n\n- *Distribució de la càrrega de treball*: l'execució de les tasques (jobs) es realitza en els slaves.\n- *Reduïr el tràfic a XCAT*: els artefactes es promouen entre entorns dins el CPD.\n- *Minimitzar les connectivitats entre CPDs*: el master només necessita connexió ssh amb els slaves. L'execució de les tasques per el desplegament la realitzen els slaves dins els CPDs.\n\n<CENTER>![SIC_MultiCPD_Slave_CPD4.png](/images/news/SIC_MultiCPD_Slave_CPD4.png)</center>\n\nDestacar que entre els diferents slaves i el master hauran de sincronitzar-se certes dades  (artefactes resultat, logs execució, ...). D'aquesta manera el master centralitza tota la informació i pot presentar-la a l'usuari al [Portal de Jenkins](http://hudson.intranet.gencat.cat).\n\nEs recorda el procediment per a poder realitzar desplegaments de les aplicacions des de SIC:\n\n- Custodiar el codi font de l'aplicació al [SVN del SIC](http://svn.intranet.gencat.cat). Si encara no es disposa d'un espai per el codi de diàleg demanar-ne la creació enviant el \"Formulari d’alta d’aplicació per a la Custòdia de codi al SIC\" que podeu trobar dins la secció de [Documentació del SIC](http://canigo.ctti.gencat.cat/sic/documentacio/Sic-documentacio) al Portal de Frameworks i Solucions d'Arquitectura.\n- Demanar l'alta de jobs a Jenkins mitjançant el \"Formulari d’alta d’aplicació per al Portal d’Integració Contínua (Jenkins)\" disponible també en la secció de [Documentació del SIC](http://canigo.ctti.gencat.cat/sic/documentacio/).\n\nAquests formularis [s'ha d'obrir una petició Remedy](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/)  pel responsable de l'aplicació (persona dins el CTTI o d’un Departament).\n\nPer a obtenir més informació relativa al SIC podeu accedir a la [secció SIC](http://canigo.ctti.gencat.cat/sic/) dins el Portal de Frameworks i Solucions d'Arquitectura. Per consultes o suport preferiblement fer una petició al [Servei SICQ del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o bé  [s'ha d'obrir una petició Remedy](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/).\n\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMzAtU0lDLU1hc3Rlci1TbGF2ZS1DUEQ0"},"L25vdGljaWVzLzIwMTUtMDUtMjktU0lDLVVwZ3JhZGUtU1ZO":{"date":1432857600000,"title":"SIC. Upgrade versió Subversion al SIC","description":"En breu s'actualitzarà la versió de SVN del servidor de SIC, passant d'una 1.6.11 a una 1.8.13. Aquesta actualització comportarà una sèrie de millores en rendiment, robustesa i seguretat al SVN de SIC.","sections":["Notícies","home"],"categories":["sic"],"key":"JUNY2015","path":"/noticies/2015-05-29-SIC-Upgrade-SVN","content":"En breu s'actualitzarà la versió de SVN del servidor de SIC, passant d'una 1.6.11 a una 1.8.13. Aquesta actualització comportarà una sèrie de millores al SVN de SIC, de les quals destaquem les següents:\n\n||Subversion 1.6|Subversion 1.8|\n|----------------------|-----------|-------------|\n|Llibreria client HTTP|neon* |serf (+rendiment)|\n|Sistema d'arxius al repositori|basat en Berkeley DB* |basat en FSFS (+robustesa)|\n|Llistat d'arxius|En accedir a l'arrel del repositori d'àmbit es presentaran totes les carpetes de codi diàleg (tot i que només deixa accedir a les que es té permís).| En accedir a l'arrel del repositori d'àmbit, només es presenten les carpetes de codi diàleg a les que es pot accedir.|\n*Deprecat per Apache\n\nTrobareu més detall dels canvis a la pàgina oficial de les [Release Notes de la versió 1.8 de Subversion](https://subversion.apache.org/docs/release-notes/1.8.html).\n\n#### Compatibilitat amb clients SVN < 1.8\nEs recomana a aquells usuaris de SIC que continuen treballant amb un client anterior a la 1.8.X que s'actualitzin també a aquesta versió per tal que puguin aprofitar al màxim les millores que introduirà aquesta versió.\n\nPer a obtenir més informació relativa al SIC podeu accedir a la [secció SIC](http://canigo.ctti.gencat.cat/sic/) dins el Portal de Frameworks i Solucions d'Arquitectura. Per consultes o suport preferiblement fer una petició al [Servei SICQ del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).","objectID":"L25vdGljaWVzLzIwMTUtMDUtMjktU0lDLVVwZ3JhZGUtU1ZO"},"L25vdGljaWVzLzIwMTUtMDYtMDItQ2FuaWdvLVBsdWdpbg==":{"date":1433203200000,"title":"Canigó. Actualització del plugin de Canigó per Eclipse","description":"Recentment s'ha publicat una nova versió del Plugin de Canigó per Eclipse. Aquesta versió és compatible amb la versió d'Eclipse Luna (4.4) per a dos de les seves 2 distribucions: Eclipse IDE for Java Developers i Eclipse IDE for Java EE Developers. A banda d'aquesta actualització del plugin també s'ha certificat el seu funcionament en S.O. Linux.","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"key":"JUNY2015","path":"/noticies/2015-06-02-Canigo-Plugin","content":"Recentment s'ha publicat una nova versió del Plugin de Canigó per Eclipse. Aquesta versió és compatible amb la versió d'Eclipse Luna (4.4) per a dos de les seves distribucions: Eclipse IDE for Java Developers i Eclipse IDE for Java EE Developers. A banda d'aquesta actualització del plugin també s'ha certificat el seu funcionament en S.O. Linux.\r\n\r\nA la següent taula s'aporta el detall de les diferents versions existents del plugin:\r\n\r\n*Nota: en la taula es mostra la última \"fix\" version de cada \"minor\" version*\r\n\r\n|Versió Plugin|Versió Canigó|Versió JSF|Spring MVC|Versió Eclipse|Compatibilitat S.O.|\r\n|-----|---|---|---|--------------|-------|\r\n|**1.0.1**|3.0.1|1.2|N/A|Helios (3.6.1)|Windows|\r\n|**1.1.0**|3.0.2|2.0|N/A|Helios (3.6.1)|Windows|\r\n|**1.2.1**|3.1.x|2.2|4.1.0.RELEASE|Helios (3.6.1)|Windows|\r\n|**1.3.1**|3.1.x|2.2|4.1.0.RELEASE|Luna (4.4)*|Windows + Linux|\r\n\r\n*Per a fer servir la versió 1.3.1 del Plugin amb la distribució JEE d'Eclipse Luna cal aplicar un patch que consisteix en substituïr una llibreria de la instal·lació base:\r\n\r\n+ La llibreria que cal sobreescriure es troba a: \\<eclipse_home\\>/plugins/org.eclipse.m2e.maven.runtime_1.5.1.20150109-1819/jars/maven-embedder-3.2.1.jar\r\n+ La llibrería amb la que s'ha de sobreescriure es pot descarregar des d'[aquest enllaç](http://canigo.ctti.gencat.cat/devenv/patch_plugin_canigo/maven-embedder-3.2.1.jar)\r\n\r\nUn cop finalitzat aquest procediment ja es pot crear un projecte Canigó des de l'Eclipse: New -> Other -> Asistent projectes Canigó -> Crear un projecte Canigó. Trobareu més informació relativa al Plugin de Canigó a la [documentació](/canigo-download-related/plugin-canigo).","objectID":"L25vdGljaWVzLzIwMTUtMDYtMDItQ2FuaWdvLVBsdWdpbg=="},"L25vdGljaWVzLzIwMTUtMDItMDUtQ2FuaWdvLWludGVncmFjaW8tc2VydmVpcy1yZXN0LWdpY2Fy":{"date":1423094400000,"title":"Canigó. Integració de serveis REST amb GICAR","description":"Les aplicacions Canigó 3 basades en l'arquitectura HTML5/JS+REST han de tenir en compte una sèrie de consideracions en cas que estiguin integrades amb GICAR. En concret, és probable que hagin de sol·licitar que s'apliquin les següents excepcions","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-02-05-Canigo-integracio-serveis-rest-gicar","content":"Les aplicacions Canigó 3 basades en l'arquitectura HTML5/JS+REST han de tenir en compte una sèrie de consideracions en cas que estiguin integrades amb GICAR. En concret, és probable que hagin de sol·licitar que s'apliquin les següents excepcions:\r\n\r\n- <i>Habilitar mètodes \"PUT\" i \"DELETE\"</i>: aquests mètodes HTTP són utilitzats en serveis RESTful per operacions de modificació/inserció de dades (PUT) i eliminació (DELETE). És molt habitual per tant en aplicacions que utilitzen REST, sobretot de backoffice on es realitza administració d'informació, que requereixin aquests mètodes HTTP.\r\n\r\n- <i>Deshabilitar la validació GICAR de la cometa simple (‘) al querystring</i>: els agents GICAR instal·lats en els frontals corporatius, a més de gestionar l'autenticació d'usuaris, també inclouen validacions de seguretat. Una d'aquestes validacions no permet la cometa simple (‘) en el querystring. Al deshabilitar aquesta validació es torna imprescindible que les aplicacions protegeixin el seu codi per evitar SQL Injection. En el cas d'aplicacions Canigó 3 es recomana fer ús del \"Parameter Binding\" de JPA (Java Persistence Api) alhora de setejar paràmetres en sentències JPQL (Java Persistence Query Language) o SQL (Structured Query Language).\r\n\r\nQuan s’hagin de fer aquestes excepcions cal que el responsable de la solució afectada obri un tiquet a <a href=\"mailto://sau.tic@gencat.cat\">sau.tic@gencat.cat</a> en el servei GICAR,  demanant l’excepció pertinent (aquestes identificades o unes altres), indicant també l’aplicació que ho requereix.\r\n\r\nUs deixem una referència al comunicat de Canigó de Novembre 2013 on podeu trobar un exemple d'aplicació Canigó 3 amb arquitectura HTML5/JS+REST. Per qualsevol dubte relacionat amb l'ús d'aquest tipus d'arquitectura en aplicacions Canigó 3 podeu fer una petició de consulta al [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) o enviar un correu a la <a href=\"mailto://oficina-tecnica.canigo.ctti@gencat.cat\">Bústia del CS Canigó</a>. ","objectID":"L25vdGljaWVzLzIwMTUtMDItMDUtQ2FuaWdvLWludGVncmFjaW8tc2VydmVpcy1yZXN0LWdpY2Fy"},"L25vdGljaWVzLzIwMTUtMDYtMTUtU0lDLURlc3BsZWdhbWVudHMgSm9icyBSZW1lZHk=":{"date":1434326400000,"title":"SIC. Peticions desplegament via Remedy","description":"Fins ara totes les peticions de desplegament de les aplicacions a entorns PRE i PRO realitzades des del SIC es demanaven via correu a SAU (sau.ctti@gencat.cat). El SIC està evolucionant per tal que aquestes peticions de desplegament es sol·licitin via Remedy a mida que van migrant les aplicacions a aquest nou sistema.","sections":["Notícies","home"],"categories":["sic"],"key":"JULIOL2015","path":"/noticies/2015-06-15-SIC-Desplegaments Jobs Remedy","content":"Fins ara totes les peticions de desplegament de les aplicacions a entorns PRE i PRO realitzades des del SIC es demanaven via correu a SAU (sau.ctti@gencat.cat). El SIC està evolucionant per tal que aquestes peticions de desplegament es sol·licitin via Remedy a mida que van migrant les aplicacions a aquest nou sistema.\nPer tal d'assolir aquest objectiu s'estan adaptant els jobs de Jenkins del SIC per tal d'integrar-se amb Remedy. Aquesta integració es realitzarà en 2 fases:\n\n+ 1a Fase: Es deshabilitarà l'execució de tots els jobs de PRE/PRO de les aplicacions que ja es trobin a Remedy. Gràcies a un sistema d'alertes seran fàcilment identificables els jobs afectats. A més, s'han enviat comunicats informatius als usuaris Release Manager d'aquestes aplicacions.\n+ 2a Fase: S'implementarà la integració SIC - Remedy per tal de permetre que els jobs obrin peticions de desplegament a PRE/PRO mitjançant la generació d'un canvi en mode DRAFT a Remedy. S'aplicarà aquesta integració als jobs deshabilitats i es reactivaran. La previsió es que a finals de Juliol es realitzi aquesta activació.\n\nMentre no s'hagi completat aquesta integració, el procediment que caldrà seguir per a demanar desplegaments d’aquestes aplicacions serà el definit per Gestió de Serveis, és a dir, obrint una RFC directament a Remedy demanant el desplegament i indicant a CPD la ubicació de l'artefacte i les instruccions de desplegament.\n\nUna vegada completat, a mesura que les aplicacions amb jobs al SIC migrin a Remedy, l'equip del SIC actualitzarà els jobs de desplegament per tal que utilitzin aquesta via.\n\nL'escenari final contempla que totes les aplicacions estiguin integrades a Remedy, però fins llavors al SIC ens trobarem en una situació com la següent:\n\n<CENTER>![SIC-Desplegament-Remedy.png](/images/news/SIC-Desplegament-Remedy.png)</center>\n\nPer qualsevol dubte relatiu a aquesta integració del SIC amb Remedy us podeu posar en contacte amb l'equip del SIC [obrint una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).","objectID":"L25vdGljaWVzLzIwMTUtMDYtMTUtU0lDLURlc3BsZWdhbWVudHMgSm9icyBSZW1lZHk="},"L25vdGljaWVzLzIwMTUtMDctMjQtQ2FuaWdvLUFycXVpdGVjdHVyYS1hcGxpY2FjaW8tcmVjb21hbmFkYQ==":{"date":1437696000000,"title":"Canigó. Arquitectura aplicació recomanada","description":"Des del CS Canigó es segueix treballant per potenciar el desenvolupament d'aplicacions amb arquitectures client/servidor desacoblades basades en serveis Rest i HTML5/JS. Aquest tipus d'arquitectura facilita el desenvolupament de la part client i servidor de forma independent.","sections":["Notícies","home"],"key":"AGOST2015","categories":["desenvolupament","canigó"],"path":"/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada","content":"Des del CS Canigó es segueix treballant per potenciar el desenvolupament d'aplicacions amb arquitectures client/servidor desacoblades basades en serveis REST i HTML5/JS. Aquest tipus d'arquitectura facilita el desenvolupament de la part client i servidor de forma independent el que suposa una sèrie d'avantatges entre els quals destaquem:\r\n\r\n* *Diferents equips de desenvolupament*: permet tenir equips especialitzats en maquetació per la capa de presentació i tècnics JEE per el backend.\r\n* *Múltiples clients*: disposar de diferents clients (Ex. web, aplicacions natives a dispositius mòbils) que consumeixen uns mateixos serveis.\r\n* *Modularització*: backend modularitzat, és a dir, diferents aplicacions  fins i tot implementades amb diferents tecnologies. Per a l’usuari seria transparent en tenir un client web únic.\r\n* *Rendiment*: és possible desplegar les planes HTML en un servidor web (Apache, Nginx) amb la resta del contingut estàtic i els serveis en un contenidor de servlets (Ex. Tomcat) o servidor d'aplicacions  (Ex. Weblogic). El fet que les planes HTML puguin ser servides directament per un servidor web sense necessitat d'arribar al servidor d'aplicacions fa que es pugui tenir un millor rendiment.\r\n\r\nL'aplicació SICJA (Sistema d'Informació de la Comissió Jurídica Assessora) del Departament de Presidència està sent desenvolupada amb aquesta arquitectura  i les impressions rebudes tant per l'usuari com per l'equip tècnic estan sent molt positives.\r\n\r\nEl desenvolupament d'aplicacions JEE amb aquesta arquitectura en detriment de JSF (JavaServer Faces) és una tendència global i que es pot visualitzar a Google Trends:\r\n\r\n<CENTER>![canigo-tendencia-tecnologies](/images/news/canigo-tendencia-tecnologies.png)</center>\r\n\r\n*Termes comparats*: Primefaces, Richfaces, JavaServer Faces (JSF), Representational state transfer (REST) i AngularJS (JavaScript MVW Framework)\r\n\r\nQualsevol proveïdor d'aplicacions de la Generalitat que vulgui desenvolupar aplicacions Canigó amb aquesta arquitectura pot utilitzar el plugin d'Eclipse (versió >= 1.2.0) que proporciona el CS Canigó per crear la base de l'aplicació. Més informació del plugin a la següent [plana](http://canigo.ctti.gencat.cat/canigo-download-related/plugin-canigo/)).","objectID":"L25vdGljaWVzLzIwMTUtMDctMjQtQ2FuaWdvLUFycXVpdGVjdHVyYS1hcGxpY2FjaW8tcmVjb21hbmFkYQ=="},"L25vdGljaWVzLzIwMTUtMDctMzEtQ2FuaWdvLVBsdWdpbi1FY2xpcHNlLU1hcnM=":{"date":1438300800000,"title":"Canigó. Certificació plugin Canigó a Eclipse Mars","description":"Donada la recent publicació d'Eclipse Mars (4.5) des del CS Canigó s'ha certificat el funcionament del plugin per la creació de projectes Canigó 3.1 en aquesta versió d'Eclipse.","sections":["Notícies","home"],"key":"AGOST2015","categories":["desenvolupament","canigó"],"path":"/noticies/2015-07-31-Canigo-Plugin-Eclipse-Mars","content":"Donada la recent publicació d'[Eclipse Mars (4.5)](https://projects.eclipse.org/releases/mars) des del CS Canigó s'ha certificat el funcionament del plugin per la creació de projectes Canigó 3.1 en aquesta versió d'Eclipse.\r\n\r\nAquesta és la taula actualitzada amb les diferents versions existents del plugin:\r\n\r\n*Nota: en la taula es mostra l'última \"fix\" version de cada \"minor\" version*\r\n\r\n|Versió Plugin|Versió Canigó|Versió JSF|Spring MVC|Versió Eclipse|Compatibilitat S.O.|\r\n|-----|---|---|---|--------------|-------|\r\n|**1.0.1**|3.0.1|1.2|N/A|Helios (3.6.1)|Windows|\r\n|**1.1.0**|3.0.2|2.0|N/A|Helios (3.6.1)|Windows|\r\n|**1.2.1**|3.1.x|2.2|4.1.0.RELEASE|Helios (3.6.1)|Windows|\r\n|**1.3.1**|3.1.x|2.2|4.1.0.RELEASE|Luna (4.4)*|Windows + Linux|\r\n|**1.4.0**|3.1.x|2.2|4.1.0.RELEASE|Mars (4.5)*|Windows + Linux|\r\n\r\n*Per a fer servir les versions 1.3.1 i 1.4.0 del Plugin amb la distribució JEE d'Eclipse cal aplicar un patch que consisteix en substituir una llibreria de la instal·lació base:\r\n\r\n_Eclipse Luna_\r\n\r\n+ La llibreria que cal sobreescriure es troba a: \\<eclipse_home\\>/plugins/org.eclipse.m2e.maven.runtime_1.5.1.20150109-1819/jars/maven-embedder-3.2.1.jar\r\n+ La llibrería amb la que s'ha de sobreescriure es pot descarregar des d'[aquest enllaç](http://canigo.ctti.gencat.cat/devenv/patch_plugin_canigo/maven-embedder-3.2.1.jar)\r\n\r\n_Eclipse Mars_\r\n\r\n+ La llibreria que cal sobreescriure es troba a: \\<eclipse_home\\>/plugins/org.eclipse.m2e.maven.runtime_1.6.0.20150526-2031/jars/maven-embedder-3.3.3.jar\r\n+ La llibrería amb la que s'ha de sobreescriure es pot descarregar des d'[aquest enllaç](http://canigo.ctti.gencat.cat/devenv/patch_plugin_canigo/maven-embedder-3.3.3.jar)\r\n\r\nUn cop finalitzat aquest procediment ja es pot crear un projecte Canigó des de l'Eclipse: New -> Other -> Assistent projectes Canigó -> Crear un projecte Canigó. Trobareu més informació relativa al Plugin de Canigó a la [documentació](/canigo-download-related/plugin-canigo).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDctMzEtQ2FuaWdvLVBsdWdpbi1FY2xpcHNlLU1hcnM="},"L25vdGljaWVzLzIwMTUtMDgtMzEtU0lDLUludGVncmFjacOzLWRlbC1TSUMtYS1SZW1lZHk=":{"date":1440979200000,"title":"SIC. Obertura de peticions al SIC via Remedy","description":"Degut a que els sistemes de suport a l'usuari de la Generalitat de Catalunya s'estan integrant a Remedy, el CS Canigó està treballant en la integració del SIC a aquest sistema.","sections":["Notícies","home"],"categories":["sic"],"key":"SEPTEMBRE2015","path":"/noticies/2015-08-31-SIC-Integració-del-SIC-a-Remedy","content":"Degut a que els sistemes de suport a l'usuari de la Generalitat de Catalunya s'estan integrant a [Remedy](https://pautic.gencat.cat), el CS Canigó està treballant conjuntament amb l'equip de SAU-Remedy en la integració del SIC a aquest sistema. \n\nFins ara, les peticions es gestionaven mitjançant el Servei de SIC al [JIRA del CSTD](http://cstd.ctti.gencat.cat) o a través del correu electrònic de la bústia SIC. \n\nEn breu s'activarà el servei 'Framework SIC' a Remedy i les peticions a SIC ja es podran d'obrir mitjançant aquesta eina. Tant les noves peticions de SIC via JIRA CSTD com les rebudes via bústia SIC, es redirigiran internament cap a Remedy, [fent una petició Remedy al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/).\n\nEs deixarà un mes de convivència entre els tres mètodes d’entrada (bústia, JIRA i Remedy). Transcorregut aquest temps, es tancarà definitivament la bústia de SIC i el servei de SIC al JIRA CSTD i totes les peticions s'hauran de gestionar via Remedy.\n\n<center>![peticions_sic_a_Remedy.png](/images/news/peticions_sic_a_Remedy.png)</center>\n\nS'emetrà un comunicat oficial informant d'aquest canvi de gestió sobre les peticions SIC on s'ampliarà aquesta informació i s'actualitzarà la documentació sobre SIC del portal per tal de reflectir aquest canvi.\n","objectID":"L25vdGljaWVzLzIwMTUtMDgtMzEtU0lDLUludGVncmFjacOzLWRlbC1TSUMtYS1SZW1lZHk="},"L25vdGljaWVzLzIwMTUtMDktMDEtQ2FuaWdvLVBsYW50aWxsYS1hcGxpY2FjaW8tcmVzdA==":{"date":1441065600000,"title":"Canigó. Plantilla aplicació REST+HTML5/Js","description":"Des de CS Canigó es proporciona una plantilla d'aplicació amb arquitectura REST+HTML5/Js. Aquesta és pot generar amb el plugin de Canigó per Eclipse versió 1.2.1 o superior","sections":["Notícies","home"],"categories":["canigo"],"key":"SEPTEMBRE2015","path":"/noticies/2015-09-01-Canigo-Plantilla-aplicacio-rest","content":"Des del CS Canigó es recomana utilitzar arquitectures client/servidor desacoblades basades en serveis REST i HTML5/JS [(comunicat Agost 2015)] (/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada). Per el frontend es dóna llibertat a utilitzar la tecnologia desitjada sempre que compleixi el PIV de Gencat. \r\n\r\nA partir de la versió 1.2.1** del Plugin de Canigó per Eclipse es pot generar l'esquelet d'una aplicació Canigó 3.1 amb arquitectura REST+HTML5/Javascript.A la plantilla que es crea amb el plugin, la part frontend corrersponent a un CRUD (Create-Read-Update-Delete) molt bàsic es troba realitzada amb HTML5/Javascript. No s'ha utilitzat cap llibreria de frontend (AngularJS, Bootstrap, EmberJS...), ja que és decisió de l'usuari triar la tecnologia més adient per la seva aplicació.\r\n\r\nAl HowTo publicat [aquest mes] (/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf) es descriu com fer la instal·lació de l'última versió del plugin (1.4.0) i la creació de l'esquelet d'una aplicació Canigó.\r\n\r\nRespecte a les tecnologies emprades a Canigó 3.1 per al backend les més rellevants són les següents:\r\n\r\n* *Spring MVC 4.1.0.RELEASE* : Framework Web basat en el patró Model-View-Controller.\r\n* *Spring Security 4.0.0.M2*: Framework que té la funció de proporcionar tant funcions d'autenticació com d'autorització a aplicacions Java.\r\n* *JPA (Java Persistence API) 2.1*: Busca la manera d'unificar les utilitats que proporcionen un mapeig objecte-relacional. La implementació de JPA per defecte a Canigó 3.1 és Hibernate versió 4.3.6.\r\n\r\nRecordar la Taula de compatibilitat de versions del plugin segons la versió d'Eclipse:\r\n\r\n|Versió Plugin|Versió Eclipse|\r\n|-----|--------------|\r\n|**1.2.1**|Helios (3.6.1)|\r\n|**1.3.1**|Luna (4.4)|\r\n|**1.4.0**|Mars (4.5)|","objectID":"L25vdGljaWVzLzIwMTUtMDktMDEtQ2FuaWdvLVBsYW50aWxsYS1hcGxpY2FjaW8tcmVzdA=="},"L25vdGljaWVzLzIwMTUtMDktMjMtQ2FuaWdvLVVzLWFwcGxldC1zaWduYXR1cmEtQ0FPQw==":{"date":1443484800000,"title":"Canigó. Ús applet d'e-signatura del CAOC","description":"La versió 45 del navegador web Google Chrome deixa de donar suport a la tecnologia NPAPI requerida per els applets Java. En conseqüència, l'applet d'e-signatura del CAOC s'ha d'executar en un altre navegador.","sections":["Notícies","home"],"key":"OCTUBRE2015","categories":["canigo"],"path":"/noticies/2015-09-23-Canigo-Us-applet-signatura-CAOC","content":"La versió 45 del navegador web Google Chrome deixa de donar suport a la tecnologia NPAPI requerida pels applets Java. En conseqüència, applets com el d'e-signatura del CAOC s'han d'executar en un altre navegador com per exemple Firefox o Internet Explorer.\r\n\r\nReferències:\r\n\r\n- [Chrome Support](https://support.google.com/chrome/answer/6213033)\r\n- [Java and Google Chrome Browser](https://java.com/en/download/faq/chrome.xml)\r\n\r\nDes d'altres navegadors, si la seguretat de Java bloqueja l'execució de l'applet cal afegir una excepció de seguretat per al lloc web del qual es descarrega.\r\n\r\nEn el cas concret de l'applet d'e-signatura, a més de tenir en compte aquests pre-requisits, des del consorci es fan una sèrie de recomanacions per la seva correcta execució:\r\n\r\n- Validar la versió de Safesign del client, en cas que no sigui l'última (3.0.76) s'hauria de desinstal·lar i descarregar des de la web del AOC ([Instal·lació T-CAT](https://web.aoc.cat/suport/knowledge-base/installacio-t-cat/))\r\n- Si es disposa d'un altre lector, es pot fer la prova si està dins la [llista de lectors homologats](https://web.aoc.cat/suport/knowledge-base/llista-de-lectors-homologats)\r\n- En cas de dubtes us podeu posar en contacte amb el CAOC a través del [Formulari de Suport](https://web.aoc.cat/suport/formulari-t-cat/)\r\n\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDktMjMtQ2FuaWdvLVVzLWFwcGxldC1zaWduYXR1cmEtQ0FPQw=="},"L25vdGljaWVzLzIwMTUtMTAtMDUtU0lDLUJvbmVzLXByYWN0aXF1ZXMtZGVzcGxlZ2FtZW50cy1JTlQ=":{"date":1444176000000,"title":"SIC. Bones pràctiques per a no interferir en els mecanismes de SIC quan s’accedeix manualment a la consola d’administració del servidor d’aplicacions","description":"Una de les funcionalitats més destacades del SIC és el desplegament automàtic d'aplicacions en entorns d'INT. Amb l'experiència adquirida fins ara en els nous CPDs, des de l'equip del SIC recomanem una sèrie de bones pràctiques per tal d'evitar que actuacions alienes al SIC puguin interferir en el correcte funcionament d'aquests desplegaments automatitzats.","sections":["Notícies","home"],"categories":["sic"],"key":"OCTUBRE2015","path":"/noticies/2015-10-05-SIC-Bones-practiques-desplegaments-INT","content":"Una de les funcionalitats més destacades del SIC és el desplegament automàtic d'aplicacions en entorns d'INT. Amb l'experiència adquirida fins ara en els nous CPDs, des de l'equip del SIC recomanem una sèrie de bones pràctiques per tal d'evitar que actuacions alienes al SIC puguin interferir en el correcte funcionament d'aquests desplegaments automatitzats.\r\n\r\nEls jobs de desplegament a entorns d'INT de SIC (en endavant jobs d'INT) s'aprovisionen d'acord a la configuració de desplegament de l'aplicació al servidor d'aplicacions. Una vegada l'equip de SIC finalitza l'aprovisionament del job d'INT aquest queda lligat a aquesta configuració. Un canvi de configuració al servidor d'aplicacions pot provocar que el job deixi de funcionar correctament pel fet que no es podrà realitzar el desplegament.\r\n\r\nPer tant, la recomanació és que un cop aprovisionat el job d'INT no es faci servir cap altre via de desplegament que no sigui el propi SIC. En cas contrari, és responsabilitat del proveïdor d'aplicacions conèixer si el desplegament pot implicar que el job d'INT del SIC deixi de funcionar.\r\n\r\nAquestes són les accions detectades que poden produir un problema al funcionament del job d'INT:\r\n\r\n* _Canvi del nom de l'aplicació a la consola d'administració del servidor_: el job referenciarà a un nom d'aplicació inexistent\r\n* _Canvi del path i/o nom de l'artefacte a desplegar_: el job no desplegarà la versió de l'artefacte que s'està promovent des del SIC\r\n* _Canvi dels permisos de l'artefacte a desplegar_: el job podria tenir problemes de permisos per enviar l'artefacte o el servidor d'aplicacions per llegir-lo\r\n\r\nEn el següent diagrama s'il·lustra l'efecte que pot produir alguna d'aquestes accions:\r\n\r\n<center>![deploy_INT.jpg](/images/news/deploy_INT.jpg)</center>\r\n\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu obrir una consulta a Remedy al servei \"FRAMEWORK SIC\".","objectID":"L25vdGljaWVzLzIwMTUtMTAtMDUtU0lDLUJvbmVzLXByYWN0aXF1ZXMtZGVzcGxlZ2FtZW50cy1JTlQ="},"L25vdGljaWVzLzIwMTUtMTAtMjctQ2FuaWdvLUFkYXB0YWNpby1hbC1QSVY=":{"date":1445904000000,"title":"Canigó. Adaptació al PIV de Gencat","description":"L'adaptació al PIV de Gencat és un requeriment per moltes aplicacions. L'estratègia a seguir per les aplicacions Canigó depèn de la versió en què estigui implementada.","sections":["Notícies","home"],"key":"NOVEMBRE2015","categories":["canigo"],"path":"/noticies/2015-10-27-Canigo-Adaptacio-al-PIV","content":"L'adaptació al [PIV (Programa d'Identificació Visual) de la Generalitat de Catalunya](http://www.gencat.cat/web/guies/estil/) és un requeriment per a moltes aplicacions web construïdes amb Canigó. L'estratègia a seguir per a aquestes aplicacions depèn de la versió en què estigui implementada. \r\n\r\n### Aplicacions ja desenvolupades amb Canigó 2 i Canigó 3\r\n\r\n* **Millor opció**:\r\n\r\n\t- Adaptar l'estil de l'aplicació al PIV mitjançant la modificació i creació de nous estils (css) sense modificar l'estructura (plantilles html) de l'aplicació. \r\n\r\n\t- Requereix un expert en maquetació, però l'esforç és molt menor que modificar l'estructura de les plantilles i incorporar els nous css\r\n\r\n* **No es recomana**:\r\n\r\n\t- Incorporar les plantilles de Bootstrap del nou Gencat ja que pot produir incompatibilitats amb la llibreria prototype.js utilitzada al servei de presentació de Canigó 2, a més de l'esforç que suposa modificar la capa de presentació (struts).\r\n\r\n* **Solució alternativa**:\r\n\r\n\t- Refer l'arquitectura de l'aplicació per desacoblar presentació i negoci. S'ha de tenir en compte que pot tenir un cost molt elevat.\r\n\r\n### Noves aplicacions Canigó 3\r\n\r\n* **Recomanació**:\r\n\r\n\t- Incorporació de Bootstrap 3 per al templating de l'aplicació i que l'arquitectura d'aquesta estigui basada en desacoblament client/servidor (veure [Arquitectura aplicació recomanada](/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada/)). Qualsevol canvi en la presentació només suposarà canvis en el client i no haver de redesplegar el backend.\r\n\r\n\t- Es poden tenir equips separats per al manteniment i evolució de la presentació i el negoci, que poden portar ritmes diferents.\r\n\r\n* **No es recomana**:\r\n\r\n\t- Utilitzar una arquitectura a l'aplicació amb acoblament entre client i servidor (struts, jsf, ...) donat que pot dificultar modificacions en el templating i els estils.","objectID":"L25vdGljaWVzLzIwMTUtMTAtMjctQ2FuaWdvLUFkYXB0YWNpby1hbC1QSVY="},"L25vdGljaWVzLzIwMTUtMTEtMDUtRkFRcyBTSUM=":{"date":1446681600000,"title":"SIC. FAQ","description":"Com a novetat, a la secció SIC del Portal de Frameworks i Solucions d'Arquitectura, pròximament es publicaran les FAQ del SIC. L'objectiu d'aquestes FAQ és donar resposta a les qüestions que sovint ens plantegen els proveïdors d'aplicacions respecte a la integració amb el SIC.","sections":["Notícies","home"],"key":"NOVEMBRE2015","categories":["sic"],"path":"/noticies/2015-11-05-FAQs SIC","content":"Com a novetat, a la secció SIC del Portal de Frameworks i Solucions d'Arquitectura, pròximament es publicaran les FAQ del SIC. L'objectiu d'aquestes FAQ és donar resposta a les qüestions que sovint ens plantegen els proveïdors d'aplicacions respecte a la integració amb el SIC.\r\n\r\nA continuació s'enumeren algunes de les entrades que apareixeran en aquestes FAQ:\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Es poden pujar binaris al SVN del SIC?**\r\n\r\nPer defecte no donat que el SVN del SIC és un repositori de codi font, no de binaris. Ara bé, es poden contemplar excepcions en cas que el codi font inclogui Applets/Servlets, l'aplicació no es trobi mavenitzada o es vulgui fer ús del SVN de SIC per l'entrega de binaris a CPD. En aquests casos cal demanar l'excepció via SAU-Remedy.\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Puc demanar l'alta d'un usuari per accedir a un repositori del SVN?**\r\n\r\nNo tothom pot demanar d'alta usuaris al SIC, només ho poden demanar els responsables d'àmbit (OGOS, OGDP, @gencat.cat) o de CPD.\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**El meu àmbit encara no està migrat a Remedy i no disposo d'usuari a Remedy per poder obrir peticions SIC en aquest canal. Com puc fer peticions de SIC?**\r\n\r\nEn aquest cas concret, es pot fer enviant un correu a la [bústia de SAU-REMEDY] (mailto:sau.tic@gencat.cat) incloent tota la informació necessària per tractar la petició. Per a més informació consultar la secció sobre [Peticions SIC a SAU-Remedy](http://localhost:1313/sic/peticions/)\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Puc variar l'estructura de carpetes dels repositoris SVN de les meves aplicacions?**\r\n\r\nEls usuaris són lliures de poder modificar l'estructura de carpetes dins l'arrel dels repositoris SVN de SIC. SIC recomana una manera de treballar i en crear el repositori genera una estructura per defecte d'acord a aquesta manera. \r\n\r\nEn cas de voler utilitzar els repositoris SVN de SIC per a fer arribar els binaris a desplegar a CPD o voler fer servir jobs de Jenkins, sí que cal respectar certes normes. Aquestes es troben publicades al [Manual d'Integració de SIC](http://canigo.ctti.gencat.cat/related/sic/manual-integracio.pdf), apartats 3.1.4 i 3.1.5 .\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Perquè en desplegar la meva aplicació a INT mitjançant un job de Jenkins del SIC s'ha desplegat una versió d'aplicació anterior a la que he escollit?**\r\n\r\nMolt probablement es deu al fet que abans l'execució del job s'ha desplegat l'aplicació manualment mitjançant la consola d'administració i la configuració de desplegament ha quedat lligada a aquella versió i no pas a la versió que compila i puja el job.\r\n\r\nPer a més informació sobre aquest problema i com evitar-ho, consultar el següent [article](http://canigo.ctti.gencat.cat/noticies/2015-10-05-SIC-Bones-practiques-desplegaments-INT/)\r\n<br/>\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\nA més d'aquestes FAQ, al [Portal de Frameworks i Solucions d'Arquitectura](http://canigo.ctti.gencat.cat/sic-documentacio/manuals/) hi ha publicats els Manuals d'Usuari i Integració amb més informació. En cas de dubtes es poden fer consultes via SAU-Remedy al servei \"FRAMEWORK SIC\".","objectID":"L25vdGljaWVzLzIwMTUtMTEtMDUtRkFRcyBTSUM="},"L25vdGljaWVzLzIwMTUtMTEtMDYtQ1MgQ2FuaWdvLVJvYWRtYXA=":{"date":1446768000000,"title":"CS Canigó. Roadmap","description":"Aquest mes d'Octubre ha estat publicat el Roadmap del CS Canigó. D'aquesta manera es dona visibilitat a les tasques que es fan des del Centre de Suport a curt i llarg termini amb una previsió de lliurament.","sections":["Notícies","home"],"key":"NOVEMBRE2015","categories":["cscanigo"],"path":"/noticies/2015-11-06-CS Canigo-Roadmap","content":"Aquest mes d'Octubre ha estat publicat el Roadmap del CS Canigó. D'aquesta manera es dona visibilitat a les tasques que es fan des del Centre de Suport a curt i llarg termini amb una previsió de lliurament.\r\n\r\n<iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1ycTBuP_02_fFQYHePMhAxAnNt70R4GyTP4phJn3EHi8&font=Default&lang=ca&initial_zoom=1&height=600' width='100%' height='600' frameborder='0'></iframe>\r\n\r\n*Aquest Roadmap està subjecte a canvis*\r\n\r\n<br>\r\n\r\nEl Roadmap és accessible des de la plana principal del [Portal de Frameworks i Solucions d'Arquitectura](http://canigo.ctti.gencat.cat). En aquesta mateixa plana, pròximament s'habilitarà un enllaç a un formulari amb la finalitat de fer arribar al CS Canigó propostes d'evolutius a incloure en el Roadmap.","objectID":"L25vdGljaWVzLzIwMTUtMTEtMDYtQ1MgQ2FuaWdvLVJvYWRtYXA="},"L25vdGljaWVzLzIwMTUtMTEtMTgtQ2FuaWdvLUVudG9ybi1EZXY=":{"date":1447804800000,"title":"Canigó. Nou entorn de desenvolupament","description":"A mitjans d'aquest mes de Novembre ha estat publicat el nou entorn de desenvolupament de Canigó. Amb aquest nou entorn es canvia l'antic instal·lable (.exe) exclusiu per a sistemes operatius Windows per un entorn multiplaforma amb moltes més possibilitats.","sections":["Notícies","home"],"key":"DESEMBRE2015","categories":["canigo"],"path":"/noticies/2015-11-18-Canigo-Entorn-Dev","content":"A mitjans d'aquest mes de Novembre ha estat publicat el nou entorn de desenvolupament de Canigó. Amb aquest nou entorn es canvia l'antic instal·lable (.exe) exclusiu per a sistemes operatius Windows per un entorn multiplaforma amb moltes més possibilitats.\r\n\r\n\r\nA continuació s'especifiquen les característiques més rellevants d'aquest nou entorn de desenvolupament:\r\n\r\n**Màquina virtual**\r\n\r\n* VM [Oracle VirtualBox](https://www.virtualbox.org/): aprovisionament de màquina virtual a partir d'un script [Vagrant](https://www.vagrantup.com/)\r\n* Linux: màquina virtual basada en sistema operatiu [Ubuntu](http://www.ubuntu.com/)\r\n* Personalitzacions: màquina virtual personalitzada proporcionant un espai d'eines CTTI\r\n\r\n**IDE**\r\n\r\nL'IDE és [Spring Tool Suite] (https://spring.io/tools) (basat en Eclipse Mars) amb JDK 7 (Oracle) i els següents plugins:\r\n\r\n* M2Eclipse per integració amb [Apache Maven](https://maven.apache.org/)\r\n* CTTI Canigó per creació aplicacions Canigó 3.1 basades en arquitectura REST+HTML5/JS o JSF\r\n* Spring Tool Suite per facilitar el desenvolupament d'aplicacions basades en [Spring](http://spring.io/projects)\r\n* Docker Tooling per manegar els contenidors [Docker](https://www.docker.com/)\r\n* Subclipse per integració amb [Subversion] (https://subversion.apache.org/)\r\n* SonarQube per integració amb [SonarQube] (http://www.sonarqube.org/) (antic Sonar)\r\n\r\n**Altres**\r\n\r\n* Engine Docker i Docker Compose Tool per l'execució de contenidors Docker\r\n* Navegador Google Chrome\r\n* Client VPNC per accés a XCAT\r\n* Fons de pantalla corporatiu CTTI\r\n* Accessos directes a eines CTTI: SIC ([SVN](http://svn.intranet.gencat.cat) i [Jenkins](http://hudson.intranet.gencat.cat)), [JIRA CSTD](https://cstd.ctti.gencat.cat/), [Portal Frameworks i Solucions d'Arquitectura](http://canigo.ctti.gencat.cat/).\r\n\r\n\r\nA més d'aquest nou entorn de desenvolupament des del CS Canigó també s'ha publicat una aplicació demo [Equipaments](https://github.com/gencat/equipaments) amb la finalitat de proporcionar als proveïdors d'aplicacions un exemple d'aplicació Canigó 3.1 per a ser desplegada en contenidors Docker. L'ús d'aquests contenidors Docker pretén simular el desplegament en els PaaS del [Full de ruta de CTTI] (https://portic.ctti.gencat.cat/les_tic/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf#search=full%20de%20ruta). El stack on es desplega aquesta aplicació demo Equipaments és Apache 2.4/Tomcat 7/MySQL 5.6.\r\n\r\nA la secció [\"Framework Canigó\"](http://canigo.ctti.gencat.cat/canigo/) -> [\"Entorn de desenvolupament\"](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/) dins d'aquest portal podeu trobar més informació amb el detall del procés d'instal·lació, execució de l'aplicació demo Equipaments així com d'altra informació d'interès per a treballar amb aquest nou entorn de desenvolupament.\r\n\r\nPer a qualsevol dubte, problema o suggerència relatiu a aquest nou entorn de desenvolupament ens podeu fer arribar una petició al servei [CAN](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) del JIRA CSTD o bé enviar-nos un correu a la nostra [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTEtMTgtQ2FuaWdvLUVudG9ybi1EZXY="},"L25vdGljaWVzLzIwMTUtMTItMDctU0lDLUJhbGFuYy0yMDE1":{"date":1449446400000,"title":"SIC. Balanç 2015","description":"Evolució del SIC des de la implantació del nou model TIC fins al desembre del 2015","sections":["Notícies","home"],"categories":["sic"],"key":"DESEMBRE2015","path":"/noticies/2015-12-07-SIC-Balanc-2015","content":"El canvi al nou model TIC ha marcat un punt i apart a la història del SIC. Des d'aquell instant, i durant aquest any i mig, el SIC ha anat assolint un conjunt de fites que queden resumides en el següent fris cronològic:\r\n\r\n<center><iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1KwmAmGiVqaPRzp3cgcZ0iCGAfb56eyJv1rgkoizBtGQ&font=Default&lang=ca&hash_bookmark=true&initial_zoom=2&height=500' width='100%' height='500' frameborder='0'></iframe></center>\r\n\r\nAquesta evolució que ha experimentat el SIC s'ha aplicat en les següents vessants:\r\n\r\n* A nivell tecnològic:\r\n\t* ampliant el ventall de tecnologies suportades:\r\n\t\t* segons el llenguatge:\r\n\t\t\t* .NET i NuGet\r\n\t\t\t* PHP\r\n        * servidors:\r\n        \t* Websphere 8.5\r\n\t\t* bases de dades:\r\n\t\t\t* Oracle 12c\r\n* A nivell d'infraestructura:\r\n\t* Implantació d'un model amb SLAVES que permet la construcció i el desplegament dins del propi CPD que alberga l'aplicació\r\n* A nivell funcional:\r\n\t* s'ha incrementat el nombre d'aplicacions que utilitzen el SVN, que construeixen i que despleguen mitjançant els nostres servidors d'integració contínua Jenkins.\r\n* A nivell de seguretat:\r\n\t* a més de l'autenticació al SVN, s'ha afegit un model autoritzatiu que permet determinar la visibilitat i les accions en funció de rols\r\n\r\nLa nostra intenció és seguir evolucionant el SIC per donar servei a qualsevol aplicació que s'utilitzi a la Generalitat. Per a més informació sobre els futurs evolutius que s'aplicaran al SIC, podeu consultar el [Roadmap d'arquitectura del CTTI](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTItMDctU0lDLUJhbGFuYy0yMDE1"},"L25vdGljaWVzLzIwMTUtMTItMTgtU0lDLVNpc3RlbWEtYXV0b3JpdHphY2lvbnMtcGV0aWNpb25z":{"date":1450396800000,"title":"SIC. Sistema d'autoritzacions de peticions FRAMEWORK SIC a SAU-Remedy","description":"L'admissió de peticions al servei FRAMEWORK SIC de SAU-Remedy es troba restringit per un sistema de rols d'usuari que determina quines operacions pot demanar cada rol. Aquest article pretén explicar com es realitza aquesta discriminació.","sections":["Notícies","home"],"categories":["sic"],"key":"GENER2016","path":"/noticies/2015-12-18-SIC-Sistema-autoritzacions-peticions","content":"L'admissió de peticions al servei FRAMEWORK SIC de SAU-Remedy es troba restringit per un sistema de rols d'usuari que determina quines operacions pot demanar cada rol. Aquest article pretén explicar com es realitza aquesta discriminació.\r\n\r\nEs controla que les peticions que representen més impacte sobre els serveis SIC provinguin d'aquells usuaris amb més pes sobre el projecte. Es consideren peticions amb impacte:\r\n\r\n* Alta/Baixes d'usuaris SIC.\r\n* Restitució de passwords d'altres usuaris SIC.\r\n* Altes de repositoris [SVN](http://svn.intranet.gencat.cat/).\r\n* Petició d'aplicació d'excepció sobre el control d'extensions d'arxius a pujar als repositoris SVN (.war, .ear, .jar).\r\n\r\n<center>![autoritzacions_peticions_responsables.png](/images/news/autoritzacions_peticions_responsables.png)</center>\r\n\r\nN'hi ha altres tipus de peticions que no representen gaire impacte sobre els serveis SIC:\r\n\r\n* Restitució de password d'usuari SIC propi (a excepció del rol gestor de peticions SIC a SAU-Remedy, donat que no requereix un usuari al SIC).\r\n* Afegir llibreries al [Nexus](http://hudson.intranet.gencat.cat/nexus/) de SIC.\r\n* Altes/modificacions de Jobs de [Jenkins](http://hudson.intranet.gencat.cat/hudson/) de les aplicacions\r\n* Inscripció d'usuaris gestors de peticions SIC a SAU-Remedy (nou rol d'usuari que resta explicat al següent [article](http://canigo.ctti.gencat.cat/noticies/2015-12-23-SIC-Nou-rol-de-peticionari-a-SAU-Remedy/))\r\n\r\n<center>![autoritzacions_peticions_tecnics.png](/images/news/autoritzacions_peticions_tecnics.png)</center>\r\n\r\n\r\n\r\nPel que fa a les consultes o incidències amb serveis SIC, qualsevol usuari pot obrir-les a SAU-Remedy. No s'aplica aquest sistema de control d'autorització.\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTItMTgtU0lDLVNpc3RlbWEtYXV0b3JpdHphY2lvbnMtcGV0aWNpb25z"},"L25vdGljaWVzLzIwMTUtMTItMjQtQ2FuaWdvLUJhbGFuYy0yMDE1":{"date":1450915200000,"title":"Canigó. Balanç 2015","description":"Resum de les tasques realitzades per l'equip de Canigó durant l'any 2015","sections":["Notícies","home"],"categories":["canigo"],"key":"GENER2016","path":"/noticies/2015-12-24-Canigo-Balanc-2015","content":"Durant l'any 2015 des de l'equip de Canigó hem assolit diferents fites que resumim en el següent timeline:\r\n\r\n<center><iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1culZh-JCr-W43Vt1qNGyhTT7wMuAOHA_BLQOwodSjaY&font=Default&lang=en&initial_zoom=1&height=650&lang=ca' width='100%' height='650' frameborder='0'></iframe></center>\r\n\r\nEns agradaria destacar per sobre de tota la resta les següents:\r\n\r\n* *[Nou Portal de Canigó ](http://canigo.ctti.gencat.cat)* (1-2-2015)\r\n\r\nAl mes de Febrer es va efectuar la migració de l'antic Confluence a un nou portal amb els nous estils Gencat. Aquest nou portal és un site estàtic que facilita molt la publicació de nous continguts així com la interacció amb els usuaris. Aprofitant aquesta migració s'han revisat continguts obsolets actualitzant-los o bé donant-los de baixa.\r\n\r\n* *[Nou entorn de treball](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/)* (15-11-2015)\r\n\r\nDurant els primers mesos de l'any s'ha analitzat la millor opció per un nou entorn de desenvolupament d'aplicacions Canigó. Finalment s'ha optat per l'aprovisionament d'una màquina virtual proporcionant un espai d'eines per facilitar el desenvolupament. Conjuntament amb aquest entorn de desenvolupament es proporciona una demo d'aplicació per a ser desplegada en un stack Apache+Tomcat+MySQL mitjançant contenidors Docker.\r\n\r\n* *Racionalització d'infraestructura* (23/12/2015 - Finalitzada primera fase)\r\n\r\nDes del mes de Octubre s'està duent a terme un projecte conjuntament amb CPD1 per tal de racionalitzar la infraestructura utilitzada al CS Canigó. En una primera fase han estat migrats al SIC el SVN, Hudson, i repositoris Maven 1 i Maven 2 propis de Canigó. Gràcies a aquesta migració de serveis destinats al manteniment del framework Canigó deixarà de ser necessària una infraestructura dedicada.\r\n\r\nPer l'any 2016 es preveu seguir evolucionant el nou portal i entorn de treball, i com a principal objectiu és pretén actualitzar l'actual versió 3.1 de Canigó. Aquesta actualització es farà aprofitant el coneixement adquirit en eines RAD analitzades durant l'any i l'estudi tecnològic realitzat sobretot pel que fa a l'evolució del framework JEE Spring. A mida que es vagin planificant les tasques previstes pel 2016 les podreu consultar en el [Roadmap d'arquitectura del CTTI](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTItMjQtQ2FuaWdvLUJhbGFuYy0yMDE1"},"L25vdGljaWVzLzIwMTYtMDEtMjgtQ2FuaWdvLUNvbm5lY3RvcnMtUElDQQ==":{"date":1453939200000,"title":"Noves versions dels connectors de Canigó amb la PICA","description":"S'han publicat noves versions dels connectors amb la PICA per a complir les noves restriccions d'esquema","sections":["Notícies","home"],"categories":["canigo"],"key":"FEBRER2016","path":"/noticies/2016-01-28-Canigo-Connectors-PICA","content":"S'han publicat noves versions dels connectors amb la PICA per a complir les noves restriccions d'esquema. És necessari informar les dades Nom i Nif d'emissor, així com informar les dades d'un funcionari en la majoria dels productes de la PICA. Els valors dels camps \"nifEmisor\" i \"nomEmisor\" a informar s’han de consultar a la [OT PICA](mailto:requeridors.otpica.ctti@gencat.cat). Per a més detall dels productes podeu visitar la Intranet d'Administració Electrònica ([IPAE](http://ipae.intranet.gencat.cat)).\r\n\r\nA continuació es mostren les noves versions publicades dels connectors amb la PICA per Canigó 2 i Canigó 3:\r\n\r\n__Canigó 2__:\r\n\r\n|Nom connector|Versió|\r\n|-----|--------------|\r\n|**canigo-connectors-pica-avisosalertes**|1.0.1|\r\n|**canigo-connectors-pica-dni**|1.1.0|\r\n|**canigo-connectors-pica-padro**|1.0.1|\r\n|**canigo-connectors-pica-tributs**|1.0.2|\r\n|**canigo-connectors-sarcat**|1.1.1|\r\n|**canigo-connectors-psis**|1.0.2|\r\n|**canigo-connectors-nt**|1.0.2|\r\n\r\n* _Per a més informació consultar la documentació de [Canigó 2](/canigo-documentacio-versions-anteriors/versio-2/)_\r\n\r\n__Canigó 3__:\r\n\r\n|Nom connector|Versió|\r\n|-----|--------------|\r\n|**canigo.integration.avisosalertes_pica**|1.1.2|\r\n|**canigo.integration.dni.pica**|1.2.0|\r\n|**canigo.integration.padro.pica**|1.1.1|\r\n|**canigo.integration.tributs.pica**|1.1.2|\r\n|**canigo.integration.sarcat.pica**|1.1.2|\r\n|**canigo.integration.psis**|1.1.2|\r\n|**canigo.integration.notificacions.electroniques**|1.3.1|\r\n\r\n* _Per a més informació consultar la documentació de [Canigó 3](/canigo-documentacio-versions-3x-integracio/)_\r\n\r\nEls canvis a l'esquema estan operatius des del 21 de desembre a PRE i durant els pròxims mesos s'aniran incorporant a PRO. Recomanem que es realitzin proves contra preproducció i en cas de no tenir nif/nom emissor que es demani a la PICA com més aviat millor.\r\n\r\nEn cas de tenir qualsevol dubte en l'ús per part de les aplicacions dels connectors amb la PICA us podeu posar en contacte amb el CS Caniǵo a través del [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/CAN) amb una petició de consulta o suport, o bé enviant-nos un correu a la nostra [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDEtMjgtQ2FuaWdvLUNvbm5lY3RvcnMtUElDQQ=="},"L25vdGljaWVzLzIwMTYtMDItMDQtU0lDLUludGVncmFjaW8tQ29udGludWEtZG90TmV0":{"date":1454544000000,"title":"Suport complet del SIC a la integració contínua amb .NET","description":"El SIC s'ha certificat en la construcció, en la gestió de dependències i en els desplegaments d'aplicatius programats amb .NET","sections":["Notícies","home"],"categories":["sic"],"key":"FEBRER2016","path":"/noticies/2016-02-04-SIC-Integracio-Continua-dotNet","content":"__Els inicis amb MSBuild__\r\n\r\nDes de l'estiu de 2015, el SIC ha estat treballant per poder oferir el mateix suport a les aplicacions desenvolupades amb .NET que el que ja ofereix a les aplicacions desenvolupades amb Java.\r\n\r\nCom a primer pas en la integració de .NET al SIC, es va habilitar la compilació i el muntatge d'aquest tipus d'aplicacions mitjançant [MSBuild](https://msdn.microsoft.com/es-es/library/dd393574.aspx).\r\n\r\nLa utilització de MSBuild permet controlar amb un fitxer xml el procés de compilació i muntatge del programari d'una forma equivalent a les eines del món Java tals com ANT i Maven. Amb MSBuild, a través de la definició de tasques i d'objectius en aquest fitxer xml, es pot orquestrar la gestió de mòduls i la generació dels artefactes .NET.\r\n\r\n__Gestió de dependències amb NuGet__\r\n\r\nUn element fonamental en la integració contínua és la gestió de dependències. L'ús de llibreries provinents de repositoris oficials o de pròpies validades i emmagatzemades en un repositori de confiança garanteix l'absència d'errors de compatibilitat entre les llibreries utilitzades en l'entorn de desenvolupament i l'entorn d'execució.\r\n\r\nDurant la tardor de 2015, es va habilitar un nou repositori en el servidor Nexus del SIC que permet emmagatzemar llibreries .NET. Es tracta d'un repositori Nexus compatible amb [NuGet](https://www.nuget.org/). A més, es va habilitar en els servidors d'integració contínua l'ús d'aquest repositori per fer el muntatge de l'aplicació. D'aquesta manera, es garanteix que les llibreries utilitzades són fiables tant en termes de compatibilitat i fiabilitat com de seguretat.\r\n\r\n__Desplegaments amb Web Deploy__\r\n\r\nUn cop s'ha aconseguit controlar el procés de muntatge i la gestió de dependències, era el torn estandarditzar el procés de desplegament als servidors.\r\n\r\nDurant el mes de gener de 2016, s'han certificat al SIC els desplegaments a IIS mitjançant [Web Deploy](https://www.microsoft.com/es-es/download/details.aspx?id=43717&751be11f-ede8-5a0c-058c-2ee190a24fa6=True). Amb aquesta eina, s'aprofita la generació de l'empaquetament zip --que es desa en el procés de muntatge en les carpetes de binaris-- per desplegar l'aplicació de forma automàtica als servidors IIS.\r\n\r\nAquest sistema de desplegament és el que internament utilitza Visual Studio en els entorns de desenvolupament.\r\n\r\nAmb aquestes tres eines, el SIC està preparat per oferir un suport complet a les aplicacions desenvolupades amb .NET. La tecnologia .NET ja és considerada \"first class\" dins del SIC, amb totes les prestacions que fins avui només gaudia la tecnologia JEE.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDItMDQtU0lDLUludGVncmFjaW8tQ29udGludWEtZG90TmV0"},"L25vdGljaWVzLzIwMTYtMDItMTAtU0lDLUNhbnZpcy1wZXRpY2lvbnMtZGVzcGxlZ2FtZW50cy1qb2JzLVBSRS1QUk8=":{"date":1455062400000,"title":"Canvi al sistema d'obertura de peticions als jobs de desplegament a PRE/PRO de SIC","description":"Fins el moment, les peticions de desplegament a entorns PRE/PRO que es demanaven mitjançant jobs de Jenkins SIC seguien l'antic model d'obertura de peticions: correu a la bústia de SAU. Amb l'entrada de Remedy, el mecanisme per a demanar desplegaments ha canviat.","sections":["Notícies","home"],"categories":["sic"],"key":"MARC2016","path":"/noticies/2016-02-10-SIC-Canvis-peticions-desplegaments-jobs-PRE-PRO","content":"Fins el moment, les peticions de desplegament a entorns PRE/PRO que es demanaven mitjançant jobs de Jenkins SIC seguien l'antic model d'obertura de peticions: correu a la bústia de SAU.\r\nAmb l'entrada de Remedy, el mecanisme per a demanar desplegaments ha canviat. Les aplicacions donades d'alta a Remedy han de demanar els desplegaments mitjançant l'obertura d'un tiquet de tipus canvi a l'eina.\r\nL'equip de SIC ha treballat en l'adaptació dels jobs de desplegament a PRE/PRO per tal d'acollir-se al model de peticions de desplegament mitjançant Remedy.\r\n\r\nEls jobs de desplegament a PRE/PRO de SIC adaptats a aquest sistema:\r\n\r\n* Pujaran els artefactes a desplegar als servidors de CPD (aquest punt no canvia respecte al model anterior).\r\n* Obriran un **canvi de tipologia “Desplegament” i en estat=”Draft”** a Remedy (no es requerirà passar prèviament per l'Atrium Impact Simulator) i com a Sol·licitant l'usuari que ha executat el job de desplegament. **L'usuari que executarà el job ha d'estar donat d'alta a GICAR i amb usuari autoritzat a treballar a ITSM Remedy. Si no és així, ITSM Remedy denegarà l'obertura del canvi** i el job finalitzarà amb error.\r\n* Els valors dels camps 'Summary' i 'Notes' que figuraran al Draft del canvi, es correspondran amb els camps 'TITOL' i 'OBSERVACIONS' del job de Jenkins. Aquests s'indicaran amb un valor per defecte que l'usuari podrà editar. La informació sobre la ubicació on s'han pujat prèviament els artefactes a desplegar s'afegirà automàticament al camp ''Notes'.\r\n* Una vegada creat el Draft, el job retornarà l'identificador de petició creada a Remedy. En paral·lel, ITSM Remedy enviarà una notificació d'obertura de tasca a la bústia de l'usuari que ha executat el job des del SIC.\r\n* El Draft es generarà amb uns camps mínims. Posteriorment, qualsevol usuari del grup de gestió d’ITSM REMEDY associat al desplegament haurà d'accedir al Draft per completar la resta de dades (incloent el document amb les instruccions de desplegament) i aplicar la instrucció operativa vigent de Gestió de Canvis.\r\n\r\n\r\n<center>![autoritzacions_peticions_responsables.png](/images/news/SIC-Jobs-peticions-Remedy.png)</center>\r\n\r\nEl canvi es va activar el dia **22 de Febrer** per als jobs d'aquelles aplicacions que ja es trobin dins Remedy. Els jobs de la resta d'aplicacions que encara no s'hagin integrat a Remedy mantindran l'antic sistema d'obertura de petició via correu a SAU.\r\nEn el moment que aquestes aplicacions s'afegeixin a Remedy, l'equip de SIC actualitzarà els seus jobs per tal que facin servir el model d'obertura de canvis via ITSM Remedy (els proveïdors no s'hauran de preocupar de demanar l'actualització dels jobs).\r\n\r\nPer a qualsevol dubte relatiu a aquest canvi, podeu contactar amb SAU (sau.tic@gencat.cat / Consulta al servei 'FRAMEWORK SIC' de Remedy).\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDItMTAtU0lDLUNhbnZpcy1wZXRpY2lvbnMtZGVzcGxlZ2FtZW50cy1qb2JzLVBSRS1QUk8="},"L25vdGljaWVzLzIwMTYtMDMtMDEtQ2FuaWdvLUNvbm5lY3Rvci1QU0dE":{"date":1456790400000,"title":"Nou connector de Canigó 3 amb la Plataforma de Serveis de Gestió documental (PSGD)","description":"S'ha publicat un nou connector de Canigó 3 amb la Plataforma de Serveis de Gestió documental (en endavant PSGD). El propòsit del connector és proporcionar una interfície Java per accedir als serveis exposats per la PSGD.","sections":["Notícies","home"],"categories":["canigo"],"key":"MARC2016","path":"/noticies/2016-03-01-Canigo-Connector-PSGD","content":"S'ha publicat un nou connector de Canigó 3 amb la Plataforma de Serveis de Gestió documental (en endavant PSGD). El propòsit del connector és proporcionar una interfície Java per accedir als serveis exposats per la PSGD.\r\n\r\nEl connector permet el consum de totes les funcionalitats oferides per aquest servei:\r\n\r\n* _Gestió del token d'autenticació_: controla el cicle de vida del token d'autenticació renovant-ho automàticament quan aquest hagi caducat\r\n* _Gestió de documents_: permet el consum de les funcionalitats relacionades amb documents\r\n\t- Alta d’un nou document (en streaming)\r\n\t- Baixa lògica d’un document\r\n\t- Marcar un document com a no modificable (“Check-out”)\r\n\t- Carregar una nova versió d’un document i marcar-lo com a modificable (“Check-in”)\r\n\t- Editar les metadades d’un document\r\n\t- Descarregar un document (en streaming)\r\n\t- Cercar documents en funció de les seves metadades\r\n* _Gestió de relació d’expedients_: permet el consum dels serveis relacionats amb la gestió de carpetes contenidores de documents\r\n\t- Alta d’un expedient\r\n\t- Baixa d’un expedient\r\n\t- Assignació d’un document a un expedient\r\n\t- Eliminar l’assignació d’un document a un expedient\r\n* _Gestió del repositori_: permet el consum dels serveis relacionats amb la gestió del quadre de classificació i del tipus de documents\r\nsuportats.\r\n\t- Manteniment del quadre de classificació\r\n\t- Manteniment de la tipologia de documents\r\n\r\nAquest connector és el primer dins el framework que consumeix serveis REST i no Webservices (SOAP). Donat que Canigó està basat en [Spring](https://projects.spring.io/spring-framework/) s'ha emprat la classe [RestTemplate](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html) per a la seva implementació. Destacar també la modalitat en streaming utilitzada per l'enviament de fitxers de gran mida evitant possibles problemes de memòria en les aplicacions.\r\n\r\nEn cas de tenir qualsevol dubte en l'ús del connector de Canigó 3 amb la PSGD podeu consultar la [documentació del connector](http://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-integracio/modul-psgd/) publicada al portal, posar-vos posar en contacte amb el CS Caniǵo a través del [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/CAN) amb una petició de consulta o suport, o bé enviant-nos un correu a la nostra [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDMtMDEtQ2FuaWdvLUNvbm5lY3Rvci1QU0dE"},"L25vdGljaWVzLzIwMTYtMDMtMzEtU0lDLURlc3BsZWdhbWVudC1kZS1zaXRlcy1zdGF0aWNzLWFsLWNsb3Vk":{"date":1459382400000,"title":"SIC. S'habiliten els desplegaments de sites estàtics al núvol","description":"A partir d'aquest mes de març, el SIC comença a fer les seves primeres passes amb les tecnologies cloud integrant el desplegament de sites estàtics a Bluemix, el servei al núvol d'IBM.","sections":["Notícies","home"],"categories":["sic"],"key":"ABRIL2016","path":"/noticies/2016-03-31-SIC-Desplegament-de-sites-statics-al-cloud","content":"Un dels objectius que el SIC s'ha fixat enguany és ampliar el ventall de tecnologies i paradigmes que suporta per donar servei al màxim d'aplicacions possible. Amb la integració dels desplegaments de sites estàtics al núvol, s'inicia un nou camí en què es pretèn que el paraigua de la Integració Contínua acabi cobrint el 100% de les aplicacions de la Generalitat de Catalunya que requereixin desplegar-se en aquest nou tipus d'entorn.\r\n\r\nEl SIC ha publicat una nova versió del *Formulari d’alta d’aplicació per al Portal d’Integració Contínua (Tasques al Jenkins)* que podeu trobar a [la plana de Formularis del SIC del Portal](http://canigo.ctti.gencat.cat/sic-documentacio/formularis/). És mitjançant aquest formulari que es pot sol·licitar aquest nou tipus de desplegaments. Veureu que s’ha creat un nou apartat \"Web estàtiques\" per aplicacions d'aquest tipus.\r\n\r\n### Sites estàtics a Bluemix\r\n\r\nVal a dir que, com a primera aproximació a aquest nou escenari, el SIC ha decidit limitar-se al desplegament de sites estàtics a Bluemix, la solució Cloud d'IBM.\r\n\r\nBluemix permet per desplegar múltiples aplicacions i/o serveis ja siguin en forma de buildpacks --com és en aquest cas-- o d'altres --com per exemple contenidors Docker--. Aquests elements desplegats s'emmagatzemen dins d'un espai determinat que, alhora, pertany a una organització concreta. És a dir, una organització pot contenir múltiples espais que alhora poden contenir diverses aplicacions. Aquesta és la jerarquia utilitzada a Bluemix per estructurar les aplicacions i els serveis albergats.\r\n\r\n<center>![sites_estatics_Bluemix.png](/images/news/sites_estatics_Bluemix.png)</center>\r\n\r\n### Jobs de Jenkins\r\n\r\nEn principi, cada aplicació web estàtica al Bluemix requerirà la creació de tres jobs de jenkins:\r\n\r\n* **Job de tipus BLD**: s'encarregarà de realitzar les mètriques de codi necessàries, la construcció de l'artefacte i la generació dels arxius de manifest per a cada entorn.\r\n* **Job de tipus PRE**: s'encarregarà de realitzar la construcció de l'artefacte i el desplegament a Bluemix utilitzant l'arxiu de manifest per a aquest entorn.\r\n* **Job de tipus PRO**: s'encarregarà de desplegar l'artefacte construït de forma satisfactòria en l'anterior entorn utilitzant l'arxiu de manifest per a aquest entorn.\r\n\r\n### Properes passes\r\n\r\nEn futures ampliacions del servei, es pretén donar suport a múltiples tipologies d'aplicació així com a múltiples proveïdors d'infrastructura al núvol.\r\n\r\nCom sempre, per a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDMtMzEtU0lDLURlc3BsZWdhbWVudC1kZS1zaXRlcy1zdGF0aWNzLWFsLWNsb3Vk"},"L25vdGljaWVzLzIwMTYtMDQtMDEtU0lDLUV0aXF1ZXRhZ2UtYWwtU1ZO":{"date":1459468800000,"title":"SIC. Etiquetatge de versions al SVN del SIC","description":"Hi ha diverses maneres de crear versions de codi al repositori SVN del SIC (sota directori /tags). Aquest article pretén recollir-ne algunes i aconsellar l'ús d'una en particular.","sections":["Notícies","home"],"categories":["sic"],"key":"ABRIL2016","path":"/noticies/2016-04-01-SIC-Etiquetage-al-SVN","content":"Hi ha diverses maneres de crear versions de codi al repositori SVN del SIC (sota directori /tags). Aquest article pretén recollir-ne algunes i aconsellar l'ús d'una en particular.\r\n\r\nEs parteix del fet que, tal com s'esmenta al [Manual d'Integració amb SIC] (http://canigo.ctti.gencat.cat/related/sic/manual-integracio.pdf), ja s'ha realitzat una primera pujada del codi font al directori /trunk del repositori de l'aplicació al SVN del SIC.\r\n<center>![etiquetatge_svn_trunk.PNG](/images/news/etiquetatge_svn_trunk.PNG)</center>\r\n\r\nLes posteriors versions (estables) del codi haurien de constar al directori /tags del repositori SVN de l'aplicació. Aquestes versions es poden generar de les següents maneres:\r\n\r\n<br/>\r\n<br/>\r\n\r\n**A partir del codi font de l'entorn de desenvolupament local**\r\n\r\nEs sincronitzaria el codi font de l'entorn local amb una nova carpeta dins el directori /tags del repositori SVN i es faria un checkin d'aquest. Això implicaria la creació d'una nova còpia etiquetada del codi al repositori, deslligada de la versió que figura al directori /trunk.\r\n<center>![etiquetatge_svn_opcio1.PNG](/images/news/etiquetatge_svn_opcio1.PNG)</center>\r\n\r\n<br/>\r\n<br/>\r\n\r\n**A partir del codi font al /trunk del repositori SVN del SIC**\r\n\r\nEn primer lloc caldria sincronitzar el codi font de l'entorn local amb el de la carpeta /trunk del repositori SVN de l'aplicació al SIC. Posteriorment caldria generar un tag d'aquest contingut i deixar-ho a la carpeta de /tags. La versió etiquetada del codi no seria una nova còpia del codi sinó una referència a al contingut del /trunk en el moment de generar-la (alterar posteriorment el contingut del /trunk no alterarà el contingut del tag generat).\r\n<center>![etiquetatge_svn_opcio2.PNG](/images/news/etiquetatge_svn_opcio2.PNG)</center>\r\n\r\n<br/>\r\n\r\n\r\nDes de SIC recomanem fer servir aquesta segona manera d'etiquetar per 2 motius:\r\n\r\n* Es redueix considerablement el temps d'espera en fer el checkin donat que només s'actualitzen els canvis al /trunk i l'operació de crear el tag del contingut del /trunk al repositori SVN és immediata.\r\n* Es genera un històric de canvis entre les versions, doncs les versions generades al /tag es troben lligades al /trunk, no són còpies noves de codi font.\r\n\r\n**NOTA**: Es recorda que els repositoris SIC són considerats com a repositoris d'entregables, no com a repositoris de treball. Per tant, només s'hauria de pujar el codi font en el /trunk quan es desitgi publicar una nova versió del codi.\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDQtMDEtU0lDLUV0aXF1ZXRhZ2UtYWwtU1ZO"},"L25vdGljaWVzLzIwMTYtMDQtMTQtQ2FuaWdvLUFkbWluaXN0cmFjaW8tTG9ncw==":{"date":1460592000000,"title":"Canigó. Nou Mòdul d'Administració de Logs","description":"Nou mòdul per al monitoratge i administració de logs d'aplicacions Canigó 3.1.","sections":["Notícies","home"],"categories":["canigo"],"key":"MAIG2016","path":"/noticies/2016-04-14-Canigo-Administracio-Logs","content":"S'ha publicat un nou mòdul de Canigó 3.1 amb la finalitat de proporcionar als proveïdors d'aplicacions eines per a l'administració i monitoratge de logs.\r\n\r\nAquest mòdul \"canigo.operation.logging\" ofereix les següents funcionalitats:\r\n\r\n### Funcionalitats\r\n\r\n#### Canviar en calent el nivell de log dels diferents paquets de l'aplicació\r\n\r\n<center>![configuracioNivellLog.PNG](/images/news/configuracioNivellLogs.PNG)</center>\r\n\r\n#### Visualització de fitxers de logs en temps real mitjançant streaming amb WebSockets\r\n\r\n<center>![visualitzacioLogs.PNG](/images/news/VisualitzacioLogs.PNG)</center>\r\n\r\n#### Descarregar els fitxers de logs\r\n\r\n<center>![descarregaLogs.PNG](/images/news/descarregaLogs.png)</center>\r\n\r\n### Plugin Canigó per Eclipse\r\n\r\nTambé s'ha publicat la versió 1.5.1 del [Plugin de Canigó per Eclipse] (/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf) el qual inclou la possibilitat d'afegir/eliminar aquest mòdul a una aplicació Canigó 3.1.\r\n\r\nAmb el Plugin de Canigó per Eclipse, en cas de crear una aplicació amb arquitectura REST+HTML5/JS el mòdul d'administració de logs ja ve inclòs per defecte.\r\n\r\n### Aplicació Demo\r\n\r\nDes del CS Canigó es proporciona una aplicació de demo d’aquest mòdul. Podeu trobar el codi font en el següent [enllaç](https://github.com/gencat/demoAdminLogs).\r\n\r\nPer a més informació sobre el mòdul podeu consultar la [documentació](/canigo-documentacio-versions-3x-core/modul-logging-admin/) publicada en el portal.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDQtMTQtQ2FuaWdvLUFkbWluaXN0cmFjaW8tTG9ncw=="},"L25vdGljaWVzLzIwMTYtMDQtMTgtU0lDLVBvbGl0aXF1ZXMtcmVzcGVjdGUtbm92ZXMtYXBsaWNhY2lvbnM=":{"date":1460937600000,"title":"SIC. Polítiques d'integració respecte a noves aplicacions","description":"Des de SIC es pretén recuperar la funcionalitat original dels repositoris SVN (custòdia del codi font) i promocionar l'us de la Plataforma d'Integració Contínua per a construïr i desplegar els binaris de les aplicacions.","sections":["Notícies","home"],"Draft":true,"categories":["sic"],"key":"MAIG2016","path":"/noticies/2016-04-18-SIC-Politiques-respecte-noves-aplicacions","content":"Als seus inicis, els repositoris SVN de CTTI es van concebir per a la custòdia i versionat de codi font de les aplicacions i la Plataforma d'Integració Contínua (jobs Jenkins) per construir els binaris a partir d'aquest codi font i desplegar-los als servidors d'aplicacions.\r\n\r\nAmb el pas del temps i de manera involuntària, s'ha permés l'ús dels repositoris SVN com a font d'intercanvi de binaris de les aplicacions amb CPD per tal que aquests darrers els puguin recollir i desplegar als seus entorns. Com a conseqüència d'aquest mode de treball, l'ús de la Plataforma d'Integració Contínua per construir i desplegar aplicacions ha quedat força desplaçat.\r\n\r\n\r\nDes de SIC es pretén recuperar la funcionalitat original dels repositoris SVN (custòdia del codi font) i promocionar l'ús de la Plataforma d'Integració Contínua per a construïr i desplegar els binaris de les aplicacions.\r\n\r\nPer a tal efecte i amb l'acord de CTTI, com a part de la preparació del servei totes les noves aplicacions hauràn de fer servir els repositoris SVN per a la custòdia de codi i la Plataforma d'Integració Contínua per a construïr els binaris i desplegar l'aplicació (les que es trobin suportades).\r\n\r\nPer a les aplicacions ja existents que facin servir els repositoris SVN per a compartir els binaris amb CPD, per el moment no s'obligarà però sí s'aconsella que s'addereixin al sistema de construcció i desplegament d'aplicacions de la Plataforma d'Integració Contínua (jobs Jenkins).\r\n\r\nS'ha elaborat el següent díptic que ha de servir com a carta de presentació de SIC i sumaritza els pasos necessaris per integrar-se.\r\n\r\n<center>![descarregaLogs.PNG](/images/news/descarregaLogs.png)</center>\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDQtMTgtU0lDLVBvbGl0aXF1ZXMtcmVzcGVjdGUtbm92ZXMtYXBsaWNhY2lvbnM="},"L25vdGljaWVzLzIwMTYtMDUtMjgtQ2FuaWdvLVByb2Nlcy1hY3R1YWxpdHphY2lvLWEtQ2FuaWdvLTNfMQ==":{"date":1464393600000,"title":"Canigó. Actualització d'aplicacions Canigó 3.0 a Canigó 3.1","description":"Recordatori del procediment per a realitzar l'actualització d'aplicacions Canigo 3.0 a Canigó 3.1","sections":["Notícies","home"],"categories":["canigo"],"key":"JUNY2016","path":"/noticies/2016-05-28-Canigo-Proces-actualitzacio-a-Canigo-3_1","content":"Amb motiu de la recent publicació del mòdul d'[Administració de Logs de Canigó](/noticies/2016-04-14-Canigo-Administracio-Logs/), el qual té com a requisit l'ús de Canigó 3.1, us recordem com procedir per a realitzar l'actualització d'una aplicació Canigó 3.0 a Canigó 3.1. Els passos a efectuar per a realitzar l'actualització els podeu trobar en aquest [howto](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Actualitzacio+Canig%C3%B3+3.0+a+Canigo+3.1.pdf).\n\nEn cas de realitzar l'actualització en una aplicació basada en arquitectura REST+HTML5/JS, i no JSF (JavaServer Faces), el frontend no es veu afectat per l'actualització. Si l'aplicació Canigó 3.0 que s'actualitza utilitza JSF cal analitzar en detall la compatibilitat de les vistes (.jsf, .xhtml) i els seus components de presentació (Primefaces, Richfaces, ...) respecte a JSF 2.2. En aquest cas l'impacte pot ser major.\n\nCanigó 3.1 es va alliberar a finals del 2014 amb els següents canvis com a més destacables:\n\n* *Actualització de llibreries*:\n\n|   | Canigó 3.0   | Canigó 3.1 |\n|---|--------------|------------|\n| __Spring Framework__ | 3.0.3.RELEASE | 4.1.0.RELEASE |\n| __JPA__ | 1.0 | 2.1 |\n| __Hibernate__ | 3.3.2.GA | 4.3.6.Final |\n| __Servlet API__ | 2.5 | 3.0.1 |\n| __JSF__ | 2.0 | 2.2 |\n| __PICA__ | 1.6.3  | 1.9.2 |\n\n* *Revisió de llibreries*: eliminació de llibreries innecessàries i unificació de llibreries entre els diferents mòduls\n\nPer a qualsevol dubte referent al procés d'actualització de Canigó 3.0 a 3.1 podeu obrir una consulta o petició de suport al [servei CAN del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN).\n","objectID":"L25vdGljaWVzLzIwMTYtMDUtMjgtQ2FuaWdvLVByb2Nlcy1hY3R1YWxpdHphY2lvLWEtQ2FuaWdvLTNfMQ=="},"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU1vbmdvREI=":{"date":1464566400000,"title":"SIC. Suport a MongoDB","description":"Suport a la primera base de dades NoSQL al SIC. Els jobs de desplegament a INT són capaços d'executar codi Javascript per manipular documents i crear o eliminar col·leccions de documents, indexos, etc.","sections":["Notícies","home"],"categories":["SIC"],"key":"JUNY2016","path":"/noticies/2016-05-30-SIC-MongoDB","content":"Durant el mes de Maig s'ha dotat al SIC de les eines i procediments necessaris per poder donar suport a MongoDB. A  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels següents documents:\r\n\r\n- <i>[Formulari d'alta d'aplicació per al Portal d'Integració Contínua (Tasques al Jenkins)](/related/sic/SIC-Formulari-Construccio-Desplegament-Aplicacio.xlsx):</i> en aquest formulari s'ha afegit una nova pestanya \"Scripts BBDD\" amb els camps necessaris per demanar l'execució de scripts MongoDB.\r\n\r\n![Formulari scripts BBDD](/images/news/formulari_mongodb.PNG \"Formulari scripts BBDD\")\r\n\r\n- <i>[Manual d'Usuari:](/related/sic/manual-usuari.pdf)</i> afegida informació per la configuració del fitxer de plans de BBDD per a MongoDB.\r\n\r\nUn exemple de com podria quedar el fitxer de plans per a MongoDB seria el següent:\r\n\r\n![Script plans MongoDB](/images/news/plans_mongodb.PNG \"Script plans MongoDB\")\r\n\r\nL'**idBBDD** fa referència a la base de dades on s'ha d'executar el script, no al tipus (podria haver scripts per dues bases de dades MongoDB, per exemple).\r\n\r\nDestacar que l'execució de scripts només es troba disponible per als entorns d'INT. Per PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD, i enviament de correu de sol·licitud de desplegament a SAU CTTI o sol·licitud de canvi a Remedy.\r\n\r\nPer a qualsevol dubte referent a l'execució de scripts de MongoDB ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU1vbmdvREI="},"L25vdGljaWVzLzIwMTUtMTItMjMtU0lDLU5vdS1yb2wtZGUtcGV0aWNpb25hcmktYS1TQVUtUmVtZWR5":{"date":1450828800000,"title":"SIC. Nou rol de peticionari SIC a SAU-Remedy","description":"Neix a SIC un nou tipus d'usuari: Gestor de peticions a SAU-Remedy. Aquest tipus d'usuari pretén flexibilitzar el sistema d'autorització de peticions de SIC afegint un nou conjunt d'usuaris autoritzats per a poder demanar certs tipus de peticions de suport de FRAMEWORK SIC a SAU- Remedy.","sections":["Notícies","home"],"categories":["sic"],"key":"GENER2016","path":"/noticies/2015-12-23-SIC-Nou-rol-de-peticionari-a-SAU-Remedy","content":"Neix a SIC un nou tipus d'usuari: Gestor de peticions a SAU-Remedy. Aquest tipus d'usuari pretén flexibilitzar el sistema [d'autorització de peticions de SIC] (http://canigo.ctti.gencat.cat/noticies/2015-12-18-SIC-Sistema-autoritzacions-peticions/) afegint un nou conjunt d'usuaris autoritzats a poder demanar certs tipus de peticions de suport de FRAMEWORK SIC a SAU- Remedy.\r\n\r\nAquests usuaris **no tindran accés als serveis de SIC** (no podrà treballar amb repositoris SVN ni amb jobs de Jenkins). El seu abast **es limitarà a poder demanar**  mitjançant SAU-Remedy:\r\n\r\n* Altes / modificacions de Jobs\r\n* Altes de llibreries a Nexus\r\n* Fer consultes sobre SIC\r\n* Reportar incidències relacionades amb serveis de SIC.\r\n\r\nLa petició d'inscripció en aquest grup d'usuaris cal que sigui efectuada pels responsables d'arquitectura i qualitat del Lot. L'haurà de demanar mitjançant petició de suport funcional a [SAU-Remedy](http://canigo.ctti.gencat.cat/sic/peticions/),adjuntant el [formulari d'alta] (http://canigo.ctti.gencat.cat/sic-documentacio/formularis/) corresponent.\r\nLes peticions que demani aquest grup d'usuaris hauran de ser referents a aplicacions del seu mateix lot.\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .","objectID":"L25vdGljaWVzLzIwMTUtMTItMjMtU0lDLU5vdS1yb2wtZGUtcGV0aWNpb25hcmktYS1TQVUtUmVtZWR5"},"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU5vZGVKUw==":{"date":1464566400000,"title":"SIC. Suport a NodeJS","description":"Suport a construcció i desplegament d'aplicacions NodeJS. Inclou resolució de dependències amb npm (Node Package Manager) per JavaScript.","sections":["Notícies","home"],"categories":["SIC"],"key":"JUNY2016","path":"/noticies/2016-05-30-SIC-NodeJS","content":"Durant el mes de Maig s'ha dotat al SIC de les eines i procediments necessaris per poder empaquetar i desplegar aplicacions [NodeJS](https://nodejs.org/) en entorns corporatius. A la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels següents documents:\r\n\r\n- <i>[Formulari d'alta d'aplicació per al Portal d'Integració Contínua (Tasques al Jenkins)](/related/sic/SIC-Formulari-Construccio-Desplegament-Aplicacio.xlsx):</i>  en aquest formulari s'ha afegit una nova pestanya \"NodeJS-Construcció,Desplegament\" amb els camps necessaris per al desplegament d'aplicacions NodeJS en entorns d'INT, PRE i PRO.\r\n- <i>[Manual d'Integració:](/related/sic/manual-integracio.pdf)</i> afegit detall dels requeriments per la integració d'aplicacions NodeJS al SIC.\r\n- <i>[Manual d'Usuari:](/related/sic/manual-usuari.pdf)</i> afegida informació per l'ús de Jenkins per tal de fer desplegaments d'aplicacions NodeJS amb el SIC.\r\n\r\nLa custòdia de codi d'aplicacions NodeJS al SVN del SIC ja era permesa, i amb l'afegit de la construcció i els desplegaments es proveeix al SIC de la possibilitat de gestionar el cicle de vida d'aplicacions desenvolupades amb aquesta tecnologia. Al SIC es resolen les dependències de l'aplicació via [npm (Node Package Manager)](https://www.npmjs.com/) a través del Nexus, motiu pel qual no és permès pujar carpetes \"node_modules\" amb el codi d'aquestes dependències. En cas de ser necessari els proveïdors d'aplicacions poden demanar la instal·lació de paquets npm propis al Nexus.\r\n\r\nDestacar que de la mateixa manera que amb aplicacions JEE i PHP, també es permet l'execució de scripts de bases de dades Oracle/MongoDB en els desplegaments automàtics a INT. Per a PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD i enviament de correu de sol·licitud de desplegament a SAU CTTI o sol·licitud de canvi a Remedy.\r\n\r\nPer a qualsevol dubte referent a la integració d'aplicacions NodeJS al SIC ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU5vZGVKUw=="},"L25vdGljaWVzLzIwMTYtMDYtMDgtR0lDQVItZG9jdW1lbnRhY2lv":{"date":1465344000000,"title":"GICAR. Publicació de la documentació al web d'Arquitectura","description":"Publicació de la documentació de GICAR al web d'arquitectura i les novetats en quant a l'entorn de desenvolupament","sections":["Notícies","home"],"categories":["GICAR"],"key":"JULIOL2016","path":"/noticies/2016-06-08-GICAR-documentacio","content":"Al mes de Juny es publica la documentació de GICAR a la web d'Arquitectura CTTI. \r\n\r\nAquesta documentació pretén ajudar als integradors a conèixer el funcionament de GICAR, l'arquitectura i els fluxos d'autenticació. \r\n\r\nUna fita molt important que volem destacar, és el fet que posem a disposició dels desenvolupadors, un entorn de Sandbox, públic i basat en Docker amb el qual podran fer proves de funcionament real de les aplicacions integrades amb GICAR: http://canigo.ctti.gencat.cat/gicar-integracio/sandbox/\r\n\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n\r\n![GICAR](/related/gicar/logo.png)\r\n<img src=\"/images/bloc/docker/large_h-dark-trans.png\" style=\"width:75%\" />","objectID":"L25vdGljaWVzLzIwMTYtMDYtMDgtR0lDQVItZG9jdW1lbnRhY2lv"},"L25vdGljaWVzLzIwMTYtMDctMDQtU0lDLU15U1FMLWktU1FMU0VSVkVS":{"date":1467590400000,"title":"SIC. Suport a MySQL i Microsoft SQL SERVER","description":"Suport a les bases de dades de tipus MySQL i Microsoft SQL SERVER. Els jobs de desplegament a INT són capaços d'executar scripts DDL i DML d'aquestes bases de dades.","sections":["Notícies","home"],"categories":["SIC"],"key":"JULIOL2016","path":"/noticies/2016-07-04-SIC-MySQL-i-SQLSERVER","content":"Durant el mes de Juny s'ha dotat al SIC de les eines i procediments necessaris per poder donar suport a les bases de dades *MySQL* i *Microsoft SQL SERVER*. Aquesta nova addició de tecnologies de Bases de Dades té afectació als següents documents de  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura:\r\n\r\n- <i>[Formulari d'alta d'aplicació per al Portal d'Integració Contínua (Tasques al Jenkins)](/related/sic/SIC-Formulari-Construccio-Desplegament-Aplicacio.xlsx):</i> a la llengüeta \"Scripts BBDD\" podreu incloure les dades de connexió a aquests tipus de bases de dades. Recordar-vos que per a cada connexió, caldrà copiar i pegar la taula amb la informació pertinent.\r\n\r\n![Formulari scripts BBDD MySQL i SQLSERVER](/images/news/SIC-formulari_ Jenkins_SQL.png \"Formulari scripts BBDD MySQL i SQLSERVER\")\r\n\r\n- <i>[Manual d'Usuari:](/related/sic/manual-usuari.pdf)</i> afegida informació per la configuració del fitxer de plans de BBDD per a aquestes bases de dades.\r\n\r\nA continuació es mostra un exemple de com podria quedar el fitxer de plans per a una aplicació amb que utilitzés aquestes bases de dades:\r\n\r\n![Script plans MySQL i SQLSERVER](/images/news/SIC-fitxer_plans.png \"MySQL i SQLSERVER\")\r\n\r\nAl fitxer de plans s'indica l'**idBBDD**. Aquest atribut fa referència al nom de la connexió que s'ha definit al formulari anterior i indica que l'script indicat s'ha d'executar a través de la connexió de base de dades amb aquest nom.\r\n\r\nDestacar que l'execució de scripts només es troba disponible per als entorns d'INT. Per PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD, i enviament de correu de sol·licitud de desplegament a SAU CTTI o sol·licitud de canvi a Remedy.\r\n\r\nPer a qualsevol dubte referent a l'execució de scripts de base de dades ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDctMDQtU0lDLU15U1FMLWktU1FMU0VSVkVS"},"L25vdGljaWVzLzIwMTYtMDctMDYtQ2xvdWQtZG9jdW1lbnRhY2lv":{"date":1467763200000,"title":"Container Cloud. Publicació de la documentació al web d'Arquitectura","description":"Ha estat publicada la documentació del Container Cloud al web d'arquitectura. En ella podreu trobar els diferents elements del catàleg, les plataformes cloud de referència, arquitectures tipus i la definició del cicle de vida de les aplicacions.","sections":["Notícies","home"],"categories":["cloud"],"key":"AGOST2016","path":"/noticies/2016-07-06-Cloud-documentacio","content":"Recentment ha estat publicada la documentació de [Container Cloud](http://canigo.ctti.gencat.cat/cloud/) a la web d'Arquitectura CTTI. Com a Container Cloud entenem totes aquelles solucions basades en containers (CaaS, Containers as a Service) a cloud públic i privat.\r\n\r\nLa documentació de Container Cloud es divideix en les següents seccions:\r\n\r\n* [**Elements del catàleg**](http://canigo.ctti.gencat.cat/cloud/cataleg/)\r\n\r\nFa referència a tots aquells elements que ens permetran desplegar les nostres aplicacions en el Container Cloud.\r\n\r\n* [**Plataformes cloud de referència**](http://canigo.ctti.gencat.cat/cloud/caas/)\r\n\r\nEnumeració de les diferents plataformes que componguen l'entorn Container Cloud.\r\n\r\n* [**Arquitectures tipus**](http://canigo.ctti.gencat.cat/cloud/aq/)\r\n\r\nEn aquesta secció podreu trobar diferents pilots d'arquitectures de referència desenvolupats per l'equip d'Administració del Cloud per tal de proveir d'exemples a tots aquells que vulguin desplegar les seves aplicacions en el Container Cloud.\r\n\r\n* [**Cicle de vida**](http://canigo.ctti.gencat.cat/cloud/lifecycle/)\r\n\r\nDetall de les diferents passes que ha de seguir una aplicació des de la seva fase inicial en què es fa el disseny d'arquitectura fins que es desplega al Container Cloud.\r\n\r\nPer qualsevol dubte relatiu al Container Cloud us podeu posar en contacte amb l'equip d'Administració del Cloud al [servei CLD del JIRA CSTD](http://cstd.ctti.gencat.cat/jiracstd/browse/CLD) o bé enviant un correu a la bústia [suport.cloud@gencat.cat](mailto:suport.cloud@gencat.cat)","objectID":"L25vdGljaWVzLzIwMTYtMDctMDYtQ2xvdWQtZG9jdW1lbnRhY2lv"},"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5ULWRvdE5FVA==":{"date":1438473600000,"title":"SIC. Gestió de dependències per aplicacions .NET i JAVA al SIC","description":"El SIC ha incorporat les tecnologies ANT i .NET. Us expliquem com implementar la gestió de dependències amb aquestes tecnologies.","sections":["Notícies","home"],"categories":["sic"],"path":"/noticies/2016-08-02-SIC-Gestio-Dependencies-ANT-dotNET","content":"## Gestió de dependències al SIC\r\n\r\nL'única forma fins a l'actualitat de gestionar dependències al SIC era mitjançant [Apache Maven](http://maven.apache.org/). Aquesta gestió de dependències només era possible en aplicacions JAVA i utilizava [Nexus](http://www.sonatype.com/download-oss-sonatype) com a repositori d'artefactes.\r\n\r\nUs recordem que, per defecte, no es permet la inclusió de llibreries i/o artefactes (.jar, .war, .ear, .dll...) al repositori de codi SVN del SIC. Aquests elements es poden obtenir de 3 formes diferents:\r\n\r\n* Si es tracta d'una llibreria del proveïdor, aquesta es generarà en el propi procés de construcció de l'aplicació.\r\n* Si no és una llibreria del proveïdor:\r\n\t* Si és una llibreria que es pot obtenir d'un repositori Maven / NuGet oficial, el servidor Nexus l'obtindrà en el procés  de construcció de l'aplicació.\r\n\t* Si és una llibreria que no es troba en cap repositori oficial, s'haurà de facilitar en el procés d'integracióde l'aplicació al SIC per a que sigui inclosa al repositori Nexus de forma manual.\r\n\r\nA continuació, amb l'experiència adquirida gràcies a la integració de les primeres aplicacions ANT i .NET al SIC, hem desenvolupat uns procediments per a que les aplicacions JAVA-ANT i .NET puguin gestionar dependències al SIC.\r\n\r\nSi hi esteu interessats, premeu els següents enllaços:\r\n\r\n* [Gestió de dependències amb .NET: NuGet](/noticies/2016-08-02-SIC-Gestio-Dependencies-dotNET)\r\n* [Gestió de dependències amb JAVA utilitzant ANT](/noticies/2016-08-02-SIC-Gestio-Dependencies-ANT)\r\n\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5ULWRvdE5FVA=="},"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5U":{"date":1470873600000,"title":"SIC. Gestió de dependències per aplicacions ANT","description":"Procediment de gestió de dependències amb aplicacions ANT al SIC","sections":["Notícies","home"],"categories":["sic"],"key":"SETEMBRE2016","path":"/noticies/2016-08-02-SIC-Gestio-Dependencies-ANT","content":"## Gestió de dependències amb Java utilitzant ANT\n\nPer aplicacions Java no mavenitzades, tot i que existeixen solucions com [Apache Ivy](http://ant.apache.org/ivy/), és freqüent la utilització directament d'[Apache ANT](http://ant.apache.org/) per a gestionar dependències.\n\nPer a què la gestió de dependències ANT configurada a l'aplicació sigui compatible amb el SIC, cal que compleixi els següents punts:\n\n1. Utilització d'una versió d'**ANT 1.9.2 o superior**.\n\n2. S'han d'incloure a l'inici del fitxer _build.xml_ del projecte les següents directives:\n\n\t\t(...)\n\t\t<property name=\"nexus-url\" value=\"http://hudson.intranet.gencat.cat/nexus/service/local/artifact/maven/redirect\" />\n    \n\t    <macrodef name=\"descarrega-nexus\">\n    \t    <attribute name=\"repositori\"/>\n\t        <attribute name=\"grup\"/>\n    \t    <attribute name=\"artefacte\"/>\n        \t<attribute name=\"versio\"/>\n        \t<attribute name=\"extensio\"/>\n\t        <attribute name=\"desti\"/>\n    \t    <sequential>\n            \t<echo>[NEXUS] Descarregant llibreria @{grup}.@{artefacte}-@{versio}.@{extensio}</echo>\n            \t<get src=\"${nexus-url}?r=@{repositori}&amp;g=@{grup}&amp;a=@{artefacte}&amp;v=@{versio}&amp;e=@{extensio}\" dest=\"@{desti}/@{artefacte}-@{versio}.@{extensio}\" />\n        \t</sequential>\n\t    </macrodef>\n\t\t(...)\n        \n3. Cercar al repositori Nexus del SIC la llibreria que desitgem incloure al projecte:\n\n  1. Accedim al [Nexus del SIC](http://hudson.intranet.gencat.cat/nexus)\n  2. Escrivim la llibreria que desitgem cercar:\n  <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-01.png\" style=\"margin: 10px auto;width: 80%;auto;display:block;\"/>\n  3. Ens apareixeran els resultats de la cerca:\n  <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-02.png\" style=\"margin: 10px auto;width: 80%;auto;display:block;\"/>\n  4. Seleccionem l'element desitjat. Ens apareixeran dades que necessitem informar:\n      * El grup\n      * L'artefacte\n      * La versió\n      * L'extensió\n      * Indicador del repositori (a l'esquerra)\n   <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-03.png\" style=\"margin: 10px auto;width: 80%;height: auto;display:block;\"/>\n  5. Ens falta saber el nom del repositori del qual s'ha resolt la dependència. Farem clic a *Repositoris*:\n   <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-04.png\" style=\"margin: 10px auto;display:block;\"/>\n  6. Busquem el repositori a partir de l'indicador obtingut al pas 3.4. En aquest cas, el repositori de **3rd party** és **thirdparty**:\n   <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-05.png\" style=\"margin: 10px auto;width: 80%;auto;display:block;\"/>\n4. Per a cada llibreria que tingui el projecte, invocar a la macro que hem definit en el pas 2. Com a destí, especificar la ruta (path relatiu) on guardeu les llibreries del projecte. Exemple:\n\n\t\t<descarrega-nexus repositori=\"thirdparty\" grup=\"com.liferay.portal\" artefacte=\"servlet-api\" versio=\"5.1.2\" extensio=\"jar\" desti=\"./lib/\"/>\n        \nPer a qualsevol dubte referent a la gestió de dependències amb ANT al SIC  podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei “FRAMEWORK SIC” de SAU-Remedy.\n\n","objectID":"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5U"},"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtZG90TkVU":{"date":1470096000000,"title":"SIC. Gestió de dependències per a aplicacions .NET","description":"Procediment de gestió de dependències amb aplicacions .NET al SIC","sections":["Notícies","home"],"categories":["sic"],"key":"AGOST2016","path":"/noticies/2016-08-02-SIC-Gestio-Dependencies-dotNET","content":"## Gestió de dependències amb .NET: NuGet\n\nDurant la tardor del 2015, es va habilitar un nou repositori en el servidor Nexus del SIC que permet emmagatzemar llibreries .NET. Es tracta d'un repositori Nexus compatible amb [NuGet](https://www.nuget.org/). A més, es va habilitar en els servidors d'integració contínua l'ús d'aquest repositori per fer el muntatge de l'aplicació. D'aquesta manera, es garanteix que les llibreries utilitzades són fiables tant en termes de compatibilitat i fiabilitat com de seguretat.\n\n### Llibreries a tenir en compte\n\nAbans de començar, us recordem que s'han d'incloure al projecte totes les llibreries que no venen per defecte en un servidor Windows amb la instal·lació del Framework de .NET.\n\nPer exemple, un problema que hem trobat de forma recurrent és la no inclusió de les llibreries del client de base de dades Oracle.\n\nAquestes llibreries s'instal·len als servidors i als entorns de desenvolupament i queden registrades al GAC (Global Assembly Cache) del sistema. Per tant, són llibreries que no cal incloure-les al projecte, ja que tant en l'entorn de desenvolupament com en els entorns d'Integració, Preproducció i Producció ja estan registrades.\n\nUn cop l'aplicació s'integra al SIC, aquest tipus de llibreries s'han d'incloure de forma obligada en la gestió de dependències del projecte, ja que, els servidors del SIC no les tenen instal·lades.\n\n### Com funciona?\n\nTota dependència que s'hagi d'incloure a un projecte .NET es declara a l'arxiu de projecte (_XXXXX.csproj_ ó _XXXXX.vbproj_). Les llibreries que no són de sistema queden amb un format similar al següent:\n\n\t(...)\n    <Reference Include=\"Oracle.DataAccess, Version=4.121.1.0, Culture=neutral, PublicKeyToken=89b483f429c47342, processorArchitecture=x86\">\n\t\t<Private>False</Private>\n    </Reference>\n    (...)\n\nAquestes llibreries s'han de declarar al projecte com paquets NuGet. Per tant, a l'arxiu de gestió de dependències NuGet (generalment `packages.config`) s'ha de declarar aquesta dependència:\n\n    <?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <packages>\n            (...)\n        <package id=\"Oracle.DataAccess.x86\" version=\"4.121.1.0\" targetFramework=\"net40\" />\n\t\t\t(...)\n    </packages>\n\nD'aquesta manera es descarregarà la llibreria del repositori Nexus del SIC a la carpeta `/packages`.\n\nHaurem de tornar a l'arxiu de projecte i incloure el path on s'ha descarregat la dependència:\n\n\t(...)\n    <Reference Include=\"Oracle.DataAccess, Version=4.121.1.0, Culture=neutral, PublicKeyToken=89b483f429c47342, processorArchitecture=x86\">\n\t\t<HintPath>..\\packages\\Oracle.DataAccess.x86.4.121.1.0\\lib\\net40\\Oracle.DataAccess.dll</HintPath>\n\t\t<Private>False</Private>\n    </Reference>\n    (...)\n\nPer tal que l'empaquetatge de l'aplicació continuï funcionant a l'entorn de desenvolupament, caldrà afegir la referència al Repository NuGet del Nexus del SIC (http://hudson.intranet.gencat.cat/nexus/content/groups/nuget-group/) a la configuració local (arxiu `Nuget.config`).\n\nTot i així, en molts aspectes no és necessari haver d'arribar a tan baix nivell. La comunitat .NET ofereix les següents solucions (no excloents entre si):\n\n* **NuGet Package Explorer**: Per explorar paquets NuGet i construir-los visualment.\n* **NuSpec Reference Generator**: Generar dependències per a nuspec\n* **NuProj**: Creador avançat de paquets NuGet amb intergació amb Visual Studio.\n\nPer a les llibreries de codi obert publicades al NuGet Gallery i per a les llibreries pròpies del proveïdor que es construeixen amb jobs de Jenkins *LIB* no caldrà fer cap tasca addicional. Per a la resta de llibreries, com per exemple el client d'Oracle o llibreries de proveïdors que no tenen jobs de Jenkins *LIB*, caldrà facilitar-li al SIC el paquet NuGet o l'artefacte `.dll` corresponent identificant l'*arquitectura* (**x86** o **x64**), la *versió* i el *targetFramework*.\n\nPer a qualsevol dubte referent a la gestió de dependències amb NuGet al SIC  podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei “FRAMEWORK SIC” de SAU-Remedy.","objectID":"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtZG90TkVU"},"L25vdGljaWVzLzIwMTYtMTAtMDQtU0lDLUNhcy1leGl0LWRlc3BsZWdhbWVudC1kb3RORVQ=":{"date":1475539200000,"title":"SIC. Cas d'èxit de desplegament d'una aplicació .NET","description":"El SIC ja compta amb un cas d'èxit de desplegament d'aplicació .NET mitjançant jobs de Jenkins. S'ha perfeccionat l'operativa dels jobs de desplegament d'aplicacions .NET per tal de fer-los capaços d'escollir el fitxer de configuració d'aplicació adient per a cada entorn on es desplegarà l'aplicació.","sections":["Notícies","home"],"categories":["sic"],"key":"OCTUBRE2016","path":"/noticies/2016-10-04-SIC-Cas-exit-desplegament-dotNET","content":"El SIC ja compta amb un cas d'èxit de desplegament d'aplicació .NET mitjançant jobs de Jenkins. \nS'ha perfeccionat l'operativa dels jobs de desplegament d'aplicacions .NET per tal de fer-los capaços d'escollir el fitxer de configuració d'aplicació (*Web.config*) adient per a cada entorn on es desplegarà l'aplicació. \n\nEl funcionament dels jobs que necessitin fer aquesta distinció serà el següent:\n\n* **Jobs de INT**: \n\t* Construirà els binaris de l'aplicació i empaquetarà en un ZIP tot el contingut a desplegar a l'IIS. \n\t* Es realitzarà un tractament d'aquest paquet per tal que inclogui l'arxiu de configuració de l'entorn de INT (reanomenarà el fitxer *Web.config.INT* a *Web.config*).\n\t* Mitjançant la utilitat MSDeploy, es desplegarà aquest paquet a l'IIS d'Integració.\n\t\n* **Jobs de PRE**:\n\t* Recollirà el paquet amb els binaris construïts del job de INT.\n\t* Es realitzarà un tractament d'aquest paquet per tal que inclogui l'arxiu de configuració de l'entorn de PRE (reanomenarà el fitxer *Web.config.PRE* a *Web.config*).\n\t* Pujarà a l'sFTP de CPD aquest paquet i obrirà una petició Remedy/correu a SAU demanant-ne el desplegament a PRE d'aquest.\n\t\n* **Jobs de PRO**:\n\t* Recollirà el paquet amb els binaris fet servir al job de PRE.\n\t* Es realitzarà un tractament d'aquest paquet per tal que inclogui l'arxiu de configuració de l'entorn de PRO (reanomenarà el fitxer *Web.config.PRO* a *Web.config*).\n\t* Pujarà a l'sFTP de CPD aquest paquet i obrirà una petició Remedy/correu a SAU demanant-ne el desplegament a PRO d'aquest.\n\t\n\n\n\nLa següent imatge il·lustra aquest comportament:\n\n![Funcionament jobs .NET](/images/news/SIC-funcionament-jobs-net.png \"Funcionament jobs .NET\")\n\nAquest sistema permetrà mantenir el principi de construcció única dels binaris + promoció d'aquests entre els diferents entorns.\n\nVal a dir que les aplicacions necessitin d'aquesta distinció de fitxers de configuració per entorn hauran d'incloure les diferents versions d'aquest fitxer al codi font (*Web.config.INT*, *Web.config.PRE*, *Web.config.PRO*). Per a aquelles aplicacions que no necessitin mantenir diferents configuracions per entorn, no s'aplicarà el tractament a l'empaquetat dels binaris abans d'enviar-ho a desplegar.\n\n\nPer a qualsevol dubte referent al funcionament dels jobs de desplegament automàtic /petició de desplegament d'aplicacions .NET, podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy.\n","objectID":"L25vdGljaWVzLzIwMTYtMTAtMDQtU0lDLUNhcy1leGl0LWRlc3BsZWdhbWVudC1kb3RORVQ="},"L25vdGljaWVzLzIwMTYtMTEtMDctU0lDLUFjdHVhbGl0emFjaW8tc29mdHdhcmU=":{"date":1478563200000,"title":"SIC. Actualització de versions d'eines al SIC","description":"El 28 d'Octubre es va portar a terme una actualització de versions d'alguns components de software al SIC per tal d'acomplir el full de ruta del CTTI","sections":["Notícies","home"],"categories":["sic"],"key":"NOVEMBRE2016","path":"/noticies/2016-11-07-SIC-Actualitzacio-software","content":"El 28 d'Octubre es va portar a terme una actualització de versions d'alguns components de software al SIC. A continuació s'exposa una taula amb el detall del programari i les versions que s'han actualitzat / afegit.\n\n\n|Programari|Versió actual|\n|------------|-------------|\n|Jenkins|~~1.609.3~~  **2.7.4**|\n|SVN|1.8.14|\n|Nexus|2.11|\n\n\nL'actualització a [Jenkins 2.7.4](https://jenkins.io/2.0/) permetrà poder fer ús de [Pipelines](https://jenkins.io/doc/book/pipeline/). Les pipelines suposaran una millora substancial respecte al control del flux d'execució dels jobs, oferint més possibilitats i permetent controlar totes les fases del procés de CD (Continuous Delivery).\n\nPer altra banda, s'ha afegit la versió de JDK 1.8, el connector d'Oracle DB 12.1 i la versió de Maven 3.3.9 a la plataforma Jenkins del SIC. D'aquesta manera, el SIC segueix aliniat amb el [full de ruta del programari](https://portic.ctti.gencat.cat/les_tic/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf) i es troba preparat per poder construir i desplegar les aplicacions que facin ús d'algunes de les tecnologies més recents.\n\nS'aprofita aquest article per informar les versions de software (llenguatges, servidors JEE/contenidors de servlets, bases de dades) suportats pel SIC:\n\n|Tecnologia|Versió|\n|----------------------|-------------|\n|JDK|1.5, 1.6, 1.7, **1.8**|\n|Oracle DB|10.2.0.5.0, **12.1**|\n|Maven|2.0.9, 2.0.10, 2.2.1, 3.2.2, **3.3.9**|\n|.NET|4.5.2|\n|ANT|1.8.2, 1.9.6|\n|IBM WAS|8.5.5|\n|node.js|0.12.13, 4.4.3, 5.10.1|\n|MongoDB|3.2.5|\n|MS SQLServer|2014|\n|MySQL|5.7.9|\n","objectID":"L25vdGljaWVzLzIwMTYtMTEtMDctU0lDLUFjdHVhbGl0emFjaW8tc29mdHdhcmU="},"L25vdGljaWVzLzIwMTYtMTItMDEtU0lDLU5vdmEtQ3JlYWNpby1NYXNzaXZhLVJlcG9zaXRvcmlzU1ZO":{"date":1480550400000,"title":"SIC. Nova creació massiva de repositoris SVN","description":"Des de SIC s'ha recopilat la informació de les aplicacions que encara no tenen repositori a SIC i s'ha portat a terme un nou procés de creació massiva de repositoris SVN","sections":["Notícies","home"],"categories":["sic"],"key":"DESEMBRE2016","path":"/noticies/2016-12-01-SIC-Nova-Creacio-Massiva-RepositorisSVN","content":"A l'Agost del 2014 el SIC es va adaptar al nou model TIC. Com a part del procés d'adaptació, es van crear els repositoris SVN de les aplicacions de les quals es tenien constància. A partir d'aquella data, els repositoris SVN de les noves aplicacions s'han creat sota demanda dels proveïdors d'aplicacions o Departament.\n\nAquest mes de Novembre s'ha extret de l'inventari d'aplicacions del Pòrtic la informació de les aplicacions que encara no tenen repositori SVN a SIC, i s'ha portat a terme un nou procés de creació massiva de repositoris SVN. \n\nEl llistat dels repositoris SVN donats d'alta fins al moment es pot consultar al següent [document] (/related/sic/Repositoris_SVN_Creats_A_SIC_Novembre2016.xlsx). \n\n\n<CENTER>![sic](/images/news/SIC_repositoris_creats_Novembre2016.png)</center>\n\n\nEs preveu repetir aquest procés d'identificació i creació massiva de repositoris periòdicament.\n\nEls proveïdors d'aplicacions que disposin d'usuari SIC i trobin creat els repositoris SVN de les aplicacions que mantenen (sota http://svn.intranet.gencat.cat/ [àmbit]), ja podran fer-los servir sense necessitat de formalitzar la petició d'alta del repositori a SIC. Altrament, hauran de continuar formalitzant la [petició d'alta de repositori] (http://canigo.ctti.gencat.cat/sic/peticions/) a SIC.\n","objectID":"L25vdGljaWVzLzIwMTYtMTItMDEtU0lDLU5vdmEtQ3JlYWNpby1NYXNzaXZhLVJlcG9zaXRvcmlzU1ZO"},"L25vdGljaWVzLzIwMTYtMTItMDQtQ2FuaWdvLUpXVA==":{"date":1480809600000,"title":"Canigó. Autenticació amb JWT (JSON Web Tokens)","description":"Autenticació amb JWT en aplicacions Canigó 3.1.x. Comparativa amb sistema tradicional basat en cookies","sections":["Notícies","home"],"categories":["canigo"],"key":"DESEMBRE2016","path":"/noticies/2016-12-04-Canigo-JWT","content":"El sistema d'autenticació tradicional utilitzat en aplicacions Canigó es basa en **cookies**. JSESSIONID és la cookie generada per contenidors de Servlets i servidors JEE, i s'utilitza per a la gestió de la sessió. El servidor crea i envia la cookie al client, el qual l'envia al servidor per a cada petició HTTP posterior. D'aquesta manera el servidor pot relacionar peticions separades que arribin d'un mateix client. Aquest sistema d'autenticació basat en cookies és **stateful**. Això significa que es manté sessió tant al costat servidor (sessió HTTP), com al client (Cookie).\n\nAquest sistema de gestió de la sessió mitjançant cookies té una sèrie d'inconvenients:\n\n* _Sobrecàrrega_: la informació relativa als usuaris normalment s'emmagatzema en memòria. Quan hi ha molts usuaris connectats, augmenta el consum de memòria al servidor.\n\n* _No escalable fàcilment_: com que s'emmagatzema informació en memòria, si necessitem balancejar la càrrega entre diferents servidors, l'usuari haurà de tornar a logar-se si les peticions no van sempre dirigides al mateix servidor. Gràcies a tècniques com sticky session o rèplica de sessió entre nodes es pot evitar. Tot i així, l'ús de cookies dificulta l'escalabilitat de les aplicacions, mentre que amb tokens el problema es soluciona de forma natural.\n\n* _CORS (Cross-Origin Resource Sharing)_: cookies + CORS no funcionen bé amb diferents dominis. \n\n* _CSRF (Cross-Site Request Forgery)_: amb cookies estem exposats a aquesta vulnerabilitat, a no ser que utilitzem alguna tècnica per protegir-nos. Amb tokens, enviats a la capçalera HTTP, estem protegits d'aquest tipus de vulnerabilitat.\n\n**[JWT (JSON Web Tokens)](https://jwt.io/)** està esdevenint un estàndard de-facto pel que fa a sistemes d'autenticació basats en tokens. La principal característica d'aquests sistemes d'autenticació és que són **stateless**. El servidor no emmagatzema informació dels usuaris logats a l'aplicació. Cada petició al servidor va acompanyada per un token el qual permet al servidor verificar l'autenticitat de la petició.\n\nEl fet que el servidor no necessiti mantenir informació de sessió per autenticar els usuaris és el principal avantatge de JWT respecte a l'ús de cookies.\n\nEl workflow amb JWT és el següent:\n\n- L'usuari realitza una petició al servei d'autenticació enviant usuari i contrasenya\n- El servei d'autenticació respon amb un token JWT amb les dades identificatives de l'usuari\n- L'usuari sol·licita accés a un servei segur enviant el token al servidor\n- La capa de seguretat valida el token, i en cas satisfactori, es dóna accés al recurs sol·licitat\n\nEn el següent diagrama observem de forma simplificada la diferència entre autenticació amb Cookies vs Tokens (JWT):\n\n![Cookies vs Tokens](/related/cs/2016/12/cookie-token-auth.png)\n\nGràcies a l'ús de JWT obtenim una sèrie de beneficis:\n\n* _Escalabilitat_: els tokens s'emmagatzemen a nivell de client, podent ser enviats a qualsevol dels nodes de l'aplicació sense que això suposi cap problema. El node servidor, sigui quin sigui, tindrà la lògica de validació del token.\n\n* _Seguretat_: com que no s'utilitza sessió, aquesta no podrà ser suplantada (CSRF).\n\n* _Multiplataforma_: no tindrem problemes en accedir des de diferents dispositius als recursos expossats per el backend de la nostra aplicació. Només cal que aquests dispositius entenguin el protocol HTTP.\n\n* _CORS_: es poden fer peticions AJAX a qualsevol servidor a qualsevol domini, donat que s'utilitza una capçalera HTTP per a transmetre la informació de l'usuari.\n\nEn cas de necessitar mantenir informació associada a la sessió de l'usuari, l'opció més natural amb JWT és emmagatzemar-la al costat client en aplicacions SPA (Single Page Application). Per exemple, en el cas de navegadors web que donin suport a HTML5 es pot fer ús del Web Storage API (sessionStorage o localStorage). És possible codificar dins el token informació de l'usuari (email, privilegis, ...). Aquesta informació ha de ser mínima, mantenint el token molt lleuger. No es considera una bona pràctica utilitzar el token com a un símil de la sessió HTTP, i sobrecarregar-lo d'informació. El token viatja al servidor a cada petició, així que no és recomanable donar-li aquest ús.\n\nEn aquest comunicat hem desenvolupat un [HowTo](/howtos/2016-11-Howto-Canigo-JWT/) amb el detall de la configuració a un backend Canigó 3.1.x per habilitar autenticació amb JWT gràcies a [Java JWT](https://java.jsonwebtoken.io/). A la pròxima versió Canigó 3.2, aquest sistema d'autenticació es proporcionarà dins el servei de seguretat per a que sigui fàcilment configurable.\n\nPer qualsevol dubte respecte a l'ús de JWT en aplicacions Canigó us podeu posar en contacte amb el CS Canigó obrint un tiquet de suport al [servei CAN del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) o enviant un correu a la bústia [oficina-tecnica.canigo.ctti@gencat.cat](mailto:oficina-tecnica.canigo.ctti@gencat.cat)\n","objectID":"L25vdGljaWVzLzIwMTYtMTItMDQtQ2FuaWdvLUpXVA=="},"L25vdGljaWVzLzIwMTctMDEtMDUtT1RDYW5pZ28tQmFsYW5jLTIwMTY=":{"date":1483574400000,"title":"Oficina Tècnica de Canigó. Balanç 2016","description":"Evolució dels serveis de la Oficina Tècnica de Canigó a l'any 2016","sections":["Notícies","home"],"categories":["sic, canigo, sgde"],"key":"GENER2017","path":"/noticies/2017-01-05-OTCanigo-Balanc-2016","content":"A continuació es mostren les fites aconseguides al 2016 segons ordre cronològic:\n\n<center><iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1sqpklweKg2oJIwJcStMksqj6jggC9idUe_A_RW2BPeo&font=Default&lang=ca&initial_zoom=2&height=500' width='100%' height='500' frameborder='0'></iframe></center>\n\nA mode resum, destacaríem les següents:\n\n* _SIC_ :\n\n\t- Suport de Jenkins SIC per a la generació d'artefactes i desplegaments automàtics en tecnologies .Net i NodeJS.\n\t- Suport de Jenkins SIC per a l'execució d'scripts a BBDD MongoDB, MySQL, SQLServer i PostgreSQL.\n\t- Desplegaments de sites estàtics al Cloud des de jobs Jenkins SIC.\n\t- Adaptació de Jenkins al sistema d'obertura de peticions de desplegament via Remedy.\n\t- Disponibilitat de l'Slave Jenkins a CPD2.\n\t- Actualització de versions de programari del SIC: Jenkins, SVN i Nexus.\n\t- El SIC s'encarrega de la gestió integral del codi font i del reporting a direcció CTTI.\n\n* _FW Canigó_ :\n\n\t- Actualització connectors Canigó amb la PICA\n\t- Nou connector amb el Gestor Documental Aresta (PSGD).\n\t- Nou mòdul d'Administració de Logs.\n\t- Publicació de noves versions de l'entorn de desenvolupament Canigó.\n\t- Certificació Canigó 3.1 en Tomcat 8 i Weblogic 12c amb Oracle Java 8\n\n* _SGDE_ :\n\n\t- Obligatorietat d'informar els camps 'ambit' i 'aplicacio' a les crides al WS\n    - Pilot de Mobilització de Formularis\n\nPer a més informació sobre els futurs evolutius planificats, podeu consultar el [Roadmap d'arquitectura del CTTI](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).\n","objectID":"L25vdGljaWVzLzIwMTctMDEtMDUtT1RDYW5pZ28tQmFsYW5jLTIwMTY="},"L25vdGljaWVzLzIwMTctMDItMDMtSW50cm9kdWNjaW8tU0lDMi4w":{"date":1486080000000,"title":"SIC. Introducció a SIC 2.0","description":"El SIC està evolucionant per tal de poder donar cabuda a les tecnologies més emprades avui dia. La primera actualització està prevista d'aplicar-se a l'Abril d'aquest any.","sections":["Notícies","home"],"categories":["sic"],"key":"FEBRER2017","path":"/noticies/2017-02-03-Introduccio-SIC2.0","content":"El SIC està evolucionant per tal de poder donar cabuda a les tecnologies més emprades avui dia. La primera actualització està prevista d'aplicar-se a l'Abril d'aquest any i inclourà els següents canvis:\n\n#### **Nou Sistema de control de codi font: Gitlab**\n\nS'incorporarà [Gitlab](https://about.gitlab.com/) com a Sistema de control de codi font (SCM). Aquest SCM conviurà amb l'actual, el SVN.\nLes noves aplicacions que s'incorporin al SIC a partir d'aquest Abril, ja ho podran fer amb Gitlab.\n\n\n#### **Sistema d'accés al Gitlab / SVN / Jenkins**\n\nA partir de l'Abril, l'accés als repositoris GIT/SVN i Jenkins es farà mitjançant les mateixes credencials del compte GICAR. \nS'emetrà un comunicat alertant de la data concreta de posada en funcionament d'aquest canvi.\n\n\n#### **Autoservei de repositoris i usuaris a Gitlab**\n\nEls mateixos proveïdors d'aplicacions seran autònoms per poder crear els repositoris de codi de les aplicacions dins el Gitlab i assignar permisos a usuaris en aquests repositoris.\nPer a les aplicacions que ja custodien el codi font al repositori SVN, el SIC oferirà la possibilitat de migrar el contingut d'aquest sistema al de Gitlab. D'igual manera, es proporcionarà un procediment als proveïdors que vulguin migrar projectes del seu GIT de desenvolupament al GITLAB del SIC.\n\n\n![SIC 1.0 vs SIC 2.0](/images/news/introduccio-sic.2.0.png)\n\nDurant els pròxims mesos s'alliberarà més informació i més detallada sobre aquests i futurs canvis que s'afegiran a SIC.\n","objectID":"L25vdGljaWVzLzIwMTctMDItMDMtSW50cm9kdWNjaW8tU0lDMi4w"},"L25vdGljaWVzLzIwMTctMDItMDYtTm92ZXRhdHMtQ2FuaWdvLTMy":{"date":1486339200000,"title":"Canigó. Novetats a propera versió Canigó 3.2","description":"Des de l'equip de Canigó s'està treballant en la versió 3.2 de Canigó, la qual incorporarà novetats importants com el suport a serveis REST i autenticació amb JWT (JSON Web Token).","sections":["Notícies","home"],"categories":["canigo"],"key":"FEBRER2017","path":"/noticies/2017-02-06-Novetats-Canigo-32","content":"Des de l'equip de Canigó s'està treballant en la versió 3.2 de Canigó, la qual incorporarà novetats importants com el suport a serveis REST i autenticació amb JWT (JSON Web Token) entre d'altres. Fa temps que tant des d'Arquitectura CTTI com des del CS Canigó s'està promovent l'ús d'arquitectures basades en servei REST al backend i consum de dades via Javascript en frontals web HTML5, i és en aquesta nova versió que s'incorporaran classes i configuracions de suport per facilitar el desenvolupament d'aplicacions que segueixin aquesta arquitectura.\n\nLa introducció de [Swagger](http://swagger.io/), framework pel disseny, construcció, documentació i consum d'APIs REST, és clau per disposar d'un ecosistema que permeti treballar amb APIs REST de forma fàcil i intuïtiva.\n\n<center>![Swagger a Canigó 3.2](/images/news/swagger-canigo.png)</center>\n\nLa integració realitzada amb Swagger i [JWT](https://jwt.io/) (JSON Web Token) permet validar la seguretat de les nostres APIs. Un cop obtingut el token (/api/auth) és possible fer crides a altres APIs REST de l'aplicació sempre que l'usuari hi estigui autoritzat. En cas contrari obtindrem un error \"HTTP 401 - Unauthorized\".\n\nComentar que JSF (JavaServer Faces) passa a ser una tecnologia deprecada en aquesta versió de Canigó. En cap cas s'evolucionarà més enllà d'actualització de llibreries per tal de garantir la compatibilitat amb contenidors de servlets i servidors d'aplicacions del [Full de Ruta del Programari](https://portic.ctti.gencat.cat/les_TIC/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf).\n\nLa data d'alliberament de Canigó 3.2 està prevista per finals d'aquest mes de Febrer de 2017. Una nova notícia o destacat es publicarà en aquest portal per tal de donar més detalls d'aquesta nova versió de Canigó: documentació, binaris i aplicació plantilla.\n\nPer qualsevol dubte us podeu posar en contacte amb el CS Canigó al [servei CAN](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) del JIRA CSTD o enviant-nos un mail a la [bústia](oficina-tecnica.canigo.ctti@gencat.cat) del CS Canigó.","objectID":"L25vdGljaWVzLzIwMTctMDItMDYtTm92ZXRhdHMtQ2FuaWdvLTMy"},"L25vdGljaWVzLzIwMTctMDMtMDYtQ2xvdWQtc2VndXJldGF0LWFjY2VzLWVsYXN0aWNzZWFyY2gtb3Nz":{"date":1488758400000,"title":"Cloud. Accés a Elasticsearch a cloud públic","description":"L'accés a un Elasticsearch a cloud públic té una sèrie de consideracions de seguretat a tenir en compte","sections":["Notícies","home"],"categories":["cloud"],"key":"MARC2017","path":"/noticies/2017-03-06-Cloud-seguretat-acces-elasticsearch-oss","content":"L'accés a un Elasticsearch (ES) a cloud públic té una sèrie de consideracions de seguretat a tenir en compte. En el cas de [Compose](https://www.compose.com/), plataforma utilitzada a solucions de cloud públic per l'aprovisionament de DBaaS, els ES no incorporen el mòdul [X-Pack](https://www.elastic.co/products/x-pack/security) el qual permet securitzar-ne l'accés. Cal incloure doncs mecanismes que impedeixin accessos no autoritzats.\r\n\r\n## Seguretat\r\n\r\nÉs imprescindible que els accessos a l'ES només es realitzin des de servidors autoritzats. Serà necessari, per tant, que s'identifiquin les IPs d'accés per tal que es configurin a una whitelist a Compose.\r\n\r\nExemple:\r\n\r\n![Whitelist Compose](/images/cloud/whitelist_compose.png)\r\n\r\n### Accés des d'una aplicació a Bluemix\r\n\r\nEn el cas que l'aplicació origen que requereix accés a l'ES estigui a Bluemix, és necessari l'ús del servei [Statica](https://console.ng.bluemix.net/catalog/services/statica).\r\n\r\n![Statica](/images/cloud/statica.png)\r\n\r\nL'assignació d'una IP fixe de sortida permetrà la seva configuració a la whitelist de Compose.\r\n\r\n### Accés des d'una aplicació a CPD corporatiu\r\n\r\nPer les aplicacions desplegades a CPD corporatiu caldrà que CPD indiqui la IP de sortida de l'aplicació a Internet. Aquesta és la IP que s'haurà de configurar a la whitelist de Compose.\r\n\r\n### Accés des d'una pàgina web\r\n\r\nEn alguns casos, com per exemple cercadors a portals web, és possible que l'accés a l'ES es realitzi des del navegador de l'usuari. Les planes web no haurien d'incorporar les credencials a l'ES donat que la sostracció d'aquestes podria derivar en un ús indegut. Pels ES que no incorporin el mòdul X-Pack és més important encara, ja que els usuaris tenen privilegis de lectura i escriptura.\r\n\r\n#### Proxy\r\n\r\nPer tal d'evitar el problema de sostracció de credencials, es recomana que l'accés a l'ES es realitzi via un proxy, per exemple, desplegat a Bluemix. Aquest proxy (Apache, Nginx, ...) serà qui tindrà les credencials d'accés a l'ES. L'accés al proxy només es podrà realitzar des del domini de l'aplicació.\r\n\r\nPer els servidors web Nginx i Apache els mòduls que permeten aquesta configuració són [ngx_http_access_module](http://nginx.org/en/docs/http/ngx_http_access_module.html) i [mod_authz_host](https://httpd.apache.org/docs/2.4/mod/mod_authz_host.html) respectivament.\r\n\r\n## Cas pràctic\r\n\r\nUn escenari real seria el d'una aplicació amb un backend a CPD corporatiu el qual insereix dades a l'ES, i un cercador que les consulta des d'una plana web.\r\n\r\n![Seguretat accés a ES a cloud públic](/images/cloud/seguretat_es_cloud_public.png)\r\n\r\n- _Administrador_: responsable d'introduïr les dades a l'ES\r\n- _Usuari_: cerca d'informació a l'ES\r\n\r\nExisteix una altra opció que consistiria en que el backend també accedís a l'ES a través del Proxy. En aquest cas seria el Proxy quí tindria configurada a la seva whitelist la \"ip_sortida_backend\", en lloc del Compose.\r\n\r\n## Referències\r\n\r\n- [Static IPs with Bluemix and Statica](https://www.ibm.com/blogs/bluemix/2015/08/static-ips-with-bluemix-and-statica/)\r\n- [Securing Elasticsearch and Kibana](https://www.elastic.co/guide/en/x-pack/current/xpack-security.html)\r\n","objectID":"L25vdGljaWVzLzIwMTctMDMtMDYtQ2xvdWQtc2VndXJldGF0LWFjY2VzLWVsYXN0aWNzZWFyY2gtb3Nz"},"L25vdGljaWVzLzIwMTctMDMtMDctUGlwZWxpbmVzLVNJQzIuMA==":{"date":1488844800000,"title":"SIC. Introducció Pipelines a SIC 2.0","description":"El passat mes es van comentar algunes de les millores que incorporarà SIC 2.0 pel que fa al SCM (s'afegeix Gitlab). L'altre gran peça de SIC, el Jenkins, també patirà un gran canvi amb l'evolució a SIC 2.0. S'incorpora el model de treball amb jobs de tipus Pipeline, job que engloba tots els estats del cicle d'Integració Contínua.","sections":["Notícies","home"],"categories":["sic"],"key":"MARC2017","path":"/noticies/2017-03-07-Pipelines-SIC2.0","content":"El passat mes es van comentar algunes de les millores que incorporarà SIC 2.0 pel que fa al SCM (s'afegeix Gitlab). L'altre gran peça de SIC, el Jenkins, també patirà un gran canvi amb l'evolució a SIC 2.0. S'incorpora el model de treball amb jobs de tipus Pipeline, job que engloba tots els estats del cicle d'Integració Contínua.\r\n\r\nFins el moment, es contempla el següent escenari:\r\n\r\n- Existeixen els següents tipus de jobs: d'instal·lació de llibreries, de construcció + validació codi, de desplegament automàtic a INT i de petició desplegament a PRE/PRO. \r\n- Tots ells s'executen per separat\r\n- Només es contempla el desplegament automàtic a entorns INT.\r\n\r\nLa versió actual de Jenkins, la 2.7.4, incorpora un nou tipus de job, el de Pipeline. Aquest tipus de jobs faciliten la inclusió del cicle complet d'Integració Contínua en un únic Job. S'està treballant en l'adaptació a aquest model de treball. Les característiques d'aquest seran:\r\n\r\n- El job ja no serà executat directament pel desenvolupador sinó que s'iniciarà automàticament en fer la pujada de codi al GitLab (un hook configurat al GitLab farà de llançadora).\r\n- El job descarregarà la darrera versió de codi font i construirà el/s binaris. Per a considerar el codi com a vàlid, s'efectuaran validacions de qualitat i test automàtics.\r\n- Prèviament al desplegament automàtic a entorns PRE i PRO, el job Pipeline contemplarà l'autorització per part dels responsables i validarà que el desplegament s'efectua dins la finestra d'execució de l'aplicació.\r\n- El flux del job Pipeline podrà ser aturat en cas de considerar una versió com a no apta per a desplegar.\r\n\r\n\r\nA continuació es mostra un esquema simplificat del funcionament del nou tipus de Job Pipeline en contrapartida al sistema actual de jobs.\r\n\r\n![SIC 1.0 vs SIC 2.0](/images/news/introduccio-pipelines-sic.2.0.png)\r\n\r\nDurant els pròxims mesos s'alliberarà informació més detallada sobre el funcionament d'aquest tipus de Jobs.","objectID":"L25vdGljaWVzLzIwMTctMDMtMDctUGlwZWxpbmVzLVNJQzIuMA=="},"L25vdGljaWVzLzIwMTctMDMtMzEtcHVibGljYWNpby1jYW5pZ28zMg==":{"date":1490918400000,"title":"Canigó. Publicada nova versió 3.2 del framework","description":"La versió 3.2 del framework Canigó presenta novetats molt importants respecte a les seves predecessores. L'objectiu principal d'aquesta nova versió és facilitar el desenvolupament d'aplicacions que segueixin el patró d'arquitectura recomanat pel CS Canigó, consistent en el desacoblament del frontend web vers els serveis de backend que exposen les dades de negoci. En aquesta línia es depreca JSF, sent aquesta l'última versió de Canigó en la que s'hi donarà suport","sections":["Notícies","home"],"categories":["canigo"],"key":"ABRIL2017","path":"/noticies/2017-03-31-publicacio-canigo32","content":"Amb l'alliberament de la versió 3.2 del framework Caniǵo s'assoleix un dels objectius que es persegueix des de fa temps al CS Canigó, consistent en facilitar el desenvolupament d'aplicacions que segueixin el patró d'arquitectura on el frontend web i el backend que exposa les dades de negoci estan totalment desacoblats. Amb aquesta finalitat s'ha incorporat un nou Mòdul RS (RESTful Services) el qual dóna suport al desenvolupament d'APIs REST. A més d'aquest nou mòdul, Canigó 3.2 té actualitzacions importants d'alguns mòduls core com els de seguretat, persistència i traces. L'altre gran objectiu d'aquesta nova versió de Canigó és facilitar el desplegament en entorns corporatius a CPDs i Container Clouds. En aquesta línia s'ha certificat el seu funcionament en Tomcat 8 i Weblogic 12c, i introduït Docker a la plantilla d'aplicació.\n\n<br>\n### Mòduls\n\nA continuació es descriuen els canvis més rellevants que s'han fet als mòduls que formen part del framework.\n\n#### Mòdul RS (RESTFul Services) [_NOU!_]\n\nEl Mòdul RS ha estat introduït al framework per permetre l'exposició de dades mitjançant serveis REST de forma àgil i seguint les millors pràctiques d'[APIs REST](http://canigo.ctti.gencat.cat/blog/2016/01/api/).\n\nLes principals característiques d'aquest mòdul són les següents:\n\n* Control genèric d'errors\n* Classes estàndard de resposta\n* APIs REST incorporades per exposar les propietats de configuració de l'aplicació i mòduls carregats\n\nTot el contingut es serveix en format JSON.\n\nPodeu trobar tota la informació d'aquest mòdul a la següent [pàgina](http://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-rs/) del portal.\n\n#### Mòdul de Seguretat [_ACTUALITZAT!_]\n\nCom a gran novetat al Mòdul de Seguretat s'incorpora el suport a [JWT (JSON Web Token)](https://jwt.io/) per tal de permetre la construcció d'aplicacions stateless que puguin ser fàcilment escalables. En concret, la llibreria utilitzada és [JJWT (Java JWT)](https://github.com/jwtk/jjwt).\n\nL'ús de JWT és compatible amb GICAR i la resta de proveïdors de seguretat suportats per Canigó. \nUn cop l'usuari ha estat autenticat, el backend Canigó genera un token que haurà de ser enviat pel client a la capçalera HTTP per a cada petició.\n\nPodeu trobar tota la informació d'aquest mòdul a la següent [pàgina](http://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-seguretat/) del portal.\n\n#### Mòdul de Persistència (JPA) [_ACTUALITZAT!_]\n\n[Spring Data JPA] (http://projects.spring.io/spring-data-jpa/) i [QueryDSL] (http://www.querydsl.com/) passen a ser les llibreries de suport principals per l'accés a dades.\n\nGràcies a Spring Data JPA i l'ús de repositoris es redueix el codi necessari per fer accessos a la base de dades. Les operacions més habituals són proporcionades pels repositoris i afegir nous mètodes d'accés a dades a aquests repositoris és molt fàcil.\n\nQueryDSL permet la generació de queries dinàmiques de forma segura mitjançant codi. És compatible amb JPA i, de la mateixa manera que Spring Data, dóna suport als motors de bases de dades més populars (Oracle, MySQL, PostgreSQL, SQLServer, MongoDB).\n\nPodeu trobar tota la informació d'aquest mòdul a la següent [pàgina](http://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-jpa/) del portal.\n\n#### Mòdul de Traces [_ACTUALITZAT!_]\n\nL'actualització de Log4j a SLF4J+Log4j2 és la principal novetat que incorpora aquest mòdul. A continuació s'enumeren els principals avantatges que suposa aquest canvi:\n\n* Loggers asíncrons\n* Nivells de log personalitzats\n* Reconfiguració automàtica\n* Ús més eficient de memòria i millores en la concurrència\n* Fàcilment extensible\n* Configuració en més formats: XML, JSON, YAML\n\nPodeu trobar tota la informació d'aquest mòdul a la següent [pàgina](http://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-traces/) del portal.\n\n#### Mòdul JSF [_DEPRECAT!_]\n\nJSF (JavaServer Faces) passa a ser una tecnologia deprecada en aquesta versió de Canigó. No s'ha evolucionat més enllà d'actualitzar versions de llibreries per tal de garantir la compatibilitat amb contenidors de servlets i servidors d'aplicacions del [Full de Ruta del Programari del CTTI](https://portic.ctti.gencat.cat/les_TIC/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf).\n\n<br>\n### Nou Repositori Maven al Nexus del SIC\n\nCanigó 3.2, en el seu core, incorpora un canvi important. Aquest canvi és el pas d'un repositori Maven a un grup de repositoris amb accés SSL: https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/\n\nGràcies a l'ús d'aquest grup de repositoris disponible al Nexus del SIC, qualsevol canvi (actualització, eliminació, afegit) als repositoris que formen part del grup serà transparent al desenvolupador d'aplicacions Canigó.\n\n<br>\n### Nova plantilla d'aplicació Canigó 3.2\n\nLa nova versió 1.6.0 del [Plugin d'Eclipse de Canigó](http://canigo.ctti.gencat.cat/canigo-download-related/plugin-canigo/) permet la creació d'aplicacions Canigó 3.2. A partir d'aquesta nova versió del plugin deixa de donar-se l'opció de crear aplicacions Canigó basades en JSF.\n\nA continuació es descriuen les novetats més importants que incorpora la plantilla d'aplicació Canigó 3.2.\n\n#### Swagger\n\nLa introducció de [Swagger](http://swagger.io/), framework pel disseny, construcció, documentació i consum d'APIs REST, és clau per disposar d'un ecosistema que permeti treballar amb APIs REST de forma fàcil i intuïtiva.\n\n<center>![Swagger a Canigó 3.2](/images/news/swagger-canigo.png)</center>\n\nLa integració realitzada amb Swagger i JWT permet validar la seguretat de les nostres APIs de forma ràpida.\n\n#### Spring Boot\n\n[Spring Boot](https://projects.spring.io/spring-boot/) ens permet executar l'aplicació sense necessitat de disposar d'un servidor d'aplicacions o contenidor de servlets. És capaç d'executar-ne un internament (Tomcat, Jetty o Undertow) i aixecar l'aplicació.\n\nAquesta és la característica més important, però en té d'altres:\n\n* Simplificació de configuració Maven\n* Configuracions de Spring de forma automàtica\n* No genera codi i no requereix configuració per XML\n\n#### Docker\n\nCanigó 3.2 pot ser desplegat en els contenidors Docker certificats per [Suport Cloud](http://canigo.ctti.gencat.cat/cloud/), ja sigui en un jar executable (Spring Boot) amb Java o en un war a Tomcat:\n\n*Bluemix*\n\n* [gencatcloud/java](https://hub.docker.com/r/gencatcloud/java)\n* [gencatcloud/tomcat](https://hub.docker.com/r/gencatcloud/tomcat)\n\n*OpenShift*\n\n* [gencatcloud/java-openshift](https://hub.docker.com/r/gencatcloud/java-openshift)\n* [gencatcloud/tomcat-openshift](https://hub.docker.com/r/gencatcloud/tomcat-openshift)\n\nD'aquesta manera es vol facilitar el desplegament d'aplicacions Canigó en entorns Container Cloud com [Bluemix](https://console.eu-gb.bluemix.net/) i d'altres basats en [OpenShift](https://www.openshift.org/).\n\n<br>\n### Certificació amb servidors del full de ruta\n\nCanigó 3.2 ha estat certificat amb alguns dels servidors del [Full de ruta del programari del CTTI](https://portic.ctti.gencat.cat/les_TIC/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf) corrent amb els runtimes Java d'Oracle suportats per cadascun d'ells:\n\n* Weblogic 12c\n* Tomcat 7 i 8\n* Websphere 8.5 (_properament_)\n\n<br>\nPer qualsevol dubte relatiu a aquesta nova versió de Canigó us podeu posar en contacte amb el CS Canigó al [servei CAN](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) del JIRA CSTD o enviant-nos un mail a la [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat) del CS Canigó.\n","objectID":"L25vdGljaWVzLzIwMTctMDMtMzEtcHVibGljYWNpby1jYW5pZ28zMg=="},"L25vdGljaWVzLzIwMTctMDUtMTItU0lDLW5vdmVzLWZ1bmNpb25hbGl0YXRz":{"date":1494547200000,"title":"SIC 2.0: Millores en la gestió d'usuaris i repositoris","description":"Atès la imminent arribada del SIC 2.0, és convenient que tots els usuaris siguin coneixedors de les noves funcionalitats que ofereix aquesta versió. En aquest article, fem un resum dels mòduls de gestió d'usuaris i repositoris.","sections":["Notícies","home"],"categories":["sic"],"key":"MAIG2017","path":"/noticies/2017-05-12-SIC-noves-funcionalitats","content":"Atès la imminent arribada del SIC 2.0, és convenient que tots els usuaris siguin coneixedors de les noves funcionalitats que ofereix aquesta versió. En aquest article, fem un resum dels mòduls de gestió d'usuaris i repositoris.\r\n\r\n## Autoservei d'usuaris\r\n\r\nAmb l'autoservei d'usuaris, hi ha un rol que pateix una evolució molt important al SIC: el rol de *Release Manager*. Els usuaris amb aquest rol podran gestionar els usuaris dels seus projectes. En concret, podran realitzar, a més de les funcions que ja disposaven al SIC 1.0, les següents accions:\r\n\r\n* Concedir/treure els accessos dels seus projectes publicats al SIC als usuaris que considerin oportú.\r\n* Definir quins permisos té cada usuari en cadascun dels projectes (poden concedir el rol de *Release Manager* a altres usuaris que no el tinguin).\r\n\r\nA més d'aquestes noves funcionalitats, cal recordar que ja no caldrà sol·licitar les altes i baixes dels usuaris al SIC. El SIC 2.0 s'ha integrat amb GICAR i, per tant, la gestió d'usuaris es realitza a través de GICAR. \r\n\r\nD'aquesta manera, ja no caldrà realitzar peticions a SAU/Remedy per cobrir cap necessitat dels proveïdors d'aplicacions pel que fa a la gestió d'usuaris del SIC.\r\n\r\n## Autoservei de repositoris\r\n\r\nDe forma similar que amb l'autoservei d'usuaris, el rol de *Release Manager* adquireix també més funcionalitats pel que fa a la gestió de repositoris.\r\n\r\nAl SIC 2.0 disposem d'un nou gestor de repositoris de codi font: **GitLab**. A més a més de les diferències tècniques (els repositoris són Git i no SVN), n'hi ha d'organitzatives. Aprofitant tota l'experiència adquirida amb el SIC 1.0, hem configurat els repositoris de forma diferent. Ara hi ha només un nivell d'agrupació: el codi d'aplicació. L'acrònim de Departament/Unitat Organitzativa l'hem eliminat. D'aquesta manera és més senzill localitzar els projectes a través de l'eina i l'estructura roman independent dels canvis departamentals.\r\n\r\nTot usuari al GitLab pot crear repositoris i grups de repositoris en el seu propi espai personal. Els *Release Managers*, a més a més, podran crear repositoris oficials en l'espai del SIC. Simplement, hauran d'entrar al grup corresponent al codi d'aplicació del projecte i els hi apareixerà l'opció de creació.\r\n\r\nPer tant, desapareix la necessitat de realitzar peticions a SAU/Remedy per sol·licitar la creació d'un nou repositori al SIC. Els lots d'aplicacions són autònoms pel que fa als repositoris.\r\n\r\n## Avantatges\r\n\r\nEls avantatges de l'evolució del SIC 2.0 són:\r\n\r\n* S'eliminen temps d'espera administratius. Els lots d'aplicacions poden treballar des del primer dia de forma autònoma.\r\n* Estandardització dels usuaris del SIC, en haver integrat aquest amb GICAR.\r\n* No cal involucrar a responsables d'àmbit ni de lot per a la gestió d'usuaris i de repositoris. El lot d'aplicacions té l'autoritat per fer-ho.\r\n* Desapareix la limitació de disposar com a màxim 3 *Release Managers* per lot i àmbit.\r\n\r\nAviat podreu consultar tota la documentació associada a aquesta nova versió del SIC al [portal](http://canigo.ctti.gencat.cat/sic-documentacio/).\r\n\r\nPer a qualsevol dubte o suggeriment, podeu contactar amb el SIC a través de SAU/Remedy o un correu electrònic a la bústia [`oficina-tecnica.canigo.ctti@gencat.cat`](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTctMDUtMTItU0lDLW5vdmVzLWZ1bmNpb25hbGl0YXRz"},"L25vdGljaWVzLzIwMTctMDYtMDctU0lDLVNJQ18yLjA=":{"date":1496793600000,"title":"SIC. Llançament del SIC 2.0","description":"El passat 31 de Maig es va realitzar la presentació oficial del SIC 2.0. Presentem un resum amb les característiques més importants.","sections":["Notícies","home"],"categories":["sic"],"key":"JUNY2017","path":"/noticies/2017-06-07-SIC-SIC_2.0","content":"## SIC 2.0\r\n\r\nEl passat 31 de Maig es va realitzar la presentació oficial del SIC 2.0. Com ja s'ha comentat en altres comunicats, aquesta nova versió del SIC incorpora:\r\n\r\n* Un autoservei d'usuaris amb el que els release managers són autosuficients per a assignar els usuaris que necessitin als seus projectes i aplicacions. Els usuaris estan precarregats des de GICAR. Només es requereix fer un login previ a [GitLab] (https://git.intranet.gencat.cat/users/sign_in) per a que siguin visibles des de l'aplicació. S'ha establert un sistema d'assignació de privilegis que funciona de la següent manera:\r\n\t* Per a Release Managers i administradors de CPD/Lloc de Treball, els privilegis s'assignen de forma automàtica.\r\n\t* Per a la resta d'usuaris de Lot, els Release Managers gestionen els seus privilegis.\r\n* Un autoservei de repositoris, mitjançant el qual, els Release Managers poden crear-los i concedir permisos d'accés a aquests a d'altres usuaris.\r\n* S'adopta de forma general els jobs de construcció i desplegament de tipus Pipeline, que permeten extensibilitat i futures millores al SIC.\r\n* Git com a nou SCM, que és de naturalesa distribuïda i que permet una millor gestió de branques, i un entorn de treball més usable i modern.\r\n* Solució als problemes d'espai deguts a l'emmagatzemament de binaris, mitjançant el nou sistema de Gestió de Binaris.\r\n\r\nAquestes noves funcionalitats s'han adquirit gràcies a la implantació dels següents sistemes:\r\n\r\n* Integració amb GICAR\r\n* GitLab 9.x\r\n* Jenkins 2.x\r\n* Nou mòdul de Gestió de Binaris\r\n\r\nPodeu descarregar-vos la presentació fent clic a [aquest enllaç](/related/sic/2.0/SIC-2.0.pdf).\r\n\r\n## Període de convivència entre Subversion i Gitlab\r\n\r\nS'ha establert un període de convivència entre Subversion i Gitlab que permetrà el traspàs progressiu de repositoris d'un sistema a l'altre. En aquest periode, es mantindran les credencials antigues únicament per accedir a Subversion. Per als altres components de SIC **caldrà utilitzar les credencials de GICAR**.\r\n\r\nLa gestió d'usuaris es farà integrament amb les eines de Gicar i de Gitlab. Les identitats antigues es mantindran per permetre la convivència.\r\n\r\nEls repositoris nous es crearan a Gitlab. Els repositoris subversion seguiran estan actius fins a que els responsables de l'aplicació hagin notificat la migració a gitlab o fins a la data de fi de disponibilitat de subversion, el 6 de novembre de 2017.\r\n\r\n### Migració de repositoris\r\n\r\nCada proveïdor d'aplicacions és autònom per migrar les seves aplicacions de SVN a GIT. Una migració entre el subversion de SIC i el nou Git de SIC2.0 pot ser una tasca feixuga per la quantitat de versions històriques que manté el repositori actual, i per tant molt sensible a errors i repeticions de la migració. Per facilitar aquesta migració, es recomana pujar la versió actual directament des dels entorns de desenvolupament locals GIT. D'aquesta manera, tindran els entorns alineats tecnològicament amb el SIC i podran fer servir les funcionalitats proporcionades per Git a l'hora de treballar amb més d'un repositori. En especial, es podrà afegir el nou *remote* corresponent al GitLab del SIC, el que permetrà fer *push* a aquest *remote* cada vegada que es vulgui generar una versió entregable al SIC. En cas de no disposar d'un entorn git local, es recomana crear-ne un i volcar-hi la darrera versió de l'aplicació al subversion local disponible i fer un push al nou git.\r\n\r\n## Nova gestió de binaris\r\n\r\nPer a evitar els problemes d'espai que generen els binaris en un SCM com git o subversion, no es permetrà la inclusió d'arxius binaris al GitLab. Si és imprescindible l'emmagatzemament de binaris, el SIC ofereix les següents alternatives:\r\n\r\n* Per a llibreries: Utilitzar el repositori Nexus del SIC.\r\n* Per a d'altres binaris:\r\n\t* Fins al 26 de Juny, s'haurà de seguir utilitzant el SVN per a la pujada de binaris.\r\n\t* A partir del 26 de Juny, s'haurà d'utilitzar el nou mòdul de Gestió de Binaris, que estarà disponible a través de l'URL: [`https://bin.sic.intranet.gencat.cat`](https://bin.sic.intranet.gencat.cat).\r\n    * L'accés al SVN per a binaris es restringirà el 10 de juliol definitivament\r\n\r\n\r\nUs facilitem un calendari amb les properes accions que es realitzaran al SIC:\r\n\r\n<iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1OTb_56tC81h5WUsq_KMVHfdoFUjrgd4HSETtbV-HAiY&font=OpenSans-GentiumBook&lang=ca&timenav_position=top&initial_zoom=1&height=650' width='100%' height='650' webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder='0'></iframe>\r\n\r\n## Beneficis del SIC 2.0\r\n\r\nEls beneficis aportats per aquests canvis són:\r\n\r\n* Autoservei en la gestió d'usuaris i en la gestió de repositoris per part dels lots d'aplicacions.\r\n* Reducció a la mínima expressió dels tràmits administratius per a que un usuari pugui fer servir un repositori o crear-ne un de nou.\r\n* Reducció del temps de cicle (interval de temps entre que es puja una funcionalitat nova al SCM i aquesta arriba a Producció).\r\n* Extensibilitat: S'han assentat els fonaments que permetran afegir futures millores al SIC d'una forma més àgil.\r\n\r\n## Informació disponible\r\n\r\nPer a més informació, podeu consultar el [FAQ del SIC](/sic/faq/) i amb més detall als [Manuals del SIC](/sic-documentacio/manuals/).\r\n\r\nEn cas de tenir qualsevol dubte, ens podeu enviar una consulta a través de SAU-Remedy (servei Framework SIC) o al correu: `oficina-tecnica.canigo.ctti@gencat.cat`.\r\n","objectID":"L25vdGljaWVzLzIwMTctMDYtMDctU0lDLVNJQ18yLjA="},"L25vdGljaWVzLzIwMTctMDctMDUtQ2FuaWdvLUxUUw==":{"date":1499212800000,"title":"Canigó. Versions LTS","description":"Nova política de versions per el framework Canigó","sections":["Notícies","home"],"categories":["canigo"],"key":"JULIOL2017","path":"/noticies/2017-07-05-Canigo-LTS","content":"Des de Canigó s'ha decidit introduir el concepte de **versions LTS (Long-Term Support)**, així com a dotar d'un significat molt concret als dígits destinats al versionatge del framework.\r\n\r\nLes [versions LTS](http://canigo.ctti.gencat.cat/blog/2017/06/versions_lts/) són un tipus especial de versions que estan designades per a ser suportades per un periode més llarg del normal, l'objectiu de les quals és ser el més estable possible. En el període de temps entre dues versions LTS apareixeran versions de Canigó que solucionin bugs, eliminin vulnerabilitats o afegeixen noves funcionalitats.\r\n\r\nLa versió Canigó 3.2.0 publicada el passat mes de Març és considerada com la primera (i actual) versió LTS del framework. És a partir d'aquesta versió que es comença aplicar la següent **política de versions**:\r\n\r\n* _4rt dígit_: publicació de correccions d'incidències o noves funcionalitats que la seva publicació no pot esperar a l'agrupació de correccions o noves funcionalitats (modificació 3er dígit) - _No planificades_ [Ex. 3.2.0.1]\r\n* _3er dígit_: correcció d'incidències, vulnerabilitats o noves funcionalitats que no introdueixen cap incompatibilitat - _Cada 3 mesos_ [Ex 3.2.1]\r\n* _2on dígit_: noves funcionalitats que introdueixen incompatibilitats, i que per tant, fan necessari adaptacions a les aplicacions - _Previsiblement cada 2 anys_\r\n\r\nRespecte al segon dígit, les versions imparelles es consideren internes destinades a proves (Ex. 3.3), i per tant, no seran aptes per a ser desplegades en entorns productius.\r\n\r\nAquest és el **roadmap** previst per Canigó:\r\n\r\n\r\n\r\n<script type=\"text/javascript\" src=\"https://www.gstatic.com/charts/loader.js\"></script>\r\n\r\n<script type=\"text/javascript\">\r\n  google.charts.load(\"current\", {packages:[\"timeline\"], 'language': 'es'});\r\n  google.charts.setOnLoadCallback(drawChart);\r\n  function drawChart() {\r\n    var container = document.getElementById('roadmap');\r\n    var chart = new google.visualization.Timeline(container);\r\n    var dataTable = new google.visualization.DataTable();\r\n\r\n\tdataTable.addColumn({ type: 'string', id: 'id' });\r\n    dataTable.addColumn({ type: 'string', id: 'Name' });\r\n    dataTable.addColumn({ type: 'date', id: 'Start' });\r\n    dataTable.addColumn({ type: 'date', id: 'End' });\r\n    dataTable.addRows([\r\n      [ '1','Canigo 3.2.0 LTS', new Date(2017, 2), new Date(2020, 2) ],\r\n      [ '2','Canigo 3.2.1', new Date(2017, 5), new Date(2017, 8) ],\r\n      [ '3','Canigo 3.2.2', new Date(2017, 8), new Date(2017, 11) ],\r\n\t  [ '4','Canigo 3.2.3', new Date(2017, 11), new Date(2018, 2) ],\r\n\t  [ '5','Canigo 3.2.4', new Date(2018, 2), new Date(2018, 5) ],\r\n\t  [ '6','Canigo 3.2.5', new Date(2018, 5), new Date(2018, 8) ],\r\n      [ '7','Canigo 3.2.6', new Date(2018, 8), new Date(2018, 11) ],\r\n\t  [ '8','Canigo 3.2.7', new Date(2018, 11), new Date(2019, 2) ],\r\n\t  [ '9','Canigo 3.4.0 LTS', new Date(2019, 2), new Date(2022, 2) ],\r\n\t  [ '10','Canigo 3.4.1', new Date(2019, 5), new Date(2019, 8) ],\r\n\t  [ '11','Canigo 3.4.2', new Date(2019, 8), new Date(2019, 11) ],\r\n\t  [ '12','Canigo 3.4.3', new Date(2019, 11), new Date(2020, 2) ],\r\n\t  [ '13','Canigo 3.4.4', new Date(2020, 2), new Date(2020, 5) ]]);\r\n\r\n    var options = {\r\n      timeline: { groupByRowLabel: false, showRowLabels: false },\r\n\t  colors: ['blue', 'green', 'green', 'green', 'green', 'green', 'green', 'green', 'blue','green','green','green','green']\r\n    };\r\n\r\n    chart.draw(dataTable, options);\r\n  }\r\n</script>\r\n\r\n<div id=\"roadmap\" style=\"height: 590px;\"></div>\r\n\r\n\r\n\r\nPel que fa al **suport**:\r\n\r\n* Les _versions LTS_ tindran un període de suport de fins a 3 anys. Per garantir la màxima estabilitat rebran totes les correccions d'incidències i vulnerabilitats, però no noves funcionalitats.\r\n\r\n* Les _versions actuals (o \"current\")_ tindran suport mentre siguin la versió actual, és a dir, de 3 mesos.\r\n\r\nCom es pot observar, cada 2 anys es publicarà una nova versió LTS (Ex. 3.4.0 LTS) amb tots els canvis (correcció d'incidències i vulnerabilitats, millores, noves funcionalitats) realitzats des de l'última versió LTS. Hi haurà un període de convivència d'un any entre versions LTS per tal que les aplicacions es puguin **actualitzar**.\r\n\r\nL'actualització de les aplicacions, sempre que es tracti d'un 4rt dígit (fix), serà directe. En el cas del 3er dígit o inferior, caldrà realitzar adaptacions. Per al 3er dígit les adaptacions seran mínimes, previsiblement només actualització de dependències amb mòduls Canigó.\r\n\r\nL'objectiu d'aquesta nova política de versionatge és evitar l'**obsolescència** tecnològica de les aplicacions que utilitzin Canigó forçant la seva actualització com a màxim cada 3 anys a la versió LTS actual.\r\n\r\nRespecte als nous desenvolupaments, es recomana adoptar la versió actual (current) i anar actualitzant fins que aparegui la següent versió LTS, per tal de tenir un suport continuat així com màxima estabilitat.\r\n\r\nPer qualsevol dubte respecte d'aquesta nova política de versionatge us podeu posar en contacte amb l'Oficina Tècnica de Canigó fent una petició al [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) o per correu a la [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTctMDctMDUtQ2FuaWdvLUxUUw=="},"L25vdGljaWVzLzIwMTctMDctMDUtU0lDLUdlc3Rpby1iaW5hcmlz":{"date":1499212800000,"title":"SIC. Nou sistema de gestió de binaris.","description":"A data 27/06/2017 es va publicar el nou sistema de gestió de binaris del SIC.","sections":["noticies","home"],"categories":["sic"],"key":"JULIOL2017","path":"/noticies/2017-07-05-SIC-Gestio-binaris","content":"A data 27/06/2017 es va publicar el nou sistema de gestió de binaris del SIC. Aquest nou sistema s'encarrega de:\r\n\r\n* Emmagatzemar els binaris que carreguen els Release Managers de Lot i deixar-los a disposició del CPD encarregat de desplegar-los.\r\n* Emmagatzemar binaris i arxius pesats que no són permesos dins de GIT i que per algun motiu no es poden emmagatzemar al Nexus (material multimèdia pesat, binaris que no són dependències, etc.) per a aplicacions que repositen codi font.\r\n\r\nD'aquesta manera s'evita la mala pràctica de dipositar binaris al SVN, procediment mitjançant el qual no es podien esborrar aquests fitxers de l'històric.\r\n\r\nL'URL d'accés a aquest nou sistema és: [https://bin.sic.intranet.gencat.cat](https://bin.sic.intranet.gencat.cat).\r\n\r\n<img alt=\"Portada Gestió Binaris SIC\" src=\"/images/news/SIC-GestioBinarisPortal.png\" style=\"margin: 10px auto;width: 80%;height: auto;display:block;\"/>\r\n\r\nLa pàgina de benvinguda disposa de dos botons:\r\n\r\n* **Dipositar artefactes al SIC**: És només accessible per als lots d'aplicacions, reenvia a l'usuari al job de Jenkins de pujada d'artefactes al SIC. És un mateix job per a tots els Release Managers de tots els lots. No registra traces amb informació sensible i transmet els links amb les ubicacions dels manuals i dels artefactes per correu electrònic a l'invocador del job. \r\nAquest job sol·licita la següent informació:\r\n\r\n\t* Codi d'aplicació: obligatori (nombre de 4 xifres)\r\n\t* Nom d'aplicació: obligatori\r\n\t* Versió: obligatori\r\n\t* Fitxer de binaris: obligatori (Fitxer de binaris a pujar)\r\n\t* Descomprimir ZIP: indica si un cop l'ARTEFACTE_BINARIS s'hagi pujat, s'ha de descomprimir el .zip facilitat\r\n\t* Fitxer de documentació: opcional (Fitxer de documentació a pujar)\r\n\r\n\tEl job valida que l'usuari tingui permisos sobre el codi d'aplicació especificat. **Avís**: Si s'especifica múltiples vegades els mateixos valors a la terna Codi d'aplicació, Nom d'aplicació i Versió, __**s'esborra el contingut previ i se sobreescriu el nou contingut**__.\r\n\r\n* **Recuperar artefactes del SIC**: És accessible tant pels Release Managers de tots els lots així com per a tots els administradors de tots els CPDS i de LdT. Els accessos són securitzats (requereixen autenticació amb credencials GICAR i cada codi d'aplicació requereix autorització per Lot/CPD/LdT).\r\n\r\nPer a més detalls, teniu tota la informació disponible al [Manual d'Usuari del SIC](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-usuari.pdf).\r\n","objectID":"L25vdGljaWVzLzIwMTctMDctMDUtU0lDLUdlc3Rpby1iaW5hcmlz"},"L25vdGljaWVzLzIwMTctMDctMTgtU0lDLUF1dG9zZXJ2ZWktdXN1YXJpcy1TSUMyLjA=":{"date":1500336000000,"title":"SIC 2.0. Funcionament de l'Autoservei d'usuaris al GitLab","description":"Aquest article descriu amb detall el funcionament de l'Autoservei d'usuaris SIC 2.0 al GitLab (editat el 2018-04-30 adaptant-se al model de seguretat 2018 del SIC)","sections":["Notícies","home"],"categories":["sic"],"key":"AGOST2017","path":"/noticies/2017-07-18-SIC-Autoservei-usuaris-SIC2.0","content":"Aquest article pretén descriure al detall funcionament de l'**Autoservei d'usuaris SIC 2.0 al [GitLab](https://git.intranet.gencat.cat/)**.\n\n**Avís**: Aquest article ha estat editat el 30/04/2018 adaptant-lo al nou model de seguerat del SIC posat en producció en aquesta data.\n\nEls usuaris que ja eren **\"Release Manager Lot x Àmbit\"** al sistema SIC 1.0, mantindran el mateix rol al sistema SIC 2.0. Això significa que en accedir al portal del GitLab (mitjançant credencials GICAR) podran trobar els Grups corresponents als codis de diàleg de les seves aplicacions.\n\n_Important_: durant el primer accés al GitLab no es comptarà amb visibilitat en els Grups d'aplicacions. Caldrà esperar a l'endemà del primer login per tal de gaudir d'aquests accessos. Cal també destacar que la identitat GICAR de l'usuari ha de tenir informada l'adreça de correu, en cas contrari haurà de gestionar l'alta d'aquesta informació per poder accedir al Git.\n\nEls **Grups** tindran com a nom el codi de diàleg de les aplicacions. Els usuaris Release Manager hauran de crear **Projectes** dins aquests grups per tal de disposar dels repositoris Git on fer la pujada de codi font de les aplicacions.\n\n<center>![RML a SIC 1.0 VS SIC 2.0](/images/news/autoserveiUsuaris_1.PNG)</center>\n<br/><br/>\nAl crear els Projecte/s dins els grups d'aplicació, la resta d'usuaris del Lot que no siguin Release Manager no tindran visibilitat a aquests.\n\n<CENTER>![Visibilitat resta usuaris Lot](/images/news/autoserveiUsuaris_2.PNG)</center>\n<br/><br/>\nPer tal de poder accedir a la vista d'aquests Grups/Projectes, cal navegar cap a les respectives seccions des del menú d'opcions. Aquest es desplega i replega picant al botó amb icone <img style=\"display:inline\" src=\"/images/news/icone_menu_gitlab.PNG\" alt=\"icone menu gitlab\"/> , situat a la part superior esquerra.\n\nEls mateixos usuaris Release Manager poden donar visibilitat a la resta d'usuaris que hagin d'accedir. La visibilitat la podran proporcionar a nivell de Projecte, no a nivell de Grup.\n\n<CENTER>![Proporcionar accés a Projecte](/images/news/autoserveiUsuaris_3.PNG)</center>\n<br/><br/>\nPer tal de concedir l'accés d'un usuari a un Projecte cal:\n\n* Accedir al Projecte al qual es vol proporcionar accés.\n* Mitjançant el menú superior cal seleccionar \"Settings\" i, dins aquest ,\"Members\".\n* Al formulari que apareix, cercar l'usuari al qual es vol donar l'accés. La cerca es pot realitzar per Nom o NIF. S'aconsella cercar per NIF.\n* Escollir el rol que ha de tenir l'usuari dins el Projecte:\n\t* Rol Master: Permetrà crear Projectes sota el grup d'aplicació i proporcionar accés a altres usuaris als projectes dins el grup.\n\t* Rol Developer: Només permetrà treballar amb el projecte en qüestió (descàrrega i pujades).\n* Picar sobre el botó de \"Add to Project\"\n\n<CENTER>![Proporcionar accés a Projecte](/images/news/autoserveiUsuaris_4.PNG)</center>\n<br/>\n\nAmb aquesta acció, l'usuari ja podrà accedir al Projecte.\nCas que el rol escollit per a l'usuari hagués estat de Master, l'endemà de l'assignació, l'usuari haurà adquirit accés a la resta de projectes del grup d'aplicacions (Projectes), convertint-se a efectes pràctics en un altre Release Manager.\n\n<CENTER>![Visibilitat adquirida segons Rol](/images/news/autoserveiUsuaris_5.PNG)</center>\n<br/>\n\n**AVÍS**: Si es desitja concedir permisos a un usuari per a un grup que no té cap projecte, caldrà prèviament crear el projecte per fer l'assignació desitjada.\n\nPer a qualsevol dubte o aclariment sobre el funcionament de l'Autoservei d'usuaris SIC al GitLab, podeu obrir una petició de Consulta a 'Framework SIC' via SAU-Remedy o contacta amb la bústia [oficina-tecnica.canigo.ctti@gencat.cat](mailto:oficina-tecnica.canigo.ctti@gencat.cat).","objectID":"L25vdGljaWVzLzIwMTctMDctMTgtU0lDLUF1dG9zZXJ2ZWktdXN1YXJpcy1TSUMyLjA="},"L25vdGljaWVzLzIwMTctMDktMDgtU0lDLU5leHVzMw==":{"date":1504828800000,"title":"SIC. Actualització a Nexus 3","description":"Aquest mes d'Agost ha estat actualitzat el Nexus del SIC de la versió 2.11 a la 3.2.1. Gràcies a aquesta actualització es dóna suport a nous tipus de repositoris com Bower, gestor de paquets força utilitzat en la construcció de frontends estàtics","sections":["noticies","home"],"categories":["sic"],"key":"SETEMBRE2017","path":"/noticies/2017-09-08-SIC-Nexus3","content":"## Actualització del Nexus del SIC\n\nS'ha actualitzat la versió del repositori de dependències del SIC (Nexus) a la versió 3.2.1. Aquest increment de versió respon a la necessitat per part del SIC per gestionar i emmagatzemar nous tipus de dependències. Els tipus de repositoris que suporta el Nexus 3.2.1 són:\n\n1. Maven 2\n2. NuGet\n3. Registre privat de Docker\n4. NPM\n5. Bower\n6. PyPI\n7. Repositoris Ruby, RubyGems i Gem\n8. Repositoris Raw i webs estàtics Maven\n\nD'aquesta manera s'amplia el nombre de tecnologies que són integrables al SIC.\n\n### Canvis respecte a la versió anterior\n\nLes implicacions d'utilitzar aquesta nova versió per al SIC són:\n\n* **Fi de suport a repostoris Maven 1**: El format de repositoris Maven 1 s'ha anat abandonant per tota la comunitat en els darrers anys (com per exemple [Atlassian al 2012](https://www.atlassian.com/blog/archives/shutting-down-maven-1-repositories-on-maven-atlassian-com)). Amb aquesta actualització, el SIC deixa de donar suport a repositoris Maven 1.\n* **Integració de tecnologies Front-End de nova generació**: Amb el suport de repositoris *bower*, juntament amb els de *NPM* que el SIC ja suportava, es pot realitzar la construcció i desplegament de pràcticament qualsevol tipus de tecnologia Front-End.\n* **Els repositoris Maven ja no són navegables per HTML**: Els repositoris al Nexus 3 ja no són navegables com ho eren al Nexus 2. Es pot seguir descarregant els artefactes a partir de la URL d'on es troben, però les estructures de carpetes de repositoris i grups no són accessibles des del navegador web. L'alternativa és seguir el següent procediment:\n\t1. Accedir directament a l'aplicació web del Nexus (https://hudson.intranet.gencat.cat/nexus/). El Nexus 3 no està integrat amb GICAR i per tant no s'ha de fer login. Tindreu accés a tots els repositoris públics de forma anònima.\n\t2. Per a navegar, a partir de l'opció del menú de l'esquerra *Browse*. Es pot navegar a través *Assets* o *Components*.\n\t3. Per a fer cerques d'artefactes, cal utilitzar el buscador a la part superior central de l'aplicació:\n\n![Exemple de cerca al Nexus 3](/images/news/SIC-cerca-Nexus3.png \"Exemple de cerca al Nexus 3\")\n\nPer a més detalls, teniu tota la informació disponible al [Manual d'Usuari del SIC](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-usuari.pdf).\n\n","objectID":"L25vdGljaWVzLzIwMTctMDktMDgtU0lDLU5leHVzMw=="},"L25vdGljaWVzLzIwMTctMTAtMTAtU0lDLUludGVyYWNjaW9ucy1KZW5raW5zLVJlbWVkeQ==":{"date":1507593600000,"title":"SIC. Interacció entre Jenkins i Remedy","description":"Degut al nombre de consultes rebudes aquest mes sobre la interacció entre Jenkins i Remedy a l'hora de generar canvis, hem creat aquest article on s'exposa com es relacionen aquests dos elements.","sections":["noticies","home"],"categories":["sic"],"key":"OCTUBRE2017","path":"/noticies/2017-10-10-SIC-Interaccions-Jenkins-Remedy","content":"## Remedy al SIC\n\nDes d'inicis de 2016, el SIC va habilitar una nova forma de comunicar els canvis originats per evolutius d'aplicacions mitjançant la creació d'un draft de CRQ a Remedy. D'aquesta manera el SIC s'adaptava al creixent nombre d'aplicacions que s'integrava amb Remedy; deixant progressivament en desús el procediment d'enviament de correus a CPD per a peticions de canvi.\n\n### Procediment de creació d'un Draft a Remedy a través d'una CRQ\n\nActualment, la interacció amb Remedy es produeix en els jobs/stages que incloguin un **desplegament semiautomàtic**. Un **desplegament semiautomàtic** és aquell que el SIC hi proporciona els artefactes generats en una fase o un job previ però alhora requereix la intervenció de CPD per tal de realitzar el desplegament. Per tal de lligar la intervenció de CPD amb el SIC, és el propi SIC el que crea un Draft a Remedy i hi informa textualment on ha dipositat els artefactes per tal que CPD els pugui recollir.\n\nEl procediment actual quan es crea un Draft a Remedy és el següent en els desplegaments semiautomàtics:\n\n#### 1. S'invoca el job de Jenkins\n\nJa sigui realitzant un push a la branca master del projecte GitLab (mètode SIC 2.0), ja sigui invocant-lo directament (mètode SIC 1.0), el job comença l'execució identificant l'usuari que ha disparat l'execució del job.\n\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/invocacioJobs.png\" alt=\"Invocació de Jobs al SIC\" title=\"Invocació de Jobs al SIC\"></img></div>\n\n#### 2. Invocació a Remedy\n\nDesprés de realitzar les tasques necessàries, el job invoca al Web Service de Remedy per tal de crear el *Change Request* (CRQ en endavant) en estat Draft.\n\nJenkins té un usuari genèric per autenticar-se amb aquest web service i, entre d'altres paràmetres, ha d'indicar un usuari com a **creador** de la CRQ. Jenkins assigna l'usuari que ha identificat en el pas anterior com a usuari creador.\n\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/InvocacioWSRemedy.png\" alt=\"Invocació al Web Service de Remedy\" title=\"Invocació al Web Service de Remedy\"></img></div>\n\n#### 3. Funcionalitat interna a Remedy\n\nEl Web Service de Remedy valida que l'usuari informat té permisos per poder crear CRQs en el servei sol·licitat. Un cop l'ha validat, el Web Service de Remedy obté un llistat de tots els coordinadors de canvi vàlids i n'agafa un a l'atzar. Finalment, acaba creant el Draft.\n\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/tasquesWSRemedy.png\" alt=\"Tasques internes del WS de Remedy\" title=\"Tasques internes del WS de Remedy\"></img></div>\n\nRecordeu que podeu consultar aquesta i altra informació al [Manual d'Usuari del SIC](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-usuari.pdf).\n\n","objectID":"L25vdGljaWVzLzIwMTctMTAtMTAtU0lDLUludGVyYWNjaW9ucy1KZW5raW5zLVJlbWVkeQ=="},"L25vdGljaWVzLzIwMTctMTEtMTAtU0lDLUVzdHJ1Y3R1cmEtcGVybWlzb3MtaS1BdXRvc2VydmVp":{"date":1525046400000,"title":"SIC 2.0. Estructura de permisos i autoservei d'usuaris","description":"Degut al gran nombre de consultes rebudes sobre el funcionament d'aquest autoservei, hem decidit publicar aquest article on describim amb més detall la seva operativa. (Editat el 30/04/2018 - nova estructura de grups en el sistema de permisos)","sections":["Notícies","home"],"categories":["sic"],"key":"NOVEMBRE2017","path":"/noticies/2017-11-10-SIC-Estructura-permisos-i-Autoservei","content":"Degut al gran nombre de consultes rebudes sobre el funcionament d'aquest autoservei, hem decidit publicar aquest article on describim amb més detall la seva operativa. Primer explicarem l'estructura de permisos del SIC 2.0 i posteriorment descriurem què cal fer per concedir permisos amb l'autoservei.\n\n**Avís**: Aquest article ha estat modificat el 30/04/2018 per explicar el nou model de seguretat (model de seguretat del SIC 2018) en el que els Release Managers ja no són d'àmbit i lot sinó que hi ha un grup de Release Managers per a cada codi d'aplicació.\n\n### Estructura de permisos del SIC 2.0\n\nEl SIC 2.0 té estructurada la seva seguretat en diferents tipus de grups:\n\n* Grups per a lots i proveïdors d'aplicacions\n* Grups per a CPDs i LdT\n* Altres grups\n\n#### Grups per a lots d'aplicacions\n\nAquests tipus de grups contenen a desenvolupadors i altres perfils que componen l'amalgama de perfils requerits per desenvolupar una aplicació. Dins d'aquests tipus de grups, distingim tres subtipus de grups:\n\n* Release Managers\n* Responsable de lot\n\nA continuació, descriurem cadascun d'aquests subtipus.\n\n**Release Managers**\n\nAquest tipus de grup recull als Release Managers (RM, en endavant). És a dir, recullen a tots els usuaris amb perfil Release Manager que pertanyen a un codi d'aplicació concret. Per exemple, el grup de RM del codi d'aplicació 0192 recull tots els Release Managers d'aquest codi d'aplicació.\n\nEls membres d'un grup RM són perfils que poden:\n\n* Operar amb el GitLab\n* Concedir permisos a altres companys per accedir com a Developers o Masters al codi d'aplicació corresponent\n* Crear projectes dins del grup oficial (el que té com a nom el codi d'aplicació) al GitLab\n* Accedir a la plataforma Jenkins per veure el resultat de l'execució d'un job\n* Dipositar i recollir binaris dipositats prèviament al mòdul de Gestió de binaris\n\n**Responsable de lot**\n\nAquest tipus de grup recull als Responsables de Lot (RSPL, en endavant). Al SIC 1.0, els membres d'aquest tipus de grup eren els encarregats de sol·licitar accés per a un RM. Actualment, al SIC 2.0, aquesta funcionalitat careix de valor gràcies a l'autoservei d'usuaris, mitjançant el qual els propis RMs poden concedir accés a companys. Aquest grup ha passat a ser un agregador tots els codis d'aplicació per a un lot. És a dir, són membres d'un lot d'aplicacions amb una participació transversal a tots els codis d'aplicació i poden realitzar les mateixes accions que un RM.\n\n#### Grups de CPD i Ldt\n\nAquests tipus de grups corresponen a CPDs (CPD1, CPD2...) i a LDT (LT2A, LT2B...). Els membres d'aquest tipus de grup tenen accés en mode lectura als repositoris i al mòdul de gestió de binaris i poden executar a Jenkins jobs de desplegament automàtic per als codis d'aplicació que els hi corresponen.\n\nLa pertinença als grups d'aquest tipus és automàtica i ve donada per la categorització que fa GICAR als usuaris, els quals assigna a un LOT/CPD/LDT concret en el moment de la creació. Per tant, tot usuari de GICAR per ser d'un CPD o un grup de LDT concrets té accés preconcedit al SIC 2.0.\n\n#### Altres tipus de grups\n\nAl SIC 2.0 tenim altres grups per a la gestió del servei i altres funcionalitats. Grup d'administradors, un grup concret per a Qualitat, etc. Són grups per al correcte funcionament i per a la integració del SIC amb la resta d'agents del CTTI.\n\nLa pertincença als grups d'aquest tipus es realitza de forma manual ja que els usuaris d'aquest tipus de grups varia amb molt poca freqüència.\n\n### Autoservei\n\nPer tant, l'autoservei d'usuaris afecta als lots i proveïdors fora de lot d'aplicacions. Tot usuari que necessiti accés haurà de sol·licitar als companys que ja en tenen que els hi concedeixin accés. Us recordem que vam publicar un [article](http://canigo.ctti.gencat.cat/noticies/2017-07-18-SIC-Autoservei-usuaris-SIC2.0/) on explicàvem com concedir permisos a companys per accedir al SIC com RM.\n\nHem inclòs referències a aquest article tant a l'apartat de [manuals del SIC](http://canigo.ctti.gencat.cat/sic-documentacio/manuals/) com a l'apartat de [FAQ del SIC](http://canigo.ctti.gencat.cat/sic/faq/) dins del web d'arquitectura per a que sigui més fàcil localitzar-lo.\n\nPer a qualsevol dubte o aclariment sobre el funcionament de l'Autoservei d'usuaris SIC al GitLab, podeu obrir una [consulta](/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta) a SAU Remedy.\n","objectID":"L25vdGljaWVzLzIwMTctMTEtMTAtU0lDLUVzdHJ1Y3R1cmEtcGVybWlzb3MtaS1BdXRvc2VydmVp"},"L25vdGljaWVzLzIwMTctMTEtMjktSm9icy1hdXRvbWF0aWNzLXBlci1hLVBSRS1pLVBSTw==":{"date":1511913600000,"title":"SIC. Jobs automàtics per a PRE i PRO","description":"Des del passat mes de novembre, el SIC està preparat per oferir jobs de desplegament automàtic als entorns de Preproducció i Producció.","sections":["Notícies","home"],"categories":["sic"],"key":"DESEMBRE2017","path":"/noticies/2017-11-29-Jobs-automatics-per-a-PRE-i-PRO","content":"Des del passat mes de novembre, el SIC està preparat per oferir jobs de desplegament automàtic als entorns de Preproducció i Producció. Aquests jobs, executats per usuaris de CPD/LDT, automatitzen les tasques realitzades pels tècnics aportant robustesa, fiabilitat i traçabilitat en els desplegaments d'aplicacions en aquests entorns.\n\nA continuació es compara el funcionament actual amb el nou funcionament que es pot adoptar gràcies als desplegaments automàtics a PRE i PRO.\n\n## Funcionament actual\n\nSi recordem el funcionament dels jobs pipeline que disposàvem fins ara amb el SIC 2.0 en entorns no containeritzats, era el següent:\n\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/Pipeline.png\" alt=\"Pipeline amb jobs semiautomàtics\" title=\"Pipeline amb jobs semiautomàtics\"></img></div>\n\n\nCom es pot observar, es tracta d'una pipeline que en els entorns de PRE i PRO hi ha aturades per a que es pugui realitzar el desplegament externament. La pipeline crea l'esborrany de la petició, ubica els artefactes a desplegar en un SFTP on els tècnics de CPD poden recollir-los i s'espera fins que els desenvolupadors indiquen si el desplegament s'ha realitzat correctament o hi ha hagut algun problema i s'ha hagut de cancel·lar. Al SIC, aquest tipus de desplegament els anomenem **semiautomàtics**.\n\n## Nou funcionament\n\nLes aplicacions que optin per disposar d'un desplegament automatitzat a PRE i PRO tindran una pipeline amb el següent patró:\n\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/PipelineJobsPREiPRO.png\" alt=\"Pipeline amb jobs automàtics\" title=\"Pipeline amb jobs automàtics\"></img></div>\n\nTal i com es pot observar al segon esquema, l'aturada per la creació del Remedy es continua realitzant. El que varia respecte al primer esquema és que hi apareixen dues petites pipelines de desplegament per als tècnics de CPD.\n\nFins ara els tècnics, quan els hi arribava el tiquet Remedy i estaven dins de la finestra vàlida de desplegament, realitzaven el desplegament a mà.\n\nAmb aquest nou model, els tècnics tenen una mini-pipeline per entorn per a la realització del desplegament. Al SIC, anomenem a aquest tipus de desplegaments com a **automàtics**.\n\nAmb aquest nou funcionament, transparent per al proveïdor d'aplicacions, els proveïdors d'infraestructura podran beneficiar-se de tenir jobs automàtics de desplegament per als entorns de PRE i PRO.\n\n## Aspectes que cal tenir en consideració\n\nAquests nous jobs pipeline per CPD tenen les següents capacitats i limitacions:\n\n* Aquests jobs de desplegament són compatibles amb plataformes en clúster i/o plataformes amb múltiples servidors per capa (servidors múltiples sense estar clusteritzats). Actualment, però, aquest sistema és compatible amb plataformes Tomcat. S'aniran integrant clústers d'altres tipus de servidors d'aplicacions a mesura que es vagin integrant aplicacions al SIC.\n* El job de CPD no realitza la marxa enrere d'entorns de BBDD. Caldrà que l'operari de CPD realitzi un backup previ de la BBDD abans de realitzar el desplegament.\n* No es podrà realitzar cap manteniment als servidors mentre s'està realitzant el desplegament. Els servidors podrien estar indisponibles en el moment de desplegament, fet que provocaria l'execució de la marxa enrere. Si durant la marxa enrere el servidor segueix estant indisponible, el job acabarà amb un error.\n* Com sempre, caldrà notificar al SIC si hi ha canvis en la infraestructura (s'afegeixen, es modifiquen o es donen de baixa servidors).\n* El SIC s'encarrega de la custòdia de l'últim artefacte desplegat correctament des del propi SIC. La marxa enrere es realitzarà utilitzant aquest artefacte. \n* En el cas que s'hagi de fer un desplegament sense estar el SIC disponible, es podrà realitzar manualment, però caldrà emmagatzemar a l'espai d'artefactes del SIC aquest darrer artefacte per a que sigui tingut en compte en la marxa enrere.\n\nEn unes setmanes, oferirem una formació a Lots d'Aplicacions i CPD/LDT per tal de cobrir tant aquesta nova funcionalitat com futures que en vindran. En breu, tant els proveïdors d'aplicacions com els d'infraestructura rebran una convocatòria.\n\nPer a qualsevol dubte o aclariment sobre el funcionament dels desplegaments automàtics a PRE i PRO, podeu obrir una petició de Consulta a 'Framework SIC' via SAU-Remedy.\n","objectID":"L25vdGljaWVzLzIwMTctMTEtMjktSm9icy1hdXRvbWF0aWNzLXBlci1hLVBSRS1pLVBSTw=="},"L25vdGljaWVzLzIwMTctMTEtVXNfVG9rZW5zX0pXVF9HSUNBUg==":{"date":1510272000000,"title":"Ús de JWT (JSON Web Token) amb GICAR","description":"Funcionament del servei de seguretat de Canigó amb tokens JWT i GICAR","sections":["noticies","home"],"categories":["canigo"],"key":"NOVEMBRE2017","path":"/noticies/2017-11-Us_Tokens_JWT_GICAR","content":"La versió de Canigó 3.2 permet treballar amb [JWT](https://en.wikipedia.org/wiki/JSON_Web_Token) (JSON Web Tokens). Concretament Canigó utilitza la llibreria [Java JWT] (https://java.jsonwebtoken.io/). Aquesta llibreria permet, un cop realitzada l'autenticació de l'usuari, generar un token amb les dades bàsiques d'aquest usuari que serà enviat pel navegador web a la capçalera HTTP per cada petició. El backend Canigó 3.2 sap que les peticions rebudes amb aquest token són d'un usuari correctament autenticat, ja que aquest backend és l'únic que el pot haver generat.\r\n\r\nEn el cas que es vulgui integrar una aplicació Canigó 3.2 que utilitza JWT amb GICAR com a mètode d'autenticació, s'ha de tenir en compte que no és necessari (i no és recomanable) que GICAR intercepti totes les peticions a cada servei REST que exposi l'aplicació. En cas contrari, se sobrecarregarà GICAR amb moltes peticions el que pot afectar també al rendiment de l'aplicació. GICAR només hauria d'interceptar l'accés a la SPA (Single Page Application), punt d'entrada a l'aplicació, mentre que els serveis REST queden protegits amb el token JWT. Només en cas que aquest token expiri, caldrà tornar a autenticar amb GICAR. L'aplicació Canigó 3.2, un cop rebi la capçalera HTTP de GICAR amb un usuari vàlid, generarà un nou token.\r\n\r\nEl funcionament del sistema és el següent:\r\n\r\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 70%; height: auto\" src=\"/images/news/diagrama_sequencia_gicar_jwt.png\" alt=\"Diagrama seqüencia GICAR-JWT\" title=\"Diagrama seqüencia GICAR-JWT\"></img></div>\r\n\r\n- L'usuari accedeix a la SPA. GICAR intercepta la petició i redirigeix a l'usuari a la pantalla de login.\r\n- L'usuari realitza el login, i l'aplicació, una vegada autenticat a GICAR, genera un token JWT amb les dades de l'usuari logat que proporciona al client.\r\n- Cada cop que es realitza una petició a un servei REST s'ha de proporcionar aquest token.\r\n- Si el servidor rep una petició REST sense tenir un token vàlid, aquest retorna un error de \"no autenticat\" (Error HTTP 401).\r\n- El client quan rep un error HTTP 401 ha de redirigir a l'usuari a la pantalla de login de GICAR.\r\n\r\nAl següent [enllaç](/canigo-documentacio-versions-3x-core/modul-seguretat/) es pot consultar més informació sobre el funcionament del servei de Seguretat de Canigó.\r\n","objectID":"L25vdGljaWVzLzIwMTctMTEtVXNfVG9rZW5zX0pXVF9HSUNBUg=="},"L25vdGljaWVzLzIwMTctMTItMTEtQ2FuaWdvLUludGVncmFjaW8tcGlwZWxpbmVzLVNJQw==":{"date":1512950400000,"title":"Canigó. Integració amb SIC 2.0","description":"Les aplicacions Canigó poden ser fàcilment integrables al SIC 2.0, tant per la seva custodia de codi al Git, com per la seva construcció i desplegament amb Jenkins","sections":["noticies"],"categories":["canigo"],"key":"DESEMBRE2017","path":"/noticies/2017-12-11-Canigo-Integracio-pipelines-SIC","content":"Les aplicacions Canigó poden ser fàcilment integrables al [**SIC (Servei d'Integració Continua)**](http://canigo.ctti.gencat.cat/sic/), tant per la seva custodia de codi al Git, com per la seva construcció i desplegament amb Jenkins. Des del CS Canigó s'ha redactat aquest [HowTo](http://canigo.ctti.gencat.cat/howtos/2017-12-howto-integracio_canigo_sic/) on s'explica pas a pas com fer aquesta integració.\r\n\r\nA mode de resum, els principals aspectes a tenir en compte són els següents:\r\n\r\n* Per la custodia de codi al **Git**...\r\n\r\n  * Cal dispossar de permissos en el projecte per el qual es vol custodiar el codi. Més informació respecte a l'Autoservei d'usuaris al Gitlab al següent [enllaç](http://canigo.ctti.gencat.cat/noticies/2017-07-18-SIC-Autoservei-usuaris-SIC2.0/)\r\n  \r\n  * Cal connectar l'aplicació Canigó local amb el projecte del Gitlab i pujar els canvis sempre a la branca principal (master). Recordar que el Git del SIC no és un repositori de desenvolupament, només s'hauran de pujar els canvis quan es tingui una versió \"releaseable\" de l'aplicació\r\n  \r\n  * Cal configurar l'aplicació per a que ignori la carpeta amb el resultat de la construcció (Ex. /target), meta-dades de l'Eclipse o IDE utilitzat, i binaris que puguin haver-hi en el codi del projecte. Aquests binaris que formen part de l'aplicació han d'ubicar-se al [Repositori de Binaris del SIC](http://canigo.ctti.gencat.cat/noticies/2017-07-05-SIC-Gestio-binaris/)\r\n\r\n* Per la construcció i desplegament amb una pipeline al **Jenkins**...\r\n\r\n  * Cal configurar el procés de construcció Maven per a que auto-configuri la versió de l'aplicació al descriptor \"sic.yml\" que ha d'ubicar-se a ```\"<app-canigo>/sic/sic.yml\"``` (Més detall en el [HowTo](http://canigo.ctti.gencat.cat/howtos/2017-12-howto-integracio_canigo_sic/)).\r\n  \r\n    **sic.yml**\r\n    ```\r\n    version: 1.0.0\r\n    ...\r\n    ```\r\n    A la propera versió de Canigó que s'alliberi, aquesta configuració Maven ja vindrà pre-establerta.\r\n    Podeu trobar més detal del fucionament de descriptor \"sic.yml\" al punt 3.3.3 del [Manual d'Usuari del SIC](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-usuari.pdf)\r\n  \r\n  * En cas que el frontend de l'aplicació es desenvolupi en un projecte apart del de backend i es desplegui també de forma independent (opció recomanada), cal també incorporar aquest descriptor ```\"<frontend>/sic/sic.yml\"``` i idealment automatitzar la seva generació\r\n  \r\n  * Cal especificar a l'equip del SIC les passes per la construcció i desplegament de l'aplicació per a que configurin la pipeline al Jenkins. En el cas del backend Canigó, normalment l'empaquetat estàndard Maven, i per la part de frontend dependrà molt de la tecnologia utilitzada (Angular, React, ...) les quals utilitzaran gestors de paquets com [npm](https://www.npmjs.com/). Aquesta petició de suport s'ha de fer via Remedy al servei \"FRAMEWORK SIC\"\r\n\r\nPer qualsevol dubte relatiu a la integració al SIC d'aplicacions Canigó, us podeu posar en contacte amb el CS Canigó enviant un correu a [oficina-tecnica.canigo.ctti@gencat.cat](mailto:oficina-tecnica.canigo.ctti@gencat.cat) o bé fent-nos arribar una petició de consulta/suport al [CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/).\r\n","objectID":"L25vdGljaWVzLzIwMTctMTItMTEtQ2FuaWdvLUludGVncmFjaW8tcGlwZWxpbmVzLVNJQw=="},"L25vdGljaWVzLzIwMTgtMDEtMTAtT1RDYW5pZ28tQmFsYW5jLTIwMTc=":{"date":1515542400000,"title":"Oficina Tècnica de Canigó i Suport Cloud. Balanç 2017","description":"Evolució dels serveis de l'Oficina Tècnica de Canigó i Suport Cloud a l'any 2017","sections":["noticies","home"],"categories":["sic, canigo, sgde","cloud"],"key":"GENER2018","path":"/noticies/2018-01-10-OTCanigo-Balanc-2017","content":"A continuació es mostren les fites aconseguides el 2017 segons ordre cronològic:\r\n\r\n<center><iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1se11kf-cofPGpMC7IQgwIcO3i1Lt_0SbVWjRMKZpHMQ&font=Georgia-Helvetica&lang=ca&initial_zoom=2&height=500' width='100%' height='500' webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder='0'></iframe></center>\r\n\r\nA mode resum, destacaríem les següents:\r\n\r\n### **Suport Cloud**\r\n\r\n- Posada en servei de la plataforma de contenidors on-premise **SwarmMe**\r\n- Posada en servei de la plataforma de contenidors on-premise **AppAgile**\r\n- Migració d'aplicacions del servei Single and Scalable Group Container Service de Bluemix al nou **Bluemix Container Service** basat en Docker i Kubernetes\r\n- Millora d'imatges Docker estàndard de gencatcloud, ara basades en la distribució de Linux **Alpine**, més segures i de tamany més reduït\r\n- Implementació de nova imatge Docker Apache-Shibboleth per la integració amb **GICAR**, tant a cloud privat com públic\r\n- Suport al desplegament d'aplicacions en les diferents plataformes de contenidors i cloud públic en catàleg: AppAgile, SwarmMe, Azure i Bluemix\r\n\r\n\r\n### SIC (Servei d'Integració Continua)\r\n\r\n- Publicació del **SIC 2.0**, el qual inclou:\r\n\t- Integració al SIC del nou sistema de gestió de versions de codi (**Git**).\r\n\t- Integració de la seguretat del SIC amb **GICAR**.\r\n\t- **Autoservei d'usuaris** al SIC, mitjançant el qual els usuaris de CTTI i de CPD/LDT tenen accés de forma automàtica i els usuaris de Lot d'aplicacions poden concedir-se permisos dins el mateix lot i àmbit.\r\n\t- Gràcies a la incorporació de l'**Autoservei de repositoris** al SIC, els usuaris de lot d'aplicacions poden crear-se de forma autònoma els seus repositoris.\r\n\t- Integració de jobs en format **pipeline** al SIC.\r\n\t- Creació d'un **Sistema de Gestió de Binaris**, mitjançant el qual s'evita l'antipatró de dispositar artefactes als sistemes de versions de codi.\r\n- Integració del SIC amb les plataformes de contenidors **Docker Bluemix Container Service (Kubernetes)** i **AppAgile (Openshift)**\r\n- Integració del SIC amb **Bluemix Cloud Foundry PaaS**\r\n- Participació de l'equip del SIC en el procés d'alta de **noves solucions**\r\n- Pas a **HTTPS** de la totalitat de serveis del SIC 2.0\r\n- Actualització de versió del servei **Nexus** a la versió 3.2.1\r\n- Integració d'un sistema de **desplegament automàtic** als entorns de PRE i PRO (amb tall de servei)\r\n\r\n\r\n### **Canigó**\r\n\r\n- Publicació de [**Canigó 3.2.0**](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10450) amb suport a arquitectures HTML5/JS+REST: Spring Boot, Swagger, JWT,...\r\n- Publicació de [**Canigó 3.2.1**](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10461) amb actualització de llibreries, suport a la càrrega de propietats en jars, millores i resolució d'incidències\r\n- Publicació de [**Canigó 3.2.2**] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10463) amb millores per donar suport a les best practices per la implementació d'APIs REST, actualització de llibreries, millores i resolució d'incidències\r\n- Publicació de [**Canigó 3.2.3**] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10464) amb la publicació de jars amb test unitaris per als mòduls core, web-rest, persistència i seguretat\r\n- Nova política de [**versions LTS**] (/noticies/2017-07-05-Canigo-LTS/) pel Framework Canigó\r\n- Certificació Canigó 3.2 en **JBoss EAP 6.4**\r\n- Publicació de la [**versió 2.0.0 del entorn de desenvolupament de Canigó**] (/canigo/entorn-desenvolupament/) amb actualització de programari\r\n\r\n\r\n### **SGDE (Servei de Gestió del Document Electrònic)**\r\n\r\n- STD (Servei de Transformació de Documents): **augmentat el límit de mida de documents** per les operacions de composició\r\n- eFormularis: **deprecada versió v8** del WS de ServeisInvocacio\r\n- STD (Servei de Transformació de Documents): composició de documents amb **diferents orientacions de pàgina**\r\n\r\nPer a més informació sobre els futurs evolutius planificats, podeu consultar el [Roadmap d'arquitectura del CTTI](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).","objectID":"L25vdGljaWVzLzIwMTgtMDEtMTAtT1RDYW5pZ28tQmFsYW5jLTIwMTc="},"L25vdGljaWVzLzIwMTgtMDItMTQtQ2FuaWdvLVN3YWdnZXItaS1TT0FQLVVJ":{"date":1518566400000,"title":"Canigó. Jocs de proves API REST","description":"Des de Canigó 3.2 es dona suport a la implementació d'APIs REST. Poder generar un joc de proves automatitzat a partir del contracte de l'API REST és possible gràcies a eines com SOAP UI","sections":["Notícies","home"],"categories":["canigo"],"key":"FEBRER2018","path":"/noticies/2018-02-14-Canigo-Swagger-i-SOAP-UI","content":"Existeixen diferents estàndards per la definició del contracte d'una API REST. Els més populars són [WADL](http://www.w3.org/Submission/wadl/) i [Swagger](https://swagger.io/) (OpenAPI Specification).\r\n**Swagger** és un framework molt útil, no només per a descriure una API REST sinó també per produir, consumir i poder visualitzar-la.\r\n\r\nDes de Canigó 3.2 es dóna suport a APIs REST gràcies a Spring 4 i el seu MVC (Model-View-Controller), i [Springfox](http://springfox.github.io/springfox/). Springfox és una implementació de l'especificació Swagger2.\r\n\r\nSwagger proporciona una UI (User Interface) amb un format \"human-readable\" de les APIs REST. L'aspecte que té en una aplicació Canigó 3.2 és la següent:\r\n\r\n*\\<base-url\\>/canigo-api.html*\r\n\r\n![canigo-api](/images/news/canigo-api.png)\r\n\r\nGràcies a aquesta UI els desenvolupadors poden conèixer i provar les APIs.\r\n\r\nA més d'aquesta UI, és possible obtenir l'especificació de l'API en format JSON.\r\n\r\n*\\<base-url\\>/api/v2/api-docs*\r\n\r\n![swagger-json](/images/news/swagger-json.png)\r\n\r\nAquesta definició de l'API en format JSON ens permet generar jocs de proves per la validació del seu funcionament. \r\n\r\n[SOAP UI](https://www.soapui.org/) és una eina molt popular per la realització de tests tant REST com SOAP, i és a partir de la versió [5.2.1+](https://www.soapui.org/news/soapui-5-2-1-released.html) que dona suport a la importació de definicions Swagger.\r\n\r\nEn aquest comunicat podeu trobar un [How-To](/howtos/2018-02-howto-swagger_soapui/) amb el detall per la generació d'aquests jocs de proves SOAP UI a partir de l'especificació Swagger.\r\n\r\nAmb el joc de proves generat, és possible l'automatització de la seva execució mitjançant la utilitat [TestRunner](https://www.soapui.org/test-automation/running-functional-tests.html) que incorpora SOAP UI. Això pot permetre, en entorns d'integració continua dels proveïdors d'aplicacions, automatitzar aquestes proves en pipelines de Jenkins. D'aquesta manera, canvis continus en el codi de les APIS poder ser validats de forma ràpida abans d'alliberar una versió estable de l'aplicació al SIC.\r\n","objectID":"L25vdGljaWVzLzIwMTgtMDItMTQtQ2FuaWdvLVN3YWdnZXItaS1TT0FQLVVJ"},"L25vdGljaWVzLzIwMTgtMDMtMDUtU0lDLVV0aWxpdHphci1icmFuY2EtbWFzdGVy":{"date":1520208000000,"title":"SIC. Branca Master al Git del SIC","description":"Arrel les consultes rebudes les darreres setmanes, creiem convenient publicar aquest article on s'explica els usos de les branques al SIC.","sections":["Notícies","home"],"categories":["sic"],"key":"FEBRER2018","path":"/noticies/2018-03-05-SIC-Utilitzar-branca-master","content":"Arrel les consultes rebudes les darreres setmanes, creiem convenient publicar aquest article on s'explica els usos de les branques al SIC.\n\n## Models de gestió de branques en repositoris Git\n\nHi ha un gran ventall d'aproximacions que es poden conjugar per a la gestió de branques d'un repositori git:\n\n1. Ús d'una sola branca, seguint el principi del [trunk-based (o master-based) development](https://continuousdelivery.com/foundations/continuous-integration/).\n2. Ús d'un sistema de branques procedimentat en el que hi ha branques fixes i branques temporals, com per exemple [GitFlow](http://nvie.com/posts/a-successful-git-branching-model/).\n3. Ús de branques no procedimentat.\n\n## Model adoptat al SIC\n\nDins d'aquest gran amalgama de possibilitats, des del SIC s'estableix utilitzar únicament la branca **master**, és a dir, és un model basat en la primera opció. L'adopció d'aquest model respon a l'ús que se'n fa del repositori Git del SIC: és un repositori de lliurables.\n\nLes pipelines, que actualment només construeixen i despleguen, en el futur realitzaran altres tasques:\n\n* Anàlisi de la qualitat del codi\n* Anàlisi de vulnerabilitats\n* Proves d'acceptació, de fum, etc.\n\nMoltes d'aquestes tasques només tenen sentit quan es tracta de lliurables.\n\nPer aquests motius, al SIC només els canvis a la branca **master** són els que inicien l'execució de la pipeline associada a l'aplicació. Els canvis a la resta de branques són ignorats per Jenkins.\n\n## Model que ha d'adoptar el proveïdor d'aplicacions\n\nEl model que es recomana seguir des del SIC en l'entorn de desenvolupament del proveïdor d'aplicacions és el mateix model que adopta el SIC: una sola branca (amb una metodologia **trunk-based**).\n\nS'han actualitzat el [FAQ](http://canigo.ctti.gencat.cat/sic/faq/), el [Manual d'Usuari](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-usuari.pdf) i [Manual d'Integració](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-integracio.pdf) tot indicant que únicament la branca master és la que té associades pipelines de Jenkins.\n\nSi teniu cap dubte al respecte, podeu obrir una [consulta](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta) a SAU Remedy.\n","objectID":"L25vdGljaWVzLzIwMTgtMDMtMDUtU0lDLVV0aWxpdHphci1icmFuY2EtbWFzdGVy"},"L25vdGljaWVzLzIwMTgtMDMtMjMtQ2FuaWdvLUNvbmZpZ3VyYWNpby1tdWx0aWVudG9ybi1TUEE=":{"date":1522800000000,"title":"Canigó. Configuració multi-entorn en SPAs","description":"Amb la separació de frontend i backend que es recomana aplicar com a patró d'arquitectura en aplicacions Canigó, i per tal d'acomplir els requeriments d'una única construcció no depenent de l'entorn que s'imposa des del SIC, cal donar una solució de configuració multi-entorn per la part de frontend","sections":["Notícies","home"],"categories":["canigo"],"key":"ABRIL2018","path":"/noticies/2018-03-23-Canigo-Configuracio-multientorn-SPA","content":"Amb la separació de frontend i backend que es recomana aplicar com a patró d'arquitectura en aplicacions Canigó, i per tal d'acomplir els requeriments d'una **única construcció no depenent de l'entorn** que s'imposa des del SIC (Servei d'Integració Continua), cal donar una solució de configuració multi-entorn per la part de frontend. Aquest frontend en les aplicacions web actuals típicament seran SPA (Single Page Application).\n\nA continuació s'enumeren diferents opcions:\n\n<br />\n\n#### Opció 1) Configuració embeguda al codi\n\nConfiguració única \"hardcoded\" al codi javascript de la SPA\n\n*Avantatges*\n\n* És la solució més simple\n\n*Inconvenients*\n\n* Es pot estar exposant informació sensible al repositori de codi\n* Per desplegar a cada entorn cal modificar el codi font amb la configuració específica\n* No dona suport a configuració multi-entorn\n\n*Conclusió*\n\nPot ser una configuració vàlida per un pilot però no per una aplicació que hagi de desplegar-se en entorns productius\n\n<br />\n\n#### Opció 2) Configuració per domini d'aplicació\n\nConfiguració multi-entorn \"hardcoded\" al client, i obtinguda en funció del domini de l'aplicació.\n\nPer exemple:\n\n- si el domini de l'aplicació és \"preproduccio.app.gencat.cat\", s'obtindria la configuració corresponent a l'entorn de preproducció\n- en cas de no portar el prefix preproduccio, sabríem que estem al de producció\n\nAquesta lògica hauria d'estar al propi codi font, ja sigui en el de la mateixa SPA, o bé en un mòdul reusable entre diferents SPAs.\n\n*Avantatges*\n\n* És una solució relativament fàcil d'aplicar\n* Multi-entorn, per desplegar a cada entorn no cal modificar el codi font amb la configuració específica\n\n*Inconvenients*\n\n* Es pot estar exposant informació sensible al repositori de codi\n* Un canvi de configuració a qualsevol entorn suposa tenir que reconstruir la SPA\n\n*Conclusió*\n\nTot i ser millor que l'opció 1), té mancances no assumibles per ser adoptada com a solució\n\n<br />\n\n#### Opció 3) Obtenir la configuració mitjançant una crida REST al backend\n\nPer aplicar aquesta solució cal que el backend exposi un endpoint d'on obtenir la configuració específica per l'entorn que requereixi la SPA. Per exemple, en un backend Canigó podria ser https://domini/api/frontendProperties.\nAquesta crida s'hauria de fer de forma autenticada (Ex. JWT) un cop l'usuari ha fet login a l'aplicació i ha obtingut el token d'accés.\n\n*Avantatges*\n\n* L'accés a la configuració és segur\n* És una solució relativament fàcil d'aplicar\n\n*Inconvenients*\n\n* L'entrada a l'aplicació té el delay que suposa fer aquesta crida al backend per obtenir la configuració\n\n*Conclusió*\n\nEl principal inconvenient que té aquesta solució és el delay que s'afegeix en la càrrega de la SPA\n\n<br /><br />\nTot i que poden haver-hi altres solucions, l'**opció 3)** es considera com a vàlida ja que compleix els requisits de multi-entorn i mínims de seguretat. És una solució força natural a aplicar en una SPA amb un backend Canigó 3.2. Per a més detall, des del CS Canigó hem preparat el [HowTo - Configuració multi-entorn a una SPA amb backend Canigó](http://canigo.ctti.gencat.cat/howtos/2018-04-howto-frontend-multientorn/).\n","objectID":"L25vdGljaWVzLzIwMTgtMDMtMjMtQ2FuaWdvLUNvbmZpZ3VyYWNpby1tdWx0aWVudG9ybi1TUEE="},"L25vdGljaWVzLzIwMTgtMDMtMjMtU0lDLUNhbnZpLXNpc3RlbWEtcGVybWlzb3M=":{"date":1521763200000,"title":"SIC. Canvi del sistema de permisos al SIC","description":"Durant el mes d'abril, es modificarà el sistema de permisos del SIC per tal de simplificar l'operativa de l'Autoservei. L'anterior model de seguretat quedarà obsolet i s'aplicarà el model de seguretat 2018.","sections":["Notícies","home"],"categories":["sic"],"key":"ABRIL2018","path":"/noticies/2018-03-23-SIC-Canvi-sistema-permisos","content":"Durant el mes d'abril, es modificarà el sistema de permisos del SIC per tal de simplificar l'operativa de l'Autoservei. L'anterior model de seguretat quedarà obsolet i s'aplicarà el **model de seguretat 2018**.\n\n## Audiència\n\nAquest canvi en el sistema de permisos afecta els proveïdors d'aplicacions. Us recordem que els proveïdors d'aplicacions són els únics que gestionen els permisos amb la modalitat d'autoservei. La resta d'usuaris del SIC (CPD, LDT, personal CTTI) tenen els seus permisos predefinits i només el SIC els pot modificar.\n\n## Canvi en l'estructura de permisos\n\n### Model de seguretat 2014\n\nFins ara, l'actual model de seguretat en el que es basava el SIC seguia una estructura bidimensional, en el que una dimensió era la definició d'àmbits a data de 2014 i l'altra dimensió es basava en el model de proveïdors de lot/fora lot:\n\n<div style=\"width:90%;margin:5px auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/SIC-model-seguretat-2014.png\" alt=\"Model de seguretat definit el 2014\" title=\"Model de seguretat definit el 2014\"></img></div>\n\nAmb el llançament de l'Autoservei d'Usuaris al SIC, aquest model de seguretat s'ha tornat poc pràctic:\n\n* Els àmbits en aquest model són estàtics. Al llarg d'aquests anys han aparegut nous departaments i d'altres han canviat de nom, s'han agrupat o s'han descompost en d'altres. Avui dia, és difícil per al proveïdor d'aplicacions determinar a quin àmbit del SIC correspon un codi d'aplicació.\n* D'altra banda, l'estructuració de proveïdors d'aplicacions amb lots no sempre és útil, ja que a vegades hi ha subcontractacions d'un lot a un altre o intervé més d'un proveïdor en un sol codi d'aplicació.\n\n### Model de seguretat 2018\n\nEl nou model pretén resoldre els problemes que ocasionava l'anterior model i, a més, se simplifica l'estructura de grups de seguretat. Passem a tenir model unidimensional de grups **basat en el codi d'aplicació**.\n\n<div style=\"width:90%;max-width: 800px;margin:5px auto;\"><img style=\"width: 90%;height: auto\" src=\"/images/news/SIC-model-seguretat-2018.png\" alt=\"Nou model de seguretat (2018)\" title=\"Nou model de seguretat (2018)\"></img></div>\n\nAquest nou model ens aporta una sèrie de beneficis:\n\n* L'increment en la finor de la granularitat ens aporta **més detall** i **més versatilitat**.\n* S'elimina la dependència que tenien els grups de seguretat amb els àmbits del SIC. Futurs canvis en l'organització de la Generalitat no afectaran el model de seguretat del SIC.\n* Els release managers de cada codi d'aplicació podran incloure els usuaris que considerin pertinents, siguin del seu lot o d'un altre.\n\n### Activació del nou model\n\nTan bon punt com entri en vigor el nou model de seguretat, estarà disponible la nova versió de la documentació relativa al sistema de permisos del SIC:\n\n* Els articles que ja parlaven dels sistemes de permisos del SIC 2.0:\n\t* [Procediment de concessió de permisos al SIC](/noticies/2017-07-18-SIC-Autoservei-usuaris-SIC2.0/)\n\t* [Estructura de permisos al SIC](/noticies/2017-11-10-SIC-Estructura-permisos-i-Autoservei/)\n* El [Manual d'Usuari](/related/sic/2.0/manual-usuari.pdf)\n* El [Manual d'Integració](/related/sic/2.0/manual-integracio.pdf)\n\nDurant l'activació es migraran els permisos actuals dels Release Managers al nou model. Per tant, els usuaris actuals no es veuran afectats per aquest canvi d'estructura de permisos.\n\nSi teniu cap dubte al respecte, podeu obrir una [consulta](/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta) a SAU Remedy.\n","objectID":"L25vdGljaWVzLzIwMTgtMDMtMjMtU0lDLUNhbnZpLXNpc3RlbWEtcGVybWlzb3M="},"L25vdGljaWVzLzIwMTgtMDQtMjctU0lDLUpvYnMtcGlwZWxpbmUtZXN0YXQtYWN0dWFs":{"date":1524787200000,"title":"SIC. Jobs pipeline: Estat de l'art","description":"Fa gairebé un any que es van implantar els jobs de tipus pipeline al SIC. En aquest article s'analitza l'estat actual d'aquests tipus de jobs i s'expliquen els futurs canvis que experimentaran aquesta modalitat de jobs","sections":["Notícies","home"],"categories":["sic"],"key":"MAIG2018","path":"/noticies/2018-04-27-SIC-Jobs-pipeline-estat-actual","content":"Fa gairebé un any que es van implantar els jobs de tipus pipeline al SIC. En aquest article s'analitza l'estat actual d'aquests tipus de jobs i s'expliquen els futurs canvis que experimentaran aquesta modalitat de jobs.\n\n## Introducció\n\nAbans de Jenkins 2.0, els _jobs_ de tipus _pipeline_ ja existien mitjançant la instal·lació d'una sèrie de plugins que permetien fer ús d'aquesta modalitat de jobs. Per a la versió 2.0 de Jenkins, els desenvolupadors de l'eina van realitzar un esforç per madurar aquesta nova funcionalitat i integrar-la al seu nucli. D'aquesta manera, a partir d'aquesta versió, l'ús de pipelines amb Jenkins passava a ser una forma oficial i més estable de creació de _jobs_.\n\nAmb la implantació l'any passat del SIC 2.0, es va incorporar la versió de Jenkins 2.7.4 que ja aportava aquesta funcionalitat.\n\n## Què és una _pipeline_ de Jenkins?\n\nUna _pipeline_ consisteix en un sistema en el que es transforma un flux de dades mitjançant un procés de fases seqüencials, sent l'entrada de cadascuna d'elles la sortida de l'anterior.\n\nEls jobs de tipus _pipeline_ tenen una part de metadades (identificació el job, definició de paràmetres, permisos...) i la pròpia _pipeline_ amb la configuració de la construcció i del desplegament. Aquesta pipeline es representa amb un arxiu Groovy que disposa una estructura segmentada en _stages_. A les instruccions de cada _stage_ se les anomena _steps_.\n\n## Avantatges en l'ús de _pipelines_\n\nEls avantatges que ens proporciona aquesta nova forma de generar els jobs són els següents:\n\n* No cal crear el job mitjançant els formularis que s'empraven amb els jobs de tipus _freestyle_ que requerien plugins, més dedicació i més manteniment.\n* Els jobs es tornen molt més versàtils. S'obre un ventall de possibilitats en l'ús d'eines. Ja no cal dependre només dels plugins, sinó que també hi ha la possibilitat d'incloure _[Shared Libraries](https://jenkins.io/doc/book/pipeline/shared-libraries/)_ de Jenkins per poder programar customitzacions de qualsevol mena.\n* Anb el desús de plugins, se simplifica la configuració i el manteniment de la plataforma Jenkins.\n* Permet realitzar la construcció i el desplegament en tots els entorns de l'aplicació amb un sol job. Facilitant el seguiment del cicle de vida de l'aplicació i garantint el principi de promoció d'artefactes entre entorns amb una única construcció.\n\n## La _pipeline_ Jenkins al SIC\n\nLa _pipeline_ Jenkins que s'ha implementat al SIC és el resultat d'implementar jobs amb els següents objectius en ment:\n\n1. Aportar el valor de cada _commit_ amb la menor latència possible a Producció.\n2. Permetre la introducció de controls (de qualitat, de robustesa, de seguretat...) al codi per evitar pujar versions que no siguin aptes.\n3. Automatitzar el cicle de vida de l'aplicació el màxim possible per evitar errors humans i tenir traça de cada construcció i de cada desplegament.\n4. Configuració del SIC definida per codi.\n\nAmb aquests objectius, s'ha definit al SIC el següent model de _pipeline_:\n\n![Pipeline del SIC](/images/news/PipelineJobsPREiPROiOficinesv1.png)\n\n## Futures passes\n\nL'ús de _pipelines_ al SIC obre un nou món de possibilitats, com per exemple automatitzar la creació de _jobs_ generant aquesta _pipeline_ a partir d'una sèrie de paràmetres de configuració.\n\nJustament a finals d'abril s'ha finalitzat el projecte de l'**Autoservei de jobs pipeline**, amb el qual es podran crear _jobs_ de forma automàtica a partir de les configuracions introduïdes als repositoris GIT per part del proveïdor d'aplicacions i del proveïdor d'infraestructures.\n\nCrearem un article en el proper comunicat explicant el seu funcionament amb més detall.\n\nTambé teniu disponible tota la informació relativa al seu funcionament al [Manual d'Usuari del SIC](/related/sic/manual-usuari.pdf).\n","objectID":"L25vdGljaWVzLzIwMTgtMDQtMjctU0lDLUpvYnMtcGlwZWxpbmUtZXN0YXQtYWN0dWFs"},"L25vdGljaWVzLzIwMTgtMDQtMzAtZWZvcm11bGFyaXMtUkVTVC1BUEk=":{"date":1525046400000,"title":"eFormularis. Serveis Invocació REST API","description":"En el projecte d'actualització tecnològica que s'està duent a terme a la plataforma d'eFormularis, s'introdueix una novetat que és la publicació d'una REST API per l'accés als Serveis d'Invocació de Formularis PDF","sections":["Notícies","home"],"categories":["sgde"],"key":"MAIG2018","path":"/noticies/2018-04-30-eformularis-REST-API","content":"En el projecte d'actualització tecnològica que s'està duent a terme a la plataforma d'eFormularis, s'introdueix una novetat que és la publicació d'una **REST API** per l'accés als Serveis d'Invocació de Formularis PDF:\n\n* Renderització de formularis PDF\n* Extracció de dades de formularis PDF\n* Aplanat de formularis PDF\n* Signatura de documents PDF amb certificat genèric de la Generalitat de Catalunya\n\nL'accés a aquesta REST API, a diferència de les versions precedessores basades en SOAP, ja es pot realitzar mitjançant **HTTPS**. L'especificació Swagger de la REST API es pot obtenir de la següent URL:\n\n**Producció**\n\nhttps://eformularis.intranet.gencat.cat/ServeisInvocacioApi/api/v2/api-docs (*No operativa fins a la posada en servei de la nova plataforma a Producció*)\n\n**Preproducció**\n\nhttps://preproduccio.eformularis.intranet.gencat.cat/ServeisInvocacioApi/api/v2/api-docs (*Operativa*)\n\n![eforms-swagger-specification](/images/news/serveis-invocacio-rest-api.png)\n\n<br>\nLes noves funcionalitats que s'afegeixin als Serveis d'Invocació de Formularis PDF està previst que només s'incorporin a aquesta REST API, i no a les versions predecessores basades en SOAP. Pel versionat de la REST API es seguiran les [bones pràctiques](http://canigo.ctti.gencat.cat/blog/2016/01/api/#versionat) definides en el blog d'arquitectura de CTTI. Tot i així, els serveis seran \"backward compatible\" sempre que sigui possible per evitar tenir que versionar la REST API.\n\nProperament a Canigó es proporcionarà una nova versió del connector amb el SGDE per incorporar un client que permeti el consum d'aquesta REST API de forma fàcil.\n\nCom a afegit a aquesta notícia, enumerem alguns dels **avantatges** que suposa l'ús de REST APIs en lloc de WS SOAP, i que han influït en la decisió d'implementar aquesta REST API pels Serveis d'Invocació de Formularis PDF:\n\n* *Rendiment*: permet format JSON per les dades, més lleuger que XML tant pel seu pes com pel seu processament\n* *Flexibilitat*: mentre que pels WS SOAP el codi dels clients ha de ser compilat per cada nou WSDL (Web Services Description Language), les REST API poden ser \"backward compatible\"\n* *Stateless*: les REST API estan concebudes per definició per a no mantenir estat, i en el cas d'operacions atòmiques, independents, com són les que formen part dels Serveis d'Invocació de Formularis PDF, encaixa perfectament\n* *Facilitat d'ús*: poden ser consumides per qualsevol client que suporti el protocol HTTP\n\nPer a qualsevol dubte respecte a l'ús d'aquesta REST API us podeu posar en contacte amb el CS Canigó preferiblement mitjançant el [servei STF del CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/STF) o bé enviant un correu a la [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\n\n","objectID":"L25vdGljaWVzLzIwMTgtMDQtMzAtZWZvcm11bGFyaXMtUkVTVC1BUEk="},"L3NnZGUvYWJvdXQ=":{"date":1422115902000,"title":"Què és el Servei de Gestió del Document Electrònic (SGDE)","description":"Plataforma, funcionalitats i ús del servei","sections":"SGDE","toc":false,"taxonomies":[],"weight":1,"path":"/sgde/about","content":"El **Servei de Gestió del Document Electrònic** proporciona als sistemes d'informació les principals funcions necessàries per al tractament i transformació del document electrònic per tal de donar suport a l'intercanvi fiable i segur de documents i informació entre els ciutadans i la Generalitat de Catalunya.\r\n\r\nPer implementar-ho s'ha desplegat un entorn corporatiu de valor afegit, basat en el format PDF, que proporciona uns serveis d'invocació (WebServices) que poden ser utilitzats des de qualsevol llenguatge o plataforma.\r\nL'arquitectura aplicada aporta la disponibilitat i flexibilitat necessària per a absorbir la demanda estacionals dels diferents departaments (campanyes, convocatòries, etc.).\r\n\r\n## Plataformes\r\n\r\nActualment l'SGDE té integrades dues plataformes:\r\n\r\n- Plataforma de **Formularis Adobe**\r\n- **Sistema de Transformació de Documents** o STD\r\n\r\n\r\n## Funcionalitats\r\n\r\nEl servei SGDE dóna resposta a la gestió del document en les transaccions per via telemàtica entre la Generalitat i els ciutadans, empreses i/o empleats públics.\r\n\r\nLes funcionalitats que ofereix s'agrupen pel tipus de plataforma on es troben implementades;\r\n\r\n### Plataforma de Formularis Adobe \r\n\r\n- Extracció de dades d'un formulari\r\n- Creació de formularis a partir de dades\r\n- Conversió de formularis intel.ligents en documents PDF plans (aplanat de formularis)\r\n- Signatura bàsica de documents amb un certificat genèric Generalitat \r\n\r\n### Sistema de Transformació de Documents o STD \r\n\r\n- Conversió a format pdf/a per a permetre la compatibilitat amb el temps\r\n- Normalització de format: Conversió de diferents formats ofimàtics al format PDF.\r\n- Transformació de documents: El sistema permet afegir informació en qualsevol dels quatre marges de cada pàgina dels documents d'entrada (imatges, texts, números de pàgina, codis QR etc.). També permetrà afegir una marca d'aigua en qualsevol posició del document.\r\n- Codi verificació de documents: Creació d'un codi segur de verificació (CSV) per a la identificació i registre del document i posicionament d'aquest codi sobre el document.\r\n\r\n## Ús del Servei\r\n\r\nPer poder utilitzar algun dels serveis de l'SGDE és necessari donar-se d'alta en alguna de les plataformes que l'integren. Per poder fer-ho s'ha de consultar la secció \"Documentació SGDE\" d'aquesta secció i seguir els passos documentats per cada plataforma.\r\n\r\nMes informació en [oficina-tecnica.canigo.ctti@gencat.cat](mailto://oficina-tecnica.canigo.ctti@gencat.cat)\r\n\r\n","objectID":"L3NnZGUvYWJvdXQ="},"L3NnZGUvZG9jdW1lbnRhY2lv":{"date":1422115902000,"title":"Documentació","description":"Documentació comú, manuals i formularis específics per cada plataforma","sections":"SGDE","taxonomies":[],"weight":2,"path":"/sgde/documentacio","content":"### Presentació del servei\n\n- [Presentació](/related/sgde/Presentació-SGDE.pdf)\n\nPer poder utilitzar els serveis del SGDE és necessari donar-se d'alta en alguna de les plataformes següents:\n\n###  Plataforma de Formularis Adobe\n\n- [Sobre Formularis](/sgde-related/intro-formularis)\n\n- [Manual d'Usuari - Servei d'Invocació de Formularis](/related/sgde/Manual-Usuari-Serveis-Invocació.pdf)\n- [Manual d'Usuari - Autoservei](/related/sgde/Manual-Usuari-Servei-Corporatiu-de-Formularis-Electrònics-v9.pdf)\n\n- [Normatiu servei corporatiu de formularis electrònics](/related/sgde/SC-NOR15-01-Norma-servei-corporatiu-de-formularis-electrònics.pdf)\n- [Llibre blanc servei corporatiu de formularis - Adobe LiveCycle](/related/sgde/GE-Llibre blanc servei corporatiu de formularis.pdf)\n\n###  Sistema de Transformació de Documents o STD\n\n- [Sobre l'STD](/sgde-related/intro-std)\n\n- [Manual d'Usuari](/related/sgde/CSCanigo.MU.P00.E01_manual_usuari_STD.pdf)\n- [Manual de Creació de Plantilles](/related/sgde/CSCanigo.MU.P00.E01_Manual_creacio_plantilles_STD.pdf)\n- [Manual d'Arquitectura](/related/sgde/CSCanigo.MA.P00.E01_manual_arquitectura_STD.pdf)\n\n- [Formulari d'Alta d'aplicació](/related/sgde/CSCanigo.PA.P00.STD_ALTA_ambit-aplicacio.xlsx)\n","objectID":"L3NnZGUvZG9jdW1lbnRhY2lv"},"L3NnZGUvZm9ybXVsYXJpcy1hY3R1YWxpdHphY2lv":{"date":1520553600000,"title":"Actualització de plataforma al servei d'eFormularis","description":"Upgrade de versió d'Adobe LiveCycle a Adobe Experience Manager (AEM)","sections":"SGDE","toc":true,"taxonomies":[],"weight":4,"path":"/sgde/formularis-actualitzacio","content":"Des del CS Canigó s'està treballant en l'actualització del producte base del servei, Adobe LiveCycle ES4. **Adobe Experience Manager (AEM) 6.3** és l'evolució d'aquest producte, el qual, a més d'oferir les mateixes funcionalitats de les que ja disposa Adobe LiveCycle, n'afegeix de noves. D'entre aquestes noves funcionalitats destaca la possibilitat de poder treballar amb formularis HTML5.\n\nPer tant, l'actualització del producte té principalment dos objectius:\n\n* Evitar l'obsolescència mantenint la compatibilitat amb les funcionalitats actuals relatives a **Formularis PDF**\n* Oferir un nou motor per poder donar servei a **Formularis HTML5**\n\n## Formularis PDF\n\n_Dominis PRE_\n\n* preproduccio.eformularis.intranet.gencat.cat\n* eformularis.pre.intranet.gencat.cat\n* preproduccio.sgde.intranet.gencat.cat\n* sgde.pre.intranet.gencat.cat\n\n_Dominis PRO_\n\n* eformularis.intranet.gencat.cat\n* sgde.intranet.gencat.cat\n\n### Autoservei Adobe (Existent)\n\nAplicació web per l'activació i publicació de formularis PDF.\n\n_PRE_\n\nhttp://preproduccio.eformularis.intranet.gencat.cat/AutoserveiAdobe\n\n_PRO_\n\nhttp://eformularis.intranet.gencat.cat/AutoserveiAdobe\n\n### WS SOAP (Existent)\n\nWebservice per operar amb formularis PDF. Els contractes de les diferents versions del webservice es mantindran intactes:\n\n_PRE_\n\nhttp://preproduccio.eformularis.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\nhttp://preproduccio.eformularis.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV1?wsdl\nhttp://preproduccio.eformularis.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacio?wsdl\n\n_PRO_\n\nhttp://eformularis.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\nhttp://eformularis.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV1?wsdl\nhttp://eformularis.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacio?wsdl\n\n### REST API (Nova)\n\nCom a millora a l'actual servei de Formularis PDF, s'incorpora una nova REST API amb les mateixes funcionalitats que ofereix el WS SOAP. Aquesta REST API està basada en Swagger2.\n\n![REST API eForms](/related/sgde/serveis-invocacio-api.png)\n\nEs recomana que, un cop es posi en marxa la nova plataforma, les noves aplicacions que s'integrin al servei utilitzin aquesta REST API. En breu es publicarà informació de com fer ús d'aquesta nova API.\n\n## Formularis HTML5\n\nEn aquest punt s'està treballant tant en la vessant més **tècnica** com en la **governança** d'aquest nou servei de Formularis HTML5. Els Adaptive Forms d'AEM són els elements que proporcionen formularis HTML5 adaptatius als usuaris.\n\n![REST API eForms](/related/sgde/formulari-html5.png)\n\n<br><br>\n\nAquesta actualització del producte s'està realitzant en una infraestructura paral·lela a l'actual. Per tant, caldrà que els integradors facin proves en aquesta nova plataforma abans no es posi en servei. Si les proves són satisfactòries, el canvi de plataforma haurà de ser totalment transparent.\n\nDurant les pròximes setmanes s'aniran comunicant amb més detall totes les novetats d'aquesta actualització en aquest mateix portal, així com una planificació de disponibilitat d'entorns, períodes de proves per part dels integradors, i posada en marxa del servei. També s'enviaran notificacions per correu als integradors per consensuar aquest calendari.\n\n## Comunicacions\n\n### [6-4-2018] Comunicat eFormularis - Actualització tecnològica del servei\n\nBenvolguts,\n \nDes del CS Canigó us informem que pròximament es farà efectiva una actualització tecnològica del servei **eFormularis**(Formularis Adobe).\n \nEmmarcat en l’evolució de la plataforma d’eFormularis, es desplegarà la solució AEM (Adobe Experience Manager) que substitueix a l’actual Adobe LiveCycle com a producte base del servei. En concret, amb aquest upgrade es pasa d'Adobe LiveCycle ES4 SP1 (11.0) a AEM 6.3, la instal·lació del qual s'ha realitzat en nous servidors amb noves versions de sistema operatiu i servidor d'aplicacions. Amb aquest canvi, a més de mantenir la plataforma al dia, s’evoluciona el servei per tenir capacitat de publicació de formularis en html a més dels actuals pdf.\n\nEl traspàs de formularis als nous servidors serà realitzat pel CS Canigó dins d'aquest procés d'actualització del servei i, per tant, no s’hauran de tornar a activar/publicar.\nIgualment, les aplicacions consumidores del servei d'eFormularis hauran de validar que tot segueix funcionant igual que abans. Per fer-ho, prèviament hauran de sol·licitar connectivitat cap als nous servidors (ip:port) des dels servidors d’aplicacions on es troben desplegades. Aquest tràmit s'hauria de realitzar durant les dues properes setmanes (9-4-2018 - 23-4-2018) per l'entorn de Preproducció. Per l'entorn de Producció la data límit és el 11-6-2018 tot i que es recomana fer-ho amb la màxima antelació possible.\n\nA continuació es descriuen els dominis i IPs dels entorns:\n \n**PREPRODUCCIÓ**\n \n_Dominis_:\n\neformularis.pre.intranet.gencat.cat (Deprecat)\n\npreproduccio.sgde.intranet.gencat.cat\n\nsgde.pre.intranet.gencat.cat (Deprecat)\n\n_Nota: aquest domini no es va informar en el comunicat. Aprofitem per indicar que, de la mateixa manera que el domini \"eformularis.pre.intranet.gencat.cat\", es donarà de baixa a mig termini donat que no compleix la normativa de dominis_\n\npreproduccio.eformularis.intranet.gencat.cat (Nou)\n \n_IP actual_:\n\n10.53.12.1 (port 80)\n \n_IP nova_:\n10.1.126.83 (ports 80 i 443)\n \n**PRODUCCIÓ**\n \n_Dominis_:\n\nsgde.intranet.gencat.cat\n\neformularis.intranet.gencat.cat\n \n_IP actual_:\n\n10.52.12.1 (port 80)\n \n_IP nova_:\n\n10.1.118.54 (ports 80 i 443)\n \nPel nou entorn de preproducció es crearà el domini \"preproduccio.eformularis.intranet.gencat.cat\" per tal d’acomplir la normativa de nomenclatura de dominis. El domini \"eformularis.pre.intranet.gencat.cat\" es donarà de baixa durant els propers mesos, per tant, recomanem que les aplicacions que l'estiguin fent servir canviïn al nou \"preproduccio.eformularis.intranet.gencat.cat\". La data definitiva de baixa del domini \"eformularis.pre.intranet.gencat.cat\" es comunicarà pròximament.\n\nLes dates de disponibilitat previstes dels nous entorns són les següents:\n\n* **PRE**: 23-4-2018\n* **PRO**: 11-6-2018\n\nEn cas que es requereixi accés a l’entorn antic de Preproducció a partir del 23-4-2018 fins el 11-6-2018, moment en que els nous entorns de Preproducció i Producció estiguin alineats, es podrà seguir fent per IP.\nÉs molt recomanable provar els formularis en el nou entorn de Preproducció abans no es faci efectiu el canvi de servidors a l’entorn Productiu. Durant les dues darreres setmanes d'Abril i tot el mes de Maig està previst que les aplicacions facin aquestes proves al nou entorn de Preproducció i reportin possibles incidents preferiblement via [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd) o en cas de no disposar de permisos d’accés a la [bústia del CS Canigó](mailto:oficina-tecnica.canigo.ctti@gencat.cat). Sol·licitem que el responsable de cada aplicació comuniqui la finalització de les proves i el seu resultat a aquesta bústia. Així des del CS Canigó podrem fer un seguiment de l’evolució d’aquestes proves en el nou entorn.\nVoldríem destacar com a canvi més important el realitzat en les operacions que treballen amb fitxers annexes. Per aquestes en concret s'haurien de fer proves el més exhaustives que sigui possible. Tal com hem indicat al paràgraf anterior, per qualsevol problema us podeu posar en contacte amb el CS Canigó pels canals oficials.\n\nSalutacions,\n\n\n### [6-4-2018] Comunicat STD - Canvi IPs del servei\n\nBenvolguts,\n\nDes del CS Canigó us informem que pròximament les IPs dels dominis \"preproduccio.sgde.intranet.gencat.cat\" i \"sgde.intranet.gencat.cat\" del servei **STD (Sistema de Transformació de Documents)** canviaran degut a un canvi a la infraestructura:\n\n**preproduccio.sgde.intranet.gencat.cat**\n\nIP actual:\n\n10.53.12.1 (port 80)\n\nIP nova:\n\n10.1.126.83(ports 80 i 443)\n\n**sgde.intranet.gencat.cat**\n\nIP actual:\n\n10.52.12.1 (port 80)\n\nIP nova:\n\n10.1.118.54 (ports 80 i 443)\n\nLes dates previstes pel canvi a cada entorn són les següents:\n\n* **PRE**: 23-4-2018\n* **PRO**: 11-6-2018\n\nCal que els integradors sol·licitin connectivitat cap a la nova ip i ports des dels servidors on es troben desplegades les aplicacions. Aquest tràmit s'hauria de realitzar durant les dues properes setmanes (9-4-2018 - 23-4-2018) per l'entorn de Preproducció. Per l'entorn de Producció la data límit és el 11/6 tot i que es recomana fer-ho amb la màxima antelació possible.\n\nPer qualsevol dubte o incident podeu contactar amb el CS Canigó preferiblement via [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd) o en cas de no disposar de permisos d’accés a la [bústia del CS Canigó](mailto:oficina-tecnica.canigo.ctti@gencat.cat). Sol·licitem que el responsable de cada aplicació confirmi que està preparada pel canvi a aquesta bústia.\n\nSalutacions,\n\n<br><br>\nPer qualsevol dubte us podeu posar en contacte amb el CS Canigó preferiblement a través del [servei STF del CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/STF) o [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\n","objectID":"L3NnZGUvZm9ybXVsYXJpcy1hY3R1YWxpdHphY2lv"},"L3NnZGUvZm9ybXVsYXJpcw==":{"date":1422115902000,"title":"Formularis electrònics","description":"Descripció del servei d'eFormularis","sections":"SGDE","taxonomies":[],"weight":3,"path":"/sgde/formularis","content":"El CTTI disposa d'una plataforma de formularis electrònics que permet la interacció amb formularis PDF dinàmics basats en Adobe Livecycle ES4 SP1 sota una arquitectura amb disponibilitat i tolerància a fallades.\r\n\r\nA més, i aquest és un dels principals avantatges respecte a la solució única amb Adobe, s'ofereix un servei d'accés a les funcionalitats requerides en el tractament de formularis electrònics sense cap necessitat de conèixer l'API que ofereix Adobe.\r\nPer a la construcció dels formularis Adobe se seguiran les recomanacions dels següents llibres normatius del CTTI:\r\n\r\n- Llibre blanc servei corporatiu de formularis\r\n- Llibre normatiu (NOR15-01 6-11-08)\r\n\r\nAquests documents i més informació com l'arquitectura de la plataforma i els procediments de treball es poden consultar dintre de l'apartat de documentació de Formularis electrònics al Portal del Centre de Suport Canigó http://canigo.ctti.gencat.cat/sgde/documentacio/\r\n","objectID":"L3NnZGUvZm9ybXVsYXJpcw=="},"L3NnZGUtcmVsYXRlZC9pbnRyby1mb3JtdWxhcmlz":{"date":1422115902000,"title":"Formularis electrònics (eFormularis)","description":"Plataforma de formularis electrònics Adobe","sections":"SGDE","taxonomies":[],"weight":3,"path":"/sgde-related/intro-formularis","content":"El CTTI disposa d'una plataforma de formularis electrònics que permet la interacció amb formularis PDF dinàmics basats en Adobe Livecycle ES4 SP1 sota una arquitectura amb disponibilitat i tolerància a fallades.\r\n\r\nA més, i aquest és un dels principals avantatges respecte a la solució única amb Adobe, s'ofereix un servei d'accés a les funcionalitats requerides en el tractament de formularis electrònics sense cap necessitat de conèixer l'API que ofereix Adobe.","objectID":"L3NnZGUtcmVsYXRlZC9pbnRyby1mb3JtdWxhcmlz"},"L3NnZGUvc3Rk":{"date":1422115902000,"title":"Sistema de Transformació de Documents (STD)","description":"Descripció del servei","sections":"SGDE","taxonomies":[],"weight":4,"path":"/sgde/std","content":"El CTTI ofereix una plataforma on es troba disponible el Sistema de Transformació de Documents o STD. Aquesta plataforma s'integra dintre del grup de Serveis del SGDE (Sistema de Gestió de Documents Electrònics) del CTTI juntament amb la plataforma de Formularis Electrònics.\r\n\r\nEls serveis inclosos per aquesta plataforma són:\r\n\r\n- Transformació de documents Ofimàtics (Word, Excel, PowerPoint, OpenOffice, etc.) a PDF.\r\n- Conversió de documents PDF mitjançant plantilles.\r\n\t- Operacions de Translació, Rotació i Escalatge.\r\n\t- Inserció de diferents tipus de Tags de Text, Imatges, Codis QR, Codis de Barres, Codis CSV i Marques d'Aigua.\r\n- Generació de Codis Segurs de Validació o CSV\r\n\r\nQualsevol aplicació que ho sol.liciti pot treballar amb l'STD prèvia petició d'alta en la plataforma. Per fer-ho s'ha d'enviar la Plantilla d'Alta al Servei, degudament omplerta a [oficina-tecnica.canigo.ctti@gencat.cat](mailto://oficina-tecnica.canigo.ctti@gencat.cat), sol.licitant formalment l'alta.\r\n","objectID":"L3NnZGUvc3Rk"},"L3NpYy9hYm91dA==":{"date":1496880000000,"title":"Què és el Servei d'Integració Continua (SIC 2.0)","description":"Conceptes, motivació i funcionalitat del servei","sections":"SIC","taxonomies":[],"weight":1,"path":"/sic/about","content":"## Conceptes i motivació\r\nLa integració de les diferents peces de programari que componen una aplicació és un repte present en tot projecte de desenvolupament. Sovint apareixen problemes com els següents:\r\n\r\n- Proves d'integració ajornades fins moments massa propers al desplegament.\r\n- Alt cost de correcció dels errors.\r\n- Visibilitat baixa de l'estat de construcció dels projectes.\r\n- Manca d'homogeneïtat en les eines utilitzades.\r\n\r\nL'existència d'un servei que gestioni el cicle de vida d'aquestes peces i permeti automatitzar certes tasques i donar visió global proporciona molts beneficis, entre els quals podem citar:\r\n\r\n- Reducció en els costos de manteniment de les aplicacions.\r\n- Augment de la qualitat i fiabilitat de les aplicacions.\r\n- Donar visibilitat de les activitats, lliurables i estat del desenvolupament dels projectes.\r\n- Disposar d'un conjunt d'eines comunes en la construcció de les aplicacions.\r\n- Establir un repositori comú on ubicar el codi font de les aplicacions.\r\n- Simplificar i reduir el temps de desplegament als diferents entorns.\r\n\r\nA més, el concepte d'integració continua permet disposar permanentment d'una versió del codi provinent d'un repositori controlat i amb uns paràmetres de qualitat mesurables.\r\n\r\nEl Servei d'Integració Continua (SIC) neix amb l'objectiu de donar aquest suport al cicle de vida de manera centralitzada i amb un cost reduït, ja que està basat en tecnologies de programari lliure.\r\n\r\n<br/>\r\n## Serveis\r\n\r\n### Lliurament del codi\r\nQuan l'equip de desenvolupament té una nova versió del codi font llesta per lliurar, es connecta al SCM de SIC i efectua la pujada de la nova versió. \r\nLa persona de l'equip que efectua aquesta acció és la que té el rol de Release Manager o Gestor de Lliuraments. \r\n\r\nTot i que qualsevol usuari de l'equip de desenvolupament podría accedir al SCM de SIC, es recomana que l'accés sigui efectuat només per les figures dels Release Manager. Se suposa que l'equip de desenvolupament ja té el seu propi repositori de codi a les seves instal·lacions i que allà és on es fan les proves pertinents fins que es considera el codi llest per lliurar.\r\n\r\n\r\n\r\n### Construcció de l'aplicació\r\n\r\nLa construcció dels projectes serà efectuada automàticament a l'eina d'Integració Contínua de SIC (Jenkins) en realitzar-se una pujada de codi al SCM de SIC.\r\nCom a resultat de la construcció es generarà un conjunt d'artefactes, bàsicament components estàtics i dinàmics. S'executaran les proves unitàries i s'efectuaran les tasques d'anàlisi de codi si l'aplicació ho requereix.\r\n\r\nLa construcció del codi pot generar errors, i el procés de lliurar codi / construir serà iteratiu en el cas més general.\r\n\r\n### Versionat del codi\r\n\r\nLa versió de les aplicacions ha de ser sempre incremental, és a dir, qualsevol nova actualització de codi al SCM del SIC ha d'anar acompanyat amb un increment de la versió.\r\n\r\nNo es permetrà que una aplicació desplegui una versió d'una aplicació igual o inferior a una versió prèviament desplegada. Si no es fes així, es podria induir a confusió en els futurs desplegaments de pre-producció i producció. Per exemple, no se sabria quina versió d'integració està desplegada en l'entorn de pre-producció.\r\n\r\n### Execució de proves unitàries\r\n\r\nDins del procés de construcció dels executables (i sempre que l'aplicació ho requereixi) s'executen les proves unitàries.\r\n\r\nCom a resultat de l'execució de les proves unitàries s'obtenen 2 tipus d'informes:\r\n\r\n* Nombre total de proves i percentatge de proves passades i fallades\r\n* Percentatge de cobertura de les proves respecte del codi font\r\n\r\n### Anàlisi del codi\r\n\r\nL'anàlisi de codi és un altre dels processos que es passen dins de la tasca de construcció. A partir d'unes regles predefinides, s'analitza el codi per tal d'obtenir mètriques d'adherència a estàndards i bones pràctiques.\r\n\r\n### Visualització del nivell de Salut del projecte\r\n\r\nA la pantalla principal del portal es pot veure, per cada projecte, unes icones que indiquen el \"nivell de salut\" del projecte. Aquest nivell de salut es pot definir per cada projecte i es basa en el número de construccions que han anat bé /malament, així com del percentatge de proves i indicadors d'anàlisi.\r\n\r\n### Desplegaments automatitzats\r\n\r\nEl SIC té capacitat per a poder realitzar el desplegament automàtic d'un gran nombre d'aplicacions de diferents tecnologies a diferents entorns. \r\n\r\nAquests es realticen mitjançant l'eina d'Integració Contínua de SIC: Jenkins. Es configurarà una única tasca per projecte que s'executarà automàticament amb cada pujada de codi al SCM. \r\nLa tasca inclourà accions de construcció d'artefacte, execució de test i desplegaments a entorns no-productius i productius. En aquells entorns on no es pugui desplegar automàticament, el flux d'execució de la tasca s'aturarà esperant una resposta manual d'acceptació.\r\n\r\n\r\n### Accés per a CPD al SCM\r\n\r\nNo totes les aplicacions poden construir els seus artefactes a desplegar mitjançant el SIC, ja sigui per estar desenvolupades amb una tecnologia no suportada per SIC o per particularitats del procés de construcció (veure el [Manual Integració](/related/sic/manual-integracio.pdf)). \r\nEn aquests casos, es permet que les aplicacions puguin lliurar els artefactes (.war, .ear, .jar, .zip, etc.) a CPD mitjançant el sistema de gestió de binaris de SIC. Aquest estarà disponible a partir de Juliol 2017, conjuntament amb les instruccions de la seva operativa.\r\n\r\n","objectID":"L3NpYy9hYm91dA=="},"L3NpYy9jbGF1":{"date":1525219200000,"title":"Clau pública del SIC","description":"Clau pública del SIC","sections":"SIC","taxonomies":[],"weight":11,"path":"/sic/clau","content":"## Clau pública del SIC\n\n<a href=\"/related/sic/key/sic_id_rsa.pub.pem\" download target=\"_blank\" style=\"display: block; margin: 25px auto; border-radius: 5px; width: 200px; padding: 10px; color: white !important; text-decoration: none !important;background-color: #CC0000;text-align: center;font-weight:bold;\">\nDescarregar la clau\n</a>\n\nLa infraestructura de clau pública (PKI en anglès) permet establir un sistema de xifrat en el que es permet l'execució amb garanties operacionals criptogràfiques, tals com el xifrat, la firma digital i el no repudi de transaccions electròniques.\n\nEl SIC aprofita els avantatges d'aquest sistema oferint aquesta clau pública als seus usuaris per tal que aquests puguin fer-ne ús en els procediments operatius que la requereixin. Es tracta d’un arxiu `.pem` amb la clau pública del SIC. Aquesta clau consisteix en una RSA de 4096 bits.\n\nActualment, l'únic cas d'ús d'aquesta clau es el següent:\n\n* Utilització en l'Autoservei de _Jobs pipeline_. En el casos en els que el proveïdor d'infraestructures necessita introduir paraules de pas als descriptors ACI.\n\n\tEn aquest cas, per encriptar les paraules de pas per a la seva introducció en l'ACI, es pot utilitzar la següent comanda:\n\n    ```\n    $ echo '<password_a_encriptar>' | openssl rsautl -encrypt -pubin -inkey sic_id_rsa.pub.pem | base64\n\tK0zcD3BuLKN55XVjqpovmwbJDEVehnEN7pz06ytPMlBowuc2IATSyH/c/zN5EmLE5DFoJcRLFA9B\n\tNmf0rh0yzUDb3kS+jXUuFhx+N35N2ScbemiZL3sjji3icXqgWmiQTmfp1hCAZgq5oMfMJzpwjWlq\n\tubT15lXq/6jgkj0hS9pYUpZBz0rH6IX0q81xRvsnQteMyrtQik/p/2ZaTbj0ciiLG61kkVcGSZLo\n\tsr9iOVdFh3q8Ok7+CAPhKaa/maGn0LEeaafj+5pBLE9AWcOy98imBRUzr4C8bi9ydMjuRdvd12XT\n\t1JdcHer/G1ZWBx9yEIYQEGgG/eFR4njNBjtjH/A53YBcbLIH2ZzHI3v33PCE5W3aVoK5qVqdVf64\n\tGlicdVQ2VSm7ROE4bfcUu4BzVw1em6hUw6LSXxH6GrKVxFe0JVWbrIlOyDL1nGu3Yu6zdplayK+q\n\tanqNjSRixyLOjoKon2g80dHGd12S7j1av3oyhPz/1KlqMt71YgTrZG3GxeW7NB356V/18bY/PwCn\n\tUcNttMs3oOvt+6d4UgeqqesA1fgDx92X+zIoyOTh2rnkfWo554cwqg+w3JaB5Kp30vGJNXwrvR+W\n\t+x4v2PLCO1D2b59Bb3n9/rFENXHE8wYLPAecPoSNjB6dB2/JdZibUwDJz+T98nOlcgJ7FcBBQ4s=\n\t$\n    ```\n\nNo es descarta que aquesta clau s'utilitzi en futures noves operatives amb el SIC. En tal cas, s'introduirà en el llistat anterior tots els usos.\n\nSi teniu cap dubte en l'ús de la clau, podeu obrir una [consulta](/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta) a SAU Remedy.","objectID":"L3NpYy9jbGF1"},"L3NpYy9mYXE=":{"date":1496016000000,"title":"FAQ SIC 2.0","description":"Preguntes freqüents sobre els serveis SIC 2.0","sections":"SIC","taxonomies":[],"weight":3,"path":"/sic/faq","content":"### **Què és SIC 2.0?** ####\r\nÉs un conjunt d'evolutius i millores que s'han aplicat als serveis SIC. Entre aquestes destaca:\r\n\r\n* Nou SCM : [GIT](https://git-scm.com/)\r\n* Nou Portal de treball: [Gitlab](https://git.intranet.gencat.cat)\r\n* Canvi al sistema de peticions d'alta de repositoris: Autoservei de repositoris de projectes a través del portal de treball Gitlab.\r\n* Canvi al sistema d'accés: amb credencials d'usuari GICAR. No caldrà demanar altes d'usuaris, ja es troben bolcats de GICAR.\r\n* Nous tipus de jobs Jenkins: Pipeline . Únic job que inclou Construcció + desplegament/petició desplegament a tots els entorns i que es dispara en fer una pujada de codi al Gitlab.\r\n\r\n<br/>\r\n\r\n#### **Què necessito per poder començar a treballar amb SIC 2.0?** ####\r\n\r\n1) Client Git instal·lat a la màquina des d'on es faran les pujades. Aquest es pot descarregar des del [web oficial de Git](https://git-scm.com/downloads)\r\n\r\n2) Usuari a GICAR, amb l'e-mail informat a la identitat.\r\n\r\n<br/>\r\n\r\n\r\n#### **Quina versió de GIT necessito tenir instal·lada per treballar-hi amb el Gitlab?** ####\r\n\r\nLa versió de GIT que fa servir el GITLAB de SIC és la 2.10.2. Segons la documentació oficial de GIT, qualsevol versió 2.X seria compatible. Tanmateix, recomanem utilitzar una versió igual o superior a la 2.7.X.\r\n\r\n<br/>\r\n\r\n\r\n#### **En accedir al Gitlab, contínuament em redirigeix a la pàgina del meu perfil i m'obliga a informar una adreça de correu. Cal fer alguna acció addicional?** ####\r\n\r\nCal tenir informat el correu electrònic a la identitat Gicar per tal que la informació es propagui al Gitlab. Caldria fer una petició de Suport al servei GICAR a través de SAU-Remedy per tal que actualitzin aquest camp.\r\n\r\n<br/>\r\n\r\n#### **Com puc migrar el codi dels repositoris SVN de SIC cap als del Gitlab?** ####\r\nHem publicat un [howto](http://canigo.ctti.gencat.cat/howtos/2017-07-Howto-Migrar-repositori-SVN-a-repositori-GIT/) sobre com migrar els projectes de SVN a Git. En cas de dubtes sobre el procediment, pot obrir una consulta a Remedy al servei de \"Framework SIC\".\r\n\r\n<br/>\r\n\r\n#### **Puc treballar simultàniament amb el repositori SVN i repositori Gitlab de la mateixa aplicació?** ####\r\nNo. En cas de fer-ho, seria difícil discernir quin dels 2 conté la darrera versió del codi. \r\n\r\nPer a les noves aplicacions, ja haurà de començar a treballar directament amb Gitlab. Per a aquelles aplicacions que migri del SVN cap al Gitlab haurà de deixar de treballar amb el repositori SVN, comunicar-ho a l'equip de SIC i fer servir únicament el repositori al Gitlab.\r\n\r\n<br/>\r\n\r\n#### **Fins quan podem utilitzar el SVN?** ####\r\nLa data planificada per al tancament definitiu del SVN és el **5 de Febrer de 2018**. Tots els repositoris SVN han d'estar migrats al Gitlab de SIC abans d'aquesta data.\r\n\r\n<br/>\r\n\r\n\r\n#### **Com afectarà la migració de codi de SVN a Gitlab als jobs Jenkins de l'aplicació?** ####\r\nS'actualitzarà l'origen de dades d'aquests per tal que apuntin al repositori del projecte de Gitlab. Els nous jobs es crearan seguint el nou tipus de job Pipeline però els ja creats romandran amb el format actual.\r\n\r\n<br/>\r\n\r\n#### **Mantindré els meus accessos/rol de SIC 1.0 a SIC 2.0?** ####\r\nMantindrà el mateix rol o rols al Gitlab/Jobs Jenkins, ja que aquest s'han heretat de l'anterior sistema d'usuaris.\r\n\r\n<br/>\r\n\r\n#### **Si ja estic logat a GICAR, per què em torna a demanar les credencials en accedir als portals Gitlab/Jenkins del SIC?** ####\r\nEls portals Gitlab/Jenkins del SIC no es troben adherits al Single Sign-On de GICAR (no llegeixen les capçaleres d'autenticació GICAR). L'autenticació i autorització es realitza contra l'LDAP del SIC, on s'han bolcat les dades dels usuaris GICAR.\r\n\r\n<br/>\r\n\r\n\r\n#### **Quina diferència hi ha entre grup d'aplicació i projecte dins el Gitlab de SIC?** ####\r\n\r\n* Els projectes són les aplicacions (o mòduls d'aplicació, llibreries pròpies ,...) que tenen versionat de codi propi. \r\n* Els grups d'aplicació són els contenidors ('carpetes') on figuren els projectes. Reben per nom el codi d'aplicació. \r\n\r\n<br/>\r\n\r\n#### **Quina diferència hi ha entre espai privat i espai corporatiu al Gitlab de SIC i a quin espai he de crear els projectes?** ####\r\nEls usuaris Release Manager podran crear tant grups d'aplicació com projectes dins el seu espai personal al portal Gitlab. Per tal d''oficialitzar' a CTTI l'entrega del codi font d'un projecte, aquest haurà de figurar a l'espai corporatiu de SIC.\r\n\r\nEls grups d'aplicació oficials només podran ser creats per l'equip del SIC. Els de les noves aplicacions es crearan arran les reunions de Fase0 de l'aplicació i els ja existents a partir de migracions de repositoris SVN.\r\nEls projectes dins els grups d'aplicació sí que podran ser creats per els propis usuaris Release Manager mitjançant el portal Gitlab.\r\n\r\n<br/>\r\n\r\n#### **Puc crear subgrups dins els grups d'aplicació oficials al Gitlab?** ####\r\nÉs possible crear subgrups dins un grup d'aplicació oficial (nom grup = codi aplicació) però de cara a la integració amb Jenkins, comportarà una incompatibilitat. Per tant, es desaconsella treballar amb subgrups (almenys dins els grups d'aplicació oficials).\r\n\r\n<br/>\r\n\r\n#### **Com puc concedir permisos als meus codis d'aplicació a altres membres?** ####\r\n* En el cas de CPD i LdT l'assignació de permisos és automàtica, per tant no cal fer res.\r\n* En el cas de lots i proveïdors d'aplicacions, us recordem que a l'agost de 2017 vam publicar un [article](http://canigo.ctti.gencat.cat/noticies/2017-07-18-SIC-Autoservei-usuaris-SIC2.0/) sobre com concedir permisos a d'altres companys. En cas de dubtes sobre el procediment, pot obrir una consulta a Remedy al servei de \"Framework SIC\".\r\n\r\n<br/>\r\n\r\n#### **Des de la nostra oficina no tenim connectivitat cap als serveis del SIC. Com podem resoldre aquest problema?** ####\r\nCaldrà configurar la vostra VPN/Lan2Lan/PPP per a que tingui accés a les adreces IP del SIC. Si us cal saber les adreces IP dels serveis podeu obrir una consulta a Remedy al servei \"Framework SIC\".\r\n\r\n<br/>\r\n\r\n#### **Quines branques provoquen l'execució de pipelines de construcció i desplegament al Jenkins?** ####\r\nÚnicament la branca `master` és la que té el lligam amb les pipelines de Jenkins. No obstant, es pot publicar qualsevol branca al Git del SIC.\r\n\r\n<br/>\r\n","objectID":"L3NpYy9mYXE="},"L3NnZGUtcmVsYXRlZC9pbnRyby1zdGQ=":{"date":1427760000000,"title":"Sistema de Transformació de Documents (STD)","description":"STD","sections":"SGDE","taxonomies":[],"weight":3,"path":"/sgde-related/intro-std","content":"El CTTI ofereix una nova plataforma on es troba disponible el **Sistema de Transformació de Documents** o STD. Aquesta plataforma s'integra dintre del grup de Serveis del **SGDE** (Sistema de Gestió de Documents Electrònics) del CTTI juntament amb la plataforma de Formularis Electrònics.\r\n\r\nEls serveis inclosos per aquesta plataforma són:\r\n\r\n- **Transformació de documents Ofimàtics** (Word, Excel, PowerPoint, OpenOffice, etc.) a PDF.\r\n- **Conversió de documents PDF** mitjançant plantilles.\r\n- Operacions de **Translació, Rotació i Escalatge**.\r\n- Inserció de diferents tipus de **Tags de Text, Imatges, Codis QR, Codis de Barres, Codis CSV i Marques d'Aigua**.\r\n- Generació de **Codis Segurs de Validació** o CSV\r\n- **OCR** (Optical Character Recognition)\r\n\r\nQualsevol aplicació que ho sol.liciti pot treballar amb l'STD prèvia petició d'alta en la plataforma. Per fer-ho s'ha d'enviar la Plantilla d'Alta al Servei, degudament omplerta a [oficina-tecnica.canigo.ctti@gencat.cat] (mailto://oficina-tecnica.canigo.ctti@gencat.cat), sol.licitant formalment l'alta.","objectID":"L3NnZGUtcmVsYXRlZC9pbnRyby1zdGQ="},"L3NpYy9pbnRlZ3JhY2lvbnMtY3Bk":{"date":1522800000000,"title":"Integració de CPDs al SIC","description":"Guia d'integració de CPDs al SIC","sections":"SIC","taxonomies":[],"weight":3,"path":"/sic/integracions-cpd","content":"Es posa a disposició dels usuaris de CPD la següent guia sobre els procediments d'integració de CPD al SIC:\n\n- [SIC - Howto - Integració de CPDs al SIC] (/howtos/2018-03-SIC-Integracions-amb-CPD)\n\nEn aquesta guia s'explica per a cada tipus de plataforma (Servidors web, servidors de fitxers, servidors d'aplicacions, bases de dades, etc.) què és el que necessita el SIC per part de CPD quan s'està posant en marxa una nova aplicació a CTTI. En concret, s'indica:\n\n* Què cal fer per part de CPD\n* Quina informació retornar al SIC\n","objectID":"L3NpYy9pbnRlZ3JhY2lvbnMtY3Bk"},"L3NpYy9wZXRpY2lvbnM=":{"date":1435276800000,"title":"Peticions SIC a SAU-Remedy","description":"Guia per a obrir peticions SIC a SAU-Remedy","sections":"SIC","taxonomies":[],"weight":3,"path":"/sic/peticions","content":"Es posa a disposició dels usuaris la següent guia sobre com obrir peticions al servei de FRAMEWORK SIC a Remedy\r\n\r\n- [SIC - Howto - Obrir peticions SIC a Autoservei Remedy ] (/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy)\r\n\r\n<br/>\r\n<br/>\r\n\r\nEn cas de mancança de disponibilitat del servei Remedy, es pot obrir la petició de SIC via bústia SAU de Remedy: [sau.tic@gencat.cat](mailto:sau.tic@gencat.cat).\r\n\r\nPer tal que aquesta petició pugui ser atesa per el personal de SAU-Remedy, cal indicar la mateixa informació que s'indicaria a la petició oberta via l'eina Remedy.\r\nEl redactat ha de ser en text plà, sense incloure sintaxi HTML. Es proposa seguir les següents plantilles a l'hora del redactat del correu de petició:\r\n<br/>\r\n<br/>\r\n\r\n[**Per a consultes:**](mailto:sau.tic@gencat.cat?subject=Consulta%20sobre%20aplicaci%C3%B3%20FRAMEWORK%20SIC&body=-%20Nom%20de%20l%27aplicaci%C3%B3%3A%20FRAMEWORK%20SIC%0A-%20Codi%20de%20la%20etiqueta%20o%20el%20nom%20del%20seu%20ordinador%3A%20SIC-Consulta%0A-%20Tel%C3%A8fon%20de%20contacte%0A%0A-%20Descripci%C3%B3%20de%20la%20consulta)\r\n\r\nTítol correu: \"Consulta sobre aplicació FRAMEWORK SIC\"\r\n\r\nCos correu: Cal indicar la següent informació:\r\n\r\n\t- Nom de l'aplicació: FRAMEWORK SIC\r\n\t- Codi de la etiqueta o el nom del seu ordinador: SIC-Consulta\r\n\t- Telèfon de contacte\r\n\r\n\t- Descripció de la consulta\r\n\t\t  \r\n <br/>\r\n <br/>\r\n\r\n[**Per a reportar una incidència:**](mailto:sau.tic@gencat.cat?subject=Incid%C3%A8ncia%20sobre%20aplicaci%C3%B3%20FRAMEWORK%20SIC&body=-%20Codi%20de%20la%20etiqueta%20o%20el%20nom%20del%20seu%20ordinador%3A%20SIC-Incid%C3%A8ncia%0A-%20Tel%C3%A8fon%20de%20contacte%0A-%20Problema%0A-%20Nom%20de%20l%27aplicaci%C3%B3%3A%20FRAMEWORK%20SIC%0A%0A-%20Descripci%C3%B3%20de%20l%27error%20o%20problema%20que%20es%20mostra%20a%20la%20pantalla)\r\n\r\nTítol correu: \"Incidència sobre aplicació FRAMEWORK SIC\"\r\n\r\nCos correu: Cal indicar la següent informació:\r\n\r\n\t- Codi de la etiqueta o el nom del seu ordinador: SIC-Incidència\r\n\t- Telèfon de contacte\r\n\t- Problema\r\n\t- Nom de l'aplicació: FRAMEWORK SIC\r\n\r\n\t- Descripció de l'error o problema que es mostra a la pantalla\r\n\t\r\n<br/>\r\n<br/>\r\n\r\n[**Petició de suport:**](mailto:sau.tic@gencat.cat?subject=Petici%C3%B3%20de%20suport%20funcional%20per%20a%20l%27aplicaci%C3%B3%20FRAMEWORK%20SIC&body=-%20Urg%C3%A8ncia%3A%20Alta%2C%20Mitjana%20o%20Baixa%0A-%20Nom%20de%20l%27aplicaci%C3%B3%3A%20FRAMEWORK%20SIC%0A-%20Descripci%C3%B3%20breu%20del%20suport%0A%0A-%20Descripci%C3%B3%20detallada%20del%20suport%0A)\r\n\r\nTítol correu: \"Petició de suport funcional per a l'aplicació FRAMEWORK SIC\"\r\n\r\nAdjunts: El [formulari](http://canigo.ctti.gencat.cat/sic-documentacio/formularis/) que es correspongui amb el tipus de petició que s'està demanant\r\n\r\nCos correu: Cal indicar la següent informació:\r\n\r\n\t- Urgència: (Alta, Mitjana o Baixa)\r\n\t- Nom de l'aplicació: FRAMEWORK SIC\r\n\t- Descripció breu del suport\r\n\r\n\t- Descripció detallada del suport\r\n","objectID":"L3NpYy9wZXRpY2lvbnM="},"L3NpYy1kb2N1bWVudGFjaW8vaG93LXRvcw==":{"date":1435276800000,"title":"How to","description":"Altres documents d'interés per a l'ús del SVN o Jenkins","sections":"SIC","path":"/sic-documentacio/how-tos","content":"Un how-to és un document informal, generalment breu, que descriu com desenvolupar una certa tasca.\r\n\r\nEn aquest apartat s'aniran afegint un seguit de how-to, per tal de facilitar l'ús dels components de SIC. Aquests documents estan disponibles en format pdf o pptx.\r\n\r\n- [SIC - Howto - Obrir peticions SIC a Remedy] (/related/sic/howto/SIC - Howto - Obrir peticions SIC a Remedy.pdf)\r\n\r\n- [SIC - Accés Tasques de Gestio del Framework SIC (versió oficial Remedy)] (/related/sic/howto/Acces Tasques de Gestio del Framework SIC.pptx)\r\n\r\n- [SIC - Migració de repositori SVN a repositori GIT] (/howtos/2017-07-Howto-Migrar-repositori-SVN-a-repositori-GIT)\r\n\r\n- [SIC - Configurar l'entorn de treball per a GIT al SIC 2.0] (/howtos/2017-07-Howto-Configurar-entorn-treball)","objectID":"L3NpYy1kb2N1bWVudGFjaW8vaG93LXRvcw=="},"L3NpYy1kb2N1bWVudGFjaW8vZm9ybXVsYXJpcw==":{"date":1435276800000,"title":"Formularis","description":"Formularis de SIC","sections":"SIC","path":"/sic-documentacio/formularis","content":"### Formularis\r\n\r\n- [Formulari d'accés per a CPD al SIC](/related/sic/SIC-Formulari-CPD.xlsx)<br />\r\n  Aquest formulari està destinat a donar accés als administradors de CPD al SIC. En cas que es vulgui donar accés a un CPD a aplicacions informar els blocs \"Dades CPD\" (Fulla Dades CPD) i \"Llistat d'aplicacions\" (Fulla dades aplicacions). Si el que es vol és donar d'alta usuaris administradors de CPD també cal emplenar el bloc \"Usuaris administradors de CPD\" (Fulla Dades CPD). En cas que s'informi el camp \"Accés a artefactes al repositori de codi font\" amb valor 'Si' per algún usuari, cal que el proveïdor de l'aplicació hagi gestionat abans amb l'equip del SIC la realització d'una excepció a les restriccions que impedeixen per defecte custodiar artefactes (.war, .ear, .jar) al Subversion del SIC. \r\n\r\n  \r\n<br/>\r\n  \r\n**Notes**\r\n\r\nArran la incorporació del Gitlab com a nou SCM, el nou sistema d'accés mitjançant credencials GICAR i l'Autoservei d'usuaris i repositoris, s'han abolit la majoria de tràmits a SIC:\r\n\r\n- No es crearan nous repositoris SVN doncs a mig termini (previsiblement el 6 de Novembre de 2017) el SIC deprecarà aquest SCM. El codi de tota nova aplicació haurà de figurar al Gitlab.\r\n- No es realitzaran noves altes d'usuaris SIC, doncs el sistema d'accés a Gitlab / Jenkins és mitjançant les credencials d'usuari GICAR.\r\n- El tràmit de petició de jobs no desapareix però sí ho fa el formulari d'alta d'aquest. A la petició d'alta de jobs de l'aplicació caldrà adjuntar el Document d'Arquitectura. La informació que no es pugui obtenir d'aquest es demanarà a proveïdor / cpd.\r\n- El tràmit d'alta d'usuari d'accés per a CPD al SIC continuarà existint fins al 26 de Juny de 2017, data en què s'activarà un nou sistema de gestió de binaris que no utilitzarà el SVN. \r\n","objectID":"L3NpYy1kb2N1bWVudGFjaW8vZm9ybXVsYXJpcw=="},"L3NpYy1kb2N1bWVudGFjaW8vbWFudWFscw==":{"date":1435276800000,"title":"Manuals de SIC","description":"Manuals de SIC","sections":"SIC","path":"/sic-documentacio/manuals","content":"### Manuals\r\n\r\n- [Manual d'Usuari](/related/sic/2.0/manual-usuari.pdf)\r\n- [Manual d'Integració](/related/sic/2.0/manual-integracio.pdf)\r\n\r\n#### Més documentació sobre SIC 2.0\r\n\r\n- [Tutorial de migració de SVN a Git](http://canigo.ctti.gencat.cat/howtos/2017-07-Howto-Migrar-repositori-SVN-a-repositori-GIT/)\r\n- [Procediment de concessió de permisos a companys de lot](http://canigo.ctti.gencat.cat/noticies/2017-07-18-SIC-Autoservei-usuaris-SIC2.0/)\r\n- [Procediment d'obertura de peticions SIC a l'Autoservei Remedy](/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy)\r\n\r\n","objectID":"L3NpYy1kb2N1bWVudGFjaW8vbWFudWFscw=="},"L3NpYy1yZWxhdGVkL2FjY2VzLWNwZA==":{"date":1427760000000,"title":"Accés per a CPD","description":"","sections":"SIC","weight":1,"path":"/sic-related/acces-cpd","content":"### Accés per a CPD\n\nPer a totes aquelles aplicacions per a les que que no és possible realitzar desplegaments automatitzats des del SIC s'ofereix la possibilitat que els administradors de CPD puguin accedir als artefactes (.war, .ear, .zip, ...) custodiats al SIC per tal de poder realitzar desplegaments en els servidors dels nous CPDs.\n\nEls administradors podran accedir indistintament tant als artefactes lliurats al Subversion com els que generi Jenkins per a una aplicació que està compilant al SIC. Amb aquesta finalitat s'ha creat el Formulari d'accés per a CPD al SIC que podeu trobar a la secció de [Documentació](/sic/documentacio). Per tal de sol- licitar aquests accessos és necessari fer arribar aquest formulari degudament emplenat al servei SIC via petició de suport al [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ). En cas de no dispossar d'usuari o permissos en aquest servei SIC del JIRA CSTD [s'ha d'obrir una petició Remedy al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/).\n\n## Procediment de desplegament\n\nÉs responsabilitat del proveïdor de l'aplicació proporcionar a l'administrador de CPD el Manual de Desplegament on indicar les instruccions per a realitzar el desplegament de l'aplicació. És en aquest manual on cal indicar quina és la ubicació dins el SIC d'on obtenir l'artefacte/s a desplegar en el CPD:\n\nExemples\n\nLliurament a Subversion:\nhttp://svn.intranet.gencat.cat/ctt/0192/demoApp/tags/<versio>/bin/<nom_artefacte>\nhttp://svn.intranet.gencat.cat/ctt/0192/demoApp/tags/<versio>/docs/<nom_doc_desplegament>\nLliurament a Jenkins: http://hudson.intranet.gencat.cat/hudson/job/CTTI_demoApp_BLD/<num_compilacio>/artifact/treball/target/demoApp.ear","objectID":"L3NpYy1yZWxhdGVkL2FjY2VzLWNwZA=="},"L3NpYy1yZWxhdGVkL25vdS1tb2RlbC10aWM=":{"date":1427760000000,"title":"Nou model TIC al SIC","description":"","sections":"SIC","weight":1,"path":"/sic-related/nou-model-tic","content":"### Nou model TIC al SIC\r\n\r\nLa implantació del nou model TIC al SIC ha consistit en:\r\n\r\n- Creació d'una nova estructura del repositoris on les aplicacions s'agrupen segons el seu àmbit i codi de diàleg (abans s'agrupaven per àmbit i nom d'aplicació).\r\n- Les noves altes d'aplicació es realitzaran contra aquesta estructura.\r\n- Creació de nous grups de permissos per gestionar els accessos a aquests repositoris.\r\n- Homogeneïtzació de la llista dels d'àmbits al que poden pertanyen les aplicacions.\r\n\r\n## Nous grups de permisos\r\n\r\nA continuació s'enumeren els grups de permisos LDAP disponibles per accedir als repositoris de codi font/Portal d'Integració Contínua del SIC:\r\n\r\n- AMBIT: Es defineix un grup per cada àmbit, cadascun amb accés total al repositori de codi de les seves aplicacions SIC.\r\nEl grup està integrat pels responsables CTTI de l'àmbit. La llista d'àmbits es pot consultar al següent apartat.\r\n- RSPL_LOT: Es defineix un grup de responsables per cada lot amb accés total al repositori de codi de les aplicacions SIC del seu lot.\r\nEl grup està integrat amb els responsables d'arquitectura i qualitat dels lots.\r\n- CPD: Es defineix un grup per cada CPD dels codis de diàleg amb accés al repositori de codi de les aplicacions SIC del seu CPD.\r\n- RML_LOT_AMBIT: Es defineix un grup de release manager per a cada lot i àmbit amb accés total a les aplicacions SIC de l'àmbit que pertanyin al lot.\r\nEl grup s'integra amb les persones sol- licitades per CTTI, aquesta sol- licitud es realitzarà com una petició estàndard al SIC.\r\n- APP_CODI_DIALEG_SVN: Es defineix un grup per a cada codi de diàleg amb accés al repositori de codi.\r\nEl grup s'integra amb les persones sol- licitades per CTTI, aquesta sol- licitud es realitzarà com una petició estàndard al SIC.\r\n\r\n## Llistat d'àmbits disponibles\r\n\r\n| Codi àmbit  \t| Descripció d'àmbit  \t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| :---------- \t| :----------------- \t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| AAM\t\t\t| \tDepartament d'Agricultura, Ramaderia, Pesca, Alimentació i Medi Natural\t|\r\n| ACC\t\t\t| \tAgència Catalana del Consum\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| ACC10\t\t\t|\tACC1Ó\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| ACT\t\t\t|\tAgència Catalana de Turisme\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| ATC\t\t\t|\tAgència Tributària de Catalunya\t\t\t\t\t\t\t\t\t\t\t|\r\n| ATM\t\t\t|\tAutoritat del Transport Metropolità\t\t\t\t\t\t\t\t\t\t|\r\n| BSF\t\t\t|\tDepartament de Benestar Social i Família\t\t\t\t\t\t\t\t|\r\n| CCAC\t\t\t|\tDirecció General d'Atenció Ciutadana i Difusió\t\t\t\t\t\t\t|\r\n| CCAE\t\t\t|\tDGPAE\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| CCE\t\t\t|\tConsell Català de l'Esport\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| CLT\t\t\t|\tDEPARTAMENT DE CULTURA\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| CTT\t\t\t|\tCentre de Telecomunicacions i Tecnologies de la Informació\t\t\t\t|\r\n| DGP\t\t\t|\tDirecció General de la Policia\t\t\t\t\t\t\t\t\t\t\t|\r\n| EAD\t\t\t|\tEADOP\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| EAPC\t\t\t|\tEscola d'Administració Pública de Catalunya\t\t\t\t\t\t\t\t|\r\n| ECO\t\t\t|\tDepartament d'Economia i Coneixement\t\t\t\t\t\t\t\t\t|\r\n| EMO\t\t\t|\tDepartament d'Empresa i Ocupació\t\t\t\t\t\t\t\t\t\t|\r\n| ENS\t\t\t|\tDepartament d'Ensenyament\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| GRI\t\t\t|\tDepartament de Governació i Relacions Institucionals\t\t\t\t\t|\r\n| ICA\t\t\t|\tICAEN\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| ICS\t\t\t|\tICS\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| INT\t\t\t|\tDepartament d'Interior\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| JUS\t\t\t|\tDepartament de Justícia\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| PRE\t\t\t|\tDepartament de la Presidència\t\t\t\t\t\t\t\t\t\t\t|\r\n| SCT\t\t\t|\tServei Català de Trànsit\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| SEM\t\t\t|\tServei d'Emergències Mèdiques\t\t\t\t\t\t\t\t\t\t\t|\r\n| SLT\t\t\t|\tDepartament de Salut\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| SOC\t\t\t|\tServei d'Ocupació de Catalunya (SOC)\t\t\t\t\t\t\t\t\t|\r\n| SUR\t\t\t|\tSecretaria d'Universitats i Recerca\t\t\t\t\t\t\t\t\t\t|\r\n| TES\t\t\t|\tDepartament de Territori i Sostenibilitat\t\t\t\t\t\t\t\t|\r\n\r\n## Repositoris de codi que ja es troben creats de forma massiva\r\n\r\nL'equip de SIC en data 10-9-2014 va realitzar la creació massiva de repositoris de codi per a les aplicacions que figuren en aquest [Inventari d'Aplicacions](/related/sic/Inventari_SIC_140910.xlsx).","objectID":"L3NpYy1yZWxhdGVkL25vdS1tb2RlbC10aWM="},"L3NpYy1yZWxhdGVkL3Byb2NlZGltZW50":{"date":1427760000000,"title":"Procediment d'alta d'aplicacions sense codi de diàleg al SIC","description":"","sections":"SIC","weight":1,"path":"/sic-related/procediment","content":"### Procediment d'alta d'aplicacions sense codi de diàleg al SIC\r\n\r\nPer aquelles aplicacions que no estan donades d'alta a l'Inventari d'Aplicacions de Gestió de Serveis cal tramitar aquesta alta prèviament a poder incorporar-la al SIC. D'aquesta manera se li assignarà un codi de diàleg, dada requerida al formulari d'alta d'aplicacions al SIC, tan si únicament es vol Custodia de Codi com si també es desitja la Construcció i Desplegament de l'aplicació a un CPD Corporatiu.\r\n\r\nL'alta a l'Inventari d'Aplicacions s'ha de realitzar emplenant la [Fitxa d'Alta d'Aplicació](/related/sic/Fitxa-Alta-App.xlsm), concretament les pestanyes \"Caracterització\" i \"NAQ Solució\", i fent-la arribar a la bústia [ogdp.suport@gencat.cat](mailto://ogdp.suport@gencat.cat). En cas de dubtes i per obtenir la darrera versió de la fitxa podeu contactar amb aquesta mateixa bústia.","objectID":"L3NpYy1yZWxhdGVkL3Byb2NlZGltZW50"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1pY2M=":{"date":1426850996000,"title":"ICC","description":"Serveis de normalització d'adreces de l'Institut Cartogràfic de Catalunya.","sections":"Canigó. Documentació versió 3.x","weight":8,"path":"/canigo-documentacio-versions-3x-integracio/modul-icc","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector, és el de proporcionar un punt d'accés als serveis de normalització d'adreces del ICC - Institut Cartogràfic de Catalunya.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional al connector de l'ICC del servei de normalització d'adreces. El servei de geocodificació de l'Institut Cartogràfic de Catalunya permet obtenir una localització geogràfica (coordenades) a partir de la descripció d'un municipi, carrer, adreça , cruïlla (textos), topònim o punt quilomètric d'una carretera.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector icc es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n### Documents i Fonts de Referència\r\n\r\n| Referència\r\n| ---------------\r\n| [Guia d'ús de l'API del Connector ICC](/related/canigo/documentacio/modul-icc/Geocodificador_Manual_Integrador_v1.12.pdf \"Guia d'us de l'API del Connector ICC\").\r\n| [Institut Cartogràfic de Catalunya - ICC](http://www.icc.cat/).\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents funcionalitats referents a les següents operacions:\r\n\r\nFuncionalitats\r\n\r\n* **Localitza adreça:** Funcionalitat que permet obtenir una localització geogràfica (coordenades) a partir de la adreça. ex: C.Balmes,5 (Barcelona).\r\n* **Localitza cruilla:** Funcionalitat que permet obtenir una localització geogràfica a partir d'una cruïlla. ex: Av. Diagonal amb Av.Meridiana (Barcelona)\r\n* **Localitza toponim:** Funcionalitat que permet obtenir una localització geogràfica a partir d'un topònim. ex: platja de la barceloneta.\r\n* **Localitza pk:** Funcionalitat que permet obtenir una localització geogràfica a partir del punt quilomètric d'una carretera. ex: carretera B-100 KM 3.\r\n* **Obtenir informació d'un punt:** Funcionalitat que permet obtenir una informació d'un punt. ex: x-> 430477.74 y ->4582122.725.\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquest component a la següent url:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.icc/\r\n\r\n#### Requeriments\r\n\r\nEl connector ICC és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\n### Instal.lació i Configuració\r\n\r\n#### Instal.lació\r\n\r\nPer tal d'instal-lar el connector ICC es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.icc.version>[1.2.0,1.3.0)</canigo.integration.icc.version>\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.icc</artifactId>\r\n    <version>${canigo.integration.icc.version}</version>\r\n</dependency>\r\n```\r\n\r\n#### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/icc.properties\r\n\r\nPropietat                     | Requerit | Descripció\r\n----------------------------- | -------- | ----------\r\n*.iccService.webServiceServer | Sí       | Endpoint del servei ICC.\r\n*.iccService.contrasenya      | Sí       | contrasenya d'access al servei.\r\n*.iccService.usuari           | Sí       | usuari d'acces al servei.\r\n\r\n\r\nCada aplicació que vulgui utilitzar les funcionalitats del ICC, haurà de seguir el següent procediment:\r\n\r\n1. Emplenar el Document d'Alta que es pot trobar aquí. No s'ha d'emplenar l'apartat d'organisme sol?licitant i persona de contacte. Aquest organisme i persona sempre ha de ser de l'administració. Si una empresa privada desenvolupa l'aplicació, la petició ha de ser feta per algú de l'administració.\r\n2. Emplenar el document d'enquesta que es pot descàrrega d'aquí.\r\n3. Enviar aquests dos documents a la direcció de correu armand.guell@icc.cat demanant l'accés al servei ICC.\r\n\r\nL'usuari i password seran subministrats en aproximadament una setmana després de la petició.\r\n\r\nEls arxius de configuració que contenen els beans del mòdul i que seran carregats per Spring, són automàticament registrats pel core de Canigó, per el que el desenvolupador no ha de definir cap arxiu XML per aixecar el servei.\r\n\r\n### Utilització del servei\r\n\r\nPer accedir al servei ICC, el desenvolupador pot realitzar una crida de forma externa mitjançant el patró 'Dependency Injection'.\r\n\r\nPodem diferenciar dues formes d'injectar-ho:\r\n\r\n* Per XML:\r\n\r\n```\r\n<bean id=\"iccWebServiceClient\" class=\"cat.gencat.ctti.canigo.arch.integration.icc.IccWebServiceClientImpl\">\r\n\t\t<property name=\"webServiceTemplate\" ref=\"webServiceTemplate\"/>\r\n\t\t<property name=\"defaultUri\" value=\"http://www.icc.cat/geocodificador/ws/wss_1.0\" />\t\t\r\n\t</bean>\r\n\r\n\t<bean id=\"webServiceTemplate\" class=\"org.springframework.ws.client.core.WebServiceTemplate\">\r\n\t\t<constructor-arg ref=\"messageFactory\" />\r\n\t\t<property name=\"interceptors\">\r\n\t\t\t<bean class=\"cat.gencat.ctti.canigo.arch.integration.icc.IccSecurity\">\r\n\t\t\t\t<constructor-arg value=\"USUARI\" />\r\n\t\t\t\t<constructor-arg value=\"CONTRASENYA\" />\r\n\t\t\t</bean>\r\n\t\t</property>\r\n\t    <property name=\"messageSender\">\r\n\t        <bean class=\"org.springframework.ws.transport.http.CommonsHttpMessageSender\" />\r\n\t    </property>\r\n\t\t<property name=\"marshaller\" ref=\"marshaller\" />\r\n\t\t<property name=\"unmarshaller\" ref=\"marshaller\" />\r\n\t\t<property name=\"defaultUri\" value=\"http://www.icc.cat/geocodificador/ws/wss_1.0\" />\r\n\t</bean>\r\n\r\n\t<bean id=\"messageFactory\" class=\"org.springframework.ws.soap.saaj.SaajSoapMessageFactory\">\r\n\t\t<property name=\"soapVersion\">\r\n\t\t\t<util:constant static-field=\"org.springframework.ws.soap.SoapVersion.SOAP_12\" />\r\n\t\t</property>\r\n\t</bean>\r\n\t\r\n\t<!-- serializador con JAXB -->\r\n\t<bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\">\r\n\t\t<property name=\"classesToBeBound\">\r\n\t\t\t<list>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Adreca</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.ArrayOfPuntGeografic</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Cruilla</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.IdNom</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Incidencia</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.InfoAdministrativa</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Localitzacio</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.LocalitzacioCruilla</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Localitzacions</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.LocalitzacionsCruilla</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.ObtenirInfoPuntInput</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.PK2</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Pks</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Punt</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.PuntGeografic</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Toponim</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Toponims</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Via</value>\r\n\t\t\t</list>\r\n\t\t</property>\r\n\t</bean>\r\n```\r\n\r\n* Per anotacions:\r\n\r\n```\r\n@Autowired\r\n@Qualifier(\"iccWebServiceClient\")\r\nIccWebServiceClient client;\r\n```\r\n\r\n#### Excepcions del servei ICC\r\n\r\nEl servei ICC pot generar excepcions IccModuleException. Aquest tipus d'excepcions les genera el servei ICC en els casos de:\r\n\r\nLes excepccions es poden donar degut a:\r\n\r\n* TimeOut a la petició del servei\r\n* Error en el format de les dades d'entrada i/o sortida\r\n* Error en el binding automàtic amb les dades.\r\n\r\nEn el cas de produir-se un error el servei ICC registra en el fitxer de logs de l'aplicació l'error produit, i llença una excepció IccModuleException a la aplicació amb l'informcació de l'excepció.\r\n\r\n#### Exemple d'utilització del servei ICC\r\n\r\n##### Localitza Adreça\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaAdreca() {\r\n\t\ttry {\r\n\t\t\tAdreca adreca = getAdreca();\r\n\t\t\tLocalitzacions response;\r\n\t\t\tresponse = client.localitzaAdreca(adreca);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate Via getVia() {\r\n\t\tVia via = new Via();\r\n\t\tvia.setNom(\"Mas Massonet\");\r\n\t\treturn via;\r\n\r\n\t}\r\n\r\n\tprivate Adreca getAdreca() {\r\n\t\tAdreca adreca = new Adreca();\r\n\t\tadreca.setPoblacio(\"Blanes\");\r\n\t\tadreca.setVia(getVia());\r\n\t\tadreca.setPortal(18);\r\n\t\tadreca.setCodiPostal(\"no\");\r\n\t\tadreca.setLlogaret(new IdNom());\r\n\t\treturn adreca;\r\n\t}\r\n}\r\n```\r\n\r\n##### Localitza Cruïlla\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaCruilla() {\r\n\t\ttry {\r\n\t\t\tCruilla cruilla = getCruilla();\r\n\t\t\tLocalitzacionsCruilla response = client.localitzaCruilla(cruilla);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate Cruilla getCruilla() {\r\n\t\tVia via1 = new Via();\r\n\t\tvia1.setTipus(\"c.\");\r\n\t\tvia1.setNom(\"Balmes\");\r\n\t\tVia via2 = new Via();\r\n\t\tvia2.setNom(\"*\");\r\n\t\tCruilla cruilla = new Cruilla();\r\n\t\tcruilla.setPoblacio(\"Barcelona\");\r\n\t\tcruilla.getVies().add(via1);\r\n\t\tcruilla.getVies().add(via2);\r\n\t\tcruilla.setComarca(new IdNom());\r\n\t\treturn cruilla;\r\n\t}\r\n}\r\n```\r\n\r\n##### Localitza Punt Quilomètric\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaPK() {\r\n\t\ttry {\r\n\t\t\tPK2 pk = getPk();\r\n\t\t\tPks response = client.localitzaPK(pk);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate PK2 getPk() {\r\n\t\tPK2 pk = new PK2();\r\n\t\tpk.setNomCarretera(\"AP-7\");\r\n\t\tpk.setKM(\"56\");\r\n\t\tpk.setCoordenadesGeografiques(false);\r\n\t\treturn pk;\r\n\t}\r\n}\r\n```\r\n\r\n##### Localitza Toponim\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaToponim() {\r\n\t\ttry {\r\n\t\t\tToponim toponim = getToponim();\r\n\t\t\tToponims response = client.localitzaToponim(toponim);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate Toponim getToponim() {\r\n\t\tToponim topo = new Toponim();\r\n\t\ttopo.setNom(\"Can Clota\");\r\n\t\ttopo.setCoordenadesGeografiques(false);\r\n\t\treturn topo;\r\n\t}\r\n}\r\n```\r\n\r\n##### Obtenir informació d'un punt\r\n\r\nEl punt pot estar en el datum ED50 o en el datum ETRS89 i les coordenades han d'estar en format UTM.\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testObtenirInfoPuntEd50() {\r\n\t\ttry {\r\n\t\t\tObtenirInfoPuntInput obtenirInfoPuntInput = getObtenirInfoPuntInputUTMED50();\r\n\t\t\tInfoAdministrativa response = client.obtenirInfoPunt(obtenirInfoPuntInput);\r\n\t\t\tAssert.assertTrue(response != null);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic void testObtenirInfoPuntEtrs89() {\r\n\t\ttry {\r\n\t\t\tObtenirInfoPuntInput obtenirInfoPuntInput = getObtenirInfoPuntInputETRS89();\r\n\t\t\tInfoAdministrativa response = client.obtenirInfoPunt(obtenirInfoPuntInput);\r\n\t\t\tAssert.assertTrue(response != null);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate PuntGeografic getPuntGeograficUTMED50() {\r\n\t\tPuntGeografic punt = new PuntGeografic();\r\n\t\tpunt.setX(428263.75);\r\n\t\tpunt.setY(4582861.0);\r\n\t\treturn punt;\r\n\t}\r\n\r\n\tprivate PuntGeografic getPuntGeograficETRS89() {\r\n\t\tPuntGeografic punt = new PuntGeografic();\r\n\t\tpunt.setX(484937.352);\r\n\t\tpunt.setY(4652370.915);\r\n\t\treturn punt;\r\n\t}\r\n\r\n\tprivate PuntGeografic getPuntGeograficBuit() {\r\n\t\tPuntGeografic punt = new PuntGeografic();\r\n\t\treturn punt;\r\n\t}\r\n\r\n\tprivate ObtenirInfoPuntInput getObtenirInfoPuntInputUTMED50() {\r\n\t\tObtenirInfoPuntInput obtenirInfoPuntInput = new ObtenirInfoPuntInput();\r\n\t\tobtenirInfoPuntInput.setPuntUTMED50(getPuntGeograficUTMED50());\r\n\t\tobtenirInfoPuntInput.setPuntUTMETRS89(getPuntGeograficBuit());\r\n\t\treturn obtenirInfoPuntInput;\r\n\t}\r\n\r\n\tprivate ObtenirInfoPuntInput getObtenirInfoPuntInputETRS89() {\r\n\t\tObtenirInfoPuntInput obtenirInfoPuntInput = new ObtenirInfoPuntInput();\r\n\t\tobtenirInfoPuntInput.setPuntUTMED50(getPuntGeograficBuit());\r\n\t\tobtenirInfoPuntInput.setPuntUTMETRS89(getPuntGeograficETRS89());\r\n\t\treturn obtenirInfoPuntInput;\r\n\t}\r\n\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1pY2M="}}